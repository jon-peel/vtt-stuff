{"version":3,"file":"ose.js","sources":["../../src/module/actor/data-model-classes/data-model-character-encumbrance.ts","../../src/module/actor/data-model-classes/data-model-character-encumbrance-basic.ts","../../src/module/actor/data-model-classes/data-model-character-encumbrance-complete.ts","../../src/module/actor/data-model-classes/data-model-character-encumbrance-detailed.ts","../../src/module/actor/data-model-classes/data-model-character-encumbrance-disabled.ts","../../src/module/actor/data-model-classes/data-model-character-encumbrance-item-based.ts","../../src/module/config.ts","../src/module/helpers-dice.js","../src/module/dialog/character-creation.js","../src/module/dialog/character-gp-cost.js","../src/module/dialog/character-modifiers.js","../src/module/dialog/entity-tweaks.js","../src/module/helpers-behaviour.js","../src/module/actor/actor-sheet.js","../src/module/actor/character-sheet.js","../../src/module/actor/data-model-classes/data-model-character-ac.ts","../../src/module/actor/data-model-classes/data-model-character-move.ts","../../src/module/actor/data-model-classes/data-model-character-scores.ts","../../src/module/actor/data-model-classes/data-model-character-spells.ts","../src/module/actor/data-model-character.js","../src/module/actor/data-model-monster.js","../src/module/item/entity.js","../src/module/actor/entity.js","../src/module/actor/monster-sheet.js","../../src/module/helpers-tags.ts","../src/module/item/data-model-ability.js","../src/module/item/data-model-armor.js","../src/module/item/data-model-container.js","../src/module/item/data-model-item.js","../src/module/item/data-model-spell.js","../src/module/item/data-model-weapon.js","../src/module/item/item-sheet.js","../../src/module/helpers-chat.ts","../src/module/helpers-treasure.js","../src/module/helpers-macros.js","../src/module/party/party.js","../src/module/party/party-xp.js","../src/module/party/party-sheet.js","../src/module/helpers-party.js","../../src/module/settings.ts","../../src/module/combat/combat-set-groups.ts","../../src/module/combat/combat.ts","../../src/module/combat/combatant.ts","../../src/module/combat/combat-tracker.ts","../src/module/actor/token-ruler.js","../../src/e2e/testUtils.ts","../../src/module/actor/__tests__/data-model-character.test.ts","../../src/module/actor/data-model-classes/__tests__/data-model-character-ac.test.ts","../../src/module/actor/data-model-classes/__tests__/data-model-character-encumbrance.test.ts","../../src/module/actor/data-model-classes/__tests__/data-model-character-move.test.ts","../../src/module/actor/data-model-classes/__tests__/data-model-character-scores.test.ts","../../src/module/actor/data-model-classes/__tests__/data-model-character-spells.test.ts","../../src/module/actor/__tests__/data-model-monster.test.ts","../../src/module/actor/__tests__/entity-actor.test.ts","../../src/module/actor/__tests__/sheet-actor.test.ts","../../src/module/actor/__tests__/sheet-actor/sheet-actor-e2e-dragndrop.test.ts","../../src/module/actor/__tests__/sheet-character.test.ts","../../src/module/actor/__tests__/sheet-monster.test.ts","../../src/module/combat/__tests__/combat.test.ts","../../src/module/dialog/__tests__/sheet-character-modifiers.test.ts","../../src/module/dialog/__tests__/sheet-entity-tweaks.test.ts","../../src/module/item/__tests__/data-model-item-ability.test.ts","../../src/module/item/__tests__/data-model-item-armor.test.ts","../../src/module/item/__tests__/data-model-item-container.test.ts","../../src/module/item/__tests__/data-model-item-misc.test.ts","../../src/module/item/__tests__/data-model-item-spell.test.ts","../../src/module/item/__tests__/data-model-item-weapon.test.ts","../../src/module/item/__tests__/entity-item.test.ts","../../src/module/item/__tests__/sheet-item.test.ts","../../src/module/party/__tests__/entity-party.test.ts","../../src/module/party/__tests__/sheet-party.test.ts","../../src/module/party/__tests__/sheet-party-xp.test.ts","../../src/module/__tests__/helpers-behaviour.test.ts","../../src/module/__tests__/helpers-chat.test.ts","../../src/module/__tests__/helpers-dice.test.ts","../../src/module/__tests__/helpers-handlebars.test.ts","../../src/module/__tests__/helpers-macros.test.ts","../../src/module/__tests__/helpers-party.test.ts","../../src/module/__tests__/helpers-treasure.test.ts","../../src/e2e/index.ts","../src/ose.js","../../src/module/helpers-handlebars.ts","../src/module/fvttModuleAPIs.js","../../src/module/preloadTemplates.ts","../../src/module/rings.ts","../src/module/renderList.js"],"sourcesContent":["/**\n * @file The base class for all encumbrance schemes. Feel free to extend this to make your own schemes!\n */\nexport interface CharacterEncumbrance {\n  variant: string;\n  enabled: boolean;\n  pct: number;\n  encumbered: boolean;\n  steps: number[];\n  value: number;\n  max: number;\n  atFirstBreakpoint: boolean | null;\n  atSecondBreakpoint: boolean | null;\n  atThirdBreakpoint: boolean | null;\n}\n\n/**\n * A class to handle character encumbrance.\n */\nexport default class OseDataModelCharacterEncumbrance\n  implements CharacterEncumbrance\n{\n  static baseEncumbranceCap = 1600;\n\n  // Default encumbrance steps used by the 'complete' and 'detailed' encumbrance variants\n  static encumbranceSteps = {\n    quarter: (1 / 4) * 100,\n    threeEighths: (3 / 8) * 100,\n    half: (1 / 2) * 100,\n  };\n\n  #encumbranceVariant;\n\n  #max;\n\n  #weight = 0;\n\n  /**\n   * The constructor\n   *\n   * @param {string} variant - The name of this encumbrance variant.\n   * @param {number} max - The max weight this character can carry\n   * @param {Item[]} items - The items this character is carrying. Note: we're not using this in the base class.\n   */\n  constructor(\n    variant = \"disabled\",\n    max = OseDataModelCharacterEncumbrance.baseEncumbranceCap\n  ) {\n    this.#encumbranceVariant = variant;\n    this.#max = max;\n  }\n\n  static defineSchema() {\n    const { ArrayField, BooleanField, NumberField, SchemaField, StringField } =\n      foundry.data.fields;\n\n    return new SchemaField({\n      variant: new StringField({ initial: \"disabled\" }),\n      enabled: new BooleanField({ initial: true }),\n      encumbered: new BooleanField({ initial: false }),\n      pct: new NumberField({ integer: false, initial: 0, min: 0, max: 100 }),\n      steps: new ArrayField(new NumberField()),\n      value: new NumberField({ integer: false }),\n      max: new NumberField({\n        integer: false,\n        initial: OseDataModelCharacterEncumbrance.baseEncumbranceCap,\n      }),\n      atFirstBreakpoint: new BooleanField({ initial: false }),\n      atSecondBreakpoint: new BooleanField({ initial: false }),\n      atThirdBreakpoint: new BooleanField({ initial: false }),\n    });\n  }\n\n  get variant() {\n    return this.#encumbranceVariant;\n  }\n\n  get enabled() {\n    return this.#encumbranceVariant !== \"disabled\";\n  }\n\n  get pct() {\n    return Math.clamp((this.value / this.max) * 100, 0, 100);\n  }\n\n  get encumbered() {\n    return this.value > this.max;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  get steps(): number[] {\n    return [];\n  }\n\n  get value(): number {\n    return this.#weight;\n  }\n\n  get max() {\n    return this.#max;\n  }\n\n  set max(value) {\n    this.#max = value;\n  }\n\n  get #delta() {\n    return this.max - OseDataModelCharacterEncumbrance.baseEncumbranceCap;\n  }\n\n  get atThirdBreakpoint() {\n    return this.pct > OseDataModelCharacterEncumbrance.encumbranceSteps.half;\n  }\n\n  get atSecondBreakpoint() {\n    return (\n      this.pct > OseDataModelCharacterEncumbrance.encumbranceSteps.threeEighths\n    );\n  }\n\n  get atFirstBreakpoint() {\n    return this.pct > OseDataModelCharacterEncumbrance.encumbranceSteps.quarter;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  get defaultMax() {\n    return (this.constructor as typeof OseDataModelCharacterEncumbrance)\n      .baseEncumbranceCap;\n  }\n\n  get alternateMax() {\n    return this.defaultMax;\n  }\n}\n","/**\n * @file A class representing the \"Basic\" encumbrance scheme from Old School Essentials: Classic Fantasy\n */\nimport OseDataModelCharacterEncumbrance, {\n  CharacterEncumbrance,\n} from \"./data-model-character-encumbrance\";\n\n// import { OSE } from '../../config';\n\n/**\n * A set of options for configuring the\n * Basic encumbrance scheme\n */\ntype Options = {\n  significantTreasure: number;\n};\n\n/**\n * @todo Add template path for encumbrance bar\n * @todo Add template path for inventory item row\n */\nexport default class OseDataModelCharacterEncumbranceBasic\n  extends OseDataModelCharacterEncumbrance\n  implements CharacterEncumbrance\n{\n  static templateEncumbranceBar = \"\";\n\n  static templateInventoryRow = \"\";\n\n  /**\n   * The machine-readable label for this encumbrance scheme\n   */\n  static type = \"basic\";\n\n  /**\n   * The human-readable label for this encumbrance scheme\n   */\n  static localizedLabel = \"OSE.Setting.EncumbranceBasic\";\n\n  /**\n   * The base value for the amount of treasure that slows a character down\n   */\n  static significantTreasure = 800;\n\n  /**\n   * A map of strings to numbers indicating how heavy a set of armor is.\n   * The heavier the armor, the slower you move.\n   */\n  static armorWeight = {\n    unarmored: 0,\n    light: 1,\n    heavy: 2,\n  };\n\n  #weight;\n\n  #treasureEncumbrance;\n\n  #heaviestArmor;\n\n  constructor(\n    max = OseDataModelCharacterEncumbrance.baseEncumbranceCap,\n    items: Item[] = [],\n    options: Options = {} as Options\n  ) {\n    super(OseDataModelCharacterEncumbranceBasic.type, max);\n    this.#treasureEncumbrance =\n      options?.significantTreasure ||\n      OseDataModelCharacterEncumbranceBasic.significantTreasure;\n\n    this.#weight = items.reduce(\n      (acc: number, { type, system: { treasure, quantity, weight } }: Item) =>\n        type !== \"item\" || !treasure ? acc : acc + quantity.value * weight,\n      0\n    );\n\n    this.#heaviestArmor = items.reduce(\n      (heaviest, { type, system: { type: armorType, equipped } }) => {\n        if (type !== \"armor\" || !equipped) return heaviest;\n        if (\n          armorType === \"light\" &&\n          heaviest ===\n            OseDataModelCharacterEncumbranceBasic.armorWeight.unarmored\n        )\n          return OseDataModelCharacterEncumbranceBasic.armorWeight.light;\n        if (armorType === \"heavy\")\n          return OseDataModelCharacterEncumbranceBasic.armorWeight.heavy;\n        return heaviest;\n      },\n      OseDataModelCharacterEncumbranceBasic.armorWeight.unarmored\n    );\n  }\n\n  static defineSchema() {\n    const { ArrayField, BooleanField, NumberField, SchemaField, StringField } =\n      foundry.data.fields;\n\n    return new SchemaField({\n      variant: new StringField({\n        initial: OseDataModelCharacterEncumbranceBasic.type,\n      }),\n      enabled: new BooleanField({ initial: true }),\n      encumbered: new BooleanField({ initial: false }),\n      overTreasureThreshold: new BooleanField({ initial: false }),\n      overSignificantTreasureThreshold: new BooleanField({ initial: false }),\n      pct: new NumberField({ integer: false, initial: 0, min: 0, max: 100 }),\n      steps: new ArrayField(new NumberField()),\n      value: new NumberField({ integer: false }),\n      max: new NumberField({\n        integer: false,\n        initial: OseDataModelCharacterEncumbrance.baseEncumbranceCap,\n      }),\n      atFirstBreakpoint: new BooleanField({ initial: false }),\n      atSecondBreakpoint: new BooleanField({ initial: false }),\n      atThirdBreakpoint: new BooleanField({ initial: false }),\n    });\n  }\n\n  get steps() {\n    return [(100 * this.#treasureEncumbrance) / this.max];\n  }\n\n  get overTreasureThreshold() {\n    return this.value >= this.#treasureEncumbrance;\n  }\n\n  get value() {\n    return this.#weight;\n  }\n\n  get overSignificantTreasureThreshold() {\n    return this.value >= this.#treasureEncumbrance;\n  }\n\n  get atThirdBreakpoint() {\n    return (\n      this.#heaviestArmor ===\n        OseDataModelCharacterEncumbranceBasic.armorWeight.heavy &&\n      this.value >= this.#treasureEncumbrance\n    );\n  }\n\n  get atSecondBreakpoint() {\n    const isHeavy =\n      this.#heaviestArmor ===\n      OseDataModelCharacterEncumbranceBasic.armorWeight.heavy;\n    const isLightWithTreasure =\n      this.#heaviestArmor ===\n        OseDataModelCharacterEncumbranceBasic.armorWeight.light &&\n      this.value >= this.#treasureEncumbrance;\n    return isHeavy || isLightWithTreasure;\n  }\n\n  get atFirstBreakpoint() {\n    return (\n      this.#heaviestArmor ===\n        OseDataModelCharacterEncumbranceBasic.armorWeight.light ||\n      this.overSignificantTreasureThreshold\n    );\n  }\n}\n","/**\n * @file A class representing the \"Complete\" encumbrance scheme from Old School Essentials: Classic Fantasy\n */\nimport OseDataModelCharacterEncumbrance, {\n  CharacterEncumbrance,\n} from \"./data-model-character-encumbrance\";\n\n// import { OSE } from '../../config';\n\n/**\n * @todo Add template path for encumbrance bar\n * @todo Add template path for inventory item row\n */\nexport default class OseDataModelCharacterEncumbranceComplete\n  extends OseDataModelCharacterEncumbrance\n  implements CharacterEncumbrance\n{\n  static templateEncumbranceBar = \"\";\n\n  static templateInventoryRow = \"\";\n\n  /**\n   * The machine-readable label for this encumbrance scheme\n   */\n  static type = \"complete\";\n\n  /**\n   * The human-readable label for this encumbrance scheme\n   */\n  static localizedLabel = \"OSE.Setting.EncumbranceComplete\";\n\n  #weight;\n\n  constructor(\n    max = OseDataModelCharacterEncumbrance.baseEncumbranceCap,\n    items: Item[] = []\n  ) {\n    super(OseDataModelCharacterEncumbranceComplete.type, max);\n    this.#weight = items.reduce(\n      (acc, { type, system: { quantity, weight } }: Item) => {\n        if (type === \"item\") return acc + quantity.value * weight;\n        if ([\"weapon\", \"armor\", \"container\"].includes(type))\n          return acc + weight;\n        return acc;\n      },\n      0\n    );\n  }\n\n  static defineSchema() {\n    const { ArrayField, BooleanField, NumberField, SchemaField, StringField } =\n      foundry.data.fields;\n\n    return new SchemaField({\n      variant: new StringField({\n        initial: OseDataModelCharacterEncumbranceComplete.type,\n      }),\n      enabled: new BooleanField({ initial: true }),\n      encumbered: new BooleanField({ initial: false }),\n      pct: new NumberField({ integer: false, initial: 0, min: 0, max: 100 }),\n      steps: new ArrayField(new NumberField()),\n      value: new NumberField({ integer: false }),\n      max: new NumberField({\n        integer: false,\n        initial: OseDataModelCharacterEncumbrance.baseEncumbranceCap,\n      }),\n      atFirstBreakpoint: new BooleanField({ initial: false }),\n      atSecondBreakpoint: new BooleanField({ initial: false }),\n      atThirdBreakpoint: new BooleanField({ initial: false }),\n    });\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  get steps() {\n    return Object.values(OseDataModelCharacterEncumbrance.encumbranceSteps);\n  }\n\n  get value(): number {\n    return this.#weight;\n  }\n}\n","/**\n * @file A class representing the \"Detailed\" encumbrance scheme from Old School Essentials: Classic Fantasy\n */\nimport OseDataModelCharacterEncumbrance, {\n  CharacterEncumbrance,\n} from \"./data-model-character-encumbrance\";\n\n// import { OSE } from '../../config';\n\n/**\n * @todo Add template path for encumbrance bar\n * @todo Add template path for inventory item row\n */\nexport default class OseDataModelCharacterEncumbranceDetailed\n  extends OseDataModelCharacterEncumbrance\n  implements CharacterEncumbrance\n{\n  static templateEncumbranceBar = \"\";\n\n  static templateInventoryRow = \"\";\n\n  /**\n   * The machine-readable label for this encumbrance scheme\n   */\n  static type = \"detailed\";\n\n  /**\n   * The human-readable label for this encumbrance scheme\n   */\n  static localizedLabel = \"OSE.Setting.EncumbranceDetailed\";\n\n  /**\n   * The weight (in coins) to add to the total weight value if the character has adventuring gear\n   */\n  static gearWeight = 80;\n\n  #weight = 0;\n\n  #hasAdventuringGear;\n\n  constructor(\n    max = OseDataModelCharacterEncumbrance.baseEncumbranceCap,\n    items: Item[] = []\n  ) {\n    super(OseDataModelCharacterEncumbranceDetailed.type, max);\n    this.#hasAdventuringGear = items.some(\n      (i: Item) => i.type === \"item\" && !i.system.treasure\n    );\n    this.#weight =\n      items.reduce(\n        (acc, { type, system: { treasure, quantity, weight } }: Item) => {\n          if (type === \"spell\" || type === \"ability\") return acc;\n\n          let value = acc;\n\n          if (type === \"item\" && treasure) value += quantity.value * weight;\n          if ([\"weapon\", \"armor\", \"container\"].includes(type)) value += weight;\n\n          return value;\n        },\n        0\n      ) +\n      (this.#hasAdventuringGear\n        ? OseDataModelCharacterEncumbranceDetailed.gearWeight\n        : 0);\n  }\n\n  static defineSchema() {\n    const { ArrayField, BooleanField, NumberField, SchemaField, StringField } =\n      foundry.data.fields;\n\n    return new SchemaField({\n      variant: new StringField({\n        initial: OseDataModelCharacterEncumbranceDetailed.type,\n      }),\n      enabled: new BooleanField({ initial: true }),\n      encumbered: new BooleanField({ initial: false }),\n      pct: new NumberField({ integer: false, initial: 0, min: 0, max: 100 }),\n      steps: new ArrayField(new NumberField()),\n      value: new NumberField({ integer: false }),\n      max: new NumberField({\n        integer: false,\n        initial: OseDataModelCharacterEncumbrance.baseEncumbranceCap,\n      }),\n      atFirstBreakpoint: new BooleanField({ initial: false }),\n      atSecondBreakpoint: new BooleanField({ initial: false }),\n      atThirdBreakpoint: new BooleanField({ initial: false }),\n    });\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  get steps() {\n    return Object.values(OseDataModelCharacterEncumbrance.encumbranceSteps);\n  }\n\n  get value(): number {\n    return this.#weight;\n  }\n}\n","/**\n * @file A class representing the \"Disabled\" encumbrance scheme;\n *       we aren't tracking carry weight here.\n */\nimport OseDataModelCharacterEncumbrance, {\n  CharacterEncumbrance,\n} from \"./data-model-character-encumbrance\";\n\n// import { OSE } from '../../config';\n\n/**\n * @todo Add template path for encumbrance bar\n * @todo Add template path for inventory item row\n */\nexport default class OseDataModelCharacterEncumbranceDisabled\n  extends OseDataModelCharacterEncumbrance\n  implements CharacterEncumbrance\n{\n  static templateEncumbranceBar = \"\";\n\n  static templateInventoryRow = \"\";\n\n  /**\n   * The machine-readable label for this encumbrance scheme\n   */\n  static type = \"disabled\";\n\n  /**\n   * The human-readable label for this encumbrance scheme\n   */\n  static localizedLabel = \"OSE.Setting.EncumbranceDisabled\";\n\n  constructor() {\n    super(OseDataModelCharacterEncumbranceDisabled.type);\n  }\n\n  static defineSchema() {\n    const { ArrayField, BooleanField, NumberField, SchemaField, StringField } =\n      foundry.data.fields;\n\n    return new SchemaField({\n      variant: new StringField({\n        initial: OseDataModelCharacterEncumbranceDisabled.type,\n      }),\n      enabled: new BooleanField({ initial: true }),\n      encumbered: new BooleanField({ initial: false }),\n      pct: new NumberField({ integer: false, initial: 0, min: 0, max: 100 }),\n      steps: new ArrayField(new NumberField()),\n      value: new NumberField({ integer: false }),\n      max: new NumberField({ integer: false }),\n      atFirstBreakpoint: new BooleanField({ initial: false }),\n      atSecondBreakpoint: new BooleanField({ initial: false }),\n      atThirdBreakpoint: new BooleanField({ initial: false }),\n    });\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  get value(): number {\n    return 0;\n  }\n}\n","/**\n * @file A class representing the \"Item-based\" encumbrance scheme from Carcass Crawler Issue Two\n */\nimport OseDataModelCharacterEncumbrance, {\n  CharacterEncumbrance,\n} from \"./data-model-character-encumbrance\";\n\n/**\n * @todo Add template path for encumbrance bar\n * @todo Add template path for inventory item row\n */\nexport default class OseDataModelCharacterEncumbranceItemBased\n  extends OseDataModelCharacterEncumbrance\n  implements CharacterEncumbrance\n{\n  static baseEncumbranceCap = 9;\n\n  static alternateBaseEncumbranceCap = 16;\n\n  static packedEncumbranceSteps = {\n    fiveEighths: (10 / 16) * 100,\n    threeQuarters: (12 / 16) * 100,\n    sevenEighths: (14 / 16) * 100,\n  };\n\n  static packedStepCounts = {\n    stepOne: 10,\n    stepTwo: 12,\n    stepThree: 14,\n  };\n\n  static equippedEncumbranceSteps = {\n    oneThird: (3 / 9) * 100,\n    fiveNinths: (5 / 9) * 100,\n    sevenNinths: (7 / 9) * 100,\n  };\n\n  static equippedStepCounts = {\n    stepOne: 3,\n    stepTwo: 5,\n    stepThree: 7,\n  };\n\n  #equippedMax;\n\n  #packedMax;\n\n  #max;\n\n  #atFiveEighths;\n\n  #atThreeQuarters;\n\n  #atSevenEights;\n\n  #atOneThird;\n\n  #atFiveNinths;\n\n  #atSevenNinths;\n\n  static templateEncumbranceBar = \"\";\n\n  static templateInventoryRow = \"\";\n\n  /**\n   * The machine-readable label for this encumbrance scheme\n   */\n  static type = \"itembased\";\n\n  /**\n   * The human-readable label for this encumbrance scheme\n   */\n  static localizedLabel = \"OSE.Setting.EncumbranceItemBased\";\n\n  #weight;\n\n  #equippedWeight;\n\n  #packedWeight;\n\n  #weightMod;\n\n  // eslint-disable-next-line sonarjs/cognitive-complexity, @typescript-eslint/no-unused-vars\n  constructor(max = 16, items: OseItem[] = [], options = {}) {\n    super(OseDataModelCharacterEncumbranceItemBased.type, max);\n    if (game.settings.get(game.system.id, \"encumbranceItemStrengthMod\")) {\n      this.#weightMod =\n        options.scores?.str?.mod > 0 ? options.scores.str.mod : 0;\n    } else {\n      this.#weightMod = 0;\n    }\n\n    const isDefaultMax =\n      !max ||\n      max === OseDataModelCharacterEncumbrance.baseEncumbranceCap ||\n      max ===\n        OseDataModelCharacterEncumbranceItemBased.alternateBaseEncumbranceCap;\n\n    this.#packedMax = isDefaultMax ? 16 : max;\n    this.#equippedMax = isDefaultMax ? 9 : max;\n    this.#packedWeight =\n      Math.ceil(\n        items.reduce((acc, item: OseItem) => {\n          if (item.type === \"item\" && item.system.isCoinsOrGems) {\n            // Coins and gems are handled below\n            return acc;\n          }\n          if (\n            (item.type === \"item\" || item.type === \"container\") &&\n            !item.system.equipped\n          ) {\n            return (\n              acc +\n              Math.ceil(item.system.quantity.value * item.system.itemslots)\n            );\n          }\n          if (\n            [\"weapon\", \"armor\"].includes(item.type) &&\n            !item.system.equipped\n          ) {\n            return acc + item.system.itemslots;\n          }\n\n          return acc;\n        }, 0)\n      ) +\n      Math.ceil(\n        items.reduce((acc, item: OseItem) => {\n          if (item.type === \"item\" && item.system.isCoinsOrGems) {\n            // Up to 100 coins or gems count as 1 item.\n            return acc + item.system.quantity.value / 100;\n          }\n\n          return acc;\n        }, 0)\n      );\n    this.#equippedWeight = Math.ceil(\n      items.reduce(\n        (acc, { type, system: { quantity, itemslots, equipped } }: Item) => {\n          if (type === \"item\" && equipped)\n            return acc + Math.ceil(quantity.value * itemslots);\n          if ([\"weapon\", \"armor\"].includes(type) && equipped)\n            return acc + itemslots;\n          return acc;\n        },\n        0\n      )\n    );\n    this.#weight = this.usingEquippedEncumbrance\n      ? this.#equippedWeight\n      : this.#packedWeight;\n\n    this.#max = this.usingEquippedEncumbrance\n      ? this.#equippedMax\n      : this.#packedMax;\n\n    this.#atFiveEighths =\n      this.#packedWeight >\n      OseDataModelCharacterEncumbranceItemBased.packedStepCounts.stepOne;\n    this.#atThreeQuarters =\n      this.#packedWeight >\n      OseDataModelCharacterEncumbranceItemBased.packedStepCounts.stepTwo;\n    this.#atSevenEights =\n      this.#packedWeight >\n      OseDataModelCharacterEncumbranceItemBased.packedStepCounts.stepThree;\n\n    this.#atOneThird =\n      this.#equippedWeight >\n      OseDataModelCharacterEncumbranceItemBased.equippedStepCounts.stepOne;\n    this.#atFiveNinths =\n      this.#equippedWeight >\n      OseDataModelCharacterEncumbranceItemBased.equippedStepCounts.stepTwo;\n    this.#atSevenNinths =\n      this.#equippedWeight >\n      OseDataModelCharacterEncumbranceItemBased.equippedStepCounts.stepThree;\n  }\n\n  static defineSchema() {\n    const { ArrayField, BooleanField, NumberField, SchemaField, StringField } =\n      foundry.data.fields;\n\n    return new SchemaField({\n      variant: new StringField({\n        initial: OseDataModelCharacterEncumbranceItemBased.type,\n      }),\n      enabled: new BooleanField({ initial: true }),\n      encumbered: new BooleanField({ initial: false }),\n      pct: new NumberField({ integer: false, initial: 0, min: 0, max: 100 }),\n      steps: new ArrayField(new NumberField()),\n      value: new NumberField({ integer: false }),\n      max: new NumberField({\n        integer: false,\n        initial: OseDataModelCharacterEncumbranceItemBased.baseEncumbranceCap,\n      }),\n      atFirstBreakpoint: new BooleanField({ initial: false }),\n      atSecondBreakpoint: new BooleanField({ initial: false }),\n      atThirdBreakpoint: new BooleanField({ initial: false }),\n      equippedSteps: new ArrayField(new NumberField()),\n      packedSteps: new ArrayField(new NumberField()),\n      equippedPct: new NumberField({ integer: false, min: 0, max: 100 }),\n      packedPct: new NumberField({ integer: false, min: 0, max: 100 }),\n      equippedValue: new NumberField({ integer: false }),\n      packedValue: new NumberField({ integer: false }),\n      equippedLabel: new StringField({ initial: \"0/0\" }),\n      packedLabel: new StringField({ initial: \"0/0\" }),\n      usingEquippedEncumbrance: new BooleanField({ initial: true }),\n      weightMod: new NumberField({ integer: true, initial: 0 }),\n    });\n  }\n\n  get steps() {\n    return this.usingEquippedEncumbrance\n      ? Object.values(\n          OseDataModelCharacterEncumbranceItemBased.equippedEncumbranceSteps\n        )\n      : Object.values(\n          OseDataModelCharacterEncumbranceItemBased.packedEncumbranceSteps\n        );\n  }\n\n  get usingEquippedEncumbrance() {\n    const equippedValues = Object.values(\n      OseDataModelCharacterEncumbranceItemBased.equippedStepCounts\n    );\n    const packedValues = Object.values(\n      OseDataModelCharacterEncumbranceItemBased.packedStepCounts\n    );\n    let equippedIndex = equippedValues.findIndex(\n      (step) => step >= this.#equippedWeight\n    );\n    equippedIndex = equippedIndex === -1 ? 4 : equippedIndex;\n\n    let packedIndex = packedValues.findIndex(\n      (step) => step >= this.#packedWeight - this.#weightMod\n    );\n    packedIndex = packedIndex === -1 ? 4 : packedIndex;\n    if (equippedIndex === 0 && packedIndex === 0) {\n      // both are under the first breakpoint, use weight comparison\n      return this.#equippedWeight >= this.#packedWeight - this.#weightMod;\n    }\n\n    return equippedIndex >= packedIndex;\n  }\n\n  get value(): number {\n    return this.#weight;\n  }\n\n  get max(): number {\n    return this.#max;\n  }\n\n  get atFirstBreakpoint(): boolean {\n    return this.usingEquippedEncumbrance\n      ? this.#atOneThird\n      : this.#atFiveEighths;\n  }\n\n  get atSecondBreakpoint(): boolean {\n    return this.usingEquippedEncumbrance\n      ? this.#atFiveNinths\n      : this.#atThreeQuarters;\n  }\n\n  get atThirdBreakpoint(): boolean {\n    return this.usingEquippedEncumbrance\n      ? this.#atSevenNinths\n      : this.#atSevenEights;\n  }\n\n  get encumbered() {\n    return this.value > this.max + this.#weightMod;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  get equippedSteps() {\n    return Object.values(\n      OseDataModelCharacterEncumbranceItemBased.equippedEncumbranceSteps\n    );\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  get packedSteps() {\n    return Object.values(\n      OseDataModelCharacterEncumbranceItemBased.packedEncumbranceSteps\n    );\n  }\n\n  get equippedPct() {\n    return Math.clamp((this.#equippedWeight / this.#equippedMax) * 100, 0, 100);\n  }\n\n  get packedPct() {\n    return Math.clamp(\n      ((this.#packedWeight - this.#weightMod) / this.#packedMax) * 100,\n      0,\n      100\n    );\n  }\n\n  get equippedValue(): number {\n    return this.#equippedWeight;\n  }\n\n  get packedValue(): number {\n    return this.#packedWeight;\n  }\n\n  get equippedLabel(): string {\n    return `${this.#equippedWeight}/${this.#equippedMax}`;\n  }\n\n  get packedLabel(): string {\n    return `${this.#packedWeight}/${this.#packedMax + this.#weightMod}`;\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  get alternateMax() {\n    return OseDataModelCharacterEncumbranceItemBased.alternateBaseEncumbranceCap;\n  }\n}\n","/**\n * @file System-wide configuration settings. Should be reachable elsewhere in the system at `CONFIG.OSE`\n */\nimport OseDataModelCharacterEncumbranceBasic from \"./actor/data-model-classes/data-model-character-encumbrance-basic\";\nimport OseDataModelCharacterEncumbranceComplete from \"./actor/data-model-classes/data-model-character-encumbrance-complete\";\nimport OseDataModelCharacterEncumbranceDetailed from \"./actor/data-model-classes/data-model-character-encumbrance-detailed\";\nimport OseDataModelCharacterEncumbranceDisabled from \"./actor/data-model-classes/data-model-character-encumbrance-disabled\";\nimport OseDataModelCharacterEncumbranceItemBased from \"./actor/data-model-classes/data-model-character-encumbrance-item-based\";\n\nexport type OseConfig = typeof OSE;\n\nexport type Attribute = keyof OseConfig[\"scores\"];\nexport type ExplorationSkill = keyof OseConfig[\"exploration_skills\"];\nexport type RollType = keyof OseConfig[\"roll_type\"];\nexport type Save = keyof OseConfig[\"saves_long\"];\nexport type Armor = keyof OseConfig[\"armor\"];\nexport type Color = keyof OseConfig[\"colors\"];\nexport type InventoryItemTag = keyof OseConfig[\"tags\"];\nexport type EncumbranceOption = keyof OseConfig[\"encumbranceOptions\"];\nexport type ApplyDamageOption = keyof OseConfig[\"apply_damage_options\"];\n\nexport const OSE = {\n  /** Path for system dist */\n  systemPath(): string {\n    return `${this.systemRoot}/dist`;\n  },\n  /** Root path for OSE system */\n  get systemRoot(): string {\n    return `/systems/${game.system.id}`;\n  },\n  /** Path for system assets */\n  get assetsPath(): string {\n    return `${this.systemRoot}/assets`;\n  },\n  get encumbrance() {\n    const variant = game.settings.get(game.system.id, \"encumbranceOption\");\n    return this.encumbranceOptions[variant] || this.encumbranceOptions.disabled;\n  },\n  encumbranceOptions: {\n    basic: OseDataModelCharacterEncumbranceBasic,\n    detailed: OseDataModelCharacterEncumbranceDetailed,\n    complete: OseDataModelCharacterEncumbranceComplete,\n    disabled: OseDataModelCharacterEncumbranceDisabled,\n    itembased: OseDataModelCharacterEncumbranceItemBased,\n  },\n  scores: {\n    str: \"OSE.scores.str.long\",\n    int: \"OSE.scores.int.long\",\n    dex: \"OSE.scores.dex.long\",\n    wis: \"OSE.scores.wis.long\",\n    con: \"OSE.scores.con.long\",\n    cha: \"OSE.scores.cha.long\",\n  },\n  scores_short: {\n    str: \"OSE.scores.str.short\",\n    int: \"OSE.scores.int.short\",\n    dex: \"OSE.scores.dex.short\",\n    wis: \"OSE.scores.wis.short\",\n    con: \"OSE.scores.con.short\",\n    cha: \"OSE.scores.cha.short\",\n  },\n  exploration_skills: {\n    ld: \"OSE.exploration.ld.long\",\n    od: \"OSE.exploration.od.long\",\n    sd: \"OSE.exploration.sd.long\",\n    fs: \"OSE.exploration.ft.long\",\n  },\n  exploration_skills_short: {\n    ld: \"OSE.exploration.ld.abrev\",\n    od: \"OSE.exploration.od.abrev\",\n    sd: \"OSE.exploration.sd.abrev\",\n    fs: \"OSE.exploration.ft.abrev\",\n  },\n  roll_type: {\n    result: \"=\",\n    above: \"≥\",\n    below: \"≤\",\n  },\n  saves_short: {\n    death: \"OSE.saves.death.short\",\n    wand: \"OSE.saves.wand.short\",\n    paralysis: \"OSE.saves.paralysis.short\",\n    breath: \"OSE.saves.breath.short\",\n    spell: \"OSE.saves.spell.short\",\n  },\n  saves_long: {\n    death: \"OSE.saves.death.long\",\n    wand: \"OSE.saves.wand.long\",\n    paralysis: \"OSE.saves.paralysis.long\",\n    breath: \"OSE.saves.breath.long\",\n    spell: \"OSE.saves.spell.long\",\n  },\n  armor: {\n    unarmored: \"OSE.armor.unarmored\",\n    light: \"OSE.armor.light\",\n    heavy: \"OSE.armor.heavy\",\n    shield: \"OSE.armor.shield\",\n  },\n  apply_damage_options: {\n    selected: \"selected\",\n    targeted: \"targeted\",\n    originalTarget: \"originalTarget\",\n  },\n  colors: {\n    green: \"OSE.colors.green\",\n    red: \"OSE.colors.red\",\n    yellow: \"OSE.colors.yellow\",\n    purple: \"OSE.colors.purple\",\n    blue: \"OSE.colors.blue\",\n    orange: \"OSE.colors.orange\",\n    white: \"OSE.colors.white\",\n  },\n  languages: [\n    \"Common\",\n    \"Lawful\",\n    \"Chaotic\",\n    \"Neutral\",\n    \"Bugbear\",\n    \"Doppelgänger\",\n    \"Dragon\",\n    \"Dwarvish\",\n    \"Elvish\",\n    \"Gargoyle\",\n    \"Gnoll\",\n    \"Gnomish\",\n    \"Goblin\",\n    \"Halfling\",\n    \"Harpy\",\n    \"Hobgoblin\",\n    \"Kobold\",\n    \"Lizard Man\",\n    \"Medusa\",\n    \"Minotaur\",\n    \"Ogre\",\n    \"Orcish\",\n    \"Pixie\",\n  ],\n  tags: {\n    melee: \"OSE.items.Melee\",\n    missile: \"OSE.items.Missile\",\n    slow: \"OSE.items.Slow\",\n    twohanded: \"OSE.items.TwoHanded\",\n    blunt: \"OSE.items.Blunt\",\n    brace: \"OSE.items.Brace\",\n    splash: \"OSE.items.Splash\",\n    reload: \"OSE.items.Reload\",\n    charge: \"OSE.items.Charge\",\n  },\n  auto_tags: {\n    get melee() {\n      return {\n        label: CONFIG.OSE.tags.melee,\n        image: `${CONFIG.OSE.assetsPath}/melee.png`,\n        icon: \"fa-sword\",\n      };\n    },\n    get missile() {\n      return {\n        label: CONFIG.OSE.tags.missile,\n        image: `${CONFIG.OSE.assetsPath}/missile.png`,\n        icon: \"fa-bow-arrow\",\n      };\n    },\n    get slow() {\n      return {\n        label: CONFIG.OSE.tags.slow,\n        image: `${CONFIG.OSE.assetsPath}/slow.png`,\n        icon: \"fa-weight-hanging\",\n      };\n    },\n    get twohanded() {\n      return {\n        label: CONFIG.OSE.tags.twohanded,\n        image: `${CONFIG.OSE.assetsPath}/twohanded.png`,\n        icon: \"fa-hands-holding\",\n      };\n    },\n    get blunt() {\n      return {\n        label: CONFIG.OSE.tags.blunt,\n        image: `${CONFIG.OSE.assetsPath}/blunt.png`,\n        icon: \"fa-hammer-crash\",\n      };\n    },\n    get brace() {\n      return {\n        label: CONFIG.OSE.tags.brace,\n        image: `${CONFIG.OSE.assetsPath}/brace.png`,\n        icon: \"fa-block-brick\",\n      };\n    },\n    get splash() {\n      return {\n        label: CONFIG.OSE.tags.splash,\n        image: `${CONFIG.OSE.assetsPath}/splash.png`,\n        icon: \"fa-burst\",\n      };\n    },\n    get reload() {\n      return {\n        label: CONFIG.OSE.tags.reload,\n        image: `${CONFIG.OSE.assetsPath}/reload.png`,\n        icon: \"fa-gear\",\n      };\n    },\n    get charge() {\n      return {\n        label: CONFIG.OSE.tags.charge,\n        image: `${CONFIG.OSE.assetsPath}/charge.png`,\n        icon: \"fa-person-running\",\n      };\n    },\n  },\n  tag_images: {\n    get melee() {\n      return `${CONFIG.OSE.assetsPath}/melee.png`;\n    },\n    get missile() {\n      return `fa-bow-arrow`;\n    },\n    get slow() {\n      return `${CONFIG.OSE.assetsPath}/slow.png`;\n    },\n    get twohanded() {\n      return `${CONFIG.OSE.assetsPath}/twohanded.png`;\n    },\n    get blunt() {\n      return `${CONFIG.OSE.assetsPath}/blunt.png`;\n    },\n    get brace() {\n      return `${CONFIG.OSE.assetsPath}/brace.png`;\n    },\n    get splash() {\n      return `${CONFIG.OSE.assetsPath}/splash.png`;\n    },\n    get reload() {\n      return `${CONFIG.OSE.assetsPath}/reload.png`;\n    },\n    get charge() {\n      return `${CONFIG.OSE.assetsPath}/charge.png`;\n    },\n  },\n  monster_saves: {\n    0: {\n      d: 14,\n      w: 15,\n      p: 16,\n      b: 17,\n      s: 18,\n    },\n    1: {\n      d: 12,\n      w: 13,\n      p: 14,\n      b: 15,\n      s: 16,\n    },\n    4: {\n      d: 10,\n      w: 11,\n      p: 12,\n      b: 13,\n      s: 14,\n    },\n    7: {\n      d: 8,\n      w: 9,\n      p: 10,\n      b: 10,\n      s: 12,\n    },\n    10: {\n      d: 6,\n      w: 7,\n      p: 8,\n      b: 8,\n      s: 10,\n    },\n    13: {\n      d: 4,\n      w: 5,\n      p: 6,\n      b: 5,\n      s: 8,\n    },\n    16: {\n      d: 2,\n      w: 3,\n      p: 4,\n      b: 3,\n      s: 6,\n    },\n    19: {\n      d: 2,\n      w: 2,\n      p: 2,\n      b: 2,\n      s: 4,\n    },\n    22: {\n      d: 2,\n      w: 2,\n      p: 2,\n      b: 2,\n      s: 2,\n    },\n  },\n  monster_thac0: {\n    0: 20,\n    1: 19,\n    2: 18,\n    3: 17,\n    4: 16,\n    5: 15,\n    6: 14,\n    7: 13,\n    9: 12,\n    10: 11,\n    12: 10,\n    14: 9,\n    16: 8,\n    18: 7,\n    20: 6,\n    22: 5,\n  },\n};\n\nexport default OSE;\n","/**\n * @file Helpful methods for dealing with OSE-specific dice logic\n */\nimport OSE from \"./config\";\n\nconst OseDice = {\n  async sendRoll({\n    parts = [],\n    data = {},\n    title = null,\n    flavor = null,\n    speaker = null,\n    form = null,\n    chatMessage = true,\n  } = {}) {\n    const template = `${OSE.systemPath()}/templates/chat/roll-result.html`;\n\n    const chatData = {\n      user: game.user.id,\n      speaker,\n    };\n\n    const templateData = {\n      title,\n      flavor,\n      data,\n      config: CONFIG.OSE,\n    };\n\n    // Optionally include a situational bonus\n    if (form !== null && form.bonus.value) {\n      parts.push(form.bonus.value);\n    }\n\n    const roll = new Roll(parts.join(\"+\"), data);\n    await roll.evaluate({ allowStrings: true });\n\n    // Convert the roll to a chat message and return the roll\n    let rollMode = game.settings.get(\"core\", \"rollMode\");\n    rollMode = form ? form.rollMode.value : rollMode;\n\n    // Force blind roll (ability formulas)\n    if (!form && data.roll.blindroll) {\n      rollMode = game.user.isGM ? \"selfroll\" : \"blindroll\";\n    }\n\n    if ([\"gmroll\", \"blindroll\"].includes(rollMode))\n      chatData.whisper = ChatMessage.getWhisperRecipients(\"GM\");\n    if (rollMode === \"selfroll\") chatData.whisper = [game.user._id];\n    if (rollMode === \"blindroll\") {\n      chatData.blind = true;\n      data.roll.blindroll = true;\n    }\n\n    templateData.result = OseDice.digestResult(data, roll);\n\n    return new Promise((resolve) => {\n      roll.render().then((r) => {\n        templateData.rollOSE = r;\n        foundry.applications.handlebars.renderTemplate(template, templateData).then((content) => {\n          chatData.content = content;\n          // Dice So Nice\n          if (game.dice3d) {\n            game.dice3d\n              .showForRoll(\n                roll,\n                game.user,\n                true,\n                chatData.whisper,\n                chatData.blind\n              )\n              .then(() => {\n                if (chatMessage !== false) ChatMessage.create(chatData);\n                resolve(roll);\n              });\n          } else {\n            chatData.sound = CONFIG.sounds.dice;\n            if (chatMessage !== false) ChatMessage.create(chatData);\n            resolve(roll);\n          }\n        });\n      });\n    });\n  },\n\n  /**\n   * Digesting results depending on type of roll\n   *\n   * @param {object} data - Contains roll data, including what type of check\n   * @param {object} roll - Evaluated Roll returned object\n   * @returns {object} - Object containing the evaluated data // @todo DigestResult\n   */\n  digestResult(data, roll) {\n    // @todo: Extract this to a DigestResult type/interface\n    const result = {\n      isSuccess: false,\n      isFailure: false,\n      target: data.roll.target,\n      total: roll.total,\n    };\n\n    const die = roll.dice?.[0]?.results?.[0]?.result ?? roll.total;\n    // eslint-disable-next-line default-case\n    switch (data.roll.type) {\n      case \"result\": {\n        if (roll.total === result.target) {\n          result.isSuccess = true;\n        } else {\n          result.isFailure = true;\n        }\n\n        break;\n      }\n\n      case \"above\": {\n        // SAVING THROWS\n        if (roll.total >= result.target) {\n          result.isSuccess = true;\n        } else {\n          result.isFailure = true;\n        }\n\n        break;\n      }\n\n      case \"below\": {\n        // MORALE, EXPLORATION\n        if (roll.total <= result.target) {\n          result.isSuccess = true;\n        } else {\n          result.isFailure = true;\n        }\n\n        break;\n      }\n\n      case \"check\": {\n        // SCORE CHECKS (1s and 20s)\n        if (die === 1 || (roll.total <= result.target && die < 20)) {\n          result.isSuccess = true;\n        } else {\n          result.isFailure = true;\n        }\n\n        break;\n      }\n\n      case \"table\": {\n        // Reaction\n        const { table } = data.roll;\n        let output = Object.values(table)[0];\n        for (let i = 0; i <= roll.total; i++) {\n          if (table[i]) {\n            output = table[i];\n          }\n        }\n        result.details = output;\n\n        break;\n      }\n\n      default: {\n        result.isSuccess = false;\n        result.isFailure = false;\n\n        break;\n      }\n    }\n    return result;\n  },\n\n  /**\n   * Evaluates if a roll is successful for both THAC0 and Ascending AC\n   *\n   * @param {object} roll - Evaluated roll data from a Roll\n   * @param {number} thac0 - THAC0 value, or Hit Target when AscendingAC\n   * @param {number} ac - AC Value, or Attack Bonus when AscendingAC\n   * @returns {boolean} - Did the attack succeed?\n   */\n  attackIsSuccess(roll, thac0, ac) {\n    // Natural 1\n    if (roll.terms[0].results[0].result === 1) {\n      return false;\n    }\n    // Natural 20\n    if (roll.terms[0].results[0].result === 20) {\n      return true;\n    }\n    return roll.total + ac >= thac0;\n  },\n\n  /**\n   * Digest the results of a target to reach, and an evaluated roll\n   * to evaluate if it does hit or not. The function adds information\n   * for generating chat card data too.\n   *\n   * @param {object} data - Data with at least roll target data\n   * @param {object} roll - Evaluation result from a Roll\n   * @returns {object} - DigestResult\n   */\n  digestAttackResult(data, roll) {\n    // @todo: Extract this to a DigestResult type/interface\n    const result = {\n      isSuccess: false,\n      isFailure: false,\n      target: \"\",\n      total: roll.total,\n    };\n    result.target = data.roll.thac0;\n    const targetActorData = data.roll.target?.actor?.system || null;\n\n    const targetAc = data.roll.target ? targetActorData?.ac?.value : 9;\n    const targetAac = data.roll.target ? targetActorData?.aac?.value : 10;\n    result.victim = data.roll.target || null;\n\n    if (game.settings.get(game.system.id, \"ascendingAC\")) {\n      const attackBonus = 0; // Attack bonus is already included in the roll\n      if (\n        this.attackIsSuccess(roll, targetAac, attackBonus) ||\n        result.victim == null\n      ) {\n        result.details = game.i18n.format(\n          \"OSE.messages.AttackAscendingSuccess\",\n          {\n            result: roll.total,\n          }\n        );\n        result.isSuccess = true;\n      } else {\n        result.details = game.i18n.format(\n          \"OSE.messages.AttackAscendingFailure\",\n          {\n            bonus: result.target,\n          }\n        );\n        result.isFailure = true;\n      }\n    } else if (\n      this.attackIsSuccess(roll, result.target, targetAc) ||\n      result.victim == null\n    ) {\n      // Show result in chat card\n      const value = result.target - roll.total;\n      result.details = game.i18n.format(\"OSE.messages.AttackSuccess\", {\n        result: value,\n        bonus: result.target,\n      });\n      result.isSuccess = true;\n    } else {\n      result.details = game.i18n.format(\"OSE.messages.AttackFailure\", {\n        bonus: result.target,\n      });\n      result.isFailure = true;\n    }\n    return result;\n  },\n\n  /**\n   * Puts together the information needed to roll a Roll and the\n   * expectations on hitting a target. Also creates the chat card\n   * containing the infromation about the evaluated roll.\n   *\n   * @param {object} param0 - Object to evaluate\n   * @param {Array<String || number>} param0.parts - Roll parts (e.g. [\"1d20\", \"3\", \"0\", \"0\"])\n   * @param {object} param0.data - Object containing target data\n   * @param {object} param0.data.roll - Roll target data\n   * @param {Array<String || number|} param0.data.roll.dmg - Roll parts for damage roll if hit\n   * @param {Actor | null} param0.data.target - Target data for the intended hit target\n   * @param {object} param0.flags -Not used directly in function, but may be passed on\n   * @param {string} param0.title - Modified in RollSave() if magic save required\n   * @param {string} param0.flavor - Not used directly in function\n   * @param {object} param0.speaker - Speaker data for the chat card\n   * @param {object} param0.form - Data from the Dialog Form that generates data for the function\n   * @returns {Promise || Void} - Either not returning anything, or a Promise for rendering a Chat Card\n   */\n  async sendAttackRoll({\n    parts = [],\n    data = {},\n    flags = {},\n    title = null,\n    flavor = null,\n    speaker = null,\n    form = null,\n  } = {}) {\n    if (data.roll.dmg.filter((v) => v !== \"\").length === 0) {\n      /**\n       * @todo should this error be localized?\n       */\n      ui.notifications.error(\n        \"Attack has no damage dice terms; be sure to set the attack's damage\"\n      );\n      return;\n    }\n    const template = `${OSE.systemPath()}/templates/chat/roll-attack.html`;\n    const chatData = {\n      user: game.user.id,\n      speaker,\n      flags,\n    };\n\n    const templateData = {\n      title,\n      flavor,\n      data,\n      config: CONFIG.OSE,\n    };\n\n    // Optionally include a situational bonus\n    if (form !== null && form.bonus.value) parts.push(form.bonus.value);\n\n    const roll = new Roll(parts.join(\"+\"), data);\n    await roll.evaluate();\n    const dmgRoll = new Roll(data.roll.dmg.join(\"+\"), data);\n    await dmgRoll.evaluate();\n\n    // Convert the roll to a chat message and return the roll\n    let rollMode = game.settings.get(\"core\", \"rollMode\");\n    rollMode = form ? form.rollMode.value : rollMode;\n\n    // Force blind roll (ability formulas)\n    if (data.roll.blindroll) {\n      rollMode = game.user.isGM ? \"selfroll\" : \"blindroll\";\n    }\n\n    if ([\"gmroll\", \"blindroll\"].includes(rollMode))\n      chatData.whisper = ChatMessage.getWhisperRecipients(\"GM\");\n    if (rollMode === \"selfroll\") chatData.whisper = [game.user._id];\n    if (rollMode === \"blindroll\") {\n      chatData.blind = true;\n      data.roll.blindroll = true;\n    }\n\n    templateData.result = OseDice.digestAttackResult(data, roll);\n\n    return new Promise((resolve) => {\n      roll.render().then((r) => {\n        templateData.rollOSE = r;\n        dmgRoll.render().then((dr) => {\n          templateData.rollDamage = dr;\n          foundry.applications.handlebars.renderTemplate(template, templateData).then((content) => {\n            chatData.content = content;\n            // 2 Step Dice So Nice\n            if (game.dice3d) {\n              game.dice3d\n                .showForRoll(\n                  roll,\n                  game.user,\n                  true,\n                  chatData.whisper,\n                  chatData.blind\n                )\n                .then(() => {\n                  if (templateData.result.isSuccess) {\n                    templateData.result.dmg = dmgRoll.total;\n                    game.dice3d\n                      .showForRoll(\n                        dmgRoll,\n                        game.user,\n                        true,\n                        chatData.whisper,\n                        chatData.blind\n                      )\n                      .then(() => {\n                        ChatMessage.create(chatData);\n                        resolve(roll);\n                      });\n                  } else {\n                    ChatMessage.create(chatData);\n                    resolve(roll);\n                  }\n                });\n            } else {\n              chatData.sound = CONFIG.sounds.dice;\n              ChatMessage.create(chatData);\n              resolve(roll);\n            }\n          });\n        });\n      });\n    });\n  },\n\n  async RollSave({\n    parts = [],\n    data = {},\n    skipDialog = false,\n    speaker = null,\n    flavor = null,\n    title = null,\n    chatMessage = true,\n  } = {}) {\n    let rolled = false;\n    const template = `${OSE.systemPath()}/templates/chat/roll-dialog.html`;\n    const dialogData = {\n      formula: parts.join(\" \"),\n      data,\n      rollMode: game.settings.get(\"core\", \"rollMode\"),\n      rollModes: CONFIG.Dice.rollModes,\n    };\n\n    const rollData = {\n      parts,\n      data,\n      title,\n      flavor,\n      speaker,\n      chatMessage,\n    };\n    if (skipDialog) {\n      return OseDice.sendRoll(rollData);\n    }\n\n    let roll;\n\n    const buttons = [\n      {\n        action: \"ok\",\n        label: game.i18n.localize(\"OSE.Roll\"),\n        icon: \"fas fa-dice-d20\",\n        callback: (event, button) => {\n          rolled = true;\n          rollData.form = button.form;\n          roll = OseDice.sendRoll(rollData);\n        },\n      },\n      {\n        action: \"magic\",\n        label: game.i18n.localize(\"OSE.saves.magic.short\"),\n        icon: \"fas fa-magic\",\n        callback: (event, button) => {\n          rolled = true;\n          rollData.form = button.form;\n          rollData.parts.push(`${rollData.data.roll.magic}`);\n          rollData.title += ` ${game.i18n.localize(\"OSE.saves.magic.short\")} (${\n            rollData.data.roll.magic\n          })`;\n          roll = OseDice.sendRoll(rollData);\n        },\n      },\n      {\n        action: \"cancel\",\n        icon: \"fas fa-times\",\n        label: game.i18n.localize(\"OSE.Cancel\"),\n        callback: () => {},\n      },\n    ];\n\n    const html = await foundry.applications.handlebars.renderTemplate(\n      template,\n      dialogData\n    );\n\n    // Create Dialog window\n    return new Promise((resolve) => {\n      new foundry.applications.api.DialogV2({\n        window: { title },\n        content: html,\n        buttons,\n        default: \"ok\",\n        submit: () => {\n          resolve(rolled ? roll : false);\n        },\n      }).render(true);\n    });\n  },\n\n  async Roll({\n    parts = [],\n    data = {},\n    skipDialog = false,\n    speaker = null,\n    flavor = null,\n    title = null,\n    chatMessage = true,\n    flags = {},\n  } = {}) {\n    let rolled = false;\n    const template = `${OSE.systemPath()}/templates/chat/roll-dialog.html`;\n    const dialogData = {\n      formula: parts.join(\" \"),\n      data,\n      rollMode: data.roll.blindroll\n        ? \"blindroll\"\n        : game.settings.get(\"core\", \"rollMode\"),\n      rollModes: CONFIG.Dice.rollModes,\n    };\n    const rollData = {\n      parts,\n      data,\n      title,\n      flavor,\n      speaker,\n      chatMessage,\n      flags,\n    };\n    if (skipDialog) {\n      return [\"melee\", \"missile\", \"attack\"].includes(data.roll.type)\n        ? OseDice.sendAttackRoll(rollData)\n        : OseDice.sendRoll(rollData);\n    }\n\n    let roll;\n\n    const buttons = [\n      {\n        action: \"ok\",\n        label: game.i18n.localize(\"OSE.Roll\"),\n        icon: \"fas fa-dice-d20\",\n        callback: (event, button) => {\n          rolled = true;\n          rollData.form = button.form;\n          roll = [\"melee\", \"missile\", \"attack\"].includes(data.roll.type)\n            ? OseDice.sendAttackRoll(rollData)\n            : OseDice.sendRoll(rollData);\n        },\n        default: true,\n      },\n      {\n        action: \"cancel\",\n        icon: \"fas fa-times\",\n        label: game.i18n.localize(\"OSE.Cancel\"),\n        callback: () => {},\n      },\n    ];\n\n    const html = await foundry.applications.handlebars.renderTemplate(template, dialogData);\n\n    // Create Dialog window\n    return new Promise((resolve) => {\n      new foundry.applications.api.DialogV2({\n        window: { title },\n        content: html,\n        buttons,\n        submit: () => {\n          resolve(rolled ? roll : false);\n        },\n      }).render(true);\n    });\n  },\n};\n\nexport default OseDice;\n","/**\n * @file The Character Creator application\n */\nimport OSE from \"../config\";\nimport OseDice from \"../helpers-dice\";\n\nexport default class OseCharacterCreator extends FormApplication {\n  static get defaultOptions() {\n    const options = super.defaultOptions;\n    options.classes = [\"ose\", \"dialog\", \"creator\"];\n    options.id = \"character-creator\";\n    options.template = `${OSE.systemPath()}/templates/actors/dialogs/character-creation.html`;\n    options.width = 235;\n    options.submitOnClose = false;\n    return options;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add the Entity name into the window title\n   *\n   * @type {string}\n   */\n  get title() {\n    return `${this.object.name}: ${game.i18n.localize(\"OSE.dialog.generator\")}`;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Construct and return the data object used to render the HTML template for this form application.\n   *\n   * @returns {object} - Render data for the form application\n   */\n  getData() {\n    const data = foundry.utils.deepClone(this.object);\n    data.user = game.user;\n    data.config = CONFIG.OSE;\n    this.counters = {\n      str: 0,\n      wis: 0,\n      dex: 0,\n      int: 0,\n      cha: 0,\n      con: 0,\n      gold: 0,\n    };\n    this.stats = {\n      sum: 0,\n      avg: 0,\n      std: 0,\n    };\n    this.scores = {};\n    this.gold = 0;\n    return data;\n  }\n\n  /* -------------------------------------------- */\n\n  doStats(ev) {\n    const list = $(ev.currentTarget).closest(\".attribute-list\");\n    const scores = Object.values(this.scores);\n    const n = scores.length;\n    const sum = scores.reduce((acc, next) => acc + next.value, 0);\n    const mean = parseFloat(sum) / n;\n    const std = Math.sqrt(\n      scores\n        .map((x) => (x.value - mean) ** 2)\n        .reduce((acc, next) => acc + next, 0) / n\n    );\n\n    const stats = list.siblings(\".roll-stats\");\n    stats.find(\".sum\").text(sum);\n    stats.find(\".avg\").text(Math.round((10 * sum) / n) / 10);\n    stats.find(\".std\").text(Math.round(100 * std) / 100);\n\n    if (n >= 6) {\n      $(ev.currentTarget)\n        .closest(\"form\")\n        .find('button[type=\"submit\"]')\n        .removeAttr(\"disabled\");\n    }\n\n    this.object.stats = {\n      sum,\n      avg: Math.round((10 * sum) / n) / 10,\n      std: Math.round(100 * std) / 100,\n    };\n  }\n\n  async rollScore(score, options = {}) {\n    // Increase counter\n    this.counters[score] += 1;\n\n    const label =\n      score === \"gold\"\n        ? \"Gold\"\n        : game.i18n.localize(`OSE.scores.${score}.long`);\n    const rollParts = [\"3d6\"];\n    const data = {\n      roll: {},\n    };\n    if (options.skipMessage) {\n      const skipMessagRoll = new Roll(rollParts[0]);\n      await skipMessagRoll.evaluate();\n    }\n    // Roll and return\n    return OseDice.Roll({\n      event: options.event,\n      parts: rollParts,\n      data,\n      skipDialog: true,\n      speaker: ChatMessage.getSpeaker({ actor: this }),\n      flavor: game.i18n.format(\"OSE.dialog.generateScore\", {\n        score: label,\n        count: this.counters[score],\n      }),\n      title: game.i18n.format(\"OSE.dialog.generateScore\", {\n        score: label,\n        count: this.counters[score],\n      }),\n    });\n  }\n\n  /** @override */\n  activateListeners(html) {\n    super.activateListeners(html);\n    html.find(\"a.score-roll\").click((ev) => {\n      const el = ev.currentTarget.parentElement.parentElement;\n      const { score } = el.dataset;\n      this.rollScore(score, { event: ev }).then((r) => {\n        this.scores[score] = { value: r.total };\n        $(el).find(\"input\").val(r.total).trigger(\"change\");\n      });\n    });\n\n    html.find(\"a.gold-roll\").click((ev) => {\n      const el = ev.currentTarget.parentElement.parentElement.parentElement;\n      this.rollScore(\"gold\", { event: ev }).then((r) => {\n        this.gold = 10 * r.total;\n        $(el).find(\".gold-value\").val(this.gold);\n      });\n    });\n\n    html.find(\"input.score-value\").change((ev) => {\n      this.doStats(ev);\n    });\n\n    html.find(\"a.auto-roll\").click(async (ev) => {\n      const stats = [\"str\", \"int\", \"dex\", \"wis\", \"con\", \"cha\"];\n      for (const char of stats) {\n        const r = await this.rollScore(char, { event: ev, skipMessage: true });\n        this.scores[char] = { value: r.total };\n      }\n      this.doStats(ev);\n      const r = await this.rollScore(\"gold\", { event: ev, skipMessage: true });\n      this.gold = 10 * r.total;\n      this.submit();\n    });\n  }\n\n  // eslint-disable-next-line no-underscore-dangle\n  async _onSubmit(\n    event,\n    { updateData = null, preventClose = false, preventRender = false } = {}\n  ) {\n    const extendedData = { ...updateData, system: { scores: this.scores } };\n    // eslint-disable-next-line no-underscore-dangle\n    super._onSubmit(event, {\n      updateData: extendedData,\n      preventClose,\n      preventRender,\n    });\n\n    // Gather scores\n    const speaker = ChatMessage.getSpeaker({ actor: this.object.actor });\n    const templateData = {\n      config: CONFIG.OSE,\n      scores: this.scores,\n      title: game.i18n.localize(\"OSE.dialog.generator\"),\n      stats: this.object.stats,\n      gold: this.gold,\n    };\n    const content = await foundry.applications.handlebars.renderTemplate(\n      `${OSE.systemPath()}/templates/chat/roll-creation.html`,\n      templateData\n    );\n\n    await ChatMessage.create({\n      content,\n      speaker,\n    });\n\n    // Generate gold\n    const itemData = {\n      name: game.i18n.localize(\"OSE.items.gp.short\"),\n      type: \"item\",\n      img: `${OSE.assetsPath}/gold.png`,\n      system: {\n        treasure: true,\n        cost: 1,\n        weight: 1,\n        quantity: {\n          value: this.gold,\n        },\n      },\n    };\n    this.object.createEmbeddedDocuments(\"Item\", [itemData]);\n  }\n\n  /**\n   * This method is called upon form submission after form data is validated\n   *\n   * @param {Event} event - The initial triggering submission event\n   * @param {object} formData - The object of validated form data with which to update the object\n   * @private\n   */\n  // eslint-disable-next-line no-underscore-dangle\n  async _updateObject(event, formData) {\n    event.preventDefault();\n    // Update the actor\n    await this.object.update(formData);\n\n    // Re-draw the updated sheet\n    this.object.sheet.render(true);\n  }\n}\n","/**\n * @file An application for deducting currency from an actor using the Shopping Cart feature\n */\n// eslint-disable-next-line no-unused-vars\nimport OSE from \"../config\";\n\nexport default class OseCharacterGpCost extends FormApplication {\n  static physicalItemTypes = new Set([\"item\", \"container\", \"weapon\", \"armor\"]);\n\n  constructor(event, preparedData, position) {\n    super(event, position);\n    this.object.preparedData = preparedData;\n  }\n\n  static get defaultOptions() {\n    const options = super.defaultOptions;\n    options.classes = [\"ose\", \"dialog\", \"gp-cost\"];\n    options.id = \"sheet-gp-cost\";\n    options.template = `${OSE.systemPath()}/templates/actors/dialogs/gp-cost-dialog.html`;\n    options.width = 240;\n    return options;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add the Entity name into the window title\n   *\n   * @type {string}\n   * @returns {string} - A localized window title\n   */\n  get title() {\n    return `${this.object.name}: ${game.i18n.localize(\n      \"OSE.dialog.shoppingCart\"\n    )}`;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Construct and return the data object used to render the HTML template for this form application.\n   *\n   * @returns {object} - The template data\n   */\n  async getData() {\n    const data = await foundry.utils.deepClone(this.object.preparedData);\n    data.totalCost = await this.#getTotalCost(data);\n    data.user = game.user;\n    this.inventory = this.object.items;\n    return data;\n  }\n\n  async close(options) {\n    return super.close(options);\n  }\n\n  /**\n   * An object that provides options to _onSubmit\n   *\n   * @typedef submitOptions\n   * @property {boolean} preventClose - Should the application be stopped from closing?\n   * @property {boolean} preventRender - Should the application be stopped from rendering?\n   */\n\n  /**\n   * Override Foundry's default _onSubmit event to add our own behaviors\n   *\n   * @param {Event} event - The native form submit event\n   * @param {submitOptions} options - Options for the _onSubmit event\n   */\n  // eslint-disable-next-line no-underscore-dangle\n  async _onSubmit(event, { preventClose = false, preventRender = false } = {}) {\n    // eslint-disable-next-line no-underscore-dangle\n    super._onSubmit(event, {\n      preventClose,\n      preventRender,\n    });\n    // Generate gold\n    const totalCost = await this.#getTotalCost(await this.getData());\n    const gp = await this.object.items.find((item) => {\n      const itemData = item.system;\n      return (\n        (item.name === game.i18n.localize(\"OSE.items.gp.short\") ||\n          item.name === \"GP\") && // legacy behavior used GP, even for other languages\n        itemData.treasure\n      );\n    });\n    if (!gp) {\n      ui.notifications.error(game.i18n.localize(\"OSE.error.noGP\"));\n      return;\n    }\n    const newGP = gp.system.quantity.value - totalCost;\n    if (newGP >= 0) {\n      await this.object.updateEmbeddedDocuments(\"Item\", [\n        { _id: gp.id, \"system.quantity.value\": newGP },\n      ]);\n\n      // Mark all items in the cart as \"paid for\" by setting a flag\n      await this.#markItemsAsPaid();\n\n      // Close the dialog after successful transaction\n      await this.close();\n    } else {\n      ui.notifications.error(game.i18n.localize(\"OSE.error.notEnoughGP\"));\n    }\n  }\n\n  /**\n   * This method is called upon form submission after form data is validated\n   *\n   * @param {Event} event - The initial triggering submission event\n   * @param {object} formData - The object of validated form data with which to update the object\n   * @private\n   */\n  async _updateObject(event, formData) {\n    event.preventDefault();\n\n    const speaker = ChatMessage.getSpeaker({ actor: this });\n    const templateData = await this.getData();\n    const content = await foundry.applications.handlebars.renderTemplate(\n      `${OSE.systemPath()}/templates/chat/inventory-list.html`,\n      templateData\n    );\n    ChatMessage.create({\n      content,\n      speaker,\n    });\n    // Update the actor\n    await this.object.update(formData);\n\n    // Re-draw the updated sheet\n    this.object.sheet.render(true);\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  async #getTotalCost(data) {\n    return data.items.reduce((total, item) => {\n      const itemData = item.system;\n      // Only count non-treasure physical items that haven't been paid for yet\n      if (\n        OseCharacterGpCost.physicalItemTypes.has(item.type) &&\n        !itemData.treasure &&\n        !item.flags?.ose?.paid\n      ) {\n        return (\n          total +\n          (itemData.quantity.max\n            ? itemData.cost * itemData.quantity.value\n            : itemData.cost)\n        );\n      }\n\n      return total;\n    }, 0);\n  }\n\n  /**\n   * Mark all items in the shopping cart as paid for\n   * This prevents them from appearing in the cart on subsequent openings\n   * Items remain in inventory but won't be counted in cart calculations\n   * @private\n   */\n  async #markItemsAsPaid() {\n    const updates = [];\n\n    this.object.items.forEach((item) => {\n      const itemData = item.system;\n      // Mark all non-treasure physical items that haven't been paid for yet\n      if (\n        OseCharacterGpCost.physicalItemTypes.has(item.type) &&\n        !itemData.treasure &&\n        !item.flags?.ose?.paid\n      ) {\n        updates.push({\n          _id: item.id,\n          \"flags.ose.paid\": true,\n        });\n      }\n    });\n\n    // Update all items in one batch\n    if (updates.length > 0) {\n      await this.object.updateEmbeddedDocuments(\"Item\", updates);\n    }\n  }\n\n  /* -------------------------------------------- */\n\n  /** @override */\n  activateListeners(html) {\n    super.activateListeners(html);\n    html.find(\"a.auto-deduct\").click(() => {\n      this.submit();\n    });\n  }\n}","/**\n * @file An application used for setting up roll modifiers\n */\nimport OSE from \"../config\";\n\nexport default class OseCharacterModifiers extends FormApplication {\n  static get defaultOptions() {\n    const options = super.defaultOptions;\n    options.classes = [\"ose\", \"dialog\", \"modifiers\"];\n    options.id = \"sheet-modifiers\";\n    options.template = `${OSE.systemPath()}/templates/actors/dialogs/modifiers-dialog.html`;\n    options.width = 240;\n    return options;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add the Entity name into the window title\n   *\n   * @returns {string} - The app title\n   */\n  get title() {\n    return `${this.object.name}: Modifiers`;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Construct and return the data object used to render the HTML template for this form application.\n   *\n   * @returns {object} - The template data\n   */\n  getData() {\n    const data = foundry.utils.deepClone(this.object);\n    data.user = game.user;\n    return data;\n  }\n\n  /* -------------------------------------------- */\n\n  /** @override */\n  activateListeners(html) {\n    super.activateListeners(html);\n  }\n}\n","/**\n * @file An application used to manage Actor configuration.\n */\nimport OSE from \"../config\";\n\nexport default class OseEntityTweaks extends FormApplication {\n  static get defaultOptions() {\n    const options = super.defaultOptions;\n    options.classes = [\"sheet-tweaks\"];\n    options.template = `${OSE.systemPath()}/templates/actors/dialogs/tweaks-dialog.html`;\n    options.width = 380;\n    return options;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add the Entity name into the window title\n   *\n   * @type {string}\n   * @returns {string} - The app title\n   */\n  get title() {\n    return `${this.object.name}: ${game.i18n.localize(\"OSE.dialog.tweaks\")}`;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Construct and return the data object used to render the HTML template for this form application.\n   *\n   * @returns {object} - The template data\n   */\n  getData() {\n    const data = foundry.utils.deepClone(this.object);\n    if (data.type === \"character\") {\n      data.isCharacter = true;\n    }\n    data.user = game.user;\n    data.config = {\n      ...CONFIG.OSE,\n      ascendingAC: game.settings.get(game.system.id, \"ascendingAC\"),\n    };\n    return data;\n  }\n\n  /* -------------------------------------------- */\n\n  /** @override */\n  activateListeners(html) {\n    super.activateListeners(html);\n  }\n\n  /**\n   * This method is called upon form submission after form data is validated\n   *\n   * @param {Event} event - The initial triggering submission event\n   * @param {object} formData - The object of validated form data with which to update the object\n   * @private\n   */\n  // eslint-disable-next-line no-underscore-dangle\n  async _updateObject(event, formData) {\n    event.preventDefault();\n\n    // Item-based encumbrance tracks two separate values by default.\n    // If the user hasn't changed the value, we null it out\n    // so that the default value is used.\n    const encumbranceMax = \"system.encumbrance.max\";\n    if (\n      CONFIG.OSE.encumbrance.type === \"itembased\" &&\n      (formData[encumbranceMax] === this.object.system.encumbrance.defaultMax ||\n        formData[encumbranceMax] ===\n          this.object.system.encumbrance.alternateMax)\n    ) {\n      formData[encumbranceMax] = null;\n    }\n\n    // Update the actor\n    await this.object.update(formData);\n    // Re-draw the updated sheet\n    // eslint-disable-next-line no-underscore-dangle\n    await this.object.sheet._render(true);\n  }\n}\n","/**\n * @file Contains helpers for various behaviors\n */\n\n/**\n * Checks if dialogs should be skipped, depending on settings\n *\n * @param {Event} event - Event that triggers a skippable dialog\n * @returns {boolean} - Returns true if dialog should be skipped\n */\nconst skipRollDialogCheck = (event) => {\n  const invertedCtrlBehavior = game.settings.get(\n    game.system.id,\n    \"invertedCtrlBehavior\"\n  );\n  return invertedCtrlBehavior\n    ? !(event && (event.ctrlKey || event.metaKey))\n    : event && (event.ctrlKey || event.metaKey);\n};\n\nexport default skipRollDialogCheck;\n","/**\n * @file The base class we use for Character and Monster sheets. Shared behavior goes here!\n */\nimport OSE from \"../config\";\nimport OseEntityTweaks from \"../dialog/entity-tweaks\";\nimport skipRollDialogCheck from \"../helpers-behaviour\";\n\n\nexport default class OseActorSheet extends foundry.appv1.sheets.ActorSheet {\n  /**\n   * IDs for items on the sheet that have been expanded.\n   * @type {Set<string>}\n   * @protected\n   */\n  _expanded = new Set();\n\n  async getData() {\n    const data = foundry.utils.deepClone(super.getData().data);\n    for (const i of this.actor.items) {\n      const isExpanded = this._expanded.has(i.id);\n      i.isExpanded = isExpanded;\n      if (isExpanded) {\n        await i.prepareDerivedData();\n      }\n    }\n    for (const i of data.items) {\n      const isExpanded = this._expanded.has(i.id);\n      i.isExpanded = isExpanded;\n      if (isExpanded) {\n        await i.prepareDerivedData();\n      }\n    }\n    data.owner = this.actor.isOwner;\n    data.editable = this.actor.sheet.isEditable;\n\n    // Store flag if the full character sheet is to be shown\n    data.isOwnerOrObserver = this.actor.isOwnerOrObserver;\n\n    data.config = {\n      ...CONFIG.OSE,\n      ascendingAC: game.settings.get(game.system.id, \"ascendingAC\"),\n      initiative: game.settings.get(game.system.id, \"initiative\") !== \"group\",\n      encumbrance: game.settings.get(game.system.id, \"encumbranceOption\"),\n      encumbranceStrengthMod:\n        game.settings.get(game.system.id, \"encumbranceItemStrengthMod\") &&\n        game.settings.get(game.system.id, \"encumbranceOption\") === \"itembased\",\n    };\n    data.isNew = this.actor.isNew();\n\n    data.encumbranceTemplate =\n      OSE.encumbrance?.templateEncumbranceBar ||\n      `${OSE.systemPath()}/templates/actors/partials/character-encumbrance.html`;\n\n    return data;\n  }\n\n  activateEditor(name, options, initialContent) {\n    // remove some controls to the editor as the space is lacking\n    // if (name === \"data.details.description\") {\n    //   options.toolbar = \"styleselect bullist hr table removeFormat save\";\n    // }\n    super.activateEditor(name, options, initialContent);\n  }\n\n  // Helpers\n\n  _getItemFromActor(event) {\n    const li = event.currentTarget.closest(\".item-entry\");\n    return this.actor.items.get(li.dataset.itemId);\n  }\n\n  // end Helpers\n\n  _toggleItemCategory(event) {\n    event.preventDefault();\n    const targetCategory = $(event.currentTarget);\n    const items = targetCategory.next(\".item-list\");\n\n    if (items.css(\"display\") === \"none\") {\n      const el = $(event.currentTarget).find(\".fas.fa-caret-right\");\n      el.removeClass(\"fa-caret-right\");\n      el.addClass(\"fa-caret-down\");\n\n      items.slideDown(200);\n    } else {\n      const el = $(event.currentTarget).find(\".fas.fa-caret-down\");\n      el.removeClass(\"fa-caret-down\");\n      el.addClass(\"fa-caret-right\");\n\n      items.slideUp(200);\n    }\n  }\n\n  _toggleContainedItems(event) {\n    event.preventDefault();\n    const targetItems = $(event.target.closest(\".container\"));\n    const items = targetItems.find(\".item-list.contained-items\");\n\n    if (items.css(\"display\") === \"none\") {\n      const el = targetItems.find(\".fas.fa-caret-right\");\n      el.removeClass(\"fa-caret-right\");\n      el.addClass(\"fa-caret-down\");\n\n      items.slideDown(200);\n    } else {\n      const el = targetItems.find(\".fas.fa-caret-down\");\n      el.removeClass(\"fa-caret-down\");\n      el.addClass(\"fa-caret-right\");\n\n      items.slideUp(200);\n    }\n  }\n\n  _toggleItemSummary(event) {\n    event.preventDefault();\n    const item = event.currentTarget.closest(\".item-entry.item\");\n    const itemSummary = item.querySelector(\".item-summary\");\n    if (itemSummary.classList.contains(\"expanded\")) {\n      this._expanded.delete(item.dataset.itemId);\n    } else {\n      this._expanded.add(item.dataset.itemId);\n    }\n    itemSummary.classList.toggle(\"expanded\");\n  }\n\n  async _displayItemInChat(event) {\n    const li = $(event.currentTarget).closest(\".item-entry\");\n    const item = this.actor.items.get(li.data(\"itemId\"));\n    item.show();\n  }\n\n  async _promptRemoveItemFromActor(item) {\n    const sheet = this;\n    return foundry.applications.api.DialogV2.confirm({\n      window: {\n        title: game.i18n.localize(\"OSE.dialog.deleteItem\"),\n      },\n      content: game.i18n.format(\"OSE.dialog.confirmDeleteItem\", {\n        name: item.name,\n      }),\n      yes: {\n        default: false,\n        callback: () => {\n          sheet._removeItemFromActor(item);\n        },\n      },\n      defaultYes: false,\n    });\n  }\n\n  // eslint-disable-next-line no-underscore-dangle, consistent-return\n  async _removeItemFromActor(item) {\n    if (item.type === \"ability\" || item.type === \"spell\") {\n      // eslint-disable-next-line no-underscore-dangle\n      return this.actor.deleteEmbeddedDocuments(\"Item\", [item._id]);\n    }\n    if (item.type !== \"container\" && item.system.containerId !== \"\") {\n      const { containerId } = item.system;\n      const newItemIds = this.actor.items\n        .get(containerId)\n        .system.itemIds.filter((o) => o !== item.id);\n\n      await this.actor.updateEmbeddedDocuments(\"Item\", [\n        { _id: containerId, system: { itemIds: newItemIds } },\n      ]);\n    }\n    if (item.type === \"container\" && item.system.itemIds) {\n      const containedItems = item.system.itemIds;\n      const updateData = containedItems.reduce((acc, val) => {\n        // Only create update data for items that still exist on the actor\n        if (this.actor.items.get(val))\n          acc.push({ _id: val, \"system.containerId\": \"\" });\n        return acc;\n      }, []);\n\n      await this.actor.updateEmbeddedDocuments(\"Item\", updateData);\n    }\n\n    // eslint-disable-next-line no-underscore-dangle\n    this.actor.deleteEmbeddedDocuments(\"Item\", [item._id]);\n  }\n\n  /**\n   * @param event\n   * @param {bool} decrement\n   */\n  _useConsumable(event, decrement) {\n    const item = this._getItemFromActor(event);\n    if (!item) return null;\n    let {\n      quantity: { value: quantity },\n    } = item.system;\n    item.update({\n      \"system.quantity.value\": decrement ? --quantity : ++quantity,\n    });\n  }\n\n  async _onSpellChange(event) {\n    event.preventDefault();\n    const item = this._getItemFromActor(event);\n    if (event.target.dataset.field === \"cast\") {\n      return item.update({ \"system.cast\": parseInt(event.target.value) });\n    }\n    if (event.target.dataset.field === \"memorize\") {\n      return item.update({\n        \"system.memorized\": parseInt(event.target.value),\n      });\n    }\n  }\n\n  async _resetSpells(event) {\n    const spellsContainer = event.currentTarget.closest(\".inventory.spells\");\n    const spellElements = spellsContainer.querySelectorAll(\".item-entry\");\n\n    const updates = [];\n    for (const el of spellElements) {\n      const { itemId } = el.dataset;\n      const item = this.actor.items.get(itemId);\n\n      if (item?.system) {\n        updates.push({\n          _id: item.id,\n          \"system.cast\": item.system.memorized,\n        });\n      }\n    }\n\n    if (updates.length > 0) {\n      await this.actor.updateEmbeddedDocuments(\"Item\", updates);\n    }\n  }\n\n  async _rollAbility(event) {\n    const item = this._getItemFromActor(event);\n    const itemData = item?.system;\n    if (item.type === \"weapon\") {\n      if (this.actor.type === \"monster\") {\n        await item.update({\n          \"system.counter.value\": itemData.counter.value - 1,\n        });\n      }\n      item.rollWeapon({ skipDialog: skipRollDialogCheck(event) });\n    } else if (item.type == \"spell\") {\n      await item.spendSpell({ skipDialog: skipRollDialogCheck(event) });\n    } else {\n      await item.rollFormula({ skipDialog: skipRollDialogCheck(event) });\n    }\n  }\n\n  async _rollSave(event) {\n    const actorObject = this.actor;\n    const element = event.currentTarget;\n    const { save } = element.parentElement.parentElement.dataset;\n    actorObject.rollSave(save, { event });\n  }\n\n  async _rollAttack(event) {\n    const actorObject = this.actor;\n    const element = event.currentTarget;\n    const { attack } = element.parentElement.parentElement.dataset;\n    actorObject.targetAttack({ roll: {} }, attack, {\n      type: attack,\n      skipDialog: skipRollDialogCheck(event),\n    });\n  }\n\n  _onSortItem(event, itemData) {\n    const source = this.actor.items.get(itemData._id);\n    const siblings = this.actor.items.filter(\n      (i) => i.data._id !== source.data._id\n    );\n    const dropTarget = event.target.closest(\"[data-item-id]\");\n    const targetId = dropTarget ? dropTarget.dataset.itemId : null;\n    const target = siblings.find((s) => s.data._id === targetId);\n    if (!target) throw new Error(`Couldn't drop near ${event.target}`);\n    const targetData = target?.system;\n\n    // Dragging items into a container\n    if (\n      (target?.type === \"container\" || target?.data?.type === \"container\") &&\n      targetData.containerId === \"\"\n    ) {\n      this.actor.updateEmbeddedDocuments(\"Item\", [\n        { _id: source.id, \"system.containerId\": target.id },\n      ]);\n      return;\n    }\n    if (source?.system.containerId !== \"\") {\n      this.actor.updateEmbeddedDocuments(\"Item\", [\n        { _id: source.id, \"system.containerId\": \"\" },\n      ]);\n    }\n\n    super._onSortItem(event, itemData);\n  }\n\n  _onDragStart(event) {\n    const li = event.currentTarget;\n    let itemIdsArray = [];\n    if (event.target.classList.contains(\"content-link\")) return;\n\n    let dragData;\n\n    // Owned Items\n    if (li.dataset.itemId) {\n      const item = this.actor.items.get(li.dataset.itemId);\n      dragData = item.toDragData();\n      dragData.item = item;\n      dragData.type = \"Item\";\n      if (item.type === \"container\" && item.system.itemIds.length > 0) {\n        // otherwise JSON.stringify will quadruple stringify for some reason\n        itemIdsArray = item.system.itemIds;\n      }\n    }\n\n    // Create drag data\n    dragData.actorId = this.actor.id;\n    dragData.sceneId = this.actor.isToken ? canvas.scene?.id : null;\n    dragData.tokenId = this.actor.isToken ? this.actor.token.id : null;\n    dragData.pack = this.actor.pack;\n\n    // Active Effect\n    if (li.dataset.effectId) {\n      const effect = this.actor.effects.get(li.dataset.effectId);\n      dragData.type = \"ActiveEffect\";\n      dragData.data = effect.data;\n    }\n\n    // Set data transfer\n    event.dataTransfer.setData(\n      \"text/plain\",\n      JSON.stringify(dragData, (key, value) => {\n        if (key === \"itemIds\") {\n          // something about how this Array is created makes its elements not real Array elements\n          // we go through this hoop to trick stringify into creating our string\n          return JSON.stringify(itemIdsArray);\n        }\n        return value;\n      })\n    );\n  }\n\n  // eslint-disable-next-line no-underscore-dangle\n  async _onDropFolder(event, data) {\n    const folder = await fromUuid(data.uuid);\n    if (!folder || folder.type !== \"Item\") return;\n\n    let itemArray = folder.contents || [];\n\n    folder.getSubfolders(true).forEach((subfolder) => {\n      itemArray.push(...subfolder.contents);\n    });\n\n    // Compendium items\n    if (itemArray.length > 0 && itemArray[0]?.uuid?.includes(\"Compendium\")) {\n      const items = [];\n      itemArray.forEach(async (item) => {\n        items.push(await fromUuid(item.uuid));\n      });\n      itemArray = items;\n    }\n\n    this._onDropItemCreate(itemArray);\n  }\n\n  // eslint-disable-next-line no-underscore-dangle\n  async _onDropItem(event, data) {\n    const targetId = event.target.closest(\".item\")?.dataset?.itemId;\n    const targetItem = this.actor.items.get(targetId);\n    const targetIsContainer = targetItem?.type === \"container\";\n\n    // This eats the event.target as it is parsed with the TextEditor.\n    const item = await Item.implementation.fromDropData(data);\n    const itemData = item.toObject();\n\n    const exists = !!this.actor.items.get(item.id);\n\n    const isContainer = this.actor.items.get(item.system.containerId);\n\n    // Issue: https://github.com/vttred/ose/issues/357\n    if (item.id === targetId) return;\n\n    if (!exists && !targetIsContainer)\n      // eslint-disable-next-line no-underscore-dangle\n      return this._onDropItemCreate([itemData]);\n\n    // eslint-disable-next-line no-underscore-dangle\n    if (isContainer) return this._onContainerItemRemove(item, isContainer);\n\n    // eslint-disable-next-line no-underscore-dangle\n    if (targetIsContainer) return this._onContainerItemAdd(item, targetItem);\n  }\n\n  async _onContainerItemRemove(item, container) {\n    const newList = container.system.itemIds.filter((s) => s != item.id);\n    const itemObj = this.object.items.get(item.id);\n    await container.update({ system: { itemIds: newList } });\n    await itemObj.update({ system: { containerId: \"\" } });\n  }\n\n  async _onContainerItemAdd(item, target) {\n    const alreadyExistsInActor = target.parent.items.find(\n      (i) => i.id === item.id\n    );\n    let latestItem = item;\n    if (!alreadyExistsInActor) {\n      // eslint-disable-next-line no-underscore-dangle\n      const newItem = await this._onDropItemCreate([item.toObject()]);\n      latestItem = newItem.pop();\n    }\n\n    const alreadyExistsInContainer = target.system.itemIds.find(\n      (i) => i.id === latestItem.id\n    );\n    if (!alreadyExistsInContainer) {\n      const newList = [...target.system.itemIds, latestItem.id];\n      await target.update({ system: { itemIds: newList } });\n      await latestItem.update({ system: { containerId: target.id, equipped: false } });\n    }\n  }\n\n  // eslint-disable-next-line no-underscore-dangle, consistent-return\n  async _onDropItemCreate(droppedItem, targetContainer = false) {\n    // override to fix hidden items because their original containers don't exist on this actor\n    const droppedItemArray = Array.isArray(droppedItem)\n      ? droppedItem\n      : [droppedItem];\n    droppedItemArray.forEach((item) => {\n      if (item.system.containerId && item.system.containerId !== \"\")\n        // eslint-disable-next-line no-param-reassign\n        item.system.containerId = \"\";\n      if (\n        item.type === \"container\" &&\n        typeof item.system.itemIds === \"string\"\n      ) {\n        // itemIds was double stringified to fix strange behavior with stringify blanking our Arrays\n        const containedItems = JSON.parse(item.system.itemIds);\n        containedItems.forEach((containedItem) => {\n          // eslint-disable-next-line no-param-reassign\n          containedItem.system.containerId = \"\";\n        });\n        droppedItem.push(...containedItems);\n      }\n    });\n    if (!targetContainer) {\n      return this.actor.createEmbeddedDocuments(\"Item\", droppedItem);\n    }\n\n    const { itemIds } = targetContainer.system;\n    itemIds.push(droppedItem.id);\n    const item = this.actor.items.get(droppedItem[0].id);\n    await targetContainer.update({ system: { itemIds } });\n    return item.update({ system: { containerId: targetContainer.id } });\n  }\n\n  /* -------------------------------------------- */\n\n  async _chooseItemType(choices = [\"weapon\", \"armor\", \"shield\", \"gear\"]) {\n    const templateData = {\n      types: choices.reduce((obj, choice) => {\n        obj[choice] = choice;\n        return obj;\n      }, {}),\n    };\n    const dlg = await foundry.applications.handlebars.renderTemplate(\n      `${OSE.systemPath()}/templates/items/entity-create.html`,\n      templateData\n    );\n    // Create Dialog window\n    return new Promise((resolve) => {\n      new foundry.applications.api.DialogV2({\n        window: { title: game.i18n.localize(\"OSE.dialog.createItem\") },\n        content: dlg,\n        buttons: [\n          {\n            action: \"ok\",\n            label: game.i18n.localize(\"OSE.Ok\"),\n            icon: \"fas fa-check\",\n            default: true,\n            callback: (event, button, html) => {\n              resolve(new foundry.applications.ux.FormDataExtended(button.form).object);\n            },\n          },\n          {\n            action: \"cancel\",\n            icon: \"fas fa-times\",\n            label: game.i18n.localize(\"OSE.Cancel\"),\n            callback: () => {},\n          },\n        ],\n      }).render(true);\n    });\n  }\n\n  // eslint-disable-next-line no-underscore-dangle\n  _createItem(event) {\n    event.preventDefault();\n    const header = event.currentTarget;\n    const { treasure, type, lvl } = header.dataset;\n    const createItem = (type, name) => ({\n      name: name || `New ${type.capitalize()}`,\n      type,\n    });\n\n    // Getting back to main logic\n    if (type === \"choice\") {\n      const choices = header.dataset.choices.split(\",\");\n      this._chooseItemType(choices).then((dialogInput) => {\n        const itemData = createItem(dialogInput.type, dialogInput.name);\n        this.actor.createEmbeddedDocuments(\"Item\", [itemData], {});\n      });\n    } else {\n      const itemData = createItem(type);\n      if (treasure) itemData.system = { treasure: true };\n      // when creating a new spell on the character sheet, we need to set the level\n      if (type === \"spell\") itemData.system = lvl ? { lvl } : { lvl: 1 };\n      return this.actor.createEmbeddedDocuments(\"Item\", [itemData], {});\n    }\n  }\n\n  async _updateItemQuantity(event) {\n    event.preventDefault();\n    const item = this._getItemFromActor(event);\n\n    if (event.target.dataset.field === \"value\") {\n      return item.update({\n        \"system.quantity.value\": parseInt(event.target.value),\n      });\n    }\n    if (event.target.dataset.field === \"max\") {\n      return item.update({\n        \"system.quantity.max\": parseInt(event.target.value),\n      });\n    }\n  }\n\n  // Override to set resizable initial size\n  // eslint-disable-next-line no-underscore-dangle\n  async _renderInner(...args) {\n    const html = await super._renderInner(...args);\n    this.form = html[0];\n\n    // Resize resizable classes\n    const resizable = html.find(\".resizable\");\n    if (resizable.length === 0) {\n      return;\n    }\n    resizable.each((_, el) => {\n      const heightDelta = this.position.height - this.options.height;\n      el.style.height = `${heightDelta + parseInt(el.dataset.baseSize)}px`;\n    });\n    return html;\n  }\n\n  // eslint-disable-next-line no-underscore-dangle\n  async _onResize(event) {\n    // eslint-disable-next-line no-underscore-dangle\n    super._onResize(event);\n\n    const html = $(this.form);\n    const resizable = html.find(\".resizable\");\n    if (resizable.length === 0) {\n      return;\n    }\n    // Resize divs\n    resizable.each((_, el) => {\n      const heightDelta = this.position.height - this.options.height;\n      el.style.height = `${heightDelta + parseInt(el.dataset.baseSize)}px`;\n    });\n    // Resize editors\n    const editors = html.find(\".editor\");\n    editors.each((id, editor) => {\n      const container = editor.closest(\".resizable-editor\");\n      if (container) {\n        const heightDelta = this.position.height - this.options.height;\n        editor.style.height = `${\n          heightDelta + parseInt(container.dataset.editorSize)\n        }px`;\n      }\n    });\n  }\n\n  // eslint-disable-next-line no-underscore-dangle\n  _onConfigureActor(event) {\n    event.preventDefault();\n    new OseEntityTweaks(this.actor, {\n      top: this.position.top + 40,\n      left: this.position.left + (this.position.width - 400) / 2,\n    }).render(true);\n  }\n\n  /**\n   * Extend and override the sheet header buttons\n   *\n   * @override\n   */\n  _getHeaderButtons() {\n    let buttons = super._getHeaderButtons();\n\n    // Token Configuration\n    const canConfigure = game.user.isGM || this.actor.isOwner;\n    if (this.options.editable && canConfigure) {\n      buttons = [\n        {\n          label: game.i18n.localize(\"OSE.dialog.tweaks\"),\n          class: \"configure-actor\",\n          icon: \"fas fa-code\",\n          onclick: (event) => this._onConfigureActor(event),\n        },\n        ...buttons,\n      ];\n    }\n    return buttons;\n  }\n\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    // Attributes\n    html.find(\".saving-throw .attribute-name a\").click((event) => {\n      this._rollSave(event);\n    });\n\n    html.find(\".attack a\").click((event) => {\n      this._rollAttack(event);\n    });\n\n    html.find(\".hit-dice .attribute-name\").click((event) => {\n      this.actor.rollHitDice({ event });\n    });\n\n    // Items (Abilities, Inventory and Spells)\n    html.find(\".item-rollable .item-image\").click(async (event) => {\n      this._rollAbility(event);\n    });\n\n    html.find(\".inventory .item-category-title\").click((event) => {\n      this._toggleItemCategory(event);\n    });\n    html.find(\".inventory .item-category-title input\").click((event) => {\n      event.stopPropagation();\n    });\n    html.find(\".inventory .category-caret\").click((event) => {\n      this._toggleContainedItems(event);\n    });\n\n    html.find(\".item-name\").click((event) => {\n      this._toggleItemSummary(event);\n    });\n\n    html.find(\".item-controls .item-show\").click(async (event) => {\n      this._displayItemInChat(event);\n    });\n\n    // Everything below here is only needed if the sheet is editable\n    if (!this.options.editable) return;\n\n    // Item Management\n    html.find(\".item-create\").click((event) => {\n      // eslint-disable-next-line no-underscore-dangle\n      this._createItem(event);\n    });\n\n    html.find(\".item-edit\").click((event) => {\n      const item = this._getItemFromActor(event);\n      item.sheet.render(true);\n    });\n\n    html.find(\".item-delete\").click((event) => {\n      const item = this._getItemFromActor(event);\n      this._promptRemoveItemFromActor(item);\n    });\n\n    html\n      .find(\".quantity input\")\n      .click((ev) => ev.target.select())\n      .change(this._updateItemQuantity.bind(this));\n\n    // Consumables\n    html.find(\".consumable-counter .full-mark\").click((event) => {\n      this._useConsumable(event, true);\n    });\n    html.find(\".consumable-counter .empty-mark\").click((event) => {\n      this._useConsumable(event, false);\n    });\n\n    // Spells\n    html\n      .find(\".memorize input\")\n      .click((event) => event.target.select())\n      .change(this._onSpellChange.bind(this));\n\n    html\n      .find(\".spells .item-reset[data-action='reset-spells']\")\n      .click((event) => {\n        this._resetSpells(event);\n      });\n  }\n}\n","/**\n * @file Extend the basic ActorSheet with some very simple modifications\n */\nimport OSE from \"../config\";\nimport OseCharacterCreator from \"../dialog/character-creation\";\nimport OseCharacterGpCost from \"../dialog/character-gp-cost\";\nimport OseCharacterModifiers from \"../dialog/character-modifiers\";\nimport OseActorSheet from \"./actor-sheet\";\n\nexport default class OseActorSheetCharacter extends OseActorSheet {\n  /**\n   * Extend and override the default options used by the 5e Actor Sheet\n   *\n   * @returns {object} - The default options for this sheet.\n   */\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: [\"ose\", \"sheet\", \"actor\", \"character\"],\n      template: `${OSE.systemPath()}/templates/actors/character-sheet.html`,\n      width: 450,\n      height: 530,\n      resizable: true,\n      tabs: [\n        {\n          navSelector: \".sheet-tabs\",\n          contentSelector: \".sheet-body\",\n          initial: \"attributes\",\n        },\n      ],\n      scrollY: [\".inventory\"],\n    });\n  }\n\n  /**\n   * Organize and classify Owned Items for Character sheets\n   *\n   * @param data\n   * @private\n   */\n  _prepareItems(data) {\n    // Assign and return\n    data.owned = {\n      items: this.actor.system.items,\n      armors: this.actor.system.armor,\n      weapons: this.actor.system.weapons,\n      treasures: this.actor.system.treasures,\n      containers: this.actor.system.containers,\n    };\n    data.treasure = this.actor.system.carriedTreasure;\n    data.containers = this.actor.system.containers;\n    data.abilities = this.actor.system.abilities;\n    data.spells = this.actor.system.spells.spellList;\n    data.slots = this.actor.system.spellSlots;\n\n    // These values are getters that aren't getting\n    // cloned when `this.actor.system` is cloned\n    data.system.usesAscendingAC = this.actor.system.usesAscendingAC;\n    data.system.meleeMod = this.actor.system.meleeMod;\n    data.system.rangedMod = this.actor.system.rangedMod;\n    data.system.init = this.actor.system.init;\n\n    // Sort by sort order (see ActorSheet)\n    [\n      ...Object.values(data.owned),\n      ...Object.values(data?.spells?.spellList || {}),\n      data.abilities,\n    ].forEach((o) => o.sort((a, b) => (a.sort || 0) - (b.sort || 0)));\n  }\n\n  generateScores() {\n    new OseCharacterCreator(this.actor, {\n      top: this.position.top + 40,\n      left: this.position.left + (this.position.width - 400) / 2,\n    }).render(true);\n  }\n\n  /**\n   * Prepare data for rendering the Actor sheet\n   * The prepared data object contains both the actor data as well as additional sheet options\n   */\n  async getData() {\n    const data = await super.getData();\n\n    // Prepare owned items\n    this._prepareItems(data);\n\n    data.enrichedBiography =\n      await foundry.applications.ux.TextEditor.implementation.enrichHTML(\n        this.object.system.details.biography,\n        { async: true }\n      );\n    data.enrichedNotes =\n      await foundry.applications.ux.TextEditor.implementation.enrichHTML(\n        this.object.system.details.notes,\n        { async: true }\n      );\n\n    return data;\n  }\n\n  async _chooseLang() {\n    const choices = CONFIG.OSE.languages;\n\n    const templateData = { choices };\n    const dlg = await foundry.applications.handlebars.renderTemplate(\n      `${OSE.systemPath()}/templates/actors/dialogs/lang-create.html`,\n      templateData\n    );\n    // Create Dialog window\n    return new Promise((resolve) => {\n      new foundry.applications.api.DialogV2({\n        window: { title: \"\" },\n        content: dlg,\n        buttons: [\n          {\n            action: \"ok\",\n            label: game.i18n.localize(\"OSE.Ok\"),\n            icon: \"fas fa-check\",\n            default: true,\n            callback: (event, button, html) => {\n              resolve(new foundry.applications.ux.FormDataExtended(button.form).object);\n            },\n          },\n          {\n            action: \"cancel\",\n            icon: \"fas fa-times\",\n            label: game.i18n.localize(\"OSE.Cancel\"),\n            callback: () => {},\n          },\n        ],\n      }).render(true);\n    });\n  }\n\n  _pushLang(table) {\n    const data = this.actor.system;\n    let update = data[table]; // V10 compatibility\n    this._chooseLang().then((dialogInput) => {\n      const name = CONFIG.OSE.languages[dialogInput.choice];\n      if (update.value) {\n        update.value.push(name);\n      } else {\n        update = { value: [name] };\n      }\n\n      const newData = {};\n      newData[table] = update;\n      return this.actor.update({ system: newData });\n    });\n  }\n\n  _popLang(table, lang) {\n    const data = this.actor.system;\n    const update = data[table].value.filter((el) => el != lang);\n    const newData = {};\n    newData[table] = { value: update };\n    return this.actor.update({ system: newData });\n  }\n\n  /* -------------------------------------------- */\n\n  _onShowModifiers(event) {\n    event.preventDefault();\n    new OseCharacterModifiers(this.actor, {\n      top: this.position.top + 40,\n      left: this.position.left + (this.position.width - 400) / 2,\n    }).render(true);\n  }\n\n  /**\n   * Prepare shopping cart data by filtering out items that have already been paid for\n   */\n  async _prepareShoppingCartData() {\n    const data = await this.getData();\n\n    // Filter out items that have been marked as paid\n    const filterUnpaidItems = (items) => {\n      return items.filter((item) => !item.flags?.ose?.paid);\n    };\n\n    // Create a filtered copy of the data with only unpaid items\n    const cartData = foundry.utils.deepClone(data);\n    if (cartData.owned) {\n      cartData.owned.items = filterUnpaidItems(cartData.owned.items || []);\n      cartData.owned.weapons = filterUnpaidItems(cartData.owned.weapons || []);\n      cartData.owned.armors = filterUnpaidItems(cartData.owned.armors || []);\n      cartData.owned.containers = filterUnpaidItems(cartData.owned.containers || []);\n    }\n\n    // Also filter the flat items array if it exists\n    if (cartData.items) {\n      cartData.items = filterUnpaidItems(cartData.items);\n    }\n\n    return cartData;\n  }\n\n  async _onShowGpCost(event) {\n    event.preventDefault();\n    const cartData = await this._prepareShoppingCartData();\n    new OseCharacterGpCost(this.actor, cartData, {\n      top: this.position.top + 40,\n      left: this.position.left + (this.position.width - 400) / 2,\n    }).render(true);\n  }\n\n  /**\n   * Activate event listeners using the prepared sheet HTML\n   *\n   * @param html - {HTML}   The prepared HTML object ready to be rendered into the DOM\n   */\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    html.find(\".ability-score .attribute-name a\").click((ev) => {\n      const actorObject = this.actor;\n      const element = ev.currentTarget;\n      const { score } = element.parentElement.parentElement.dataset;\n      const { stat } = element.parentElement.parentElement.dataset;\n      if (score) {\n        actorObject.rollCheck(score, { event: ev });\n      } else if (stat === \"lr\") {\n        actorObject.rollLoyalty(score, { event: ev });\n      }\n    });\n\n    html.find(\".exploration .attribute-name a\").click((ev) => {\n      const actorObject = this.actor;\n      const element = ev.currentTarget;\n      const expl = element.parentElement.parentElement.dataset.exploration;\n      actorObject.rollExploration(expl, { event: ev });\n    });\n\n    html.find(\"a[data-action='modifiers']\").click((ev) => {\n      this._onShowModifiers(ev);\n    });\n\n    html.find(\"a[data-action='gp-cost']\").click((ev) => {\n      this._onShowGpCost(ev);\n    });\n\n    // Everything below here is only needed if the sheet is editable\n    if (!this.options.editable) return;\n\n    // Language Management\n    html.find(\".item-push\").click((ev) => {\n      ev.preventDefault();\n      const header = ev.currentTarget;\n      const table = header.dataset.array;\n      this._pushLang(table);\n    });\n\n    html.find(\".item-pop\").click((ev) => {\n      ev.preventDefault();\n      const header = ev.currentTarget;\n      const table = header.dataset.array;\n      this._popLang(table, $(ev.currentTarget).closest(\".item\").data(\"lang\"));\n    });\n\n    // Toggle Equipment\n    html.find(\".item-toggle\").click(async (ev) => {\n      const li = $(ev.currentTarget).parents(\".item\");\n      const item = this.actor.items.get(li.data(\"itemId\"));\n      await item.update({\n        system: {\n          equipped: !item.system.equipped,\n        },\n      });\n\n    });\n\n    html.find(\"a[data-action='generate-scores']\").click((ev) => {\n      this.generateScores(ev);\n    });\n  }\n}","/**\n * @file A class to handle the nested AC/AAC props on OseDataModelCharacter.\n */\n\ninterface CharacterAC {\n  base: number;\n  naked: number;\n  shield: number;\n  value: number;\n  mod: number;\n}\n\nexport default class OseDataModelCharacterAC implements CharacterAC {\n  static baseAscending = 10;\n\n  static baseDescending = 9;\n\n  static propAscending = \"aac\";\n\n  static propDescending = \"ac\";\n\n  #armor;\n\n  #dexMod;\n\n  #mod;\n\n  #acProp;\n\n  #isAscending;\n\n  /**\n   * AC Constructor\n   *\n   * @param {boolean} isAscending - Is this meant to represent ascending or descending AC?\n   * @param {Item} armor - Currently equipped Items with type of armor\n   * @param {number} dexMod - The bonus/penalty, from -3 to +3, applied to AC.\n   * @param {number} mod - Miscellaneous modifier to AC\n   */\n  constructor(\n    isAscending: boolean = false,\n    armor: Item[] = [],\n    dexMod: number = 0,\n    mod: number = 0\n  ) {\n    this.#isAscending = isAscending;\n    this.#armor = armor;\n    this.#dexMod = dexMod;\n    this.#mod = mod;\n    this.#acProp = this.#isAscending\n      ? OseDataModelCharacterAC.propAscending\n      : OseDataModelCharacterAC.propDescending;\n  }\n\n  #getShieldBonus(): number {\n    return (\n      this.#armor.find(({ system: { type } }: Item) => type === \"shield\")\n        ?.system[this.#acProp].value || 0\n    );\n  }\n\n  /**\n   * The base AC value for a character, depending on\n   * if we're using ascending or descending AC\n   *\n   * @returns {number} - The base AC value\n   */\n  get base(): number {\n    return this.#isAscending\n      ? OseDataModelCharacterAC.baseAscending\n      : OseDataModelCharacterAC.baseDescending;\n  }\n\n  /**\n   * A character's armor class without armor or a shield\n   *\n   * @returns {number} - The character's naked AC\n   */\n  get naked(): number {\n    return this.#isAscending\n      ? this.base + this.#dexMod\n      : this.base - this.#dexMod;\n  }\n\n  /**\n   * A character's shield bonus, if any\n   *\n   * @returns {number} - The shield bonus\n   */\n  get shield(): number {\n    return this.#getShieldBonus();\n  }\n\n  /**\n   * The AC value from worn armor\n   *\n   * @todo After data migration, armor should be a bonus to naked AC.\n   * @returns {number | null} - The AC value from worn armor\n   */\n  get #armored(): number | null {\n    const armor = this.#armor.find(\n      ({ system: { type } }: Item) => type !== \"shield\"\n    )?.system[this.#acProp].value;\n    // Null if any falsy value but 0\n    if (!armor && armor !== 0) return null;\n\n    return this.#isAscending ? armor + this.#dexMod : armor - this.#dexMod;\n  }\n\n  /**\n   * A character's armor class\n   *\n   * @todo Data migration for armor with AC/AAC to act as a bonus, not an override\n   * @returns {number} - The creature's AC\n   */\n  get value(): number {\n    const base = this.#armored === null ? this.naked : this.#armored;\n    return this.#isAscending\n      ? base + this.shield + this.mod\n      : base - this.shield - this.mod;\n  }\n\n  // @TODO This will need to be editable once we get to creatures\n  // eslint-disable-next-line @typescript-eslint/no-empty-function\n  set value(_change: number) {} // eslint-disable-line class-methods-use-this\n\n  /**\n   * A character's miscellaneous armor class modifier\n   *\n   * @returns {number} - The creature's AC modifier\n   */\n  get mod(): number {\n    return this.#mod;\n  }\n\n  set mod(change: number) {\n    this.#mod = change;\n  }\n}\n","/**\n * @file A class representing the character's ability to move, depending on encumbrance state\n */\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport OseDataModelCharacterEncumbrance from \"./data-model-character-encumbrance\";\n\nexport interface CharacterMove {\n  base: number;\n  encounter: number;\n  overland: number;\n}\n\n/**\n * A class representing a character's move speeds.\n */\nexport default class OseDataModelCharacterMove implements CharacterMove {\n  static baseMoveRate = 120;\n\n  #moveBase;\n\n  #autocalculate;\n\n  #encumbranceVariant;\n\n  #overEncumbranceLimit;\n\n  #atFirstBreakpoint;\n\n  #atSecondBreakpoint;\n\n  #atThirdBreakpoint;\n\n  /**\n   * The constructor\n   *\n   * @param {OseDataModelCharacterEncumbrance} encumbrance - An object representing the character's encumbrance values\n   * @param {boolean} shouldCalculateMovement - Should the class autocalculate movement?\n   * @param {number} base - The base move rate for the actor\n   */\n  constructor(\n    encumbrance: OseDataModelCharacterEncumbrance = new OseDataModelCharacterEncumbrance(),\n    shouldCalculateMovement = true,\n    base = OseDataModelCharacterMove.baseMoveRate\n  ) {\n    // Props necessary for any encumbrance variant\n    this.#moveBase = base;\n    this.#autocalculate = shouldCalculateMovement;\n    this.#encumbranceVariant = encumbrance.variant;\n    this.#overEncumbranceLimit = encumbrance.encumbered;\n\n    // Encumbrance Breakpoints\n    this.#atFirstBreakpoint = encumbrance.atFirstBreakpoint;\n    this.#atSecondBreakpoint = encumbrance.atSecondBreakpoint;\n    this.#atThirdBreakpoint = encumbrance.atThirdBreakpoint;\n  }\n\n  #derivedSpeed() {\n    if (this.#overEncumbranceLimit) return 0;\n    if (this.#atThirdBreakpoint) return this.#moveBase * 0.25;\n    if (this.#atSecondBreakpoint) return this.#moveBase * 0.5;\n    return this.#atFirstBreakpoint ? this.#moveBase * 0.75 : this.#moveBase;\n  }\n\n  get base() {\n    // Manual entry for movement\n    if (!this.#autocalculate || this.#encumbranceVariant === \"disabled\")\n      return this.#moveBase;\n    // Automatic calculation for movement\n    return this.#derivedSpeed();\n  }\n\n  set base(value) {\n    this.#moveBase = value;\n  }\n\n  get encounter() {\n    return this.base / 3;\n  }\n\n  get overland() {\n    return this.base / 5;\n  }\n}\n","/**\n * @file A class representing a Character's ability scores.\n */\ntype IncomingScore = {\n  value: number;\n  bonus: number;\n};\n\ntype Scores = {\n  str: BaseScore;\n  int: BaseScore;\n  wis: BaseScore;\n  dex: BaseScore;\n  con: BaseScore;\n  cha: BaseScore;\n};\ntype OptionalScores = Partial<Scores>;\n\ntype BaseScore = IncomingScore & { mod: number };\n\nexport interface CharacterScores {\n  str: BaseScore & { od: number };\n  int: BaseScore & { literacy: string; spoken: string };\n  wis: BaseScore;\n  dex: BaseScore & { init: number };\n  con: BaseScore;\n  cha: BaseScore & { loyalty: number; retain: number; npc: number };\n}\n\n/**\n * A class representing a character's ability scores\n */\nexport default class OseDataModelCharacterScores implements CharacterScores {\n  /**\n   * Standard modifiers, from -3 to 3.\n   *\n   * Applied to:\n   * - `str.mod`\n   * - `int.mod`\n   * - `wis.mod`\n   * - `dex.mod`\n   * - `con.mod`\n   * - `cha.mod`\n   * - `cha.retain` (with a +4 modifier)\n   * - `cha.loyalty` (with a +7 modifier)\n   */\n  static standardAttributeMods = {\n    0: -3,\n    3: -3,\n    4: -2,\n    6: -1,\n    9: 0,\n    13: 1,\n    16: 2,\n    18: 3,\n  };\n\n  /**\n   * Capped modifiers, from -2 to 2.\n   *\n   * Applied to:\n   * - `dex.init`\n   * - `cha.npc`\n   */\n  static cappedAttributeMods = {\n    0: -2,\n    3: -2,\n    4: -1,\n    6: -1,\n    9: 0,\n    13: 1,\n    16: 1,\n    18: 2,\n  };\n\n  /**\n   * Modifier tables for the Open Door exploration skill, from 0 to 5.\n   * Applied to:\n   * - `str.od`\n   */\n  static openDoorMods = {\n    0: 0,\n    3: 1,\n    9: 2,\n    13: 3,\n    16: 4,\n    18: 5,\n  };\n\n  /**\n   * Mapping tables for character literacy.\n   * Applied to:\n   * - `int.literacy`\n   */\n  static literacyMods = {\n    0: \"\",\n    3: \"OSE.Illiterate\",\n    6: \"OSE.LiteracyBasic\",\n    9: \"OSE.Literate\",\n  };\n\n  /**\n   * Mapping tables for character's spoken languages.\n   * Applied to:\n   * - `int.spoken`\n   */\n  static spokenMods = {\n    0: \"OSE.NativeBroken\",\n    3: \"OSE.Native\",\n    13: \"OSE.NativePlus1\",\n    16: \"OSE.NativePlus2\",\n    18: \"OSE.NativePlus3\",\n  };\n\n  static valueFromTable(table: { [str: string]: any }, val: number) {\n    let output;\n    for (let i = 0; i <= val; i += 1) {\n      if (table[i] !== undefined) {\n        output = table[i];\n      }\n    }\n    return output;\n  }\n\n  #str: IncomingScore = { value: 0, bonus: 0 };\n\n  #int: IncomingScore = { value: 0, bonus: 0 };\n\n  #wis: IncomingScore = { value: 0, bonus: 0 };\n\n  #dex: IncomingScore = { value: 0, bonus: 0 };\n\n  #con: IncomingScore = { value: 0, bonus: 0 };\n\n  #cha: IncomingScore = { value: 0, bonus: 0 };\n\n  /**\n   * The constructor\n   *\n   * @param {object} scores - An object containing the six primary ability scores.\n   * @param {string} scores.str - The character's strength\n   * @param {string} scores.int - The character's intelligence\n   * @param {string} scores.wis - The character's wisdom\n   * @param {string} scores.dex - The character's dexterity\n   * @param {string} scores.con - The character's constitution\n   * @param {string} scores.cha - The character's charisma\n   */\n  constructor({ str, int, wis, dex, con, cha }: OptionalScores = {}) {\n    this.#str = str ?? { value: 0, bonus: 0 };\n    this.#int = int ?? { value: 0, bonus: 0 };\n    this.#wis = wis ?? { value: 0, bonus: 0 };\n    this.#dex = dex ?? { value: 0, bonus: 0 };\n    this.#con = con ?? { value: 0, bonus: 0 };\n    this.#cha = cha ?? { value: 0, bonus: 0 };\n  }\n\n  get str() {\n    return {\n      value: this.#str.value,\n      bonus: this.#str.bonus,\n      mod: this.#strMod,\n      od: this.#strOpenDoorsMod,\n    };\n  }\n\n  set str(change) {\n    this.#str = {\n      ...this.#str,\n      ...change,\n    };\n  }\n\n  get #strMod() {\n    return OseDataModelCharacterScores.valueFromTable(\n      OseDataModelCharacterScores.standardAttributeMods,\n      this.#str.value\n    );\n  }\n\n  get #strOpenDoorsMod() {\n    return OseDataModelCharacterScores.valueFromTable(\n      OseDataModelCharacterScores.openDoorMods,\n      this.#str.value\n    );\n  }\n\n  get int() {\n    return {\n      value: this.#int.value,\n      bonus: this.#int.bonus,\n      mod: this.#intMod,\n      literacy: this.#intLiteracyMod,\n      spoken: this.#intSpokenLanguagesMod,\n    };\n  }\n\n  set int(change) {\n    this.#int = {\n      ...this.#int,\n      ...change,\n    };\n  }\n\n  get #intMod() {\n    return OseDataModelCharacterScores.valueFromTable(\n      OseDataModelCharacterScores.standardAttributeMods,\n      this.#int.value\n    );\n  }\n\n  get #intLiteracyMod() {\n    return OseDataModelCharacterScores.valueFromTable(\n      OseDataModelCharacterScores.literacyMods,\n      this.#int.value\n    );\n  }\n\n  get #intSpokenLanguagesMod() {\n    return OseDataModelCharacterScores.valueFromTable(\n      OseDataModelCharacterScores.spokenMods,\n      this.#int.value\n    );\n  }\n\n  get wis() {\n    return {\n      value: this.#wis.value,\n      bonus: this.#wis.bonus,\n      mod: this.#wisMod,\n    };\n  }\n\n  set wis(change) {\n    this.#wis = {\n      ...this.#wis,\n      ...change,\n    };\n  }\n\n  get #wisMod() {\n    return OseDataModelCharacterScores.valueFromTable(\n      OseDataModelCharacterScores.standardAttributeMods,\n      this.#wis.value\n    );\n  }\n\n  get dex() {\n    return {\n      value: this.#dex.value,\n      bonus: this.#dex.bonus,\n      mod: this.#dexMod,\n      init: this.#dexInitMod,\n    };\n  }\n\n  set dex(change) {\n    this.#dex = {\n      ...this.#dex,\n      ...change,\n    };\n  }\n\n  get #dexMod() {\n    return OseDataModelCharacterScores.valueFromTable(\n      OseDataModelCharacterScores.standardAttributeMods,\n      this.#dex.value\n    );\n  }\n\n  get #dexInitMod() {\n    return OseDataModelCharacterScores.valueFromTable(\n      OseDataModelCharacterScores.cappedAttributeMods,\n      this.#dex.value\n    );\n  }\n\n  get con() {\n    return {\n      value: this.#con.value,\n      bonus: this.#con.bonus,\n      mod: this.#conMod,\n    };\n  }\n\n  set con(change) {\n    this.#con = {\n      ...this.#con,\n      ...change,\n    };\n  }\n\n  get #conMod() {\n    return OseDataModelCharacterScores.valueFromTable(\n      OseDataModelCharacterScores.standardAttributeMods,\n      this.#con.value\n    );\n  }\n\n  get cha() {\n    return {\n      value: this.#cha.value,\n      bonus: this.#cha.bonus,\n      mod: this.#chaMod,\n      loyalty: this.#chaLoyaltyMod,\n      retain: this.#chaRetainMod,\n      npc: this.#chaReactionMod,\n    };\n  }\n\n  set cha(change) {\n    this.#cha = {\n      ...this.#cha,\n      ...change,\n    };\n  }\n\n  get #chaMod() {\n    return OseDataModelCharacterScores.valueFromTable(\n      OseDataModelCharacterScores.standardAttributeMods,\n      this.#cha.value\n    );\n  }\n\n  get #chaReactionMod() {\n    return OseDataModelCharacterScores.valueFromTable(\n      OseDataModelCharacterScores.cappedAttributeMods,\n      this.#cha.value\n    );\n  }\n\n  get #chaRetainMod() {\n    return this.#chaMod + 4;\n  }\n\n  get #chaLoyaltyMod() {\n    return this.#chaMod + 7;\n  }\n}\n","/**\n * @file A class representing a creature's spellcasting abilities\n */\ntype Slot = {\n  used: number;\n  max: number;\n};\n\ntype Slots = {\n  [n: number]: Slot;\n};\n\ntype Spells = {\n  [n: number]: Item[];\n};\n\nconst reducedSpells = (list: Spells, item: Item) => {\n  const { lvl } = item.system;\n  const othersAtLvl = list[lvl] || [];\n  return {\n    ...list,\n    [lvl]: [...othersAtLvl, item].sort((a, b) => a.name.localeCompare(b.name)),\n  };\n};\n\nexport interface CharacterSpells {\n  enabled: boolean;\n  spellList: Spells;\n  slots: Slots;\n}\n\nexport default class OseDataModelCharacterSpells implements CharacterSpells {\n  #slots = {};\n\n  #spellList: Item[] = [];\n\n  #enabled: boolean;\n\n  constructor(\n    {\n      enabled,\n      ...maxSlots\n    }: { enabled?: boolean; [n: number]: { max: number } },\n    spellList: Item[] = []\n  ) {\n    this.#spellList = spellList;\n    this.#enabled = enabled || false;\n\n    const usedSlots = this.#spellList?.reduce(this.#reducedUsedSlots, {}) || {};\n\n    this.#slots = Object.keys(maxSlots || {}).reduce(\n      (list, item, idx) =>\n        this.#usedAndMaxSlots(list, item, idx, usedSlots, maxSlots),\n      {}\n    );\n  }\n\n  get enabled() {\n    return this.#enabled;\n  }\n\n  set enabled(state) {\n    this.#enabled = state;\n  }\n\n  get spellList() {\n    return this.#spellList.reduce(\n      (list, item) => reducedSpells(list, item),\n      {}\n    );\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  #reducedUsedSlots(list: { [n: number]: number }, item: Item) {\n    const { lvl } = item.system;\n    let { cast } = item.system;\n    if (!cast || Number.isNaN(cast)) cast = 0;\n    const usedAtLvl = list[lvl] || 0;\n    return {\n      ...list,\n      [lvl]: usedAtLvl + cast,\n    };\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  #usedAndMaxSlots(\n    list: Slots,\n    item: Item | string,\n    idx: number,\n    usedSlots: { [n: number]: number },\n    maxSlots: { [n: number]: { max: number } }\n  ) {\n    if (item === \"enabled\") return list;\n    const lv = idx;\n    const max = maxSlots[lv]?.max || 0;\n    const used = usedSlots[lv];\n\n    return {\n      ...list,\n      [lv]: { used, max },\n    };\n  }\n\n  get slots(): Slots {\n    return this.#slots;\n  }\n}\n","/**\n * @file The data model for Actors of type Character.\n */\nimport OseDataModelCharacterAC from \"./data-model-classes/data-model-character-ac\";\nimport OseDataModelCharacterMove from \"./data-model-classes/data-model-character-move\";\nimport OseDataModelCharacterScores from \"./data-model-classes/data-model-character-scores\";\nimport OseDataModelCharacterSpells from \"./data-model-classes/data-model-character-spells\";\n\nconst getItemsOfActorOfType = (actor, filterType, filterFn = null) =>\n  actor.items\n    .filter(({ type }) => type === filterType)\n    .filter(filterFn || (() => true));\n\nexport default class OseDataModelCharacter extends foundry.abstract.TypeDataModel {\n  prepareDerivedData() {\n    this.scores = new OseDataModelCharacterScores(this.scores);\n\n    // eslint-disable-next-line new-cap\n    this.encumbrance = new CONFIG.OSE.encumbrance(\n      this.encumbrance.max,\n      [...this.parent.items],\n      {\n        significantTreasure: game.settings.get(\n          game.system.id,\n          \"significantTreasure\"\n        ),\n        scores: this.scores,\n      },\n      this.scores.str.mod\n    );\n\n    this.movement = new OseDataModelCharacterMove(\n      this.encumbrance,\n      this.config.movementAuto,\n      this.movement.base\n    );\n\n    // @todo Once we create the new character sheet,\n    //       we shouldn't need to list both AC schemes\n    this.ac = new OseDataModelCharacterAC(\n      false,\n      getItemsOfActorOfType(this.parent, \"armor\", (a) => a.system.equipped),\n      this.scores.dex.mod,\n      this.ac.mod\n    );\n\n    this.aac = new OseDataModelCharacterAC(\n      true,\n      getItemsOfActorOfType(this.parent, \"armor\", (a) => a.system.equipped),\n      this.scores.dex.mod,\n      this.aac.mod\n    );\n\n    this.spells = new OseDataModelCharacterSpells(this.spells, this.#spellList);\n  }\n\n  // @todo define schema options; stuff like min/max values and so on.\n  static defineSchema() {\n    const { BooleanField, NumberField, ObjectField, SchemaField, StringField } =\n      foundry.data.fields;\n\n    return {\n      spells: new ObjectField(),\n      scores: new ObjectField(),\n      details: new ObjectField(),\n      ac: new ObjectField(),\n      aac: new ObjectField(),\n      encumbrance: CONFIG.OSE.encumbrance.defineSchema(),\n      movement: new ObjectField(),\n      config: new ObjectField(),\n      initiative: new SchemaField({\n        value: new NumberField({ integer: false, initial: 0 }),\n        mod: new NumberField({ integer: false, initial: 0 }),\n      }),\n      hp: new SchemaField({\n        hd: new StringField(),\n        value: new NumberField({ integer: true }),\n        max: new NumberField({ integer: true }),\n      }),\n      thac0: new ObjectField(),\n      languages: new ObjectField(),\n      saves: new SchemaField({\n        breath: new SchemaField({ value: new NumberField({ integer: true }) }),\n        death: new SchemaField({ value: new NumberField({ integer: true }) }),\n        paralysis: new SchemaField({\n          value: new NumberField({ integer: true }),\n        }),\n        spell: new SchemaField({ value: new NumberField({ integer: true }) }),\n        wand: new SchemaField({ value: new NumberField({ integer: true }) }),\n      }),\n      exploration: new SchemaField({\n        ft: new NumberField({ integer: true, positive: true }),\n        ld: new NumberField({ integer: true, positive: true }),\n        od: new NumberField({ integer: true, positive: true }),\n        sd: new NumberField({ integer: true, positive: true }),\n      }),\n      retainer: new SchemaField({\n        enabled: new BooleanField(),\n        loyalty: new NumberField({ integer: true }),\n        wage: new StringField(),\n      }),\n    };\n  }\n\n  /**\n   * @inheritdoc\n   */\n  static migrateData(source) {\n    this.#migrateCantrips(source);\n\n    return super.migrateData(source);\n  }\n\n  /**\n   * Ensure cantrips (level 0 spells) exist in the spells object.\n   * @param {OseDataModelCharacter} source - Source data to migrate\n   */\n  static #migrateCantrips(source) {\n    const spells = source.spells ?? {};\n\n    // If there are spells but no cantrips (level 0 spells),\n    // add an empty cantrip entry.\n    if (spells && !spells[\"0\"]) {\n      spells[\"0\"] = { max: 0, value: 0 };\n    }\n  }\n\n  // @todo This only needs to be public until\n  //       we can ditch sharing out AC/AAC.\n  // eslint-disable-next-line class-methods-use-this\n  get usesAscendingAC() {\n    return game.settings.get(game.system.id, \"ascendingAC\");\n  }\n\n  get meleeMod() {\n    const ascendingAcMod = this.usesAscendingAC ? this.thac0.bba || 0 : 0;\n    return (\n      (this.scores.str?.mod || 0) +\n      (this.thac0?.mod?.melee || 0) +\n      ascendingAcMod\n    );\n  }\n\n  get rangedMod() {\n    const ascendingAcMod = this.usesAscendingAC ? this.thac0.bba || 0 : 0;\n    return (\n      (this.scores.dex?.mod || 0) +\n      (this.thac0?.mod?.missile || 0) +\n      ascendingAcMod\n    );\n  }\n\n  get isNew() {\n    const { str, int, wis, dex, con, cha } = this.scores;\n    return ![str, int, wis, dex, con, cha].reduce(\n      (acc, el) => acc + el.value,\n      0\n    );\n  }\n\n  get containers() {\n    return getItemsOfActorOfType(\n      this.parent,\n      \"container\",\n      ({ system: { containerId } }) => !containerId\n    );\n  }\n\n  get treasures() {\n    return getItemsOfActorOfType(\n      this.parent,\n      \"item\",\n      ({ system: { treasure, containerId } }) => treasure && !containerId\n    );\n  }\n\n  get carriedTreasure() {\n    const total = this.treasures.reduce(\n      (acc, { system: { quantity, cost } }) => acc + quantity.value * cost,\n      0\n    );\n    return Math.round(total * 100) / 100;\n  }\n\n  get items() {\n    return getItemsOfActorOfType(\n      this.parent,\n      \"item\",\n      ({ system: { treasure, containerId } }) => !treasure && !containerId\n    );\n  }\n\n  get weapons() {\n    return getItemsOfActorOfType(\n      this.parent,\n      \"weapon\",\n      ({ system: { containerId } }) => !containerId\n    );\n  }\n\n  get armor() {\n    return getItemsOfActorOfType(\n      this.parent,\n      \"armor\",\n      ({ system: { containerId } }) => !containerId\n    );\n  }\n\n  get abilities() {\n    return getItemsOfActorOfType(\n      this.parent,\n      \"ability\",\n      ({ system: { containerId } }) => !containerId\n    ).sort((a, b) => (a.sort || 0) - (b.sort || 0));\n  }\n\n  get spellList() {\n    return getItemsOfActorOfType(\n      this.parent,\n      \"spell\",\n      ({ system: { containerId } }) => !containerId\n    );\n  }\n\n  get #spellList() {\n    // Maintain backwards compatibility\n    return this.spellList;\n  }\n\n  get isSlow() {\n    return this.weapons.length === 0\n      ? false\n      : this.weapons.some(\n          (item) =>\n            !(\n              item.type !== \"weapon\" ||\n              !item.system.slow ||\n              !item.system.equipped\n            )\n        );\n  }\n\n  get init() {\n    const group = game.settings.get(game.system.id, \"initiative\") !== \"group\";\n\n    return group\n      ? (this.initiative.value || 0) +\n          (this.initiative.mod || 0) +\n          this.scores.dex.init\n      : 0;\n  }\n}\n","/**\n * @file The data model for Actors of type Monster\n */\n// Encumbrance schemes\nimport OseDataModelCharacterEncumbranceDisabled from \"./data-model-classes/data-model-character-encumbrance-disabled\";\nimport OseDataModelCharacterSpells from \"./data-model-classes/data-model-character-spells\";\nimport OseDataModelCharacterMove from \"./data-model-classes/data-model-character-move\";\n\nconst getItemsOfActorOfType = (actor, filterType, filterFn = null) =>\n  actor.items\n    .filter(({ type }) => type === filterType)\n    .filter(filterFn || (() => true));\n\nexport default class OseDataModelMonster extends foundry.abstract.TypeDataModel {\n  prepareDerivedData() {\n    this.encumbrance = new OseDataModelCharacterEncumbranceDisabled();\n    this.spells = new OseDataModelCharacterSpells(this.spells, this.#spellList);\n    this.movement = new OseDataModelCharacterMove(\n      this.encumbrance,\n      (this.config.movementAuto = false),\n      this.movement.base\n    );\n  }\n\n  /**\n   * @inheritdoc\n   */\n  static migrateData(source) {\n    this.#migrateMonsterLanguages(source);\n    this.#migrateCantrips(source);\n\n    return super.migrateData(source);\n  }\n\n  /**\n   * Use an empty array for system.languages.value\n   * in order to suppress Polyglot errors.\n   *\n   * @param {OseDataModelMonster} source - Source data to migrate\n   */\n  static #migrateMonsterLanguages(source) {\n    const languages = source.languages ?? {};\n\n    // If languages.value isn't an iterable, use an empty array\n    if (typeof languages?.value?.[Symbol.iterator] !== \"function\") {\n      languages.value = [];\n    }\n  }\n\n  /**\n   * Ensure cantrips (level 0 spells) exist in the spells object.\n   * @param {OseDataModelMonster} source - Source data to migrate\n   */\n  static #migrateCantrips(source) {\n    const spells = source.spells ?? {};\n\n    // If there are spells but no cantrips (level 0 spells),\n    // add an empty cantrip entry.\n    if (spells && !spells[\"0\"]) {\n      spells[\"0\"] = { max: 0, value: 0 };\n    }\n  }\n\n  // @todo define schema options; stuff like min/max values and so on.\n  static defineSchema() {\n    const { StringField, NumberField, BooleanField, ObjectField, SchemaField } =\n      foundry.data.fields;\n\n    return {\n      spells: new ObjectField(),\n      details: new ObjectField(),\n      ac: new ObjectField(),\n      aac: new ObjectField(),\n      encumbrance: new SchemaField({\n        value: new NumberField({ integer: false }),\n        max: new NumberField({ integer: false }),\n      }),\n      movement: new ObjectField(),\n      config: new ObjectField(),\n      initiative: new SchemaField({\n        value: new NumberField({ integer: false, initial: 0 }),\n        mod: new NumberField({ integer: false, initial: 0 }),\n      }),\n      hp: new SchemaField({\n        hd: new StringField(),\n        value: new NumberField({ integer: true }),\n        max: new NumberField({ integer: true }),\n      }),\n      thac0: new ObjectField(),\n      languages: new ObjectField(),\n      saves: new SchemaField({\n        breath: new SchemaField({ value: new NumberField({ integer: true }) }),\n        death: new SchemaField({ value: new NumberField({ integer: true }) }),\n        paralysis: new SchemaField({\n          value: new NumberField({ integer: true }),\n        }),\n        spell: new SchemaField({ value: new NumberField({ integer: true }) }),\n        wand: new SchemaField({ value: new NumberField({ integer: true }) }),\n      }),\n      retainer: new SchemaField({\n        enabled: new BooleanField(),\n        loyalty: new NumberField({ integer: true }),\n        wage: new StringField(),\n      }),\n    };\n  }\n\n  // @todo This only needs to be public until\n  //       we can ditch sharing out AC/AAC.\n  // eslint-disable-next-line class-methods-use-this\n  get usesAscendingAC() {\n    return game.settings.get(game.system.id, \"ascendingAC\");\n  }\n\n  get isNew() {\n    return !Object.values(this.saves).reduce(\n      (prev, curr) => prev + (parseInt(curr?.value, 10) || 0),\n      0\n    );\n  }\n\n  get containers() {\n    return getItemsOfActorOfType(\n      this.parent,\n      \"container\",\n      ({ system: { containerId } }) => !containerId\n    );\n  }\n\n  get treasures() {\n    return getItemsOfActorOfType(\n      this.parent,\n      \"item\",\n      ({ system: { treasure, containerId } }) => treasure && !containerId\n    ).sort((a, b) => a.name.localeCompare(b.name));\n  }\n\n  get items() {\n    return getItemsOfActorOfType(\n      this.parent,\n      \"item\",\n      ({ system: { treasure, containerId } }) => !treasure && !containerId\n    ).sort((a, b) => a.name.localeCompare(b.name));\n  }\n\n  get weapons() {\n    return getItemsOfActorOfType(\n      this.parent,\n      \"weapon\",\n      ({ system: { containerId } }) => !containerId\n    ).sort((a, b) => a.name.localeCompare(b.name));\n  }\n\n  get armor() {\n    return getItemsOfActorOfType(\n      this.parent,\n      \"armor\",\n      ({ system: { containerId } }) => !containerId\n    ).sort((a, b) => a.name.localeCompare(b.name));\n  }\n\n  get abilities() {\n    return getItemsOfActorOfType(\n      this.parent,\n      \"ability\",\n      ({ system: { containerId } }) => !containerId\n    ).sort((a, b) => (a.sort || 0) - (b.sort || 0));\n  }\n\n  get attackPatterns() {\n    return [...this.weapons, ...this.abilities]\n      .sort((a, b) => {\n        // Transparent attack patterns always go last.\n        if (\n          a.system.pattern !== \"transparent\" &&\n          b.system.pattern === \"transparent\"\n        ) {\n          return -1;\n        }\n        if (\n          a.system.pattern === \"transparent\" &&\n          b.system.pattern !== \"transparent\"\n        ) {\n          return 1;\n        }\n\n        // White attack patterns are used for all general monster abilities.\n        // Put these at the end of the colors.\n        if (a.system.pattern === \"white\" && b.system.pattern !== \"white\") {\n          return 1;\n        }\n        if (b.system.pattern === \"white\" && a.system.pattern !== \"white\") {\n          return -1;\n        }\n\n        return b.type.localeCompare(a.type) || a.name.localeCompare(b.name);\n      })\n      .reduce((prev, curr) => {\n        const updated = { ...prev };\n        const { pattern } = curr.system;\n        if (!updated[pattern]) updated[pattern] = [];\n        return { ...updated, [pattern]: [...updated[pattern], curr] };\n      }, {});\n  }\n\n  get #spellList() {\n    return getItemsOfActorOfType(\n      this.parent,\n      \"spell\",\n      ({ system: { containerId } }) => !containerId\n    );\n  }\n\n  get isSlow() {\n    return this.weapons.length === 0\n      ? false\n      : this.weapons.every(\n          (item) => !(item.type !== \"weapon\" || !item.system.slow)\n        );\n  }\n\n  get init() {\n    const group = game.settings.get(game.system.id, \"initiative\") !== \"group\";\n\n    return group\n      ? (this.initiative.value || 0) + (this.initiative.mod || 0)\n      : 0;\n  }\n}\n","/**\n * @file The system-specific Item entity, containing logic for operating on all available Item types.\n */\nimport OSE from \"../config\";\nimport OseDice from \"../helpers-dice\";\n\n/**\n * Override and extend the basic :class:`Item` implementation\n */\nexport default class OseItem extends Item {\n  // Replacing default image */\n  static get defaultIcons() {\n    return {\n      spell: `${OSE.assetsPath}/default/spell.png`,\n      ability: `${OSE.assetsPath}/default/ability.png`,\n      armor: `${OSE.assetsPath}/default/armor.png`,\n      weapon: `${OSE.assetsPath}/default/weapon.png`,\n      item: `${OSE.assetsPath}/default/item.png`,\n      container: `${OSE.assetsPath}/default/bag.png`,\n    };\n  }\n\n  static async create(data, context = {}) {\n    if (data.img === undefined) {\n      data.img = this.defaultIcons[data.type];\n    }\n    return super.create(data, context);\n  }\n\n  static migrateData(source) {\n    if (source?.img === \"\" && source.type) {\n      source.img = this.defaultIcons(source.type);\n    }\n    if (source?.system?.itemslots === undefined) {\n      if (\n        (source?.system?.tags ?? []).some(\n          (tag) => tag.value === \"Two-handed\"\n        ) &&\n        source?.type === \"weapon\"\n      )\n        source.system.itemslots = 2;\n      if (source?.system?.type === \"heavy\" && source.type === \"armor\")\n        source.system.itemslots = 2;\n    }\n\n    return source;\n  }\n\n  prepareData() {\n    super.prepareData();\n  }\n\n  async prepareDerivedData() {\n    // Rich text description\n    this.system.enrichedDescription =\n      await foundry.applications.ux.TextEditor.implementation.enrichHTML(\n        this.system.description,\n        { async: true }\n      );\n  }\n\n  static chatListeners(html) {\n    // Use event delegation for buttons\n    html.addEventListener(\"click\", (event) => {\n      const button = event.target.closest(\".card-buttons button\");\n      if (button) {\n        OseItem._onChatCardAction(event);\n      }\n\n      const itemName = event.target.closest(\".item-name\");\n      if (itemName) {\n        OseItem._onChatCardToggleContent(event);\n      }\n    });\n  }\n\n  async getChatData(htmlOptions) {\n    const itemType = this.type;\n\n    const itemData = this.system;\n\n    // Item properties\n    const props = [];\n\n    if (itemType === \"weapon\") {\n      itemData.tags.forEach((t) => props.push(t.value));\n    }\n    if (itemType === \"spell\") {\n      props.push(\n        `${itemData.class} ${itemData.lvl}`,\n        itemData.range,\n        itemData.duration\n      );\n    }\n    if (itemData.hasOwnProperty(\"equipped\")) {\n      props.push(itemData.equipped ? \"Equipped\" : \"Not Equipped\");\n    }\n\n    // Filter properties and return\n    itemData.properties = props.filter((p) => !!p);\n    return itemData;\n  }\n\n  rollWeapon(options = {}) {\n    const isNPC = this.actor.type != \"character\";\n    const targets = 5;\n    const itemData = this.system;\n\n    let type = isNPC ? \"attack\" : \"melee\";\n    const rollData = {\n      item: this._source,\n      actor: this.actor,\n      roll: {\n        save: itemData.save,\n        target: null,\n      },\n    };\n\n    if (itemData.missile && itemData.melee && !isNPC) {\n      // Dialog\n      new foundry.applications.api.DialogV2({\n        window: { title: \"Choose Attack Range\" },\n        content: \"\",\n        buttons: [\n          {\n            action: \"melee\",\n            icon: \"fas fa-fist-raised\",\n            label: game.i18n.localize(\"OSE.Melee\"),\n            default: true,\n            callback: () => {\n              this.actor.targetAttack(rollData, \"melee\", options);\n            },\n          },\n          {\n            action: \"missile\",\n            icon: \"fas fa-bullseye\",\n            label: game.i18n.localize(\"OSE.Missile\"),\n            callback: () => {\n              this.actor.targetAttack(rollData, \"missile\", options);\n            },\n          },\n        ],\n      }).render(true);\n      return true;\n    }\n    if (itemData.missile && !isNPC) {\n      type = \"missile\";\n    }\n    this.actor.targetAttack(rollData, type, options);\n    return true;\n  }\n\n  async rollFormula(options = {}) {\n    const itemData = this.system;\n\n    if (!itemData.roll) {\n      throw new Error(\"This Item does not have a formula to roll!\");\n    }\n\n    const label = `${this.name}`;\n    const rollParts = [itemData.roll];\n\n    const type = itemData.rollType;\n\n    const rollData = {\n      actor: this.actor,\n      item: this._source,\n      description: null,\n      save: itemData.save,\n      properties: this.system.autoTags,\n      roll: {\n        type,\n        target: itemData.rollTarget,\n        blindroll: itemData.blindroll,\n      },\n    };\n\n    if (this.type === \"spell\") {\n      rollData.description = itemData.description\n    };\n\n    // Roll and return\n    return OseDice.Roll({\n      event: options.event,\n      parts: rollParts,\n      data: rollData,\n      skipDialog: true,\n      speaker: ChatMessage.getSpeaker({ actor: this }),\n      flavor: game.i18n.format(\"OSE.roll.formula\", { label }),\n      title: game.i18n.format(\"OSE.roll.formula\", { label }),\n    });\n  }\n\n  async spendSpell() {\n    if (this.type !== \"spell\")\n      throw new Error(\n        \"Trying to spend a spell on an item that is not a spell.\"\n      );\n\n    const itemData = this.system;\n    await this.update({\n      system: {\n        cast: itemData.cast - 1,\n      },\n    });\n\n    if (itemData.roll) {\n      await this.rollFormula()\n    } else {\n      await this.show({ skipDialog: true })\n    }\n  }\n\n  _getRollTag(data) {\n    if (data.roll) {\n      const roll = `${data.roll}${data.rollTarget ? CONFIG.OSE.roll_type[data.rollType] : \"\"\n        }${data.rollTarget ? data.rollTarget : \"\"}`;\n      return {\n        label: `${game.i18n.localize(\"OSE.items.Roll\")} ${roll}`,\n      };\n    }\n  }\n\n  _getSaveTag(data) {\n    if (data.save) {\n      return {\n        label: CONFIG.OSE.saves_long[data.save],\n        icon: \"fa-skull\",\n      };\n    }\n  }\n\n  getAutoTagList() {\n    const tagList = [];\n    const data = this.system;\n    const itemType = this.type;\n\n    switch (itemType) {\n      case \"container\":\n      case \"item\": {\n        break;\n      }\n\n      case \"weapon\": {\n        tagList.push({ label: data.damage, icon: \"fa-tint\" });\n        if (data.missile) {\n          tagList.push({\n            label: `${data.range.short}/${data.range.medium}/${data.range.long}`,\n            icon: \"fa-bullseye\",\n          });\n        }\n\n        // Push manual tags\n        data.tags.forEach((t) => {\n          tagList.push({ label: t.value });\n        });\n        break;\n      }\n\n      case \"armor\": {\n        tagList.push({ label: CONFIG.OSE.armor[data.type], icon: \"fa-tshirt\" });\n        break;\n      }\n\n      case \"spell\": {\n        tagList.push(\n          { label: data.class },\n          { label: data.range },\n          { label: data.duration }\n        );\n        break;\n      }\n\n      case \"ability\": {\n        const reqs = data.requirements.split(\",\");\n        reqs.forEach((req) => tagList.push({ label: req }));\n        break;\n      }\n    }\n\n    const rollTag = this._getRollTag(data);\n    if (rollTag) {\n      tagList.push(rollTag);\n    }\n\n    const saveTag = this._getSaveTag(data);\n    if (saveTag) {\n      tagList.push(saveTag);\n    }\n\n    return tagList;\n  }\n\n  /**\n   * Push a manual tag to the item.\n   * This will automatically fill in the checkboxes for melee, slow, and missile tags, skipping the tag list.\n   * If the tag has one of these special tags in parentheses (e.g. \"Bulky (Slow)\"), the Slow checkbox\n   * will be checked, and the tag will be added to the list with the title \"Bulky\".\n   *\n   * @param {string[]} values - The values of the tags to add.\n   * @returns {Promise<OseItem|undefined>>} - The updated Document instance, or undefined if not updated\n   */\n  async pushManualTag(values) {\n    const data = this?.system;\n    let update = [];\n    if (data.tags) {\n      update = data.tags;\n    }\n    const newData = {};\n    const regExp = /\\(([^)]+)\\)/;\n    values.forEach((val) => {\n      // Catch infos in brackets\n      const matches = regExp.exec(val);\n      let title = \"\";\n      if (matches) {\n        title = matches[1];\n        val = val.slice(0, Math.max(0, matches.index)).trim();\n      } else {\n        val = val.trim();\n        title = val;\n      }\n      // Auto fill checkboxes\n      switch (title.toLowerCase()) {\n        case CONFIG.OSE.tags.melee.toLowerCase(): {\n          newData.melee = true;\n          break;\n        }\n\n        case CONFIG.OSE.tags.slow.toLowerCase(): {\n          newData.slow = true;\n          break;\n        }\n\n        case CONFIG.OSE.tags.missile.toLowerCase(): {\n          newData.missile = true;\n          break;\n        }\n      }\n\n      // Add the tag if it has a specific title or if it is not a checkbox\n      if (\n        title !== val ||\n        (!newData.melee && !newData.slow && !newData.missile)\n      ) {\n        update.push({\n          title,\n          value: val,\n          label: val,\n        });\n      }\n\n      if (val === \"Two-handed\" && this.type === \"weapon\") {\n        newData.itemslots = 2;\n      }\n    });\n    newData.tags = update;\n    return this.update({ system: newData });\n  }\n\n  /**\n   * Remove a manual tag from the item.\n   *\n   * @param {string} value - The value of the tag to remove.\n   * @returns {Promise<OseItem|undefined>} - The updated Document instance, or undefined if not updated\n   */\n  popManualTag(value) {\n    const itemData = this.system;\n\n    const { tags } = itemData;\n    if (!tags) return;\n\n    const update = tags.filter(\n      (el) => el.value.toLowerCase() !== value.toLowerCase()\n    );\n    const newData = {\n      tags: update,\n    };\n    return this.update({ system: newData });\n  }\n\n  roll(options = {}) {\n    const itemData = this.system;\n    switch (this.type) {\n      case \"weapon\": {\n        this.rollWeapon(options);\n        break;\n      }\n\n      case \"spell\": {\n        this.spendSpell(options);\n        break;\n      }\n\n      case \"ability\": {\n        if (itemData.roll) {\n          this.rollFormula();\n        } else {\n          this.show();\n        }\n        break;\n      }\n\n      case \"item\":\n      case \"armor\": {\n        this.show();\n      }\n    }\n  }\n\n  /**\n   * Show the item to Chat, creating a chat card which contains follow up attack or damage roll options\n   *\n   * @returns {Promise}\n   */\n  async show() {\n    const itemType = this.type;\n    // Basic template rendering data\n    const token = this.actor?.token;\n    const templateData = {\n      actor: this.actor,\n      tokenId: token ? `${token.parent.id}.${token.id}` : null,\n      item: this._source,\n      itemId: this._source._id,\n      data: await this.getChatData(),\n      labels: this.labels,\n      isHealing: this.isHealing,\n      hasDamage: this.hasDamage,\n      isSpell: itemType === \"spell\",\n      hasSave: this.hasSave,\n      config: CONFIG.OSE,\n    };\n    templateData.rollFormula = new Roll(\n      templateData.data.roll,\n      templateData\n    ).formula;\n    templateData.data.properties = this.system.autoTags;\n\n    // Render the chat card template\n    const template = `${OSE.systemPath()}/templates/chat/item-card.html`;\n    const html = await foundry.applications.handlebars.renderTemplate(template, templateData);\n\n    // Basic chat message data\n    const chatData = {\n      user: game.user.id,\n      type: CONST.CHAT_MESSAGE_STYLES.OTHER,\n      content: html,\n      speaker: {\n        actor: this.actor?.id,\n        token: this.actor?.token,\n        alias: this.actor?.name,\n      },\n    };\n\n    // Toggle default roll mode\n    const rollMode = game.settings.get(\"core\", \"rollMode\");\n    if ([\"gmroll\", \"blindroll\"].includes(rollMode))\n      chatData.whisper = ChatMessage.getWhisperRecipients(\"GM\");\n    if (rollMode === \"selfroll\") chatData.whisper = [game.user.id];\n    if (rollMode === \"blindroll\") chatData.blind = true;\n\n    // Create the chat message\n    return ChatMessage.create(chatData);\n  }\n\n  /**\n   * Handle toggling the visibility of chat card content when the name is clicked\n   *\n   * @param {Event} event - The originating click event\n   * @private\n   */\n  static _onChatCardToggleContent(event) {\n    event.preventDefault();\n    const header = event.target.closest(\".item-name\");\n    const card = header.closest(\".chat-card\");\n    const content = card.querySelector(\".card-content\");\n    if (content.style.display === \"none\") {\n      $(content).slideDown(200);\n    } else {\n      $(content).slideUp(200);\n    }\n  }\n\n  static async _onChatCardAction(event) {\n    event.preventDefault();\n\n    // Extract card data\n    const button = event.target.closest(\".card-buttons button\");\n    button.disabled = true;\n    const card = button.closest(\".chat-card\");\n    const { messageId } = card.closest(\".message\").dataset;\n    const message = game.messages.get(messageId);\n    const { action } = button.dataset;\n\n    // Validate permission to proceed with the roll\n    const isTargetted = action === \"save\";\n    if (!(isTargetted || game.user.isGM || message.isAuthor)) return;\n\n    // Get the Actor from a synthetic Token\n    const actor = this._getChatCardActor(card);\n    if (!actor) return;\n\n    // Get the Item\n    const item = actor.items.get(card.dataset.itemId);\n    if (!item) {\n      return ui.notifications.error(\n        game.i18n.format(\"OSE.error.itemNoLongerExistsOnActor\", {\n          actorName: actor.name,\n          itemId: card.dataset.itemId,\n        })\n      );\n    }\n\n    // Get card targets\n    let targets = [];\n    if (isTargetted) {\n      targets = this._getChatCardTargets(card);\n    }\n\n    // Attack and Damage Rolls\n    switch (action) {\n      case \"damage\": {\n        await item.rollDamage({ event });\n        break;\n      }\n\n      case \"formula\": {\n        await item.rollFormula({ event });\n        break;\n      }\n\n      case \"save\": {\n        if (targets.length === 0) {\n          ui.notifications.error(\n            game.i18n.localize(\"OSE.error.noTokenControlled\")\n          );\n          return (button.disabled = false);\n        }\n        for (const t of targets) {\n          await t.rollSave(button.dataset.save, { event });\n        }\n\n        break;\n      }\n      // No default\n    }\n\n    // Re-enable the button\n    button.disabled = false;\n  }\n\n  static _getChatCardActor(card) {\n    // Case 1 - a synthetic actor from a Token\n    const tokenKey = card.dataset.tokenId;\n    if (tokenKey) {\n      const [sceneId, tokenId] = tokenKey.split(\".\");\n      const scene = game.scenes.get(sceneId);\n      if (!scene) return null;\n      const tokenData = scene.getEmbeddedDocument(\"Token\", tokenId);\n      if (!tokenData) return null;\n      const token = new Token(tokenData);\n      return token.actor;\n    }\n\n    // Case 2 - use Actor ID directory\n    const { actorId } = card.dataset;\n    return game.actors.get(actorId) || null;\n  }\n\n  static _getChatCardTargets(card) {\n    const { character } = game.user;\n    const { controlled } = canvas.tokens;\n    const targets = controlled.reduce(\n      (arr, t) => (t.actor ? [...arr, t.actor] : arr),\n      []\n    );\n    if (character && controlled.length === 0) targets.push(character);\n    return targets;\n  }\n}\n","import OseItem from \"../item/entity\";\n\nimport skipRollDialogCheck from \"../helpers-behaviour\";\nimport OseDice from \"../helpers-dice\";\n\n/**\n * Used in the rollAttack function to remove zeroes from rollParts arrays\n *\n * @param {[]} arr - an array\n * @returns {[]} - an array\n */\nconst removeFalsyElements = (arr) =>\n  arr.reduce((a, b) => (b ? [...a, b] : a), []);\n\nexport default class OseActor extends Actor {\n\n  static migrateData(source) {\n    // Fixing missing img\n    if (source?.img === \"\") {\n      source.img = \"icons/svg/mystery-man.svg\";\n    }\n    if (source?.prototypeToken?.texture?.img === \"\") {\n      source.prototypeToken.texture.img = \"icons/svg/mystery-man.svg\";\n    }\n    // Fixing missing movement.value by moving it to details.movement\n    if (source?.system?.movement?.value && !source?.system?.details.movement) {\n      source.system.details.movement = source.system.movement.value;\n      delete source.system.movement.value;\n    }\n\n    return source;\n  }\n\n  async update(data, options = {}) {\n    const newData = { ...data };\n    const {\n      \"system.ac.value\": acValue,\n      \"system.aac.value\": aacValue,\n      \"system.ac.mod\": acMod,\n      \"system.aac.mod\": aacMod,\n      \"system.thac0.bba\": bbaValue,\n      \"system.thac0.value\": thac0Value,\n    } = newData;\n    // Compute AAC from AC\n    if (acValue !== undefined) {\n      newData[\"system.aac.value\"] = 19 - acValue;\n    } else if (aacValue !== undefined) {\n      newData[\"system.ac.value\"] = 19 - aacValue;\n    }\n\n    // Ensure AAC and AC have the same mod value\n    if (acMod !== undefined) {\n      newData[\"system.aac.mod\"] = acMod;\n    } else if (aacMod !== undefined) {\n      newData[\"system.ac.mod\"] = aacMod;\n    }\n\n    // Compute Thac0 from BBA\n    if (thac0Value !== undefined) {\n      newData[\"system.thac0.bba\"] = 19 - thac0Value;\n    } else if (bbaValue !== undefined) {\n      newData[\"system.thac0.value\"] = 19 - bbaValue;\n    }\n\n    return super.update(newData, options);\n  }\n\n  async createEmbeddedDocuments(embeddedName, data = [], context = {}) {\n    data.map((item) => {\n      if (item.img === undefined) {\n        item.img = OseItem.defaultIcons[item.type];\n      }\n    });\n    return super.createEmbeddedDocuments(embeddedName, data, context);\n  }\n\n  /* -------------------------------------------- */\n  /*  Socket Listeners and Handlers\n    /* -------------------------------------------- */\n  getExperience(value, options = {}) {\n    const actorData = this.system;\n    const actorType = this.type;\n    // @TODO this seems like not the best spot for defining the xpKey const\n    const xpKey = \"system.details.xp.value\";\n\n    if (actorType !== \"character\") {\n      return;\n    }\n    const modified = Math.floor(\n      value + (actorData.details.xp.bonus * value) / 100\n    );\n    return this.update({\n      [xpKey]: modified + actorData.details.xp.value,\n    }).then(() => {\n      const speaker = ChatMessage.getSpeaker({ actor: this });\n      ChatMessage.create({\n        content: game.i18n.format(\"OSE.messages.GetExperience\", {\n          name: this.name,\n          value: modified,\n        }),\n        speaker,\n      });\n    });\n  }\n\n  isNew() {\n    return this.system.isNew;\n  }\n\n  /** @inheritDoc */\n  // eslint-disable-next-line no-underscore-dangle\n  async _preCreate(data, options, user) {\n    // eslint-disable-next-line no-underscore-dangle\n    await super._preCreate(data, options, user);\n\n    // If this Actor came from a Compendium, do not change the values.\n    // eslint-disable-next-line no-underscore-dangle\n    if (this._stats?.compendiumSource?.startsWith(\"Compendium.\")) return;\n\n    // Configure prototype token settings\n    const prototypeToken = {};\n    if (this.type === \"character\") {\n      Object.assign(prototypeToken, {\n        // Only set actorLink if it's not already defined\n        ...(data.prototypeToken?.actorLink === undefined && {\n          actorLink: true,\n        }),\n        ...(data.prototypeToken?.disposition === undefined && {\n          disposition: foundry.CONST.TOKEN_DISPOSITIONS.FRIENDLY,\n        }),\n      });\n    }\n    this.updateSource({ prototypeToken });\n  }\n\n  get isOwnerOrObserver() {\n    return (\n      this.isOwner ||\n      this.testUserPermission(\n        game.user,\n        CONST.DOCUMENT_OWNERSHIP_LEVELS.OBSERVER\n      )\n    );\n  }\n\n  generateSave(hd) {\n    hd = hd.includes(\"+\") ? parseInt(hd) + 1 : parseInt(hd);\n\n    // Compute saves\n    let saves = {};\n    for (let i = 0; i <= hd; i++) {\n      const tmp = CONFIG.OSE.monster_saves[i];\n      if (tmp) {\n        saves = tmp;\n      }\n    }\n\n    // Compute Thac0\n    let thac0 = 20;\n    Object.keys(CONFIG.OSE.monster_thac0).forEach((k) => {\n      if (hd < parseInt(k)) return;\n      thac0 = CONFIG.OSE.monster_thac0[k];\n    });\n\n    this.update({\n      \"system.thac0.value\": thac0,\n      \"system.thac0.bba\": 19 - thac0,\n      \"system.saves\": {\n        death: {\n          value: saves.d,\n        },\n        wand: {\n          value: saves.w,\n        },\n        paralysis: {\n          value: saves.p,\n        },\n        breath: {\n          value: saves.b,\n        },\n        spell: {\n          value: saves.s,\n        },\n      },\n    });\n  }\n\n  /* -------------------------------------------- */\n  /*  Rolls                                       */\n  /* -------------------------------------------- */\n\n  async rollHP(options = {}) {\n    const { total } = await new Roll(this.system.hp.hd).roll({ async: true });\n    return this.update({ \"system.hp\": { max: total, value: total } });\n  }\n\n  rollSave(save, options = {}) {\n    const label = game.i18n.localize(`OSE.saves.${save}.long`);\n    const rollParts = [\"1d20\"];\n    const actorData = this.system;\n    const actorType = this.type;\n\n    const data = {\n      actor: this,\n      roll: {\n        type: \"above\",\n        target: actorData.saves[save].value,\n        magic: actorType === \"character\" ? actorData.scores.wis.mod : 0,\n      },\n      details: game.i18n.format(\"OSE.roll.details.save\", { save: label }),\n    };\n\n    const rollMethod =\n      actorType === \"character\" ? OseDice.RollSave : OseDice.Roll;\n\n    // Roll and return\n    return rollMethod({\n      event: options.event,\n      parts: rollParts,\n      data,\n      skipDialog: options.fastForward || skipRollDialogCheck(options.event),\n      speaker: ChatMessage.getSpeaker({ actor: this }),\n      flavor: game.i18n.format(\"OSE.roll.save\", { save: label }),\n      title: game.i18n.format(\"OSE.roll.save\", { save: label }),\n      chatMessage: options.chatMessage,\n    });\n  }\n\n  rollMorale(options = {}) {\n    const actorData = this.system;\n\n    const rollParts = [\"2d6\"];\n\n    const data = {\n      actor: this,\n      roll: {\n        type: \"below\",\n        target: actorData.details.morale,\n      },\n    };\n\n    // Roll and return\n    return OseDice.Roll({\n      event: options.event,\n      parts: rollParts,\n      data,\n      skipDialog: true,\n      speaker: ChatMessage.getSpeaker({ actor: this }),\n      flavor: game.i18n.localize(\"OSE.roll.morale\"),\n      title: game.i18n.localize(\"OSE.roll.morale\"),\n    });\n  }\n\n  rollLoyalty(options = {}) {\n    const label = game.i18n.localize(\"OSE.roll.loyalty\");\n    const rollParts = [\"2d6\"];\n\n    const actorData = this.system;\n\n    const data = {\n      actor: this,\n      roll: {\n        type: \"below\",\n        target: actorData.retainer.loyalty,\n      },\n    };\n\n    // Roll and return\n    return OseDice.Roll({\n      event: options.event,\n      parts: rollParts,\n      data,\n      skipDialog: true,\n      speaker: ChatMessage.getSpeaker({ actor: this }),\n      flavor: label,\n      title: label,\n    });\n  }\n\n  rollReaction(options = {}) {\n    const rollParts = [\"2d6\"];\n\n    const data = {\n      actor: this,\n      roll: {\n        type: \"table\",\n        table: {\n          2: game.i18n.format(\"OSE.reaction.Hostile\", {\n            name: this.name,\n          }),\n          3: game.i18n.format(\"OSE.reaction.Unfriendly\", {\n            name: this.name,\n          }),\n          6: game.i18n.format(\"OSE.reaction.Neutral\", {\n            name: this.name,\n          }),\n          9: game.i18n.format(\"OSE.reaction.Indifferent\", {\n            name: this.name,\n          }),\n          12: game.i18n.format(\"OSE.reaction.Friendly\", {\n            name: this.name,\n          }),\n        },\n      },\n    };\n\n    // Roll and return\n    return OseDice.Roll({\n      event: options.event,\n      parts: rollParts,\n      data,\n      skipDialog: options.fastForward || skipRollDialogCheck(options.event),\n      speaker: ChatMessage.getSpeaker({ actor: this }),\n      flavor: game.i18n.localize(\"OSE.reaction.check\"),\n      title: game.i18n.localize(\"OSE.reaction.check\"),\n    });\n  }\n\n  rollCheck(score, options = {}) {\n    const actorType = this.type;\n\n    if (actorType !== \"character\") return;\n\n    const actorData = this.system;\n\n    const label = game.i18n.localize(`OSE.scores.${score}.long`);\n    const rollParts = [\"1d20\"];\n\n    const data = {\n      actor: this,\n      roll: {\n        type: \"check\",\n        target: actorData.scores[score].value,\n      },\n\n      details: game.i18n.format(\"OSE.roll.details.attribute\", {\n        score: label,\n      }),\n    };\n\n    // Roll and return\n    return OseDice.Roll({\n      event: options.event,\n      parts: rollParts,\n      data,\n      skipDialog: options.fastForward || skipRollDialogCheck(options.event),\n      speaker: ChatMessage.getSpeaker({ actor: this }),\n      flavor: game.i18n.format(\"OSE.roll.attribute\", { attribute: label }),\n      title: game.i18n.format(\"OSE.roll.attribute\", { attribute: label }),\n      chatMessage: options.chatMessage,\n    });\n  }\n\n  rollHitDice(options = {}) {\n    const actorType = this.type;\n\n    const actorData = this.system;\n\n    const label = game.i18n.localize(`OSE.roll.hd`);\n    let rollParts = [actorData.hp.hd];\n\n    if (actorType === \"character\") {\n      // A character always gains at least 1 hit point per Hit Die,\n      // regardless of CON modifier.\n      rollParts = [\n        `max(${actorData.hp.hd} + ${\n          actorData.scores.con.mod * actorData.details.level\n        }, ${actorData.hp.hd[0]})`,\n      ];\n    }\n\n    const data = {\n      actor: this,\n      roll: {\n        type: \"hitdice\",\n      },\n    };\n\n    // Roll and return\n    return OseDice.Roll({\n      event: options.event,\n      parts: rollParts,\n      data,\n      skipDialog: true,\n      speaker: ChatMessage.getSpeaker({ actor: this }),\n      flavor: label,\n      title: label,\n    });\n  }\n\n  rollAppearing(options = {}) {\n    const actorType = this.type;\n    if (actorType !== \"monster\") return;\n\n    const actorData = this.system;\n\n    const rollParts = [];\n    let label = \"\";\n    if (options.check === \"wilderness\") {\n      rollParts.push(actorData.details.appearing.w);\n      label = \"2\";\n    } else {\n      rollParts.push(actorData.details.appearing.d);\n      label = \"1\";\n    }\n    const data = {\n      actor: this,\n      roll: {\n        type: {\n          type: \"appearing\",\n        },\n      },\n    };\n\n    // Roll and return\n    return OseDice.Roll({\n      event: options.event,\n      parts: rollParts,\n      data,\n      skipDialog: true,\n      speaker: ChatMessage.getSpeaker({ actor: this }),\n      flavor: game.i18n.format(\"OSE.roll.appearing\", { type: label }),\n      title: game.i18n.format(\"OSE.roll.appearing\", { type: label }),\n    });\n  }\n\n  rollExploration(expl, options = {}) {\n    const actorType = this.type;\n    if (actorType !== \"character\") return;\n    const actorData = this.system;\n\n    const label = game.i18n.localize(`OSE.exploration.${expl}.long`);\n    const rollParts = [\"1d6\"];\n\n    const data = {\n      actor: this,\n      roll: {\n        type: \"below\",\n        target: actorData.exploration[expl],\n        blindroll: true,\n      },\n      details: game.i18n.format(\"OSE.roll.details.exploration\", {\n        expl: label,\n      }),\n    };\n\n    // Roll and return\n    return OseDice.Roll({\n      event: options.event,\n      parts: rollParts,\n      data,\n      skipDialog: options.fastForward || skipRollDialogCheck(options.event),\n      speaker: ChatMessage.getSpeaker({ actor: this }),\n      flavor: game.i18n.format(\"OSE.roll.exploration\", { exploration: label }),\n      title: game.i18n.format(\"OSE.roll.exploration\", { exploration: label }),\n    });\n  }\n\n  async rollDamage(attData, options = {}) {\n    const data = this.system;\n\n    const rollData = {\n      actor: this,\n      item: attData.item,\n      roll: {\n        type: \"damage\",\n      },\n    };\n\n    const dmgParts = [];\n    if (attData.roll?.dmg) {\n      dmgParts.push(attData.roll.dmg);\n    } else {\n      dmgParts.push(\"1d6\");\n    }\n\n    // Add Str to damage\n    if (attData.roll?.type === \"melee\" && data.scores.str.mod) {\n      dmgParts.push(data.scores.str.mod);\n    }\n\n    // Damage roll\n    return OseDice.Roll({\n      event: options.event,\n      parts: dmgParts,\n      data: rollData,\n      skipDialog: true,\n      speaker: ChatMessage.getSpeaker({ actor: this }),\n      flavor: `${attData.label} - ${game.i18n.localize(\"OSE.Damage\")}`,\n      title: `${attData.label} - ${game.i18n.localize(\"OSE.Damage\")}`,\n    });\n  }\n\n  async targetAttack(data, type, options) {\n    if (game.user.targets.size > 0) {\n      for (const t of game.user.targets.values()) {\n        data.roll.target = t;\n        await this.rollAttack(data, {\n          type,\n          skipDialog: options.skipDialog,\n        });\n      }\n    } else {\n      this.rollAttack(data, { type, skipDialog: options.skipDialog });\n    }\n  }\n\n  /**\n   * Constructs the attack roll formula for an attack\n   *\n   * @param {object} attData - the attack data\n   * @param {OseItem} attData.item - the item being used in the attack\n   * @param {OseActor} attData.actor - this actor (at least it should be!)\n   * @param {object} attData.roll - the attack roll data\n   * @param {string} attData.roll.save - the save roll that may be used against the attack\n   * @param {OseActor} attData.roll.target - the target of the attack\n   * @param {object} options - the type of attack and whether to skip the dialog\n   * @param {string} options.type - the type of attack, i.e. melee or missile\n   * @param {boolean} options.skipDialog - whether to skip the dialog\n   * @returns {OseDice.Roll} - the attack roll with completed rollParts and other data\n   */\n  rollAttack(attData, options = {}) {\n    const data = this.system;\n\n    const label = attData.item\n      ? game.i18n.format(\"OSE.roll.attacksWith\", {\n          name: attData.item.name,\n        })\n      : game.i18n.format(\"OSE.roll.attacks\", {\n          name: this.name,\n        });\n\n    const dmgParts = removeFalsyElements([\n      // Weapon damage roll value\n      attData.item?.system?.damage ?? \"1d6\",\n    ]);\n\n    // Weapon Damage Bonus\n    const globalIgnoreAttackBonusOnDamageRoll = game.settings.get(game.system.id, \"ignoreAttackBonusOnDamageRoll\");\n\n    // Global and per-actor flag to ignore bonus dmg are set\n    if (!globalIgnoreAttackBonusOnDamageRoll && !this.system.config?.ignoreBonusDamage && attData.item?.system?.bonus)\n      dmgParts.push(attData.item?.system?.bonus);\n\n    const rollParts = [\"1d20\"];\n    const ascending = game.settings.get(game.system.id, \"ascendingAC\");\n\n    if (ascending && data.thac0.bba) rollParts.push(data.thac0.bba);\n\n    // for each type of attack, add the Tweaks bonus\n    // and str/dex modifier only if it's non-zero\n    let attackMods = [];\n\n    if (options.type === \"melee\")\n      attackMods = [data.scores.str.mod, data.thac0.mod.melee];\n\n    dmgParts.push(...removeFalsyElements(attackMods));\n\n    // Add missile mod to attack roll only (missile attacks don't get bonus damage)\n    if (options.type === \"missile\")\n      attackMods = [data.scores.dex.mod, data.thac0.mod.missile];\n\n    // Add weapon bonus to attack roll only (already added to dmgParts)\n    if (attData.item) attackMods.push(attData.item?.system?.bonus);\n\n    rollParts.push(...removeFalsyElements(attackMods));\n\n    const rollData = {\n      actor: this,\n      item: attData.item,\n      itemId: attData.item?._id,\n      roll: {\n        type: options.type,\n        thac0: data.thac0.value,\n        dmg: dmgParts,\n        save: attData.roll.save,\n        target: attData.roll.target,\n      },\n    };\n    // Roll and return\n    return OseDice.Roll({\n      event: options.event,\n      parts: rollParts,\n      data: rollData,\n      skipDialog: options.skipDialog,\n      speaker: ChatMessage.getSpeaker({ actor: this }),\n      flavor: label,\n      flags: { ose: { roll: \"attack\", itemId: attData.item?._id } },\n      title: label,\n    });\n  }\n\n  /**\n   * @param {number | string} amount\n   * @param {1 | -1} multiplier\n   * @returns\n   */\n  async applyDamage(amount = 0, multiplier = 1) {\n    amount = Math.floor(parseInt(amount) * multiplier);\n\n    const { value, max } = this.system.hp;\n\n    // Update the Actor\n    return this.update({\n      \"system.hp.value\": Math.clamp(value - amount, 0, max),\n    });\n  }\n}\n","/**\n * @file The sheet class for Actors of type Monster\n */\nimport OSE from \"../config\";\nimport OseActorSheet from \"./actor-sheet\";\n\n\n/**\n * Extend the basic ActorSheet with some very simple modifications\n */\nexport default class OseActorSheetMonster extends OseActorSheet {\n  /**\n   * Extend and override the default options used by the Actor Sheet\n   *\n   * @returns {object} - The sheet's default options\n   */\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: [\"ose\", \"sheet\", \"monster\", \"actor\"],\n      template: `${OSE.systemPath()}/templates/actors/monster-sheet.html`,\n      width: 450,\n      height: 560,\n      resizable: true,\n      tabs: [\n        {\n          navSelector: \".tabs\",\n          contentSelector: \".sheet-body\",\n          initial: \"attributes\",\n        },\n      ],\n    });\n  }\n\n  /**\n   * Organize and classify Owned Items for Character sheets\n   *\n   * @param data\n   * @private\n   */\n  _prepareItems(data) {\n    // Assign and return\n    data.owned = {\n      weapons: this.actor.system.weapons,\n      items: this.actor.system.items,\n      containers: this.actor.system.containers,\n      armors: this.actor.system.armor,\n      treasures: this.actor.system.treasures,\n    };\n\n    data.attackPatterns = this.actor.system.attackPatterns;\n    data.spells = this.actor.system.spells.spellList;\n  }\n\n  /**\n   * Prepare data for rendering the Actor sheet\n   * The prepared data object contains both the actor data as well as additional sheet options\n   */\n  async getData() {\n    const data = await super.getData();\n    // Prepare owned items\n    this._prepareItems(data);\n\n    const monsterData = data?.system;\n\n    // Settings\n    data.config.morale = game.settings.get(game.system.id, \"morale\");\n    monsterData.details.treasure.link =\n      await foundry.applications.ux.TextEditor.implementation.enrichHTML(\n        monsterData.details.treasure.table,\n        { async: true }\n      );\n    data.isNew = this.actor.isNew();\n\n    data.enrichedBiography =\n      await foundry.applications.ux.TextEditor.implementation.enrichHTML(\n        this.object.system.details.biography,\n        { async: true }\n      );\n\n    // Monsters don't show an encumbrance bar\n    data.encumbranceTemplate = \"\";\n\n    return data;\n  }\n\n  /**\n   * Monster creation helpers\n   */\n  async generateSave() {\n    const choices = CONFIG.OSE.monster_saves;\n\n    const templateData = { choices };\n    const dlg = await foundry.applications.handlebars.renderTemplate(\n      `${OSE.systemPath()}/templates/actors/dialogs/monster-saves.html`,\n      templateData\n    );\n    // Create Dialog window\n    return new foundry.applications.api.DialogV2({\n      window: { title: game.i18n.localize(\"OSE.dialog.generateSaves\") },\n      position: {\n        width: 250,\n      },\n      content: dlg,\n      buttons: [\n        {\n          action: \"ok\",\n          label: game.i18n.localize(\"OSE.Ok\"),\n          icon: \"fas fa-check\",\n          default: true,\n          callback: (event, button) => {\n            const { hd } = new foundry.applications.ux.FormDataExtended(\n              button.form\n            ).object;\n            this.actor.generateSave(hd.replace(/[^\\d+.-]/g, \"\"));\n          },\n        },\n        {\n          action: \"cancel\",\n          icon: \"fas fa-times\",\n          label: game.i18n.localize(\"OSE.Cancel\"),\n          callback: () => {},\n        },\n      ],\n    }).render(true);\n  }\n\n  async _onDrop(event) {\n    super._onDrop(event);\n    let data;\n    try {\n      data = JSON.parse(event.dataTransfer.getData(\"text/plain\"));\n      if (data.type !== \"RollTable\") return;\n    } catch (error) {\n      return false;\n    }\n\n    let link = \"\";\n    if (data.pack) {\n      const tableDatum = game.packs\n        .get(data.pack)\n        .index.find((el) => el._id === data.id);\n      link = `@UUID[${data.uuid}]{${tableDatum.name}}`;\n    } else {\n      link = `@UUID[${data.uuid}]`;\n    }\n    this.actor.update({ \"system.details.treasure.table\": link });\n  }\n\n  /* -------------------------------------------- */\n  async _resetAttacks(event) {\n    return Promise.all(\n      this.actor.items\n        .filter((i) => i.type === \"weapon\")\n        .map((weapon) =>\n          weapon.update({\n            \"system.counter.value\": parseInt(weapon.system.counter.max),\n          })\n        )\n    );\n  }\n\n  async _updateAttackCounter(event) {\n    event.preventDefault();\n    const item = this._getItemFromActor(event);\n\n    if (event.target.dataset.field === \"value\") {\n      return item.update({\n        \"system.counter.value\": parseInt(event.target.value),\n      });\n    }\n    if (event.target.dataset.field === \"max\") {\n      return item.update({\n        \"system.counter.max\": parseInt(event.target.value),\n      });\n    }\n  }\n\n  _cycleAttackPatterns(event) {\n    const item = super._getItemFromActor(event);\n    const currentColor = item.system.pattern;\n    // Attack patterns include all OSE colors and transparent\n    const colors = Object.keys(CONFIG.OSE.colors);\n    colors.push(\"transparent\");\n    let index = colors.indexOf(currentColor);\n    if (index + 1 === colors.length) {\n      index = 0;\n    } else {\n      index++;\n    }\n    item.update({\n      \"system.pattern\": colors[index],\n    });\n  }\n\n  /**\n   * Activate event listeners using the prepared sheet HTML\n   *\n   * @param html - {HTML}   The prepared HTML object ready to be rendered into the DOM\n   */\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    html.find(\".morale-check a\").click((ev) => {\n      const actorObject = this.actor;\n      actorObject.rollMorale({ event: ev });\n    });\n\n    html.find(\".reaction-check a\").click((ev) => {\n      const actorObject = this.actor;\n      actorObject.rollReaction({ event: ev });\n    });\n\n    html.find(\".appearing-check a\").click((ev) => {\n      const actorObject = this.actor;\n      const check = $(ev.currentTarget).closest(\".check-field\").data(\"check\");\n      actorObject.rollAppearing({ event: ev, check });\n    });\n\n    html.find(\".treasure-table a\").contextmenu((ev) => {\n      this.actor.update({ \"system.details.treasure.table\": null });\n    });\n\n    // Everything below here is only needed if the sheet is editable\n    if (!this.options.editable) return;\n\n    html.find(\".item-reset[data-action='reset-attacks']\").click((ev) => {\n      this._resetAttacks(ev);\n    });\n\n    html\n      .find(\".counter input\")\n      .click((ev) => ev.target.select())\n      .change(this._updateAttackCounter.bind(this));\n\n    html.find(\".hp-roll\").click((ev) => {\n      this.actor.rollHP({ event: ev });\n    });\n\n    html.find(\".item-pattern\").click((ev) => this._cycleAttackPatterns(ev));\n\n    html\n      .find('button[data-action=\"generate-saves\"]')\n      .click(() => this.generateSave());\n  }\n}\n","/**\n * @file Contains helpers for tag generation\n */\n\nconst OseTags = {\n  /**\n  * Returns the formula used for dice roll calculations\n  * @param actor - The actor object which owns the item with roll data\n  * @param data.roll - The string used to generate a formula\n  * @returns tagFormula - The constructed roll formula\n  */\n  rollTagFormula({\n    actor = {},\n    data = {\n      roll: \"\",\n    },\n  } = {}) {\n\n    const formulaData = {\n      actor,\n      data,\n    };\n\n    const tagFormula = new Roll(data.roll, formulaData).formula;\n    return tagFormula;\n  },\n\n  /**\n  * Returns the roll type and target value of rolls\n  * @param rollType - Type of roll target used\n  * @returns tagTarget - The constructed type and target value\n  */\n  rollTagTarget({\n    rollType = \"\" as keyof typeof CONFIG.OSE.roll_type,\n    rollTarget = null,\n  } = {}) {\n\n    const tagTarget =\n      rollTarget === null\n        ? \"\"\n        : ` ${CONFIG.OSE.roll_type[rollType]}${rollTarget}`;\n\n    return tagTarget;\n  },\n};\n\nexport default OseTags;\n","/**\n * @file The data model for Items of type Ability\n */\nimport OseTags from \"../helpers-tags\";\n\nexport default class OseDataModelAbility extends foundry.abstract\n  .TypeDataModel {\n  static defineSchema() {\n    const { StringField, NumberField, BooleanField, ArrayField, ObjectField } =\n      foundry.data.fields;\n    return {\n      save: new StringField(),\n      pattern: new StringField(),\n      requirements: new StringField(),\n      roll: new StringField(),\n      rollType: new StringField(),\n      rollTarget: new NumberField(),\n      blindroll: new BooleanField(),\n      description: new StringField(),\n      tags: new ArrayField(new ObjectField()),\n    };\n  }\n\n  get #rollTag() {\n    if (!this.roll) return null;\n\n    const rollLabel = game.i18n.localize(\"OSE.items.Roll\");\n\n    const rollFormula = OseTags.rollTagFormula({\n      actor: this.parent?.actor,\n      data: this._source,\n    });\n\n    const rollTarget = OseTags.rollTagTarget({\n      rollType: this.rollType,\n      rollTarget: this.rollTarget,\n    });\n\n    return {\n      label: `${rollLabel} ${rollFormula}${rollTarget}`,\n    };\n  }\n\n  get #saveTag() {\n    if (!this.save) return null;\n\n    return {\n      label: CONFIG.OSE.saves_long[this.save],\n      icon: \"fa-skull\",\n    };\n  }\n\n  get manualTags() {\n    return this.tags || [];\n  }\n\n  get autoTags() {\n    return [\n      ...(this.requirements?.split(\",\").map((req) => ({ label: req.trim() })) || []),\n      this.#rollTag,\n      this.#saveTag,\n    ].filter((t) => !!t);\n  }\n}\n","/**\n * @file The data model for Items of type Armor\n */\nexport default class OseDataModelArmor extends foundry.abstract.TypeDataModel {\n  static ArmorTypes = {\n    unarmored: \"OSE.armor.unarmored\",\n    light: \"OSE.armor.light\",\n    heavy: \"OSE.armor.heavy\",\n    shield: \"OSE.armor.shield\",\n  };\n\n  static defineSchema() {\n    const {\n      SchemaField,\n      StringField,\n      NumberField,\n      BooleanField,\n      ArrayField,\n      ObjectField,\n    } = foundry.data.fields;\n    return {\n      type: new StringField({\n        initial: \"light\",\n        choices: Object.keys(OseDataModelArmor.ArmorTypes),\n      }),\n      ac: new SchemaField({\n        value: new NumberField({\n          initial: 9,\n        }),\n      }),\n      aac: new SchemaField({\n        value: new NumberField({\n          initial: 10,\n        }),\n      }),\n      description: new StringField(),\n      tags: new ArrayField(new ObjectField()),\n      equipped: new BooleanField(),\n      cost: new NumberField({ min: 0, initial: 0 }),\n      containerId: new StringField(),\n      quantity: new SchemaField({\n        value: new NumberField({ min: 0, initial: 0 }),\n        max: new NumberField({ min: 0, initial: 0 }),\n      }),\n      weight: new NumberField({ min: 0, initial: 0 }),\n      itemslots: new NumberField({ min: 0, initial: 1 }),\n    };\n  }\n\n  get manualTags() {\n    if (!this.tags) return null;\n\n    const tagNames = new Set(\n      Object.values(CONFIG.OSE.auto_tags).map(({ label }) => label)\n    );\n    return this.tags\n      .filter(({ value }) => !tagNames.has(value))\n      .map(({ title, value }) => ({\n        title,\n        value,\n        label: value,\n      }));\n  }\n\n  get autoTags() {\n    const tagNames = Object.values(CONFIG.OSE.auto_tags);\n\n    const autoTags = this.tags.map(({ value }) =>\n      tagNames.find(({ label }) => value === label)\n    );\n\n    return [\n      { label: OseDataModelArmor.ArmorTypes[this.type], icon: \"fa-tshirt\" },\n      ...autoTags,\n      ...this.manualTags,\n    ]\n      .flat()\n      .filter((t) => !!t);\n  }\n}\n","/**\n * @file The data model for Items of type Container\n */\nexport default class OseDataModelContainer extends foundry.abstract\n  .TypeDataModel {\n  static defineSchema() {\n    const {\n      SchemaField,\n      StringField,\n      NumberField,\n      ArrayField,\n      ObjectField,\n      BooleanField,\n    } = foundry.data.fields;\n    return {\n      itemIds: new ArrayField(new StringField()),\n      description: new StringField(),\n      tags: new ArrayField(new ObjectField()),\n      equipped: new BooleanField(),\n      cost: new NumberField({ min: 0, initial: 0 }),\n      containerId: new StringField(),\n      quantity: new SchemaField({\n        value: new NumberField({ min: 0, initial: 0 }),\n        max: new NumberField({ min: 0, initial: 0 }),\n      }),\n      weight: new NumberField({ min: 0, initial: 0 }),\n      itemslots: new NumberField({ min: 0, initial: 1 }),\n    };\n  }\n\n  get contents() {\n    if (!this.itemIds) return null;\n    if (!this?.parent?.parent?.items) return null;\n    const { id } = this.parent;\n    return this.parent.parent.items.filter(\n      ({ system: { containerId } }) => id === containerId\n    );\n  }\n\n  get totalWeight() {\n    if (!this.contents) return 0;\n\n    return this.contents.reduce(\n      (acc, { system: { weight, quantity } }) =>\n        acc + weight * (quantity?.value || 1),\n      0\n    );\n  }\n\n  get manualTags() {\n    if (!this.tags) return null;\n\n    const tagNames = new Set(\n      Object.values(CONFIG.OSE.auto_tags).map(({ label }) => label)\n    );\n    return this.tags\n      .filter(({ value }) => !tagNames.has(value))\n      .map(({ title, value }) => ({ title, value, label: value }));\n  }\n\n  get autoTags() {\n    const tagNames = Object.values(CONFIG.OSE.auto_tags);\n\n    const autoTags = this.tags.map(({ value }) =>\n      tagNames.find(({ label }) => value === label)\n    );\n\n    return [...autoTags, ...this.manualTags].flat().filter((t) => !!t);\n  }\n}\n","/**\n * @file The data model for Items of type Ability\n */\nexport default class OseDataModelItem extends foundry.abstract.TypeDataModel {\n  static defineSchema() {\n    const {\n      SchemaField,\n      StringField,\n      NumberField,\n      BooleanField,\n      ArrayField,\n      ObjectField,\n    } = foundry.data.fields;\n    return {\n      treasure: new BooleanField(),\n      description: new StringField(),\n      tags: new ArrayField(new ObjectField()),\n      equipped: new BooleanField(),\n      cost: new NumberField({ min: 0, initial: 0 }),\n      containerId: new StringField(),\n      quantity: new SchemaField({\n        value: new NumberField({ min: 0, initial: 1 }),\n        max: new NumberField({ min: 0, initial: 0 }),\n      }),\n      weight: new NumberField({ min: 0, initial: 0 }),\n      itemslots: new NumberField({ min: 0, initial: 0 }),\n    };\n  }\n\n  get cumulativeWeight() {\n    return this.weight * this.quantity.value;\n  }\n\n  get cumulativeCost() {\n    return this.cost * this.quantity.value;\n  }\n\n  get cumulativeItemslots() {\n    return Math.ceil(this.itemslots * this.quantity.value);\n  }\n\n  static migrateData(source) {\n    if (source.details?.description && !source.description)\n      source.description = source.details.description;\n    return source;\n  }\n\n  get manualTags() {\n    if (!this.tags) return null;\n\n    const tagNames = new Set(\n      Object.values(CONFIG.OSE.auto_tags).map(({ label }) => label)\n    );\n    return this.tags\n      .filter(({ value }) => !tagNames.has(value))\n      .map(({ title, value }) => ({ title, value, label: value }));\n  }\n\n  get autoTags() {\n    const tagNames = Object.values(CONFIG.OSE.auto_tags);\n\n    const autoTags = this.tags.map(({ value }) =>\n      tagNames.find(({ label }) => value === label)\n    );\n\n    return [...autoTags, ...this.manualTags].flat().filter((t) => !!t);\n  }\n\n  get isCoinsOrGems() {\n    if (!this.treasure) return false;\n\n    if (\n      this.tags?.some(\n        (t) =>\n          t.value === \"gem\" ||\n          t.value === \"gems\" ||\n          t.value === \"coin\" ||\n          t.value === \"coins\"\n      )\n    ) {\n      return true;\n    }\n\n    if (!this.parent?.name) return false;\n\n    const itemName = this.parent.name.toLowerCase();\n    if (itemName.endsWith(\" coins\")) return true;\n\n    const coins = [\n      \"cp\",\n      \"sp\",\n      \"ep\",\n      \"gp\",\n      \"pp\",\n      game.i18n.localize(\"OSE.items.gp.short\").toLowerCase(),\n      game.i18n.localize(\"OSE.items.gp.long\").toLowerCase(),\n      \"[00.01] copper (cp)\",\n      \"[00.10] silver (sp)\",\n      \"[00.50] electrum (ep)\",\n      \"[01.00] gold (gp)\",\n      \"[10.00] platinum (pp)\",\n    ];\n\n    return coins.includes(itemName);\n  }\n}\n","/**\n * @file The data model for Items of type Spell\n */\nimport OseTags from \"../helpers-tags\";\n\nexport default class OseDataModelSpell extends foundry.abstract.TypeDataModel {\n  static defineSchema() {\n    const { StringField, NumberField, ArrayField, ObjectField } =\n      foundry.data.fields;\n    return {\n      save: new StringField(),\n      lvl: new NumberField({ integer: true, min: 0 }),\n      class: new StringField(),\n      duration: new StringField(),\n      range: new StringField(),\n      roll: new StringField(),\n      memorized: new NumberField({ min: 0 }),\n      cast: new NumberField({ min: 0 }),\n      description: new StringField(),\n      tags: new ArrayField(new ObjectField()),\n    };\n  }\n\n  get #rollTag() {\n    if (!this.roll) return null;\n\n    const rollLabel = game.i18n.localize(\"OSE.items.Roll\");\n\n    const rollFormula = OseTags.rollTagFormula({\n      actor: this.parent?.actor,\n      data: this._source,\n    });\n\n    return {\n      label: `${rollLabel} ${rollFormula}`,\n    };\n  }\n\n  get #saveTag() {\n    if (!this.save) return null;\n\n    return {\n      label: CONFIG.OSE.saves_long[this.save],\n      icon: \"fa-skull\",\n    };\n  }\n\n  get manualTags() {\n    return this.tags || [];\n  }\n\n  get autoTags() {\n    return [\n      { label: this.class ?? \"\" },\n      { label: this.range ?? \"\" },\n      { label: this.duration ?? \"\" },\n      this.#rollTag,\n      this.#saveTag,\n    ].filter((t) => !!t);\n  }\n}\n","/**\n * @file The data model for Items of type Weapon\n */\nexport default class OseDataModelWeapon extends foundry.abstract.TypeDataModel {\n  static defineSchema() {\n    const {\n      SchemaField,\n      StringField,\n      NumberField,\n      BooleanField,\n      ArrayField,\n      ObjectField,\n    } = foundry.data.fields;\n    return {\n      damage: new StringField(),\n      description: new StringField(),\n      tags: new ArrayField(new ObjectField()),\n      equipped: new BooleanField(),\n      save: new StringField(),\n      range: new SchemaField({\n        short: new NumberField({ integer: true, min: 0, initial: 0 }),\n        medium: new NumberField({ integer: true, min: 0, initial: 0 }),\n        long: new NumberField({ integer: true, min: 0, initial: 0 }),\n      }),\n      bonus: new NumberField({}),\n      pattern: new StringField(),\n      missile: new BooleanField(),\n      melee: new BooleanField({ initial: true }),\n      slow: new BooleanField(),\n      counter: new SchemaField({\n        value: new NumberField({ integer: true, min: 0, initial: 0 }),\n        max: new NumberField({ integer: true, min: 0, initial: 0 }),\n      }),\n      cost: new NumberField({ min: 0, initial: 0 }),\n      containerId: new StringField(),\n      quantity: new SchemaField({\n        value: new NumberField({ min: 0 }),\n        max: new NumberField({ min: 0 }),\n      }),\n      weight: new NumberField({ min: 0 }),\n      itemslots: new NumberField({ min: 0, initial: 1 }),\n    };\n  }\n\n  get #missileTag() {\n    if (!this.missile) return null;\n    return [\n      CONFIG.OSE.auto_tags.missile,\n      {\n        label: `${this.range.short}/${this.range.medium}/${this.range.long}`,\n        icon: \"fa-bullseye\",\n      },\n    ];\n  }\n\n  get #meleeTag() {\n    if (!this.melee) return null;\n    return CONFIG.OSE.auto_tags.melee;\n  }\n\n  get #slowTag() {\n    if (!this.slow) return null;\n    return CONFIG.OSE.auto_tags.slow;\n  }\n\n  get #saveTag() {\n    if (!this.save) return null;\n\n    return {\n      label: CONFIG.OSE.saves_long[this.save],\n      icon: \"fa-skull\",\n    };\n  }\n\n  get manualTags() {\n    if (!this.tags) return null;\n\n    const tagNames = new Set(\n      Object.values(CONFIG.OSE.auto_tags).map(({ label }) => label)\n    );\n    return this.tags.filter(({ value }) => !tagNames.has(value));\n  }\n\n  /**\n   * Icons that display in the inventory grid's weapon row, under \"Qualities\"\n   *\n   * @returns {Array} - An array of qualities that display in the \"Qualities\" column on an Actor's Inventory sheet\n   */\n  get qualities() {\n    return [\n      ...this.autoTags\n        .filter((t) => !!t.image)\n        .map((t) => ({\n          ...t,\n          title: t.label,\n        })),\n      ...this.manualTags,\n    ];\n  }\n\n  get autoTags() {\n    const tagNames = Object.values(CONFIG.OSE.auto_tags);\n\n    const autoTags = this.tags.map(({ value }) =>\n      tagNames.find(({ label }) => value === label)\n    );\n\n    return [\n      { label: this.damage ?? \"\", icon: \"fa-tint\" },\n      this.#meleeTag,\n      this.#missileTag,\n      this.#slowTag,\n      ...autoTags,\n      this.#saveTag,\n    ]\n      .flat()\n      .filter((t) => !!t);\n  }\n}\n","/**\n * @file The system-level sheet for items of any type\n */\nimport OSE from \"../config\";\n\n/**\n * Extend the basic ItemSheet with some very simple modifications\n */\nexport default class OseItemSheet extends foundry.appv1.sheets.ItemSheet {\n  /**\n   * Extend and override the default options used by the Simple Item Sheet\n   *\n   * @returns {object}\n   */\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: [\"ose\", \"sheet\", \"item\"],\n      width: 520,\n      height: 390,\n      resizable: true,\n      tabs: [\n        {\n          navSelector: \".tabs\",\n          contentSelector: \".sheet-body\",\n          initial: \"description\",\n        },\n      ],\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /** @override */\n  get template() {\n    const path = `${OSE.systemPath()}/templates/items`;\n    return `${path}/${this.item.type}-sheet.html`;\n  }\n\n  /**\n   * Prepare data for rendering the Item sheet\n   * The prepared data object contains both the actor data as well as additional sheet options\n   *\n   * @returns {object} Data for the Handlebars template\n   */\n  async getData() {\n    const { data } = super.getData();\n    data.editable = this.document.sheet.isEditable;\n    data.config = {\n      ...CONFIG.OSE,\n      encumbrance: game.settings.get(game.system.id, \"encumbranceOption\"),\n    };\n    data.enriched = {\n      description: await foundry.applications.ux.TextEditor.implementation.enrichHTML(\n        this.item.system?.description || \"\",\n        { async: true }\n      ),\n    };\n    return data;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Activate event listeners using the prepared sheet HTML\n   *\n   * @param {JQuery} html - The prepared HTML object ready to be rendered into the DOM\n   */\n  activateListeners(html) {\n    html.find('input[data-action=\"add-tag\"]').keypress((ev) => {\n      if (ev.which === 13) {\n        const value = $(ev.currentTarget).val();\n        const values = value.split(\",\");\n        this.object.pushManualTag(values);\n      }\n    });\n    html.find(\".tag-delete\").click((ev) => {\n      const value = ev.currentTarget.parentElement.dataset.tag;\n      this.object.popManualTag(value);\n    });\n    html.find(\"a.melee-toggle\").click(() => {\n      this.object.update({ \"system.melee\": !this.object.system.melee });\n    });\n\n    html.find(\"a.missile-toggle\").click(() => {\n      this.object.update({ \"system.missile\": !this.object.system.missile });\n    });\n\n    super.activateListeners(html);\n  }\n}\n","/**\n * @file A collection of helper utils for chat cards\n */\nimport OseActor from \"./actor/entity\";\n\nimport { OseContextMenuEntry } from \"../global\";\n\n/**\n * Apply damage to a target actor\n *\n * @param {Actor | null} actor - The target actor to apply damage to\n * @param {string} amount - The amount of damage to apply\n * @param {1 | -1} multiplier - The multiplier to apply to the damage\n * @param {string} nameOrId - The name or ID of the target actor\n */\nasync function applyDamageToTarget(\n  actor: Actor | null,\n  amount: string,\n  multiplier: 1 | -1,\n  nameOrId: string\n) {\n  if (!game.user?.isGM || !(actor instanceof OseActor)) {\n    ui.notifications?.error(\n      game.i18n.format(\"OSE.error.cantDealDamageTo\", { nameOrId })\n    );\n    return;\n  }\n  await actor.applyDamage(amount, multiplier);\n}\n\n/**\n * Apply rolled dice damage to the token or tokens which are currently controlled.\n * This allows for damage to be scaled by a multiplier to account for healing, critical hits, or resistance\n *\n * @param {HTMLElement} html - The chat entry which contains the roll data\n * @param {number} multiplier - A damage multiplier to apply to the rolled damage.\n */\nfunction applyChatCardDamage(html: HTMLElement, multiplier: 1 | -1) {\n  const diceTotalTargets = html.querySelectorAll(\".dice-total\");\n  const lastDiceTotalTarget = diceTotalTargets[\n    diceTotalTargets.length - 1\n  ] as HTMLElement;\n  const amount = lastDiceTotalTarget?.textContent || \"0\";\n  const dmgTgt = game.settings.get(game.system.id, \"applyDamageOption\");\n  if (dmgTgt === CONFIG.OSE.apply_damage_options.originalTarget) {\n    const victimId = (html.querySelector(\".chat-target\") as HTMLElement)\n      ?.dataset.id;\n    (async () => {\n      const actor = ((await fromUuid(victimId || \"\")) as TokenDocument)?.actor;\n      await applyDamageToTarget(\n        actor,\n        amount,\n        multiplier,\n        actor?.name || victimId || \"original target\"\n      );\n    })();\n  }\n  if (dmgTgt === CONFIG.OSE.apply_damage_options.targeted) {\n    game.user?.targets.forEach((t) =>\n      applyDamageToTarget(t.actor, amount, multiplier, t.name)\n    );\n  }\n  if (dmgTgt === CONFIG.OSE.apply_damage_options.selected) {\n    canvas.tokens?.controlled.forEach((t) =>\n      applyDamageToTarget(t.actor, amount, multiplier, t.name)\n    );\n  }\n}\n\n/**\n * Check if the chat card can apply damage\n *\n * @param {HTMLElement} html - The chat card HTML element\n */\nfunction canApplyDamage(html: HTMLElement) {\n  if (!game.user?.isGM) return false;\n\n  if (!html.querySelector(\".dice-total\")) return false;\n  const applyDamageOption = game.settings.get(\n    game.system.id,\n    \"applyDamageOption\"\n  );\n  switch (applyDamageOption) {\n    case CONFIG.OSE.apply_damage_options.originalTarget:\n      const chatTargets = html.querySelectorAll(\".chat-target\");\n      const lastChatTarget = chatTargets[chatTargets.length - 1] as HTMLElement;\n      return !!lastChatTarget?.dataset.id;\n\n    case CONFIG.OSE.apply_damage_options.targeted:\n      return !!game.user?.targets?.size;\n\n    case CONFIG.OSE.apply_damage_options.selected:\n      return !!canvas.tokens?.controlled.length;\n\n    default:\n      ui.notifications?.error(\n        game.i18n.format(\"OSE.error.unexpectedSettings\", {\n          configName: \"applyDamageOption\",\n          configValue: applyDamageOption,\n        })\n      );\n      return false;\n  }\n}\n\nconst canApply: OseContextMenuEntry[\"condition\"] = (li) => canApplyDamage(li);\n\n/**\n * This function is used to hook into the Chat Log context menu to add additional options to each message\n * These options make it easy to conveniently apply damage to controlled tokens based on the value of a Roll\n *\n * @param {object} _ - Unused jQuery collection\n * @param {Array} options - The list of context menu options\n * @returns {undefined}\n */\nexport const addChatMessageContextOptions = (\n  _: HTMLElement,\n  options: OseContextMenuEntry[]\n) => {\n  options.push(\n    {\n      name: game.i18n.localize(\"OSE.messages.applyDamage\"),\n      icon: '<i class=\"fas fa-user-minus\"></i>',\n      condition: canApply,\n      callback: (li) => applyChatCardDamage(li, 1),\n    },\n    {\n      name: game.i18n.localize(\"OSE.messages.applyHealing\"),\n      icon: '<i class=\"fas fa-user-plus\"></i>',\n      condition: canApply,\n      callback: (li) => applyChatCardDamage(li, -1),\n    }\n  );\n  return options;\n};\n\n/* -------------------------------------------- */\n\nexport const addChatMessageButtons = (msg: ChatMessage, html: HTMLElement) => {\n  // Hide blind rolls\n  const blindable = html.querySelector(\".blindable\") as HTMLElement;\n  if (\n    // @ts-ignore need to add ChatMessage document property updates.\n    msg?.blind &&\n    !game.user?.isGM &&\n    blindable &&\n    blindable.dataset.blind === \"true\"\n  ) {\n    blindable.outerHTML =\n      \"<div class='dice-roll'><div class='dice-result'><div class='dice-formula'>???</div></div></div>\";\n  }\n  // Buttons\n  const roll = html.querySelector(\".damage-roll\");\n  if (roll && canApplyDamage(html)) {\n    const diceDamageDiv = document.createElement(\"div\");\n    diceDamageDiv.className = \"dice-damage\";\n\n    const button = document.createElement(\"button\");\n    button.type = \"button\";\n    button.dataset.action = \"apply-damage\";\n    button.innerHTML = '<i class=\"fas fa-tint\"></i>';\n\n    diceDamageDiv.append(button);\n    roll.append(diceDamageDiv);\n\n    button.addEventListener(\"click\", (ev) => {\n      ev.preventDefault();\n      applyChatCardDamage(html, 1);\n    });\n  }\n};\n\nexport const functionsForTesting = {\n  applyChatCardDamage,\n};\n","/**\n * @file Helper functions related to treasure table rolls\n */\nimport { OSE } from \"./config\";\n\n// eslint-disable-next-line import/prefer-default-export\nexport const augmentTable = (table, html) => {\n  // Treasure Toggle\n  const isTreasureTable = Boolean(\n    table.document.getFlag(game.system.id, \"treasure\")\n  );\n\n  const treasureTableToggle = document.createElement(\"div\");\n  treasureTableToggle.className = \"toggle-treasure\";\n  treasureTableToggle.title = \"Toggle Treasure Table\";\n  if (isTreasureTable) {\n    treasureTableToggle.classList.add(\"active\");\n  }\n\n  const head = html.querySelector(\".sheet-header\");\n  head.append(treasureTableToggle);\n\n  html.querySelector(\".toggle-treasure\").addEventListener(\"click\", () => {\n    const isTreasure = Boolean(\n      table.document.getFlag(game.system.id, \"treasure\")\n    );\n    table.document.setFlag(game.system.id, \"treasure\", !isTreasure);\n  });\n\n  // Treasure table formatting\n  if (!isTreasureTable) {\n    return;\n  }\n\n  // Hide irrelevant standard fields\n  const rangeFields = html.querySelectorAll(\".range\");\n  rangeFields.forEach((el) => {\n    el.style.display = \"none\";\n  });\n  const normalizeResults = html.querySelector(\"button[data-action=normalizeResults]\");\n  if (normalizeResults) {\n    normalizeResults.remove();\n  }\n\n  const chanceHeader = html.querySelector(\"thead .weight\");\n  if (chanceHeader) chanceHeader.textContent = \"Chance (%)\";\n\n  const chanceColumn = html.querySelectorAll(\".weight\");\n  chanceColumn.forEach((col) => {\n    col.style.flex = \"0 0 75px\";\n  });\n\n  const formula = html.querySelector(\"input[name=formula]\");\n  if (formula) {\n    formula.value = \"1d100\";\n    formula.disabled = true;\n  }\n\n  // Replace Roll button\n  const rollButton = document.createElement(\"button\");\n  rollButton.className = \"roll-treasure\";\n  rollButton.type = \"button\";\n  rollButton.innerHTML = `<i class=\"fas fa-gem\"></i> ${game.i18n.localize(\n    \"OSE.table.treasure.roll\"\n  )}`;\n\n  const footerRoll = html.querySelector(\".form-footer [data-action='drawResult']\");\n  footerRoll.replaceWith(rollButton);\n\n  rollButton.addEventListener(\"click\", (ev) => {\n    rollTreasure(table.document, { event: ev });\n  });\n};\n\n/**\n *\n * @param table\n * @param data\n */\nasync function drawTreasure(table, data) {\n  const percent = async (chance) => {\n    const roll = new Roll(\"1d100\");\n    await roll.evaluate();\n    return roll.total <= chance;\n  };\n  data.treasure = {};\n  if (table.getFlag(game.system.id, \"treasure\")) {\n    for (const r of table.results) {\n      if (await percent(r.weight)) {\n        const text = await r.getHTML();\n        data.treasure[r.id] = {\n          img: r.img,\n          text: await foundry.applications.ux.TextEditor.implementation.enrichHTML(text, { async: true }),\n        };\n        const parsedUuid = foundry.utils.parseUuid(r.documentUuid);\n        const documentCollection = parsedUuid?.collection?.metadata?.id ?? parsedUuid?.documentType ?? \"\";\n        if (\n          r.type === CONST.TABLE_RESULT_TYPES.DOCUMENT &&\n          documentCollection === \"RollTable\"\n        ) {\n          const embeddedTable = await fromUuid(r.documentUuid);\n          await drawTreasure(embeddedTable, data.treasure[r.id]);\n        }\n      }\n    };\n  } else {\n    const { results } = await table.roll();\n    for (const s of results) {\n      data.treasure[s.id] = { img: s.img, text: await s.getHTML() };\n    };\n  }\n  return data;\n}\n\n/**\n *\n * @param table\n * @param options\n */\nexport async function rollTreasure(table, options = {}) {\n  // Draw treasure\n  const data = await drawTreasure(table, {});\n  const templateData = {\n    treasure: data.treasure,\n    table,\n  };\n\n  // Animation\n  if (options.event) {\n    const results = $(options.event.currentTarget.parentElement)\n      .prev()\n      .find(\".table-result\");\n    results.each((_, item) => {\n      item.classList.remove(\"active\");\n      if (data.treasure[item.dataset.resultId]) {\n        item.classList.add(\"active\");\n      }\n    });\n  }\n\n  await new Promise(resolve => requestAnimationFrame(resolve));\n  const html = await foundry.applications.handlebars.renderTemplate(\n    `${OSE.systemPath()}/templates/chat/roll-treasure.html`,\n    templateData\n  );\n\n  const chatData = {\n    content: html,\n    // sound: \"systems/ose/assets/coins.mp3\"\n  };\n\n  const rollMode = game.settings.get(\"core\", \"rollMode\");\n  if ([\"gmroll\", \"blindroll\"].includes(rollMode))\n    chatData.whisper = ChatMessage.getWhisperRecipients(\"GM\");\n  if (rollMode === \"selfroll\") chatData.whisper = [game.user._id];\n  if (rollMode === \"blindroll\") chatData.blind = true;\n\n  ChatMessage.create(chatData);\n}\n\nexport const functionsForTesting = {\n  drawTreasure,\n  rollTreasure,\n};\n","/**\n * @file Functions that make working with hotbar macros easier\n */\nimport { rollTreasure } from \"./helpers-treasure\";\n\n/* -------------------------------------------- */\n/*  Hotbar Macros                               */\n/* -------------------------------------------- */\n\n/**\n * Create a Macro from an Item drop.\n * Get an existing item macro if one exists, otherwise create a new one.\n *\n * @param {object} data - The dropped data\n * @param {number} slot - The hotbar slot to use\n * @returns {Promise} - Promise of assigned macro or a notification\n */\nexport async function createOseMacro(data, slot) {\n  if (data.type === \"Macro\") {\n    return game.user.assignHotbarMacro(await fromUuid(data.uuid), slot);\n  }\n  if (data.type === \"RollTable\") {\n    const command = `game.ose.rollTableMacro(\"${data.uuid}\");`;\n    const table = await fromUuid(data.uuid);\n    const macro = await Macro.create({\n      name: table.name,\n      type: \"script\",\n      img: table.img,\n      command,\n      flags: { \"ose.tableMacro\": true },\n    });\n    return game.user.assignHotbarMacro(macro, slot);\n  }\n  if (data.type !== \"Item\")\n    return ui.notifications.warn(\n      game.i18n.localize(\"OSE.warn.macrosNotAnItem\")\n    );\n  if (data.uuid.indexOf(\"Item.\") <= 0)\n    return ui.notifications.warn(\n      game.i18n.localize(\"OSE.warn.macrosOnlyForOwnedItems\")\n    );\n  const { item } = data;\n\n  // Create the macro command\n  const command = `game.ose.rollItemMacro(\"${item.name}\");`;\n  let macro = game.macros.contents.find(\n    (m) => m.name === item.name && m.command === command\n  );\n  if (!macro || macro.ownership[game.userId] === undefined) {\n    macro = await Macro.create({\n      name: item.name,\n      type: \"script\",\n      img: item.img,\n      command,\n      flags: { \"ose.itemMacro\": true },\n    });\n  }\n  return game.user.assignHotbarMacro(macro, slot);\n}\n\n/* -------------------------------------------- */\n\n/**\n * Create a Macro from an Item drop.\n * Get an existing item macro if one exists, otherwise create a new one.\n *\n * @param {string} itemName - Name of item to roll\n * @returns {Promise} - Promise of item roll or notification\n */\nexport function rollItemMacro(itemName) {\n  const speaker = ChatMessage.getSpeaker();\n  // Active actor, or inactive actor + token on scene allowed\n  if (!(speaker.actor && speaker.scene))\n    return ui.notifications.warn(\n      game.i18n.localize(\"OSE.warn.macrosNoTokenOwnedInScene\")\n    );\n\n  let actor;\n  if (speaker.token) actor = game.actors.tokens[speaker.token];\n  if (!actor) actor = game.actors.get(speaker.actor);\n\n  // Get matching items\n  const items = actor ? actor.items.filter((i) => i.name === itemName) : [];\n  if (items.length > 1) {\n    ui.notifications.warn(\n      game.i18n.format(\"OSE.warn.moreThanOneItemWithName\", {\n        actorName: actor.name,\n        itemName,\n      })\n    );\n  } else if (items.length === 0) {\n    return ui.notifications.error(\n      game.i18n.format(\"OSE.error.noItemWithName\", {\n        actorName: actor.name,\n        itemName,\n      })\n    );\n  }\n  const item = items[0];\n\n  // Trigger the item roll\n  return item.roll();\n}\n\n/**\n * Roll on a RollTable by uuid if it exists.\n *\n * @param {string} tableUuId - UuId of the RollTable\n */\nexport function rollTableMacro(tableUuId) {\n  fromUuid(tableUuId).then((table) => {\n    if (table === null) {\n      return ui.notifications.error(\n        game.i18n.format(\"OSE.error.noRollTableWithUuId\", {\n          uuid: tableUuId,\n        })\n      );\n    }\n    //\n\n    if (table.getFlag(game.system.id, \"treasure\")) {\n      return rollTreasure(table);\n    }\n    return table.draw({ displayChat: true });\n  });\n}\n","/**\n * @file Static OseParty methods\n */\n\nconst OseParty = {\n  /**\n   * Returns all characters currently in the Party\n   *\n   * @public\n   * @returns {OseActor[]} - A list of party members\n   */\n  get currentParty() {\n    return game.actors.filter(\n      (act) =>\n        act.type === \"character\" &&\n        act.flags[game.system.id] &&\n        act.flags[game.system.id].party === true\n    );\n  },\n};\n\nexport default OseParty;\n","/**\n * @file An application for dispensing XP to party members\n */\nimport OSE from \"../config\";\nimport OseParty from \"./party\";\n\nexport default class OsePartyXP extends FormApplication {\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: [\"ose\", \"dialog\", \"party-xp\"],\n      template: `${OSE.systemPath()}/templates/apps/party-xp.html`,\n      width: 300,\n      height: \"auto\",\n      resizable: false,\n      closeOnSubmit: true,\n    });\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add the Entity name into the window title\n   *\n   * @type {string}\n   */\n  // eslint-disable-next-line class-methods-use-this\n  get title() {\n    return game.i18n.localize(\"OSE.dialog.xp.deal\");\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Construct and return the data object used to render the HTML template for this form application.\n   *\n   * @returns {object}\n   */\n  getData() {\n    return {\n      actors: OseParty.currentParty,\n      data: this.object,\n      config: CONFIG.OSE,\n      user: game.user,\n      settings: game.settings,\n    };\n  }\n\n  // eslint-disable-next-line no-underscore-dangle, class-methods-use-this\n  _onDrop(event) {\n    event.preventDefault();\n    // WIP Drop Item Quantity\n    let data;\n    try {\n      data = JSON.parse(event.dataTransfer.getData(\"text/plain\"));\n      if (data.type !== \"Item\") return;\n    } catch (error) {\n      return false;\n    }\n  }\n  /* -------------------------------------------- */\n\n  // eslint-disable-next-line no-underscore-dangle\n  _updateObject(event) {\n    // eslint-disable-next-line no-underscore-dangle\n    this._dealXP(event);\n  }\n\n  // eslint-disable-next-line no-underscore-dangle\n  _calculateShare() {\n    const { currentParty } = OseParty;\n\n    const html = $(this.form);\n    const totalXP = html.find('input[name=\"total\"]').val();\n    const baseXpShare = parseFloat(totalXP) / currentParty.length;\n\n    currentParty.forEach((a) => {\n      const actorData = a?.system;\n      const xpShare = Math.floor(\n        (actorData.details.xp.share / 100) * baseXpShare\n      );\n      html.find(`li[data-actor-id='${a.id}'] input`).val(xpShare);\n    });\n  }\n\n  // eslint-disable-next-line no-underscore-dangle\n  _dealXP() {\n    const html = $(this.form);\n    const rows = html.find(\".actor\");\n    rows.each((_, row) => {\n      const qRow = $(row);\n      const value = qRow.find(\"input\").val();\n      const id = qRow.data(\"actorId\");\n      const actor = OseParty.currentParty.find((e) => e.id === id);\n      if (value) {\n        actor.getExperience(Math.floor(parseInt(value, 10)));\n      }\n    });\n  }\n\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    const totalField = html.find('input[name=\"total\"]');\n    // eslint-disable-next-line no-underscore-dangle\n    totalField.on(\"input\", this._calculateShare.bind(this));\n\n    html.find('button[data-action=\"deal-xp\"').click((event) => {\n      super.submit(event);\n    });\n  }\n}\n","/**\n * @file An application for managing the current party.\n */\nimport OSE from \"../config\";\nimport OseParty from \"./party\";\nimport OsePartyXP from \"./party-xp\";\n\nconst Party = {\n  partySheet: void 0,\n};\n\nexport default class OsePartySheet extends FormApplication {\n  static get defaultOptions() {\n    return foundry.utils.mergeObject(super.defaultOptions, {\n      classes: [\"ose\", \"dialog\", \"party-sheet\"],\n      template: `${OSE.systemPath()}/templates/apps/party-sheet.html`,\n      width: 280,\n      height: 400,\n      resizable: true,\n      dragDrop: [\n        { dragSelector: \".actor-list .actor\", dropSelector: \".party-members\" },\n      ],\n      closeOnSubmit: false,\n    });\n  }\n\n  static init() {\n    Party.partySheet = new OsePartySheet();\n  }\n\n  static showPartySheet(options = {}) {\n    OsePartySheet.partySheet.render(true, { focus: true, ...options });\n  }\n\n  static get partySheet() {\n    return Party.partySheet;\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Add the Entity name into the window title\n   *\n   * @type {string}\n   */\n  get title() {\n    return game.i18n.localize(\"OSE.dialog.partysheet\");\n  }\n\n  /* -------------------------------------------- */\n\n  /**\n   * Construct and return the data object used to render the HTML template for this form application.\n   *\n   * @returns {object}\n   */\n  getData() {\n    const settings = {\n      ascending: game.settings.get(game.system.id, \"ascendingAC\"),\n    };\n\n    return {\n      partyActors: OseParty.currentParty,\n      // data: this.object,\n      config: CONFIG.OSE,\n      user: game.user,\n      settings,\n    };\n  }\n\n  async _addActorToParty(actor) {\n    if (actor.type !== \"character\") {\n      return;\n    }\n\n    await actor.setFlag(game.system.id, \"party\", true);\n  }\n\n  async _removeActorFromParty(actor) {\n    await actor.setFlag(game.system.id, \"party\", false);\n  }\n\n  /* ---------------------- */\n  /* --Drag&Drop Behavior-- */\n  /* ---------------------- */\n\n  /* - Adding to the Party Sheet -*/\n  _onDrop(event) {\n    event.preventDefault();\n    // WIP Drop Items\n    let data;\n    try {\n      data = JSON.parse(event.dataTransfer.getData(\"text/plain\"));\n\n      switch (data.type) {\n        case \"Actor\": {\n          return this._onDropActor(event, data);\n        }\n\n        case \"Folder\": {\n          return this._onDropFolder(event, data);\n        }\n      }\n    } catch (error) {\n      return false;\n    }\n  }\n\n  async _onDropActor(event, data) {\n    if (data.type !== \"Actor\") {\n      return;\n    }\n\n    const droppedActor = await fromUuid(data.uuid);\n\n    this._addActorToParty(droppedActor);\n  }\n\n  _recursiveAddFolder(folder) {\n    folder.contents.forEach((actor) => this._addActorToParty(actor));\n    folder.children.forEach((folder) => this._recursiveAddFolder(folder.folder));\n  }\n\n  async _onDropFolder(event, data) {\n    const folder = await fromUuid(data.uuid);\n    if (folder?.type !== \"Actor\") return;\n\n    this._recursiveAddFolder(folder);\n  }\n\n  /* - Dragging from the Party Sheet - */\n  async _onDragStart(event) {\n    try {\n      const { uuid } = event.currentTarget.dataset;\n      const dragData = (await fromUuid(uuid)).toDragData();\n      // Set data transfer\n      event.dataTransfer.setData(\"text/plain\", JSON.stringify(dragData));\n    } catch (error) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /* -------------------------------------------- */\n\n  async _dealXP(ev) {\n    new OsePartyXP(this.object, {}).render(true);\n  }\n\n  /** @override */\n  activateListeners(html) {\n    super.activateListeners(html);\n\n    html.find(\".header #deal-xp\").click(this._dealXP.bind(this));\n\n    // Actor buttons\n    const getActor = (event) => {\n      const id = event.currentTarget.closest(\".actor\").dataset.actorId;\n      return game.actors.get(id);\n    };\n\n    html.find(\".field-img button[data-action='open-sheet']\").click((event) => {\n      getActor(event).sheet.render(true);\n    });\n\n    html\n      .find(\".field-img button[data-action='remove-actor']\")\n      .click(async (event) => {\n        await this._removeActorFromParty(getActor(event));\n        this.render(true);\n      });\n  }\n}\n","/**\n * @file Helper functions for managing the Party Sheet\n */\nimport OsePartySheet from \"./party/party-sheet\";\n\n/**\n * Add a button to the actor sheet to open the Party Sheet\n *\n * @param {foundry.applications.sidebar.tabs.ActorDirectory} object - The actor directory object\n */\nexport const addControl = (object) => {\n  const html = object.element;\n  if (html?.querySelector(\"button.ose-party-sheet\")) {\n    // If the button already exists, do not add it again\n    return;\n  }\n\n  const control = document.createElement(\"button\");\n  control.className = \"ose-party-sheet\";\n  control.type = \"button\";\n  control.title = game.i18n.localize(\"OSE.dialog.partysheet\");\n  const icon = document.createElement(\"i\");\n  icon.className = \"fas fa-users\";\n  control.append(icon);\n\n  const searchToggle = html.querySelector(\".toggle-search-mode\");\n  if (searchToggle) {\n    control.addEventListener(\"click\", (ev) => {\n      ev.preventDefault();\n      Hooks.call(\"OSE.Party.showSheet\");\n    });\n\n    searchToggle.parentNode.insertBefore(control, searchToggle);\n  }\n};\n\nexport const update = (actor) => {\n  const partyFlag = actor.getFlag(game.system.id, \"party\");\n\n  if (!partyFlag) {\n    return;\n  }\n\n  OsePartySheet.partySheet.render();\n};\n","/**\n * @file Wire up system settings.\n */\nimport { ApplyDamageOption, EncumbranceOption } from \"./config\";\n\n/**\n * Perform setting registration.\n */\nconst registerSettings = () => {\n  game.settings.register(game.system.id, \"initiative\", {\n    name: game.i18n.localize(\"OSE.Setting.Initiative\"),\n    hint: game.i18n.localize(\"OSE.Setting.InitiativeHint\"),\n    default: \"group\",\n    scope: \"world\",\n    type: String,\n    requiresReload: true,\n    config: true,\n    choices: {\n      individual: \"OSE.Setting.InitiativeIndividual\",\n      group: \"OSE.Setting.InitiativeGroup\",\n    },\n  });\n\n  game.settings.register(game.system.id, \"rerollInitiative\", {\n    name: game.i18n.localize(\"OSE.Setting.RerollInitiative\"),\n    hint: game.i18n.localize(\"OSE.Setting.RerollInitiativeHint\"),\n    default: \"reset\",\n    scope: \"world\",\n    type: String,\n    config: true,\n    choices: {\n      keep: \"OSE.Setting.InitiativeKeep\",\n      reset: \"OSE.Setting.InitiativeReset\",\n      reroll: \"OSE.Setting.InitiativeReroll\",\n    },\n  });\n\n  game.settings.register(game.system.id, \"ascendingAC\", {\n    name: game.i18n.localize(\"OSE.Setting.AscendingAC\"),\n    hint: game.i18n.localize(\"OSE.Setting.AscendingACHint\"),\n    default: false,\n    scope: \"world\",\n    type: Boolean,\n    config: true,\n  });\n\n  game.settings.register(game.system.id, \"morale\", {\n    name: game.i18n.localize(\"OSE.Setting.Morale\"),\n    hint: game.i18n.localize(\"OSE.Setting.MoraleHint\"),\n    default: false,\n    scope: \"world\",\n    type: Boolean,\n    config: true,\n  });\n\n  game.settings.register(game.system.id, \"encumbranceOption\", {\n    name: game.i18n.localize(\"OSE.Setting.Encumbrance\"),\n    hint: game.i18n.localize(\"OSE.Setting.EncumbranceHint\"),\n    default: \"detailed\",\n    scope: \"world\",\n    type: String,\n    config: true,\n    requiresReload: true,\n    choices: Object.values(CONFIG.OSE.encumbranceOptions).reduce((obj, enc) => {\n      return { ...obj, [enc.type]: enc.localizedLabel };\n    }, {}) as SettingConfig<EncumbranceOption>[\"choices\"],\n  });\n\n  game.settings.register(game.system.id, \"encumbranceItemStrengthMod\", {\n    name: game.i18n.localize(\"OSE.Setting.EncumbranceItemStrengthMod\"),\n    hint: game.i18n.localize(\"OSE.Setting.EncumbranceItemStrengthModHint\"),\n    default: false,\n    scope: \"world\",\n    type: Boolean,\n    config: true,\n  });\n\n  game.settings.register(game.system.id, \"significantTreasure\", {\n    name: game.i18n.localize(\"OSE.Setting.SignificantTreasure\"),\n    hint: game.i18n.localize(\"OSE.Setting.SignificantTreasureHint\"),\n    default: 800,\n    scope: \"world\",\n    type: Number,\n    config: true,\n  });\n\n  game.settings.register(game.system.id, \"languages\", {\n    name: game.i18n.localize(\"OSE.Setting.Languages\"),\n    hint: game.i18n.localize(\"OSE.Setting.LanguagesHint\"),\n    default: \"\",\n    scope: \"world\",\n    type: String,\n    config: true,\n  });\n  game.settings.register(game.system.id, \"applyDamageOption\", {\n    name: game.i18n.localize(\"OSE.Setting.applyDamageOption\"),\n    hint: game.i18n.localize(\"OSE.Setting.applyDamageOptionHint\"),\n    default: \"selected\",\n    scope: \"world\",\n    type: String,\n    config: true,\n    choices: {\n      selected: game.i18n.localize(\"OSE.Setting.damageSelected\"),\n      targeted: game.i18n.localize(\"OSE.Setting.damageTarget\"),\n      originalTarget: game.i18n.localize(\"OSE.Setting.damageOriginalTarget\"),\n    },\n  });\n  game.settings.register(game.system.id, \"invertedCtrlBehavior\", {\n    name: game.i18n.localize(\"OSE.Setting.InvertedCtrlBehavior\"),\n    hint: game.i18n.localize(\"OSE.Setting.InvertedCtrlBehaviorHint\"),\n    default: false,\n    scope: \"world\",\n    type: Boolean,\n    config: true,\n  });\n  game.settings.register(game.system.id, \"ignoreAttackBonusOnDamageRoll\", {\n    name: game.i18n.localize(\"OSE.Setting.ignoreAttackBonusOnDamageRoll\"),\n    hint: game.i18n.localize(\"OSE.Setting.ignoreAttackBonusOnDamageRollHint\"),\n    default: false,\n    scope: \"world\",\n    type: Boolean,\n    config: true,\n    requiresReload: true,\n  });\n  game.settings.register(game.system.id, \"hasPromptedDefaultOSETokenRing\", {\n    default: false,\n    scope: \"world\",\n    type: Boolean,\n  });\n};\n\ndeclare global {\n  namespace ClientSettings {\n    // Include OSE settings in addition to foundry default settings\n    interface Values {\n      \"ose.initiative\": \"individual\" | \"group\";\n      \"ose.rerollInitiative\": \"keep\" | \"reset\" | \"reroll\";\n      \"ose.ascendingAC\": boolean;\n      \"ose.morale\": boolean;\n      \"ose.encumbranceOption\": EncumbranceOption;\n      \"ose.significantTreasure\": number;\n      \"ose.languages\": string;\n      \"ose.applyDamageOption\": ApplyDamageOption;\n      \"ose.ignoreAttackBonusOnDamageRoll\": boolean;\n    }\n  }\n}\n\nexport default registerSettings;\n","import { OSE } from \"../config\";\nimport { OSECombatant } from \"./combatant\";\n\nconst { HandlebarsApplicationMixin, ApplicationV2 } = foundry.applications.api;\n\nexport default class OSECombatGroupSelector extends HandlebarsApplicationMixin(ApplicationV2) {\n  _highlighted;\n\n  // ===========================================================================\n  // APPLICATION SETUP\n  // ===========================================================================\n  static DEFAULT_OPTIONS = {\n    id: \"combat-set-groups-{id}\",\n    classes: [\"combat-set-groups\"],\n    tag: \"form\",\n    window: {\n      frame: true,\n      positioned: true,\n      title: \"OSE.combat.SetCombatantGroups\",\n      icon: \"fa-solid fa-flag\",\n      controls: [],\n      minimizable: false,\n      resizable: true,\n      contentTag: \"section\",\n      contentClasses: [],\n    },\n    actions: {},\n    form: {\n      handler: undefined,\n      submitOnChange: true,\n    },\n    position: {\n      width: 600,\n      height: \"auto\",\n    },\n  };\n\n  static PARTS = {\n    main: {\n      template: `/systems/ose/dist/templates/apps/combat-set-groups.hbs`,\n    },\n  };\n\n  // ===========================================================================\n  // RENDER SETUP\n  // ===========================================================================\n\n  /** @inheritDoc */\n  async _prepareContext(options) {\n    return {\n      groups: OSE.colors,\n      combatants: game.combat?.combatants || [],\n    };\n  }\n\n  /** @inheritDoc */\n  _onRender(context, options) {\n    super._onRender(context, options);\n    for (const li of this.element.querySelectorAll(\"[data-combatant-id]\")) {\n      li.addEventListener(\"mouseover\", this.#onCombatantHoverIn.bind(this));\n      li.addEventListener(\"mouseout\", this.#onCombatantHoverOut.bind(this));\n    }\n    this.element.addEventListener(\"change\", this._updateObject);\n  }\n\n  // ===========================================================================\n  // UPDATING\n  // ===========================================================================\n\n  /** @inheritDoc */\n  protected async _updateObject(event: Event): Promise<void> {\n    event.preventDefault();\n    event.stopPropagation();\n    const input = event.target as HTMLInputElement;\n    if (!input?.name || !input?.value) return;\n    const combatant = game.combat?.combatants.get(input.name) as OSECombatant;\n    if (!combatant) return;\n    await combatant.assignGroup(input.value);\n  }\n\n  // ===========================================================================\n  // UI EVENTS\n  // ===========================================================================\n\n  #onCombatantHoverIn(event: PointerEvent) {\n    event.preventDefault();\n    if (!canvas.ready) return;\n    const li = event.currentTarget as HTMLLIElement;\n    const { combatantId } = li.dataset;\n    if (!combatantId) return;\n    const combatant = game.combat?.combatants.get(combatantId) as OSECombatant;\n    const token = combatant.token?.object as Token;\n    if (token?.isVisible) {\n      if (!token.controlled) {\n        token._onHoverIn(event, { hoverOutOthers: true });\n      }\n      this._highlighted = token;\n    }\n  }\n\n  #onCombatantHoverOut(event: PointerEvent) {\n    event.preventDefault();\n    if (this._highlighted) {\n      this._highlighted._onHoverOut(event);\n    }\n    this._highlighted = null;\n  }\n}\n","/**\n * @file System-level modifications to the way combat works\n */\nimport { OSE } from \"../config\";\nimport OSECombatGroupSelector from \"./combat-set-groups\";\n\nexport const actionGroups = {\n  slow: \"OSE.items.Slow\",\n  cast: \"OSE.spells.Cast\",\n};\n\n/**\n * An extension of Foundry's Combat class that implements initiative for individual combatants.\n *\n * @todo Use a single chat card for rolling group initiative\n */\nexport class OSECombat extends foundry.documents.Combat {\n  static FORMULA = \"1d6 + @init\";\n\n  static GROUP_FORMULA = \"1d6\";\n\n  static get GROUPS() {\n    return {\n      ...OSE.colors,\n      ...Object.entries(actionGroups).reduce((acc, [key, value]) => {\n        (acc as Record<string, string>)[key] = game.i18n.localize(value);\n        return acc;\n      }, {}),\n    };\n  }\n\n  // Track combatant groups since multiple combatants can trigger group creation\n  // at the same time.\n  #combatantGroups = new Map<string, Promise<CombatantGroup>>();\n\n  get #rerollBehavior() {\n    return game.settings.get(game.system.id, \"rerollInitiative\");\n  }\n\n  /**\n   * Returns whether the combat is using group initiative.\n   *\n   * @returns {boolean} True if the combat is using group initiative, false otherwise.\n   */\n  get isGroupInitiative(): boolean {\n    return game.settings.get(game.system.id, \"initiative\") === \"group\";\n  }\n\n  // ===========================================================================\n  // INITIATIVE MANAGEMENT\n  // ===========================================================================\n\n  /**\n   * Roll initiative for all combatants.\n   *\n   * @param {object} [options={}] - Additional options which modify how initiative rolls are created or presented.\n   * @param {boolean} [options.excludeAlreadyRolled=false] - If true, exclude combatants that have already rolled initiative.\n   * @param {boolean} [options.updateTurn=false] - Update the Combat turn after adding new initiative scores to\n   *                                               keep the turn on the same Combatant.\n   * @private\n   */\n  async #rollAbsolutelyEveryone({\n    excludeAlreadyRolled = false,\n    updateTurn = false,\n  } = {}) {\n    const formula = this.isGroupInitiative\n      ? OSECombat.GROUP_FORMULA\n      : OSECombat.FORMULA;\n\n    await this.rollInitiative(\n      this.combatants\n        .filter(\n          (c) => !c.defeated && (!excludeAlreadyRolled || c.initiative === null)\n        )\n        .map((c) => c.id),\n      {\n        formula,\n        updateTurn,\n      }\n    );\n  }\n\n  /**\n   * Reroll initiative for all combatants.\n   * If the initiative type is set to \"group\", reroll initiative for each group.\n   *\n   * @param {object} [options={}] - Additional options which modify how initiative rolls are created or presented.\n   * @param {boolean} [options.excludeAlreadyRolled=false] - If true, exclude combatants that have already rolled initiative.\n   * @param {boolean} [options.updateTurn=false] - Update the Combat turn after adding new initiative scores to\n   *                                               keep the turn on the same Combatant.\n   */\n  async smartRerollInitiative({\n    excludeAlreadyRolled = false,\n    updateTurn = false,\n  } = {}) {\n    if (!this.isGroupInitiative) {\n      return this.#rollAbsolutelyEveryone({ excludeAlreadyRolled, updateTurn });\n    }\n\n    const updates = [];\n    const messages = [];\n    for (const group of this.groups) {\n      if (\n        group.members.size === 0 ||\n        (excludeAlreadyRolled && group.initiative !== null) ||\n        group.name === \"slow\"\n      ) {\n        continue;\n      }\n\n      const roll = new Roll(OSECombat.GROUP_FORMULA);\n      await roll.evaluate();\n      updates.push({ _id: group.id, initiative: roll.total });\n\n      const rollMode = game.settings.get(\"core\", \"rollMode\");\n\n      // Construct chat message data\n      const messageData = {\n        speaker: {\n          alias: game.i18n.localize(\"OSE.Initiative\"),\n        },\n        flavor: game.i18n.format(\"OSE.roll.initiative\", {\n          group: foundry.utils.escapeHTML(group.name),\n        }),\n        flags: { \"core.initiativeRoll\": true },\n      };\n      const chatData = await roll.toMessage(messageData, {\n        rollMode,\n        create: false,\n      });\n      messages.push(chatData);\n    }\n\n    if (updates.length === 0) {\n      return this;\n    }\n\n    await foundry.documents.ChatMessage.implementation.create(messages);\n    await this.updateEmbeddedDocuments(\"CombatantGroup\", updates);\n\n    return this;\n  }\n\n  /**\n   * Handle updating a combatant group.\n   */\n  async onUpdateCombatantGroup() {\n    this.setupTurns();\n    await ui.combat.render(true);\n  }\n\n  /** @override */\n  async rollAll(options: object) {\n    await super.rollAll(options);\n    // Preserve the fact that it's no-one's turn currently.\n    let turn = this.turn === null || this.turns.length === 0 ? null : 0;\n    if (this.settings.skipDefeated && turn !== null) {\n      turn = this.turns.findIndex((t) => !t.isDefeated);\n      if (turn === -1) {\n        ui.notifications.warn(\"COMBAT.NoneRemaining\", { localize: true });\n        turn = 0;\n      }\n    }\n    await this.update({ turn });\n    this.setupTurns();\n    await ui.combat.render(true);\n    return this;\n  }\n\n  // ===========================================================================\n  // COMBAT LIFECYCLE MANAGEMENT\n  // ===========================================================================\n\n  /** @override */\n  async startCombat() {\n    await super.startCombat();\n    if (this.#rerollBehavior !== \"reset\")\n      await this.smartRerollInitiative({\n        excludeAlreadyRolled: true,\n      });\n    return this;\n  }\n\n  /**\n   * Reset the actions of all combatants in the combat.\n   */\n  async resetActions() {\n    for (const combatant of this.combatants) {\n      await combatant.setFlag(game.system.id, \"prepareSpell\", false);\n      await combatant.setFlag(game.system.id, \"moveInCombat\", false);\n    }\n  }\n\n  /** @override */\n  async _onEndRound(context: CombatRoundEventContext) {\n    await super._onEndRound(context);\n    if (context?.round) {\n      // Further processing when rounds other than round 0 end (start combat).\n      switch (this.#rerollBehavior) {\n        case \"reset\":\n          await this.resetAll();\n          break;\n\n        case \"reroll\":\n          await this.smartRerollInitiative();\n          break;\n\n        case \"keep\":\n        default:\n          break;\n      }\n      await this.resetActions();\n    }\n  }\n\n  /** @override */\n  async resetAll(args: object) {\n    await super.resetAll(args);\n\n    if (this.isGroupInitiative) {\n      const groupUpdates = this.groups.map((g: CombatantGroup) => ({\n        _id: g.id,\n        initiative: null,\n      }));\n\n      if (groupUpdates.length > 0) {\n        await this.updateEmbeddedDocuments(\"CombatantGroup\", groupUpdates);\n      }\n    }\n  }\n\n  /**\n   * Activate the given combatant within the combat.\n   *\n   * @param {number} turn - The turn number of the combatant to activate.\n   */\n  async activateCombatant(turn: number) {\n    if (game.user.isGM) {\n      await game.combat.update({ turn });\n    }\n  }\n\n  /**\n   * Assign a combatant to a group, creating the group if it doesn't exist.\n   * This method prevents multiple groups being created due to the async nature\n   * of Foundry VTT.\n   *\n   * @param {OSECombatant} combatant - The combatant to assign to the group.\n   * @param {string} groupName - The name of the group to assign the combatant to.\n   */\n  async assignGroup(combatant: OSECombatant, groupName: string) {\n    if (!groupName) {\n      return;\n    }\n\n    if (this.#combatantGroups.has(groupName)) {\n      await this.#combatantGroups.get(groupName);\n    } else {\n      const groupCreation = this.createEmbeddedDocuments(\"CombatantGroup\", [\n        { name: groupName, initiative: null },\n      ]);\n      this.#combatantGroups.set(groupName, groupCreation);\n      await groupCreation;\n    }\n\n    const group = this.groups.find((g: CombatantGroup) => g.name === groupName);\n    if (!group) {\n      return;\n    }\n    await combatant.update({ group: group.id });\n  }\n\n  /**\n   * Determine which group each combatant should be added to, or if a new group should be created.\n   *\n   * @returns {Map<string, { combatants: OSECombatant[], expanded: boolean }>}\n   */\n  async createGroups() {\n    for (const combatant of this.combatants) {\n      if (combatant.group) continue;\n\n      const key = combatant.groupRaw;\n      if (!key) continue;\n\n      await this.assignGroup(combatant, key);\n    }\n\n    return this.groups;\n  }\n\n  /**\n   * Prompts to set the combatant groups.\n   */\n  setCombatantGroups() {\n    new OSECombatGroupSelector().render(true, { focus: true });\n  }\n\n  /** @override */\n  _sortCombatants(a, b) {\n    // First sort by initiative\n    const ia = Number.isNumeric(a.initiative) ? a.initiative : -Infinity;\n    const ib = Number.isNumeric(b.initiative) ? b.initiative : -Infinity;\n    const initiativeDiff = ib - ia;\n\n    if (initiativeDiff !== 0) return initiativeDiff;\n\n    // If still tied, sort by group name if available\n    if (a.group?.name && b.group?.name && a.group?.name !== b.group?.name) {\n      const colorsKeys = Object.keys(OSECombat.GROUPS);\n      const indexA = colorsKeys.indexOf(a.group.name);\n      const indexB = colorsKeys.indexOf(b.group.name);\n\n      const colorDiff = indexA - indexB;\n      if (colorDiff !== 0) return colorDiff;\n    }\n\n    // If still tied, sort by disposition\n    // Higher values of CONST.TOKEN_DISPOSITIONS are sorted first (e.g. Friendly).\n    const dispositionA = a.token?.disposition ?? 0;\n    const dispositionB = b.token?.disposition ?? 0;\n    if (dispositionA !== dispositionB) {\n      // Return negative to prioritize higher disposition values\n      return dispositionB - dispositionA;\n    }\n\n    // If still tied, sort by player ownership and retainer status together\n    // Player-owned combatants come before non-player-owned ones\n    if (a.hasPlayerOwner !== b.hasPlayerOwner) {\n      return a.hasPlayerOwner ? -1 : 1;\n    }\n    if (a.hasPlayerOwner && b.hasPlayerOwner) {\n      // Both are player-owned, sort non-retainers first\n      const isRetainerA = !!a.system?.retainer?.enabled;\n      const isRetainerB = !!b.system?.retainer?.enabled;\n      if (isRetainerA !== isRetainerB) {\n        return isRetainerA ? 1 : -1; // Reverse order for player-owned\n      }\n    } else if (!a.hasPlayerOwner && !b.hasPlayerOwner) {\n      // For non-player owned, sort retainers before non-retainers\n      const isRetainerA = !!a.system?.retainer?.enabled;\n      const isRetainerB = !!b.system?.retainer?.enabled;\n      if (isRetainerA !== isRetainerB) {\n        return isRetainerA ? -1 : 1;\n      }\n    }\n\n    if (a.name && a.name === b.name) {\n      // Use ID comparison if the names are the same\n      return a.id > b.id ? 1 : -1;\n    }\n\n    return (a.name || \"\").localeCompare(b.name || \"\");\n  }\n}\n","export class OSECombatant extends Combatant {\n  static INITIATIVE_VALUE_SLOWED = -789;\n\n  static INITIATIVE_VALUE_DEFEATED = -790;\n\n  // ===========================================================================\n  // BOOLEAN FLAGS\n  // ===========================================================================\n\n  get isCasting() {\n    return this.getFlag(game.system.id, \"prepareSpell\");\n  }\n\n  set isCasting(value) {\n    this.setFlag(game.system.id, \"prepareSpell\", value);\n  }\n\n  get isSlow() {\n    return this.actor?.system?.isSlow;\n  }\n\n  get isDefeated() {\n    if (this.defeated) return true;\n\n    return !this.defeated && this.actor?.system?.hp?.value === 0;\n  }\n\n  // ===========================================================================\n  // INITIATIVE MANAGEMENT\n  // ===========================================================================\n\n  getInitiativeRoll(formula: string) {\n    let term = formula || CONFIG.Combat.initiative.formula;\n    if (this.isSlow) term = `${OSECombatant.INITIATIVE_VALUE_SLOWED}`;\n    if (this.isDefeated) term = `${OSECombatant.INITIATIVE_VALUE_DEFEATED}`;\n    const rollData = this.actor?.getRollData() || {};\n    return new Roll(term, rollData);\n  }\n\n  async getData(options = {}) {\n    const context = await super.getData(options);\n    return foundry.utils.mergeObject(context, {\n      slow: this.isSlow,\n      casting: this.isCasting,\n    });\n  }\n\n  /**\n   * Assign this combatant to a group.\n   *\n   * @param {string} group - The name of the group to assign this combatant to. If empty, the group will be automatically determined.\n   */\n  async assignGroup(group: string) {\n    if (!group) {\n      group = this.groupRaw;\n    }\n\n    if (this.group?.name === group) {\n      return;\n    }\n\n    await this.combat.assignGroup(this, group);\n  }\n\n  /**\n   * Key for the group to which this combatant should belong.\n   *\n   * @returns {string} - The group key for this combatant.\n   */\n  get groupRaw(): string {\n    if (this.actor?.system?.isSlow) {\n      return \"slow\";\n    }\n\n    const assignedGroup = this.group?.name;\n    if (assignedGroup) {\n      return assignedGroup;\n    }\n\n    switch (this.token?.disposition) {\n      case -1:\n        return \"red\";\n      case 0:\n        return \"purple\";\n      case 1:\n        return \"green\";\n      default:\n        return \"white\";\n    }\n  }\n}\n","import { OSE } from \"../config\";\nimport { OSECombat } from \"./combat\";\nimport { OSECombatant } from \"./combatant\";\n\n\nexport default class OSECombatTracker extends foundry.applications.sidebar.tabs\n  .CombatTracker {\n  /** @inheritDoc */\n  static DEFAULT_OPTIONS = {\n    ...foundry.applications.sidebar.tabs.CombatTracker.DEFAULT_OPTIONS,\n    actions: {\n      ...foundry.applications.sidebar.tabs.CombatTracker.DEFAULT_OPTIONS\n        .actions,\n      casting: OSECombatTracker.#onCombatantControl,\n      retreat: OSECombatTracker.#onCombatantControl,\n    },\n  };\n\n  /** @inheritDoc */\n  async _prepareTrackerContext(context, options) {\n    await super._prepareTrackerContext(context, options);\n    context.turns?.forEach((turn) => {\n      const combatant = game.combat.combatants.get(turn.id);\n      turn.isSlowed =\n        turn.initiative === `${OSECombatant.INITIATIVE_VALUE_SLOWED}`;\n      turn.isCasting = !!combatant.getFlag(game.system.id, \"prepareSpell\");\n      turn.isRetreating = !!combatant.getFlag(game.system.id, \"moveInCombat\");\n      turn.isOwnedByUser = !!combatant.actor?.isOwner;\n      turn.group = combatant.group;\n    });\n    return context;\n  }\n\n  /** @inheritDoc */\n  static #onCombatantControl(...args) {\n    return this._onCombatantControl(...args);\n  }\n\n  /**\n   * Handle performing some action for an individual combatant.\n   *\n   * @param {PointerEvent} event - The triggering event.\n   * @param {HTMLElement} target - The action target element.\n   * @protected\n   */\n  async _onCombatantControl(event, target) {\n    event.preventDefault();\n    event.stopPropagation();\n    const btn = target || event.currentTarget;\n    const { combatantId } = btn.closest(\".combatant\").dataset;\n    const combatant = this.viewed.combatants.get(combatantId);\n    const action = btn.dataset.control || btn.dataset.action;\n    switch (action) {\n      case \"casting\":\n        await this.#toggleFlag(combatant as OSECombatant, \"prepareSpell\");\n        return super._onCombatantControl(event, target);\n\n      case \"retreat\":\n        await this.#toggleFlag(combatant as OSECombatant, \"moveInCombat\");\n        return super._onCombatantControl(event, target);\n    }\n    return super._onCombatantControl(event, target);\n  }\n\n  /** @override */\n  _configureRenderOptions(options: object) {\n    super._configureRenderOptions(options);\n\n    // Replace the tracker template\n    this.constructor.PARTS.tracker.template = `${OSE.systemPath()}/templates/sidebar/combat-tracker-combatant.hbs`;\n\n    return options;\n  }\n\n  /**\n   * Toggle a boolean flag value on the combatant.\n   *\n   * @param {OSECombatant} combatant - The combatant to toggle the flag on.\n   * @param {string} flag - The flag name to toggle.\n   * @private\n   */\n  async #toggleFlag(combatant: OSECombatant, flag: string) {\n    const isActive = !!combatant.getFlag(game.system.id, flag);\n    await combatant.setFlag(game.system.id, flag, !isActive);\n  }\n\n  /**\n   * Get context menu entries for Combatants in the tracker.\n   *\n   * @returns {ContextMenuEntry[]}\n   * @protected\n   */\n  _getEntryContextOptions() {\n    const options = super._getEntryContextOptions();\n    return [\n      {\n        name: game.i18n.localize(\"OSE.combat.SetCombatantAsActive\"),\n        icon: '<i class=\"fas fa-star-of-life\"></i>',\n        callback: (li: HTMLElement) => {\n          const { combatantId } = li.dataset;\n          const turnToActivate = this.viewed.turns.findIndex(\n            (t: OSECombatant) => t.id === combatantId\n          );\n          this.viewed.activateCombatant(turnToActivate);\n        },\n      },\n      ...options,\n    ];\n  }\n\n  /**\n   * Adjust initiative tracker to group combatants.\n   *\n   * @param {HTMLElement} html - The combat tracker being rendered.\n   */\n  async renderGroups(html: HTMLElement) {\n    if (\n      !this.viewed ||\n      game.settings.get(game.system.id, \"initiative\") !== \"group\"\n    ) {\n      return;\n    }\n\n    const headerButtonContainer = html.querySelector(\n      \".combat-tracker-header .control-buttons\"\n    );\n    if (headerButtonContainer) {\n      // Replace the buttons with the OSE versions\n      const reRollButton = document.createElement(\"button\");\n      reRollButton.type = \"button\";\n      reRollButton.classList.add(\n        \"inline-control\",\n        \"combat-control\",\n        \"combat-button\",\n        \"icon\",\n        \"fa-solid\",\n        \"fa-dice\"\n      );\n      reRollButton.dataset.action = \"smartRerollInitiative\";\n      reRollButton.dataset.tooltip = game.i18n.localize(\"OSE.Reroll\");\n      reRollButton.ariaLabel = game.i18n.localize(\"OSE.Reroll\");\n\n      const setCombatantGroupsButton = document.createElement(\"button\");\n      setCombatantGroupsButton.type = \"button\";\n      setCombatantGroupsButton.classList.add(\n        \"inline-control\",\n        \"combat-control\",\n        \"combat-button\",\n        \"icon\",\n        \"fa-solid\",\n        \"fa-flag\"\n      );\n      setCombatantGroupsButton.dataset.action = \"setCombatantGroups\";\n      setCombatantGroupsButton.dataset.tooltip = game.i18n.localize(\n        \"OSE.combat.SetCombatantGroups\"\n      );\n      setCombatantGroupsButton.ariaLabel = game.i18n.localize(\n        \"OSE.combat.SetCombatantGroups\"\n      );\n\n      headerButtonContainer.replaceChildren(\n        reRollButton,\n        setCombatantGroupsButton\n      );\n    }\n\n    const list = html.querySelector(\".directory-list, .combat-tracker\");\n    for (const combatantGroup of this.viewed?.groups?.values()) {\n      if (!combatantGroup.members?.size) {\n        continue;\n      }\n\n      const children =\n        list?.querySelectorAll(\n          [\n            ...combatantGroup.members.map(\n              (c: OSECombatant) => `[data-combatant-id=\"${c?.id}\"]`\n            ),\n          ].join(\", \")\n        ) || [];\n      if (children.length === 0) {\n        continue;\n      }\n\n      const label = combatantGroup.name;\n      const groupContainer = document.createElement(\"li\");\n\n      const initiativeCounter = document.createElement(\"span\");\n      initiativeCounter.classList.add(\"create-button\");\n      initiativeCounter.style.fontSize = \"1.25em\";\n      initiativeCounter.style.fontWeight = \"600\";\n      initiativeCounter.style.flex = \"0 0 20px\";\n      initiativeCounter.style.textAlign = \"center\";\n\n      if (label === \"slow\") {\n        initiativeCounter.innerHTML = `<i class=\"fa fa-weight-hanging\"></i>`;\n      } else {\n        initiativeCounter.textContent = combatantGroup.initiative;\n      }\n\n      const groupHeader = document.createElement(\"div\");\n      groupHeader.className = \"group-header flexrow\";\n      groupHeader.style.background = `linear-gradient(90deg, var(--ose-group-color-${label}, ${label}), transparent)`;\n\n      const tokenName = document.createElement(\"div\");\n      tokenName.className = \"token-name\";\n\n      const nameStrong = document.createElement(\"strong\");\n      nameStrong.className = \"name\";\n\n      const diceIcon = document.createElement(\"i\");\n      diceIcon.className = \"fas fa-dice-d6\";\n      nameStrong.append(diceIcon);\n\n      nameStrong.append(\n        \" \",\n        game.i18n.localize(\n          label === \"slow\" ? \"OSE.items.Slow\" : `OSE.colors.${label}`\n        )\n      );\n\n      tokenName.append(nameStrong);\n      groupHeader.append(tokenName);\n      groupHeader.append(initiativeCounter.cloneNode(true));\n\n      const wrapper = document.createElement(\"div\");\n      wrapper.className = \"wrapper\";\n\n      const groupChildren = document.createElement(\"ol\");\n      groupChildren.className = \"group-children\";\n      wrapper.append(groupChildren);\n\n      groupContainer.append(groupHeader);\n      groupContainer.append(wrapper);\n      groupContainer.dataset.groupKey = label;\n      groupContainer.dataset.initiative =\n        label === \"slow\" ? \"-1\" : combatantGroup.initiative;\n      children[0].before(groupContainer);\n      groupContainer\n        .querySelector(\".group-children\")\n        ?.replaceChildren(...children);\n    }\n  }\n}\n","export default class TokenRulerOSE extends foundry.canvas.placeables.tokens.TokenRuler {\n  /** @override */\n  _getGridHighlightStyle(waypoint, offset) {\n    const style = super._getGridHighlightStyle(waypoint, offset);\n    if (!this.token?.actor || !style?.color) return style;\n\n    let movement = this.token.actor.system?.movement?.base ?? 120;\n    const { cost } = waypoint.measurement;\n\n    if (this.token.actor?.inCombat) {\n      movement = Math.floor(movement / 3);\n    }\n\n    if (cost > movement) {\n      return {\n        ...style,\n        color: 0x99_00_00,\n      };\n    }\n\n    return style;\n  }\n}\n","/**\n * @file Utilities for our Quench tests\n */\n\nconst inputDelay = 120;\n\nexport const delay = (ms: number) =>\n  new Promise((resolve) => {\n    setTimeout(resolve, ms);\n  });\n\n/**\n * If there are messages, purge them.\n */\nexport const trashChat = (): any => {\n  if (game.messages?.size)\n    return game.messages?.documentClass.deleteDocuments([], { deleteAll: true });\n};\n\n/**\n * Delays execution so the UI can catch up.\n *\n * @returns {Promise} The delay.\n */\nexport const waitForInput = () => delay(inputDelay);\n\nexport const openWindows = (className: string) =>\n  Object.values(ui.windows).filter((o) =>\n    o.options.classes.includes(className)\n  );\n\nexport const openDialogs = () =>\n  Object.values(ui.windows).filter((o) => o.options.classes.includes(\"dialog\"));\n\nexport const openV2Dialogs = () =>\n  Array.from(foundry.applications.instances.values())\n    .filter((o) => o.options.classes.includes(\"dialog\"));\n\nexport const closeDialogs = async () => {\n  for (const o of openDialogs()) {\n    await o.close();\n  }\n};\n\nexport const closeV2Dialogs = async () => {\n  for (const o of openV2Dialogs()) {\n    await o.close();\n  }\n};\n\nexport const closeSheets = async () => {\n  for (const w of openWindows(\"sheet\")) {\n    await w.close();\n  }\n  waitForInput();\n};\n\n/**\n * Gets the active notifications from the UI. Needed because Foundry no longer\n * allows accessing the Notification class values directly.\n *\n * @returns {HTMLElement[]} An array of active notification elements.\n */\nexport const getActiveNotifications = (): HTMLElement[] => Array.from(document.querySelectorAll(\"#notifications li\").values() as unknown as HTMLElement[]);\n\n/**\n * Checks if an object is a likely to be a Notification since Foundry\n * no longer allows accessing the Notification class values directly.\n *\n * @param obj\n */\nexport const objectIsNotification = (obj: any): obj is Notification =>\n  typeof obj?.message === \"string\" &&\n  typeof obj?.type === \"string\" &&\n  typeof obj?.remove === \"function\";\n\n/**\n * Returns the random number required to roll a specific number on a die.\n * This function is used to replace the `CONFIG.Dice.randomUniform` function as\n * it is then fed into the `randomFace` function of a DiceTerm.\n *\n * @param {number} requiredResult - The specific number you want to roll (e.g. 3 for rolling a 3 on a d6).\n * @param {number} diceFaces - The number of faces on the dice. (e.g. 6 for a d6)\n */\nexport const rollSpecificNumber = (\n  requiredResult: number,\n  diceFaces: number\n) => 1 - requiredResult / diceFaces;\n\n/**\n * MOCKING HELPERS\n */\n\nexport const createMockActorKey = async (\n  type: string,\n  data: object = {},\n  key: string = \"\"\n) =>\n  CONFIG.Actor.documentClass.create({\n    ...data,\n    name: `Test Actor ${key}`,\n    type,\n  });\n\nexport const createWorldTestItem = async (\n  type: string,\n  name: string = `New World Test ${type.capitalize()}`\n) =>\n  CONFIG.Item.documentClass.create({\n    type,\n    name,\n  });\n\nexport const createActorTestItem = async (\n  actor: StoredDocument<Actor> | undefined,\n  type: string,\n  name: string = `New Actor Test ${type.capitalize()}`,\n  data: object = {}\n) => actor?.createEmbeddedDocuments(\"Item\", [{ type, name, ...data }]);\n\nexport const createMockMacro = async () =>\n  CONFIG.Macro.documentClass.create({\n    name: `Mock Macro ${foundry.utils.randomID()}`,\n    type: \"script\",\n    command: \"console.log('Testing Macro');\",\n  });\n\nexport const createMockScene = async () =>\n  CONFIG.Scene.documentClass.create({ name: \"Mock Scene\", tokenVision: true });\n\nexport const getMockActorKey = async (key: string) =>\n  game.actors?.getName(`Test Actor ${key}`);\n\nexport const createMockCompendium = async (\n  type: CompendiumCollection.Metadata[\"type\"]\n  // eslint-disable-next-line unicorn/consistent-function-scoping\n): Promise<CompendiumCollection> =>\n  // eslint-disable-next-line no-undef\n  foundry.documents.collections.CompendiumCollection.createCompendium({\n    label: \"Test Compendium\",\n    name: \"testcompendium\",\n    type,\n    path: \"\",\n    private: false,\n    package: \"world\"\n  });\n\n// eslint-disable-next-line unicorn/consistent-function-scoping\nexport const cleanUpCompendium = async () =>\n  game.packs.get(\"world.testcompendium\")?.deleteCompendium();\n\n/**\n * CLEANUP HELPERS\n */\n\nexport const cleanUpMacros = async () => {\n  const mockMacros = game.macros?.filter((o) => o.name?.includes(\"Mock Macro\"));\n  for (const o of mockMacros || []) {\n    await o.delete();\n  }\n  return true;\n};\n\nexport const cleanUpActorsByKey = async (key: string) => {\n  for (const a of game.actors?.filter((a) => a.name === `Test Actor ${key}`)) {\n    await a.delete();\n  }\n};\n\nexport const cleanUpWorldItems = async () => {\n  for (const a of game.items?.filter((a) => a?.name?.includes(\"New World Test\"))) {\n    await a.delete();\n  }\n};\n\nexport const cleanUpScenes = async () => {\n  for (const s of game.scenes?.filter((s) => s.name === \"Mock Scene\")) {\n    await s.delete();\n  }\n};\n\n/**\n * CONSTS\n */\nexport const itemTypes = new Set([\n  \"spell\",\n  \"ability\",\n  \"armor\",\n  \"weapon\",\n  \"item\",\n  \"container\",\n]);\n","/**\n * @file Quench unit tests for the Character data model class.\n */\n// eslint-disable-next-line import/no-cycle\nimport { QuenchMethods } from \"../../../e2e\";\nimport {\n  cleanUpActorsByKey,\n  createMockActorKey,\n  getMockActorKey,\n} from \"../../../e2e/testUtils\";\nimport OseDataModelCharacter from \"../data-model-character\";\nimport OseDataModelCharacterScores from \"../data-model-classes/data-model-character-scores\";\n\nexport const key = \"ose.actor.datamodel.character\";\nexport const options = { displayName: \"OSE: Actor: Data Model: Character\" };\n\nconst createMockActor = () => createMockActorKey(\"character\", {}, key);\n\nexport default ({ describe, it, expect, after, before }: QuenchMethods) => {\n  const dataModel = new OseDataModelCharacter();\n  const ascendingACSetting = game.settings.get(game.system.id, \"ascendingAC\");\n  const initiativeSetting = game.settings.get(game.system.id, \"initiative\");\n  const encumbranceSetting = game.settings.get(\n    game.system.id,\n    \"encumbranceOption\"\n  );\n\n  after(async () => {\n    game.settings.set(game.system.id, \"ascendingAC\", ascendingACSetting);\n    game.settings.set(game.system.id, \"initiative\", initiativeSetting);\n    game.settings.set(game.system.id, \"encumbranceOption\", encumbranceSetting);\n    await cleanUpActorsByKey(key);\n  });\n\n  // @todo: Can this be tested without creating an actor?\n  describe(\"prepareDerivedData()\", () => {\n    before(async () => {\n      await game.settings.set(game.system.id, \"encumbranceOption\", \"detailed\");\n      await createMockActor();\n    });\n\n    it(\"has scores\", async () => {\n      const actor = await getMockActorKey(key);\n      expect(actor?.system.scores).not.undefined;\n      expect(actor?.system.scores.str).not.undefined;\n      expect(actor?.system.scores.str.od).not.undefined;\n      expect(actor?.system.scores.int).not.undefined;\n      expect(actor?.system.scores.int.literacy).not.undefined;\n      expect(actor?.system.scores.int.spoken).not.undefined;\n      expect(actor?.system.scores.wis).not.undefined;\n      expect(actor?.system.scores.dex).not.undefined;\n      expect(actor?.system.scores.dex.init).not.undefined;\n      expect(actor?.system.scores.con).not.undefined;\n      expect(actor?.system.scores.cha).not.undefined;\n      expect(actor?.system.scores.cha.loyalty).not.undefined;\n      expect(actor?.system.scores.cha.retain).not.undefined;\n      expect(actor?.system.scores.cha.npc).not.undefined;\n    });\n\n    it(\"has encumbrance\", async () => {\n      const actor = await getMockActorKey(key);\n      expect(actor?.system.encumbrance).not.undefined;\n      expect(actor?.system.encumbrance.variant).not.undefined;\n      expect(actor?.system.encumbrance.enabled).not.undefined;\n      expect(actor?.system.encumbrance.pct).not.undefined;\n      expect(actor?.system.encumbrance.encumbered).not.undefined;\n      expect(actor?.system.encumbrance.steps).not.undefined;\n      expect(actor?.system.encumbrance.value).not.undefined;\n      expect(actor?.system.encumbrance.max).not.undefined;\n      expect(actor?.system.encumbrance.steps).not.undefined;\n      //expect(actor?.system.encumbrance.atQuarterEncumbered).not.undefined;\n      //expect(actor?.system.encumbrance.atEighthEncumbered).not.undefined;\n    });\n\n    it(\"has movement\", async () => {\n      const actor = await getMockActorKey(key);\n      expect(actor?.system.movement).not.undefined;\n      expect(actor?.system.movement.base).not.undefined;\n      expect(actor?.system.movement.encounter).not.undefined;\n      expect(actor?.system.movement.overland).not.undefined;\n    });\n\n    it(\"has ac\", async () => {\n      const actor = await getMockActorKey(key);\n      expect(actor?.system.ac).not.undefined;\n      expect(actor?.system.ac.base).not.undefined;\n      expect(actor?.system.ac.naked).not.undefined;\n      expect(actor?.system.ac.shield).not.undefined;\n      expect(actor?.system.ac.value).not.undefined;\n      expect(actor?.system.ac.mod).not.undefined;\n    });\n\n    it(\"has aac\", async () => {\n      const actor = await getMockActorKey(key);\n      expect(actor?.system.aac).not.undefined;\n      expect(actor?.system.aac.base).not.undefined;\n      expect(actor?.system.aac.naked).not.undefined;\n      expect(actor?.system.aac.shield).not.undefined;\n      expect(actor?.system.aac.value).not.undefined;\n      expect(actor?.system.aac.mod).not.undefined;\n    });\n\n    describe(\"has spells\", () => {\n      const spellLevels = new Set([\"1\", \"2\", \"3\", \"4\", \"5\", \"6\"]);\n\n      it(\"has spells\", async () => {\n        const actor = await getMockActorKey(key);\n        expect(actor?.system.spells).not.undefined;\n        expect(actor?.system.spells.enabled).not.undefined;\n        expect(actor?.system.spells.spellList).not.undefined;\n        expect(actor?.system.spells.slots).not.undefined;\n      });\n\n      spellLevels.forEach((lvl) => {\n        it(`has spell level ${lvl}`, async () => {\n          const actor = await getMockActorKey(key);\n          expect(actor?.system.spells.slots[lvl]).not.undefined;\n          expect(Object.keys(actor?.system.spells.slots[lvl])).contain(\"used\");\n          expect(Object.keys(actor?.system.spells.slots[lvl])).contain(\"max\");\n        });\n      });\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n    });\n  });\n\n  describe(\"defineSchema()\", () => {\n    before(async () => {\n      await createMockActor();\n    });\n\n    const flatFields = [\"config\", \"initiative\", \"thac0\", \"languages\"];\n    flatFields.forEach((field) => {\n      it(`has ${field}`, async () => {\n        const actor = await getMockActorKey(key);\n        expect(actor?.system[field]).not.undefined;\n      });\n    });\n\n    const recursiveFields = [\n      { field: \"hp\", subFields: [\"hd\", \"value\", \"max\"] },\n      { field: \"exploration\", subFields: [\"ft\", \"ld\", \"od\", \"sd\"] },\n      { field: \"retainer\", subFields: [\"enabled\", \"loyalty\", \"wage\"] },\n    ];\n    recursiveFields.forEach(({ field, subFields }) => {\n      subFields.forEach((subField) => {\n        it(`${field} field has ${subField} subfield`, async () => {\n          const actor = await getMockActorKey(key);\n          expect(actor?.system[field]).not.undefined;\n          expect(actor?.system[field][subField]).not.undefined;\n        });\n      });\n    });\n\n    const doubleRecursiveFields = [\n      {\n        field: \"saves\",\n        subFields: [\n          { subField: \"breath\", subSubField: [\"value\"] },\n          { subField: \"death\", subSubField: [\"value\"] },\n          { subField: \"paralysis\", subSubField: [\"value\"] },\n          { subField: \"spell\", subSubField: [\"value\"] },\n          { subField: \"wand\", subSubField: [\"value\"] },\n        ],\n      },\n    ];\n    doubleRecursiveFields.forEach(({ field, subFields }) => {\n      subFields.forEach(({ subField, subSubField }) => {\n        it(`${field} field has ${subField} subfield, which has ${subSubField} field`, async () => {\n          const actor = await getMockActorKey(key);\n          expect(actor?.system[field]).not.undefined;\n          expect(actor?.system[field][subField]).not.undefined;\n          expect(actor?.system[field][subField][subSubField]).not.undefined;\n        });\n      });\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n    });\n  });\n\n  describe(\"usesAscendingAC()\", () => {\n    it(\"successfully reads from settings\", () => {\n      expect(dataModel.usesAscendingAC).equal(\n        game.settings.get(game.system.id, \"ascendingAC\")\n      );\n    });\n  });\n\n  describe(\"meleeMod()\", () => {\n    describe(\"ascendingAC on\", () => {\n      before(async () => {\n        await game.settings.set(game.system.id, \"ascendingAC\", true);\n      });\n\n      it(\"without scores, return 0 if bba undefined\", () => {\n        expect(dataModel.meleeMod).equal(0);\n      });\n\n      it(\"without scores, return thac0.bba when bba defined\", () => {\n        dataModel.thac0.bba = 12;\n        expect(dataModel.meleeMod).equal(12);\n        dataModel.thac0.bba = 0;\n        expect(dataModel.thac0.bba).equal(0);\n      });\n    });\n\n    describe(\"ascendingAC off\", () => {\n      before(async () => {\n        await game.settings.set(game.system.id, \"ascendingAC\", false);\n      });\n\n      it(\"without scores, return 0\", async () => {\n        expect(dataModel.meleeMod).equal(0);\n      });\n    });\n\n    it(\"adds str modifier\", () => {\n      dataModel.scores.str = { mod: 10 };\n      expect(dataModel.meleeMod).equal(10);\n      dataModel.scores.str.mod = 0;\n      expect(dataModel.scores.str.mod).equal(0);\n    });\n\n    it(\"adds thac0 melee modifier\", () => {\n      dataModel.thac0.mod = { melee: 5 };\n      expect(dataModel.meleeMod).equal(5);\n      dataModel.thac0.mod.melee = 0;\n      expect(dataModel.thac0.mod.melee).equal(0);\n    });\n  });\n\n  describe(\"rangedMod()\", () => {\n    describe(\"ascendingAC on\", () => {\n      before(async () => {\n        await game.settings.set(game.system.id, \"ascendingAC\", true);\n      });\n\n      it(\"without scores, return 0 if bba undefined\", () => {\n        expect(dataModel.rangedMod).equal(0);\n      });\n\n      it(\"without scores, return thac0.bba when bba defined\", () => {\n        dataModel.thac0.bba = 12;\n        expect(dataModel.rangedMod).equal(12);\n        dataModel.thac0.bba = 0;\n        expect(dataModel.thac0.bba).equal(0);\n      });\n    });\n\n    describe(\"ascendingAC off\", () => {\n      before(async () => {\n        await game.settings.set(game.system.id, \"ascendingAC\", false);\n      });\n\n      it(\"without scores, return 0\", async () => {\n        expect(dataModel.rangedMod).equal(0);\n      });\n    });\n\n    it(\"adds dex modifier\", () => {\n      dataModel.scores.dex = { mod: 10 };\n      expect(dataModel.rangedMod).equal(10);\n      dataModel.scores.dex.mod = 0;\n      expect(dataModel.scores.dex.mod).equal(0);\n    });\n\n    it(\"adds thac0 missile modifier\", () => {\n      dataModel.thac0.mod = { missile: 5 };\n      expect(dataModel.rangedMod).equal(5);\n      dataModel.thac0.mod.missile = 0;\n      expect(dataModel.thac0.mod.missile).equal(0);\n    });\n  });\n\n  describe(\"isNew()\", () => {\n    it(\"New when all ability scores are at 0\", async () => {\n      const testActor = await createMockActorKey(\n        \"character\",\n        {\n          system: {\n            scores: {\n              str: { value: 0 },\n              int: { value: 0 },\n              wis: { value: 0 },\n              dex: { value: 0 },\n              con: { value: 0 },\n              cha: { value: 0 },\n            },\n          },\n        },\n        key\n      );\n      expect(testActor?.system.isNew).to.be.true;\n    });\n\n    it(\"Not new when any ability score is above 0\", async () => {\n      const testActor = await createMockActorKey(\n        \"character\",\n        {\n          system: {\n            scores: {\n              str: { value: 10 },\n              int: { value: 0 },\n              wis: { value: 0 },\n              dex: { value: 0 },\n              con: { value: 0 },\n              cha: { value: 0 },\n            },\n          },\n        },\n        key\n      );\n      expect(testActor?.system.isNew).to.be.false;\n    });\n\n    it(\"New when all saves are at 0\", async () => {\n      const testActor = await createMockActorKey(\n        \"monster\",\n        {\n          system: {\n            saves: {\n              breath: { value: 0 },\n              death: { value: 0 },\n              paralysis: { value: 0 },\n              spell: { value: 0 },\n              wand: { value: 0 },\n            },\n          },\n        },\n        key\n      );\n      expect(testActor?.system.isNew).to.be.true;\n    });\n\n    it(\"Not new when any save is above 0\", async () => {\n      const testActor = await createMockActorKey(\n        \"monster\",\n        {\n          system: {\n            saves: {\n              breath: { value: 10 },\n              death: { value: 0 },\n              paralysis: { value: 0 },\n              spell: { value: 0 },\n              wand: { value: 0 },\n            },\n          },\n        },\n        key\n      );\n      expect(testActor?.system.isNew).to.be.false;\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n    });\n  });\n\n  describe(\"containers()\", () => {\n    it(\"returns all containers\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.items.contents.length).equal(0);\n      expect(actor?.system.containers.length).equal(0);\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        { type: \"container\", name: \"test container\" },\n      ]);\n      expect(actor?.items.contents.length).equal(1);\n      const itemContainer = actor?.items.getName(\"test container\");\n      expect(itemContainer).to.not.be.undefined;\n      expect(itemContainer?.name).equal(\"test container\");\n      expect(actor?.system.containers.length).equal(1);\n      // eslint-disable-next-line no-underscore-dangle\n      expect(actor?.system.containers[0]._id).equal(itemContainer?.id);\n      await actor?.delete();\n    });\n  });\n\n  describe(\"treasures()\", () => {\n    it(\"returns treasures on actor\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.items.contents.length).equal(0);\n      expect(actor?.system.treasures.length).equal(0);\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        { type: \"item\", name: \"test treasure\", system: { treasure: true } },\n      ]);\n      expect(actor?.items.contents.length).equal(1);\n      const itemTreasure = actor?.items.getName(\"test treasure\");\n      expect(itemTreasure).to.not.be.undefined;\n      expect(itemTreasure?.name).equal(\"test treasure\");\n      expect(itemTreasure?.system.treasure).is.true;\n      expect(actor?.system.treasures.length).equal(1);\n      // eslint-disable-next-line no-underscore-dangle\n      expect(actor?.system.treasures[0]._id).equal(itemTreasure?.id);\n      await actor?.delete();\n    });\n\n    it(\"doesn't returns treasures on actor if in container\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.items.contents.length).equal(0);\n      expect(actor?.system.treasures.length).equal(0);\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        { type: \"container\", name: \"test container\" },\n      ]);\n      const container = actor?.items.getName(\"test container\");\n      expect(container).to.not.be.undefined;\n      expect(container?.name).equal(\"test container\");\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        {\n          type: \"item\",\n          name: \"test treasure\",\n          system: { treasure: true, containerId: container?.id },\n        },\n      ]);\n      expect(actor?.items.contents.length).equal(2);\n      const itemTreasure = actor?.items.getName(\"test treasure\");\n      expect(itemTreasure).to.not.be.undefined;\n      expect(itemTreasure?.name).equal(\"test treasure\");\n      expect(itemTreasure?.system.treasure).is.true;\n      expect(itemTreasure?.system.containerId).equal(container?.id);\n      expect(actor?.system.treasures.length).equal(0);\n      await actor?.delete();\n    });\n  });\n\n  describe(\"carriedTreasure()\", () => {\n    it(\"return treasure value on actor\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.items.contents.length).equal(0);\n      expect(actor?.system.carriedTreasure).equal(0);\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        {\n          type: \"item\",\n          name: \"test treasure\",\n          system: { treasure: true, quantity: { value: 1 }, cost: 10 },\n        },\n      ]);\n      expect(actor?.items.contents.length).equal(1);\n      const itemTreasure = actor?.items.getName(\"test treasure\");\n      expect(itemTreasure).to.not.be.undefined;\n      expect(itemTreasure?.name).equal(\"test treasure\");\n      expect(itemTreasure?.system.treasure).is.true;\n      expect(actor?.system.carriedTreasure).equal(10);\n      await actor?.delete();\n    });\n\n    it(\"return multiple treasure value on actor\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.items.contents.length).equal(0);\n      expect(actor?.system.carriedTreasure).equal(0);\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        {\n          type: \"item\",\n          name: \"test treasure\",\n          system: { treasure: true, quantity: { value: 1 }, cost: 10 },\n        },\n        {\n          type: \"item\",\n          name: \"test treasure 2\",\n          system: { treasure: true, quantity: { value: 3 }, cost: 4 },\n        },\n      ]);\n      expect(actor?.items.contents.length).equal(2);\n      const itemTreasure = actor?.items.getName(\"test treasure\");\n      expect(itemTreasure).to.not.be.undefined;\n      expect(itemTreasure?.name).equal(\"test treasure\");\n      expect(itemTreasure?.system.treasure).is.true;\n      const itemTreasure2 = actor?.items.getName(\"test treasure 2\");\n      expect(itemTreasure2).to.not.be.undefined;\n      expect(itemTreasure2?.name).equal(\"test treasure 2\");\n      expect(itemTreasure2?.system.treasure).is.true;\n      expect(actor?.system.carriedTreasure).equal(10 + 3 * 4);\n      await actor?.delete();\n    });\n\n    it(\"doesn't returns treasure value on actor if in container\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.items.contents.length).equal(0);\n      expect(actor?.system.carriedTreasure).equal(0);\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        { type: \"container\", name: \"test container\" },\n      ]);\n      const container = actor?.items.getName(\"test container\");\n      expect(container).to.not.be.undefined;\n      expect(container?.name).equal(\"test container\");\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        {\n          type: \"item\",\n          name: \"test treasure\",\n          system: {\n            treasure: true,\n            containerId: container?.id,\n            quantity: { value: 1 },\n            cost: 10,\n          },\n        },\n      ]);\n      expect(actor?.items.contents.length).equal(2);\n      const itemTreasure = actor?.items.getName(\"test treasure\");\n      expect(itemTreasure).to.not.be.undefined;\n      expect(itemTreasure?.name).equal(\"test treasure\");\n      expect(itemTreasure?.system.treasure).is.true;\n      expect(itemTreasure?.system.containerId).equal(container?.id);\n      expect(actor?.system.carriedTreasure).equal(0);\n      await actor?.delete();\n    });\n  });\n\n  describe(\"items()\", () => {\n    it(\"only returns other items than treasure\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.items.contents.length).equal(0);\n      expect(actor?.system.items.length).equal(0);\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        {\n          type: \"item\",\n          name: \"test item\",\n        },\n        {\n          type: \"item\",\n          name: \"test treasure\",\n          system: { treasure: true, quantity: { value: 3 }, cost: 4 },\n        },\n      ]);\n      expect(actor?.items.contents.length).equal(2);\n      const testItem = actor?.items.getName(\"test item\");\n      expect(testItem).to.not.be.undefined;\n      expect(testItem?.name).equal(\"test item\");\n      const testTreasure = actor?.items.getName(\"test treasure\");\n      expect(testTreasure).to.not.be.undefined;\n      expect(testTreasure?.name).equal(\"test treasure\");\n      expect(testTreasure?.system.treasure).is.true;\n      expect(actor?.system.items.length).equal(1);\n      expect(actor?.system.items[0].name).equal(\"test item\");\n      await actor?.delete();\n    });\n\n    it(\"only returns other items than stored in containers\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.items.contents.length).equal(0);\n      expect(actor?.system.items.length).equal(0);\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        {\n          type: \"container\",\n          name: \"test container\",\n        },\n      ]);\n      const container = actor?.items.getName(\"test container\");\n      expect(container).to.not.be.undefined;\n      expect(container?.name).equal(\"test container\");\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        {\n          type: \"item\",\n          name: \"test item in container\",\n          system: { containerId: container?.id },\n        },\n        {\n          type: \"item\",\n          name: \"test item\",\n        },\n      ]);\n      expect(actor?.items.contents.length).equal(3);\n      const itemInContainer = actor?.items.getName(\"test item in container\");\n      expect(itemInContainer).to.not.be.undefined;\n      expect(itemInContainer?.name).equal(\"test item in container\");\n      const testItem = actor?.items.getName(\"test item\");\n      expect(testItem).to.not.be.undefined;\n      expect(testItem?.name).equal(\"test item\");\n      expect(actor?.system.items.length).equal(1);\n      expect(actor?.system.items[0].name).equal(\"test item\");\n      await actor?.delete();\n    });\n  });\n\n  const testTypes = [\n    { type: \"weapon\", getter: \"weapons\" },\n    { type: \"ability\", getter: \"abilities\" },\n    { type: \"armor\", getter: \"armor\" },\n    { type: \"spell\", getter: \"spellList\" },\n  ];\n  testTypes.forEach(({ type, getter }) => {\n    describe(`${getter}()`, () => {\n      it(`returns all ${getter}`, async () => {\n        const actor = await createMockActor();\n        expect(actor?.items.contents.length).equal(0);\n        expect(actor?.system[getter].length).equal(0);\n        await actor?.createEmbeddedDocuments(\"Item\", [\n          { type, name: `test ${type}` },\n        ]);\n        expect(actor?.items.contents.length).equal(1);\n        const testItem = actor?.items.getName(`test ${type}`);\n        expect(testItem).to.not.be.undefined;\n        expect(testItem?.name).equal(`test ${type}`);\n        expect(actor?.system[getter].length).equal(1);\n        // eslint-disable-next-line no-underscore-dangle\n        expect(actor?.system[getter][0]._id).equal(testItem?.id);\n        await actor?.delete();\n      });\n\n      it(`returns all ${getter} except ones in container`, async () => {\n        switch (getter) {\n          case \"abilities\":\n            // Abilities are not stored in containers\n            return;\n\n          case \"spellList\":\n            // Spells are not stored in containers\n            return;\n\n          default:\n            break;\n        }\n\n        const actor = await createMockActor();\n        expect(actor?.items.contents.length).equal(0);\n        expect(actor?.system[getter].length).equal(0);\n        await actor?.createEmbeddedDocuments(\"Item\", [\n          {\n            type: \"container\",\n            name: \"test container\",\n          },\n        ]);\n        const container = actor?.items.getName(\"test container\");\n        expect(container).to.not.be.undefined;\n        expect(container?.name).equal(\"test container\");\n        await actor?.createEmbeddedDocuments(\"Item\", [\n          {\n            type,\n            name: `test ${type} in container`,\n            system: { containerId: container?.id },\n          },\n          {\n            type,\n            name: `test ${type}`,\n          },\n        ]);\n        expect(actor?.items.contents.length).equal(3);\n        const itemInContainer = actor?.items.getName(\n          `test ${type} in container`\n        );\n        expect(itemInContainer).to.not.be.undefined;\n        expect(itemInContainer?.name).equal(`test ${type} in container`);\n        const testItem = actor?.items.getName(`test ${type}`);\n        expect(testItem).to.not.be.undefined;\n        expect(testItem?.name).equal(`test ${type}`);\n        expect(actor?.system[getter].length).equal(1);\n        // eslint-disable-next-line no-underscore-dangle\n        expect(actor?.system[getter][0]._id).equal(testItem?.id);\n        await actor?.delete();\n      });\n    });\n  });\n\n  describe(\"isSlow()\", () => {\n    it(\"returns false if no weapons\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.system.isSlow).is.false;\n      await actor?.delete();\n    });\n\n    it(\"returns false if weapon that has slow tag and not equipped\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.items.contents.length).equal(0);\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        {\n          type: \"weapon\",\n          name: \"test weapon\",\n          system: { slow: true, equipped: false },\n        },\n      ]);\n      expect(actor?.items.contents.length).equal(1);\n      const testItem = actor?.items.getName(\"test weapon\");\n      expect(testItem).to.not.be.undefined;\n      expect(testItem?.name).equal(\"test weapon\");\n      expect(actor?.system.isSlow).is.false;\n      await actor?.delete();\n    });\n\n    it(\"returns false if weapon that doesn't have slow tag and is equipped\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.items.contents.length).equal(0);\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        {\n          type: \"weapon\",\n          name: \"test weapon\",\n          system: { slow: false, equipped: true },\n        },\n      ]);\n      expect(actor?.items.contents.length).equal(1);\n      const testItem = actor?.items.getName(\"test weapon\");\n      expect(testItem).to.not.be.undefined;\n      expect(testItem?.name).equal(\"test weapon\");\n      expect(actor?.system.isSlow).is.false;\n      await actor?.delete();\n    });\n\n    it(\"returns true if weapon that has slow tag and is equipped\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.items.contents.length).equal(0);\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        {\n          type: \"weapon\",\n          name: \"test weapon\",\n          system: { slow: true, equipped: true },\n        },\n      ]);\n      expect(actor?.items.contents.length).equal(1);\n      const testItem = actor?.items.getName(\"test weapon\");\n      expect(testItem).to.not.be.undefined;\n      expect(testItem?.name).equal(\"test weapon\");\n      expect(actor?.system.isSlow).is.true;\n      await actor?.delete();\n    });\n  });\n\n  describe(\"init()\", () => {\n    describe(\"group inititative\", () => {\n      before(async () => {\n        await game.settings.set(game.system.id, \"initiative\", \"group\");\n      });\n\n      it(\"returns 0\", () => {\n        expect(dataModel.init).equal(0);\n      });\n\n      it(\"returns 0 with initiative value set\", async () => {\n        dataModel.initiative.value = 12;\n        expect(dataModel.init).equal(0);\n        dataModel.initiative.value = 0;\n        expect(dataModel.initiative.value).equal(0);\n      });\n\n      it(\"returns 0 with initiative mod set\", async () => {\n        dataModel.initiative.mod = 10;\n        expect(dataModel.init).equal(0);\n        dataModel.initiative.mod = 0;\n        expect(dataModel.initiative.mod).equal(0);\n      });\n\n      it(\"returns 0 with dex mod init set\", async () => {\n        dataModel.dex = { mod: { init: 5 } };\n        expect(dataModel.init).equal(0);\n        dataModel.dex.mod.init = 0;\n        expect(dataModel.dex.mod.init).equal(0);\n      });\n    });\n\n    describe(\"individual inititative\", () => {\n      before(async () => {\n        await game.settings.set(game.system.id, \"initiative\", \"individual\");\n        // Initialise the scores with a \"standard\" dexterity score\n        dataModel.scores = new OseDataModelCharacterScores({\n          dex: { value: 9, bonus: 0, mod: 0 },\n        });\n      });\n\n      it(\"returns 0 by default\", () => {\n        expect(dataModel.initiative.value).equal(0);\n        expect(dataModel.initiative.mod).equal(0);\n        expect(dataModel.scores.dex.init).equal(0);\n        expect(dataModel.init).equal(0);\n      });\n\n      it(\"returns correctly with initiative value set\", async () => {\n        dataModel.initiative.value = 12;\n        expect(dataModel.init).equal(12);\n        dataModel.initiative.value = 0;\n        expect(dataModel.initiative.value).equal(0);\n      });\n\n      it(\"returns correctly with initiative mod set\", async () => {\n        dataModel.initiative.mod = 10;\n        expect(dataModel.init).equal(10);\n        dataModel.initiative.mod = 0;\n        expect(dataModel.initiative.mod).equal(0);\n      });\n\n      it(\"returns correctly with dex mod init set\", async () => {\n        // See the Ability Scores section in the OSE SRD for how dexterity affects initiative\n        dataModel.scores.dex = { value: 18 };\n        expect(dataModel.init).equal(2);\n        dataModel.scores.dex = { value: 9 };\n        expect(dataModel.scores.dex.init).equal(0);\n      });\n\n      it(\"returns correctly with initiative value, mod, and dex mod init set\", async () => {\n        dataModel.initiative.value = 12;\n        dataModel.initiative.mod = 10;\n        dataModel.scores.dex = { value: 18 };\n        expect(dataModel.init).equal(24);\n        dataModel.initiative.value = 0;\n        expect(dataModel.initiative.value).equal(0);\n        dataModel.initiative.mod = 0;\n        expect(dataModel.initiative.mod).equal(0);\n        dataModel.scores.dex = { value: 9 };\n        expect(dataModel.scores.dex.init).equal(0);\n      });\n    });\n  });\n};\n","/**\n * @file Tests for the class representing a creature data model's AC\n */\nimport { QuenchMethods } from \"../../../../e2e\";\nimport OseDataModelCharacterAC from \"../data-model-character-ac\";\n\nexport const key = \"ose.actor.datamodel.character.ac\";\nexport const options = { displayName: \"OSE: Actor: Data Model: Character AC\" };\n\nexport default ({ describe, it, expect }: QuenchMethods) => {\n  const armorAC = 4;\n  const shieldAC = 2;\n  // eslint-disable-next-line new-cap\n  const armor = new Item.implementation({\n    name: \"Armor\",\n    type: \"armor\",\n    system: {\n      ac: { value: armorAC },\n      aac: { value: armorAC },\n      type: \"light\",\n      equipped: true,\n    },\n  }) as Item;\n\n  // eslint-disable-next-line new-cap\n  const shield = new Item.implementation({\n    name: \"Shield\",\n    type: \"armor\",\n    system: {\n      ac: { value: shieldAC },\n      aac: { value: shieldAC },\n      type: \"shield\",\n      equipped: true,\n    },\n  }) as Item;\n\n  const itemsArmor = [armor];\n  const itemsShield = [shield] as Item[];\n  const itemsBoth = [armor, shield] as Item[];\n\n  const positiveDexMod = 3;\n  const negativeDexMod = -1;\n\n  const positiveArbitraryMod = 2;\n  const negativeArbitraryMod = -4;\n\n  describe(\"Naked AC values\", () => {\n    describe(\"Returns the default base AC\", () => {\n      it(\"When ascending\", () => {\n        const ac = new OseDataModelCharacterAC(true);\n        expect(ac.value).to.equal(OseDataModelCharacterAC.baseAscending);\n      });\n      it(\"When descending\", () => {\n        const ac = new OseDataModelCharacterAC();\n        expect(ac.value).to.equal(OseDataModelCharacterAC.baseDescending);\n      });\n    });\n  });\n\n  describe(\"Armored AC values\", () => {\n    describe(\"Returns the expected AC, provided equipment\", () => {\n      describe(\"With armor\", () => {\n        it(\"When ascending\", () => {\n          const ac = new OseDataModelCharacterAC(true, itemsArmor);\n          // @todo this should be the expectation, needs to happen after data migration\n          // expect(ac,value).to.equal(OseDataModelCharacterAC.baseAscending + armorAC)\n          expect(ac.value).to.equal(armorAC);\n        });\n        it(\"When descending\", () => {\n          const ac = new OseDataModelCharacterAC(false, itemsArmor);\n          // @todo this should be the expectation, needs to happen after data migration\n          // expect(ac,value).to.equal(OseDataModelCharacterAC.baseDescending - armorAC)\n          expect(ac.value).to.equal(armorAC);\n        });\n      });\n\n      describe(\"With shield\", () => {\n        it(\"When ascending\", () => {\n          const ac = new OseDataModelCharacterAC(true, itemsShield);\n          expect(ac.value).to.equal(\n            OseDataModelCharacterAC.baseAscending + shieldAC\n          );\n        });\n        it(\"When descending\", () => {\n          const ac = new OseDataModelCharacterAC(false, itemsShield);\n          expect(ac.value).to.equal(\n            OseDataModelCharacterAC.baseDescending - shieldAC\n          );\n        });\n      });\n\n      describe(\"With armor and shield\", () => {\n        it(\"When ascending\", () => {\n          const ac = new OseDataModelCharacterAC(true, itemsBoth);\n          // @todo this should be the expectation, needs to happen after data migration\n          // expect(ac,value).to.equal(OseDataModelCharacterAC.baseAscending + armorAC + shieldAC)\n          expect(ac.value).to.equal(armorAC + shieldAC);\n        });\n        it(\"When descending\", () => {\n          const ac = new OseDataModelCharacterAC(false, itemsBoth);\n          // @todo this should be the expectation, needs to happen after data migration\n          // expect(ac,value).to.equal(OseDataModelCharacterAC.baseDescending - armorAC - shieldAC)\n          expect(ac.value).to.equal(armorAC - shieldAC);\n        });\n      });\n    });\n  });\n\n  describe(\"With a dexterity modifier\", () => {\n    describe(\"Positive modifier\", () => {\n      describe(\"When ascending\", () => {\n        const base = OseDataModelCharacterAC.baseAscending;\n        it(\"Unarmored, no shield\", () => {\n          const ac = new OseDataModelCharacterAC(true, [], positiveDexMod);\n          expect(ac.value).to.equal(base + positiveDexMod);\n        });\n        it(\"Armored, no shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            true,\n            itemsArmor,\n            positiveDexMod\n          );\n          expect(ac.value).to.equal(armorAC + positiveDexMod);\n        });\n        it(\"Unarmored, shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            true,\n            itemsShield,\n            positiveDexMod\n          );\n          expect(ac.value).to.equal(base + shieldAC + positiveDexMod);\n        });\n        it(\"Armored, shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            true,\n            itemsBoth,\n            positiveDexMod\n          );\n          expect(ac.value).to.equal(armorAC + shieldAC + positiveDexMod);\n        });\n      });\n      describe(\"When descending\", () => {\n        const base = OseDataModelCharacterAC.baseDescending;\n        it(\"Unarmored, no shield\", () => {\n          const ac = new OseDataModelCharacterAC(false, [], positiveDexMod);\n          expect(ac.value).to.equal(base - positiveDexMod);\n        });\n        it(\"Armored, no shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            false,\n            itemsArmor,\n            positiveDexMod\n          );\n          expect(ac.value).to.equal(armorAC - positiveDexMod);\n        });\n        it(\"Unarmored, shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            false,\n            itemsShield,\n            positiveDexMod\n          );\n          expect(ac.value).to.equal(base - shieldAC - positiveDexMod);\n        });\n        it(\"Armored, shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            false,\n            itemsBoth,\n            positiveDexMod\n          );\n          expect(ac.value).to.equal(armorAC - shieldAC - positiveDexMod);\n        });\n      });\n    });\n    describe(\"Negative modifier\", () => {\n      describe(\"When ascending\", () => {\n        const base = OseDataModelCharacterAC.baseAscending;\n        it(\"Unarmored, no shield\", () => {\n          const ac = new OseDataModelCharacterAC(true, [], negativeDexMod);\n          expect(ac.value).to.equal(base + negativeDexMod);\n        });\n        it(\"Armored, no shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            true,\n            itemsArmor,\n            negativeDexMod\n          );\n          expect(ac.value).to.equal(armorAC + negativeDexMod);\n        });\n        it(\"Unarmored, shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            true,\n            itemsShield,\n            negativeDexMod\n          );\n          expect(ac.value).to.equal(base + shieldAC + negativeDexMod);\n        });\n        it(\"Armored, shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            true,\n            itemsBoth,\n            negativeDexMod\n          );\n          expect(ac.value).to.equal(armorAC + shieldAC + negativeDexMod);\n        });\n      });\n      describe(\"When descending\", () => {\n        const base = OseDataModelCharacterAC.baseDescending;\n        it(\"Unarmored, no shield\", () => {\n          const ac = new OseDataModelCharacterAC(false, [], negativeDexMod);\n          expect(ac.value).to.equal(base - negativeDexMod);\n        });\n        it(\"Armored, no shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            false,\n            itemsArmor,\n            negativeDexMod\n          );\n          expect(ac.value).to.equal(armorAC - negativeDexMod);\n        });\n        it(\"Unarmored, shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            false,\n            itemsShield,\n            negativeDexMod\n          );\n          expect(ac.value).to.equal(base - shieldAC - negativeDexMod);\n        });\n        it(\"Armored, shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            false,\n            itemsBoth,\n            negativeDexMod\n          );\n          expect(ac.value).to.equal(armorAC - shieldAC - negativeDexMod);\n        });\n      });\n    });\n  });\n\n  describe(\"With an arbitrary modifier\", () => {\n    describe(\"Positive modifier\", () => {\n      describe(\"When ascending\", () => {\n        const base = OseDataModelCharacterAC.baseAscending;\n        it(\"Unarmored, no shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            true,\n            [],\n            0,\n            positiveArbitraryMod\n          );\n          expect(ac.value).to.equal(base + positiveArbitraryMod);\n        });\n        it(\"Armored, no shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            true,\n            itemsArmor,\n            0,\n            positiveArbitraryMod\n          );\n          expect(ac.value).to.equal(armorAC + positiveArbitraryMod);\n        });\n        it(\"Unarmored, shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            true,\n            itemsShield,\n            0,\n            positiveArbitraryMod\n          );\n          expect(ac.value).to.equal(base + shieldAC + positiveArbitraryMod);\n        });\n        it(\"Armored, shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            true,\n            itemsBoth,\n            0,\n            positiveArbitraryMod\n          );\n          expect(ac.value).to.equal(armorAC + shieldAC + positiveArbitraryMod);\n        });\n      });\n      describe(\"When descending\", () => {\n        const base = OseDataModelCharacterAC.baseDescending;\n        it(\"Unarmored, no shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            false,\n            [],\n            0,\n            positiveArbitraryMod\n          );\n          expect(ac.value).to.equal(base - positiveArbitraryMod);\n        });\n        it(\"Armored, no shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            false,\n            itemsArmor,\n            0,\n            positiveArbitraryMod\n          );\n          expect(ac.value).to.equal(armorAC - positiveArbitraryMod);\n        });\n        it(\"Unarmored, shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            false,\n            itemsShield,\n            0,\n            positiveArbitraryMod\n          );\n          expect(ac.value).to.equal(base - shieldAC - positiveArbitraryMod);\n        });\n        it(\"Armored, shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            false,\n            itemsBoth,\n            0,\n            positiveArbitraryMod\n          );\n          expect(ac.value).to.equal(armorAC - shieldAC - positiveArbitraryMod);\n        });\n      });\n    });\n    describe(\"Negative modifier\", () => {\n      describe(\"When ascending\", () => {\n        const base = OseDataModelCharacterAC.baseAscending;\n        it(\"Unarmored, no shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            true,\n            [],\n            0,\n            negativeArbitraryMod\n          );\n          expect(ac.value).to.equal(base + negativeArbitraryMod);\n        });\n        it(\"Armored, no shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            true,\n            itemsArmor,\n            0,\n            negativeArbitraryMod\n          );\n          expect(ac.value).to.equal(armorAC + negativeArbitraryMod);\n        });\n        it(\"Unarmored, shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            true,\n            itemsShield,\n            0,\n            negativeArbitraryMod\n          );\n          expect(ac.value).to.equal(base + shieldAC + negativeArbitraryMod);\n        });\n        it(\"Armored, shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            true,\n            itemsBoth,\n            0,\n            negativeArbitraryMod\n          );\n          expect(ac.value).to.equal(armorAC + shieldAC + negativeArbitraryMod);\n        });\n      });\n      describe(\"When descending\", () => {\n        const base = OseDataModelCharacterAC.baseDescending;\n        it(\"Unarmored, no shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            false,\n            [],\n            0,\n            negativeArbitraryMod\n          );\n          expect(ac.value).to.equal(base - negativeArbitraryMod);\n        });\n        it(\"Armored, no shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            false,\n            itemsArmor,\n            0,\n            negativeArbitraryMod\n          );\n          expect(ac.value).to.equal(armorAC - negativeArbitraryMod);\n        });\n        it(\"Unarmored, shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            false,\n            itemsShield,\n            0,\n            negativeArbitraryMod\n          );\n          expect(ac.value).to.equal(base - shieldAC - negativeArbitraryMod);\n        });\n        it(\"Armored, shield\", () => {\n          const ac = new OseDataModelCharacterAC(\n            false,\n            itemsBoth,\n            0,\n            negativeArbitraryMod\n          );\n          expect(ac.value).to.equal(armorAC - shieldAC - negativeArbitraryMod);\n        });\n      });\n    });\n  });\n};\n","/**\n * @file Tests for encumbrance schemes that are part of the Old School Essentials SRD\n */\nimport { QuenchMethods } from \"../../../../e2e\";\nimport OseDataModelCharacterEncumbrance from \"../data-model-character-encumbrance\";\nimport EncumbranceBasic from \"../data-model-character-encumbrance-basic\";\nimport EncumbranceComplete from \"../data-model-character-encumbrance-complete\";\nimport EncumbranceDetailed from \"../data-model-character-encumbrance-detailed\";\nimport EncumbranceDisabled from \"../data-model-character-encumbrance-disabled\";\nimport EncumbranceItemBased from \"../data-model-character-encumbrance-item-based\";\n\nexport const key = \"ose.actor.datamodel.character.encumbrance\";\nexport const options = {\n  displayName: \"OSE: Actor: Data Model: Character Encumbrance\",\n};\n\nconst toPct = (value: number, max: number) =>\n  Math.clamp((100 * value) / max, 0, 100);\nconst createMockItem = (\n  type: string,\n  weight: number,\n  quantity: number,\n  itemOptions = {}\n): Item =>\n  // eslint-disable-next-line new-cap\n  new Item.implementation({\n    name: `Mock ${type} ${foundry.utils.randomID()}`,\n    type,\n    system: { ...itemOptions, weight, quantity: { value: quantity } },\n  }) as Item;\n\nexport default ({ describe, it, expect }: QuenchMethods) => {\n  describe(\"Disabled Encumbrance\", () => {\n    it(\"Is disabled\", () => {\n      let enc = new OseDataModelCharacterEncumbrance();\n      expect(enc.enabled).to.be.false;\n\n      enc = new EncumbranceDisabled();\n      expect(enc.enabled).to.be.false;\n    });\n  });\n\n  describe(\"Basic Encumbrance\", () => {\n    it(\"Is enabled\", () => {\n      const enc = new EncumbranceBasic();\n      expect(enc.enabled).to.be.true;\n    });\n\n    it(\"Returns the appropriate encumbrance steps\", () => {\n      const enc = new EncumbranceBasic();\n      const step = game.settings.get(game.system.id, \"significantTreasure\");\n      const expectedSteps = [(100 * (step as number)) / enc.max];\n      expect(enc.steps).to.have.members(expectedSteps);\n    });\n\n    describe(\"Returns current carried weight\", () => {\n      it(\"As Percentage\", () => {\n        const max = 1600;\n        const pct25 = 400;\n        const pct50 = 800;\n        const pct75 = 1200;\n\n        let enc = new EncumbranceBasic(max, [\n          createMockItem(\"item\", pct25, 1, { treasure: true }),\n        ]);\n        expect(enc.pct).to.equal(toPct(pct25, max));\n\n        enc = new EncumbranceBasic(max, [\n          createMockItem(\"item\", pct50, 1, { treasure: true }),\n        ]);\n        expect(enc.pct).to.equal(toPct(pct50, max));\n\n        enc = new EncumbranceBasic(max, [\n          createMockItem(\"item\", pct75, 1, { treasure: true }),\n        ]);\n        expect(enc.pct).to.equal(toPct(pct75, max));\n\n        enc = new EncumbranceBasic(max, [\n          createMockItem(\"item\", max, 1, { treasure: true }),\n        ]);\n        expect(enc.pct).to.equal(100);\n\n        enc = new EncumbranceBasic(max, [\n          createMockItem(\"item\", max, 1, { treasure: false }),\n        ]);\n        expect(enc.pct).to.equal(0);\n      });\n      it(\"As Value\", () => {\n        const max = 1600;\n        const pct25 = 400;\n        const pct50 = 800;\n        const pct75 = 1200;\n\n        let enc = new EncumbranceBasic(max, [\n          createMockItem(\"item\", pct25, 1, { treasure: true }),\n        ]);\n        expect(enc.value).to.equal(pct25);\n\n        enc = new EncumbranceBasic(max, [\n          createMockItem(\"item\", pct50, 1, { treasure: true }),\n        ]);\n        expect(enc.value).to.equal(pct50);\n\n        enc = new EncumbranceBasic(max, [\n          createMockItem(\"item\", pct75, 1, { treasure: true }),\n        ]);\n        expect(enc.value).to.equal(pct75);\n\n        enc = new EncumbranceBasic(max, [\n          createMockItem(\"item\", max, 1, { treasure: true }),\n        ]);\n        expect(enc.value).to.equal(max);\n\n        enc = new EncumbranceBasic(max, [\n          createMockItem(\"item\", max, 1, { treasure: false }),\n        ]);\n        expect(enc.value).to.equal(0);\n      });\n      describe(\"As fully encumbered flag\", () => {\n        it(\"Encumbered over full load (1600.1)\", () => {\n          const enc = new EncumbranceBasic(1600, [\n            createMockItem(\"item\", 1600.1, 1, { treasure: true }),\n          ]);\n          expect(enc.encumbered).to.be.true;\n        });\n        describe(\"Not encumbered\", () => {\n          it(\"from non-treasure items\", () => {\n            const enc = new EncumbranceBasic(1600, [\n              createMockItem(\"weapon\", 1600.1, 1),\n              createMockItem(\"armor\", 1600.1, 1),\n              createMockItem(\"container\", 1600.1, 1),\n              createMockItem(\"item\", 1600.1, 1),\n            ]);\n            expect(enc.encumbered).to.be.false;\n          });\n          it(\"from a partial load\", () => {\n            const enc = new EncumbranceBasic(1600, [\n              createMockItem(\"item\", 400, 1, { treasure: true }),\n            ]);\n            expect(enc.encumbered).to.be.false;\n          });\n        });\n      });\n      it('As \"over significant treasure threshold\" flag', () => {\n        let enc = new EncumbranceBasic(1600, [\n          createMockItem(\"item\", 400, 1, { treasure: true }),\n        ]);\n        expect(enc.overSignificantTreasureThreshold).to.be.false;\n\n        enc = new EncumbranceBasic(1600, [\n          createMockItem(\"item\", 800, 1, { treasure: true }),\n        ]);\n        expect(enc.overSignificantTreasureThreshold).to.be.true;\n\n        enc = new EncumbranceBasic(1600, [createMockItem(\"weapon\", 800, 1)]);\n        expect(enc.overSignificantTreasureThreshold).to.be.false;\n      });\n    });\n\n    it(\"Returns max carry weight\", () => {\n      const setMax = 2000;\n\n      let enc = new EncumbranceBasic(setMax);\n      expect(enc.max).to.equal(setMax);\n\n      enc = new EncumbranceBasic();\n      expect(enc.max).to.equal(\n        OseDataModelCharacterEncumbrance.baseEncumbranceCap\n      );\n    });\n  });\n\n  describe(\"Detailed Encumbrance\", () => {\n    it(\"Is enabled\", () => {\n      const enc = new EncumbranceDetailed();\n      expect(enc.enabled).to.be.true;\n    });\n    it(\"Returns the appropriate encumbrance steps\", () => {\n      const enc = new EncumbranceDetailed();\n      expect(enc.steps).to.have.members(\n        Object.values(OseDataModelCharacterEncumbrance.encumbranceSteps)\n      );\n    });\n    describe(\"Returns current carried weight\", () => {\n      it(\"As Percentage\", () => {\n        const max = 1600;\n        const pct25 = 400;\n        const pct50 = 800;\n        const pct75 = 1200;\n\n        let enc = new EncumbranceDetailed(max, [\n          createMockItem(\"item\", pct25, 1, { treasure: true }),\n        ]);\n        expect(enc.pct).to.equal(toPct(pct25, max));\n\n        enc = new EncumbranceDetailed(max, [\n          createMockItem(\"item\", pct50, 1, { treasure: true }),\n        ]);\n        expect(enc.pct).to.equal(toPct(pct50, max));\n\n        enc = new EncumbranceDetailed(max, [\n          createMockItem(\"item\", pct75, 1, { treasure: true }),\n        ]);\n        expect(enc.pct).to.equal(toPct(pct75, max));\n\n        enc = new EncumbranceDetailed(max, [\n          createMockItem(\"item\", max, 1, { treasure: true }),\n        ]);\n        expect(enc.pct).to.equal(100);\n\n        enc = new EncumbranceDetailed(max, [\n          createMockItem(\"item\", max, 1, { treasure: false }),\n        ]);\n        expect(enc.pct).to.equal(toPct(EncumbranceDetailed.gearWeight, max));\n      });\n      it(\"As Value\", () => {\n        const max = 1600;\n        const pct25 = 400;\n        const pct50 = 800;\n        const pct75 = 1200;\n\n        let enc = new EncumbranceDetailed(max, [\n          createMockItem(\"item\", pct25, 1, { treasure: true }),\n        ]);\n        expect(enc.value).to.equal(pct25);\n\n        enc = new EncumbranceDetailed(max, [\n          createMockItem(\"item\", pct50, 1, { treasure: true }),\n        ]);\n        expect(enc.value).to.equal(pct50);\n\n        enc = new EncumbranceDetailed(max, [\n          createMockItem(\"item\", pct75, 1, { treasure: true }),\n        ]);\n        expect(enc.value).to.equal(pct75);\n\n        enc = new EncumbranceDetailed(max, [\n          createMockItem(\"item\", max, 1, { treasure: true }),\n        ]);\n        expect(enc.value).to.equal(max);\n\n        enc = new EncumbranceDetailed(max, [\n          createMockItem(\"item\", max, 1, { treasure: false }),\n        ]);\n        expect(enc.value).to.equal(EncumbranceDetailed.gearWeight);\n      });\n      describe(\"As fully encumbered flag\", () => {\n        it(\"Encumbered over full load (1600.1)\", () => {\n          const enc = new EncumbranceDetailed(1600, [\n            createMockItem(\"item\", 1600.1, 1, { treasure: true }),\n          ]);\n          expect(enc.encumbered).to.be.true;\n        });\n        describe(\"Not encumbered\", () => {\n          it(\"from non-treasure items\", () => {\n            const enc = new EncumbranceDetailed(1600, [\n              createMockItem(\"item\", 1600.1, 1),\n            ]);\n            expect(enc.encumbered).to.be.false;\n            expect(enc.value).to.equal(80);\n          });\n          it(\"from a partial load\", () => {\n            const enc = new EncumbranceDetailed(1600, [\n              createMockItem(\"item\", 400, 1, { treasure: true }),\n            ]);\n            expect(enc.encumbered).to.be.false;\n          });\n        });\n      });\n    });\n\n    it(\"Returns max carry weight\", () => {\n      const setMax = 2000;\n\n      let enc = new EncumbranceDetailed(setMax);\n      expect(enc.max).to.equal(setMax);\n\n      enc = new EncumbranceDetailed();\n      expect(enc.max).to.equal(\n        OseDataModelCharacterEncumbrance.baseEncumbranceCap\n      );\n    });\n  });\n\n  describe(\"Complete Encumbrance\", () => {\n    it(\"Is enabled\", () => {\n      const enc = new EncumbranceComplete();\n      expect(enc.enabled).to.be.true;\n    });\n    it(\"Returns the appropriate encumbrance steps\", () => {\n      const enc = new EncumbranceComplete();\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      expect(enc.steps).to.have.members(\n        Object.values(OseDataModelCharacterEncumbrance.encumbranceSteps)\n      );\n    });\n    describe(\"Returns current carried weight\", () => {\n      it(\"As Percentage\", () => {\n        const max = 1600;\n        const pct25 = 400;\n        const pct50 = 800;\n        const pct75 = 1200;\n\n        let enc = new EncumbranceComplete(max, [\n          createMockItem(\"item\", pct25, 1, { treasure: true }),\n        ]);\n        expect(enc.pct).to.equal(toPct(pct25, max));\n\n        enc = new EncumbranceComplete(max, [\n          createMockItem(\"item\", pct50, 1, { treasure: true }),\n        ]);\n        expect(enc.pct).to.equal(toPct(pct50, max));\n\n        enc = new EncumbranceComplete(max, [\n          createMockItem(\"item\", pct75, 1, { treasure: true }),\n        ]);\n        expect(enc.pct).to.equal(toPct(pct75, max));\n\n        enc = new EncumbranceComplete(max, [\n          createMockItem(\"item\", max, 1, { treasure: true }),\n        ]);\n        expect(enc.pct).to.equal(100);\n\n        enc = new EncumbranceComplete(max, [\n          createMockItem(\"item\", max, 1, { treasure: false }),\n        ]);\n        expect(enc.pct).to.equal(100);\n      });\n      it(\"As Value\", () => {\n        const max = 1600;\n        const pct25 = 400;\n        const pct50 = 800;\n        const pct75 = 1200;\n\n        let enc = new EncumbranceComplete(max, [\n          createMockItem(\"item\", pct25, 1, { treasure: true }),\n        ]);\n        expect(enc.value).to.equal(pct25);\n\n        enc = new EncumbranceComplete(max, [\n          createMockItem(\"item\", pct50, 1, { treasure: true }),\n        ]);\n        expect(enc.value).to.equal(pct50);\n\n        enc = new EncumbranceComplete(max, [\n          createMockItem(\"item\", pct75, 1, { treasure: true }),\n        ]);\n        expect(enc.value).to.equal(pct75);\n\n        enc = new EncumbranceComplete(max, [\n          createMockItem(\"item\", max, 1, { treasure: true }),\n        ]);\n        expect(enc.value).to.equal(max);\n\n        enc = new EncumbranceComplete(max, [\n          createMockItem(\"item\", max, 1, { treasure: false }),\n        ]);\n        expect(enc.value).to.equal(max);\n      });\n      describe(\"As fully encumbered flag\", () => {\n        it(\"Encumbered over full load (1600.1)\", () => {\n          let enc = new EncumbranceComplete(1600, [\n            createMockItem(\"item\", 1600.1, 1, { treasure: true }),\n          ]);\n          expect(enc.encumbered).to.be.true;\n          enc = new EncumbranceComplete(1600, [\n            createMockItem(\"item\", 1600.1, 1, { treasure: false }),\n          ]);\n          expect(enc.encumbered).to.be.true;\n        });\n        describe(\"Not encumbered\", () => {\n          it(\"from a partial load\", () => {\n            const enc = new EncumbranceComplete(1600, [\n              createMockItem(\"item\", 400, 1, { treasure: true }),\n            ]);\n            expect(enc.encumbered).to.be.false;\n          });\n          it(\"from a full load\", () => {\n            let enc = new EncumbranceComplete(1600, [\n              createMockItem(\"item\", 1600, 1, { treasure: true }),\n            ]);\n            expect(enc.encumbered).to.be.false;\n            enc = new EncumbranceComplete(1600, [\n              createMockItem(\"item\", 1600, 1, { treasure: false }),\n            ]);\n            console.info(enc);\n            expect(enc.encumbered).to.be.false;\n          });\n        });\n      });\n    });\n\n    it(\"Returns max carry weight\", () => {\n      const setMax = 2000;\n\n      let enc = new EncumbranceComplete(setMax);\n      expect(enc.max).to.equal(setMax);\n\n      enc = new EncumbranceComplete();\n\n      expect(enc.max).to.equal(\n        OseDataModelCharacterEncumbrance.baseEncumbranceCap\n      );\n    });\n  });\n\n  describe(\"Item-based Encumbrance\", () => {\n    it(\"Is enabled\", () => {\n      const enc = new EncumbranceItemBased(0);\n      expect(enc.enabled).to.be.true;\n    });\n    it(\"Returns the appropriate encumbrance steps\", () => {\n      const enc = new EncumbranceItemBased(0);\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      expect(enc.steps).to.have.members(\n        Object.values(EncumbranceItemBased.equippedEncumbranceSteps)\n      );\n    });\n    describe(\"Returns current carried weight\", () => {\n      it(\"Equipped Slots\", () => {\n        const matrix = [\n          {\n            quantity: 1,\n            atFirstBreakpoint: false,\n            atSecondBreakpoint: false,\n            atThirdBreakpoint: false,\n            encumbered: false,\n          },\n          {\n            quantity: 2,\n            atFirstBreakpoint: false,\n            atSecondBreakpoint: false,\n            atThirdBreakpoint: false,\n            encumbered: false,\n          },\n          {\n            quantity: 3,\n            atFirstBreakpoint: false,\n            atSecondBreakpoint: false,\n            atThirdBreakpoint: false,\n            encumbered: false,\n          },\n          {\n            quantity: 4,\n            atFirstBreakpoint: true,\n            atSecondBreakpoint: false,\n            atThirdBreakpoint: false,\n            encumbered: false,\n          },\n          {\n            quantity: 5,\n            atFirstBreakpoint: true,\n            atSecondBreakpoint: false,\n            atThirdBreakpoint: false,\n            encumbered: false,\n          },\n          {\n            quantity: 6,\n            atFirstBreakpoint: true,\n            atSecondBreakpoint: true,\n            atThirdBreakpoint: false,\n            encumbered: false,\n          },\n          {\n            quantity: 7,\n            atFirstBreakpoint: true,\n            atSecondBreakpoint: true,\n            atThirdBreakpoint: false,\n            encumbered: false,\n          },\n          {\n            quantity: 8,\n            atFirstBreakpoint: true,\n            atSecondBreakpoint: true,\n            atThirdBreakpoint: true,\n            encumbered: false,\n          },\n          {\n            quantity: 9,\n            atFirstBreakpoint: true,\n            atSecondBreakpoint: true,\n            atThirdBreakpoint: true,\n            encumbered: false,\n          },\n          {\n            quantity: 10,\n            atFirstBreakpoint: true,\n            atSecondBreakpoint: true,\n            atThirdBreakpoint: true,\n            encumbered: true,\n          },\n        ];\n\n        for (const row of matrix) {\n          const enc = new EncumbranceItemBased(0, [\n            createMockItem(\"item\", 0, row.quantity, {\n              itemslots: 1,\n              equipped: true,\n            }),\n          ]);\n          expect(enc.value, `equipped value (${row.quantity})`).to.equal(\n            row.quantity\n          );\n          expect(enc.atFirstBreakpoint, \"atFirstBreakpoint\").to.equal(\n            row.atFirstBreakpoint\n          );\n          expect(enc.atSecondBreakpoint, \"atSecondBreakpoint\").to.equal(\n            row.atSecondBreakpoint\n          );\n          expect(enc.atThirdBreakpoint, \"atThirdBreakpoint\").to.equal(\n            row.atThirdBreakpoint\n          );\n          expect(enc.encumbered, \"encumbered flag\").to.equal(row.encumbered);\n        }\n      });\n      it(\"Packed Slots\", () => {\n        const matrix = [\n          {\n            quantity: 1,\n            atFirstBreakpoint: false,\n            atSecondBreakpoint: false,\n            atThirdBreakpoint: false,\n            encumbered: false,\n          },\n          {\n            quantity: 2,\n            atFirstBreakpoint: false,\n            atSecondBreakpoint: false,\n            atThirdBreakpoint: false,\n            encumbered: false,\n          },\n          {\n            quantity: 9,\n            atFirstBreakpoint: false,\n            atSecondBreakpoint: false,\n            atThirdBreakpoint: false,\n            encumbered: false,\n          },\n          {\n            quantity: 10,\n            atFirstBreakpoint: false,\n            atSecondBreakpoint: false,\n            atThirdBreakpoint: false,\n            encumbered: false,\n          },\n          {\n            quantity: 11,\n            atFirstBreakpoint: true,\n            atSecondBreakpoint: false,\n            atThirdBreakpoint: false,\n            encumbered: false,\n          },\n          {\n            quantity: 12,\n            atFirstBreakpoint: true,\n            atSecondBreakpoint: false,\n            atThirdBreakpoint: false,\n            encumbered: false,\n          },\n          {\n            quantity: 13,\n            atFirstBreakpoint: true,\n            atSecondBreakpoint: true,\n            atThirdBreakpoint: false,\n            encumbered: false,\n          },\n          {\n            quantity: 14,\n            atFirstBreakpoint: true,\n            atSecondBreakpoint: true,\n            atThirdBreakpoint: false,\n            encumbered: false,\n          },\n          {\n            quantity: 15,\n            atFirstBreakpoint: true,\n            atSecondBreakpoint: true,\n            atThirdBreakpoint: true,\n            encumbered: false,\n          },\n          {\n            quantity: 16,\n            atFirstBreakpoint: true,\n            atSecondBreakpoint: true,\n            atThirdBreakpoint: true,\n            encumbered: false,\n          },\n          {\n            quantity: 17,\n            atFirstBreakpoint: true,\n            atSecondBreakpoint: true,\n            atThirdBreakpoint: true,\n            encumbered: true,\n          },\n        ];\n\n        for (const row of matrix) {\n          const enc = new EncumbranceItemBased(0, [\n            createMockItem(\"item\", 0, row.quantity, {\n              itemslots: 1,\n            }),\n          ]);\n          expect(enc.packedValue, `packed value (${row.quantity})`).to.equal(\n            row.quantity\n          );\n          expect(enc.atFirstBreakpoint, \"atFirstBreakpoint\").to.equal(\n            row.atFirstBreakpoint\n          );\n          expect(enc.atSecondBreakpoint, \"atSecondBreakpoint\").to.equal(\n            row.atSecondBreakpoint\n          );\n          expect(enc.atThirdBreakpoint, \"atThirdBreakpoint\").to.equal(\n            row.atThirdBreakpoint\n          );\n          expect(enc.encumbered, \"encumbered flag\").to.equal(row.encumbered);\n        }\n      });\n      it(\"Coins and Gems\", () => {\n        const matrix = [\n          {\n            quantity: 1,\n            value: 1,\n          },\n          {\n            quantity: 50,\n            value: 1,\n          },\n          {\n            quantity: 100,\n            value: 1,\n          },\n          {\n            quantity: 101,\n            value: 2,\n          },\n        ];\n\n        for (const row of matrix) {\n          const enc = new EncumbranceItemBased(0, [\n            createMockItem(\"item\", 0, row.quantity, {\n              treasure: true,\n              tags: [{ value: \"gems\" }],\n            }),\n          ]);\n          expect(enc.packedValue, `packed value (${row.quantity})`).to.equal(\n            row.value\n          );\n          expect(enc.encumbered, \"encumbered flag\").to.be.false;\n        }\n      });\n    });\n\n    it(\"Returns max carry weight\", () => {\n      const enc = new EncumbranceItemBased(0);\n      expect(enc.max).to.equal(9); // Equipped Max is always 9\n    });\n  });\n};\n","/**\n * @file Tests for the data model class that determines character movement speed\n */\nimport { QuenchMethods } from \"../../../../e2e\";\nimport OseDataModelCharacterEncumbrance from \"../data-model-character-encumbrance\";\nimport EncumbranceBasic from \"../data-model-character-encumbrance-basic\";\nimport EncumbranceComplete from \"../data-model-character-encumbrance-complete\";\nimport EncumbranceDetailed from \"../data-model-character-encumbrance-detailed\";\nimport OseDataModelCharacterMove from \"../data-model-character-move\";\n\nexport const key = \"ose.actor.datamodel.character.move\";\nexport const options = {\n  displayName: \"OSE: Actor: Data Model: Character Movement\",\n};\n\nconst createMockItem = (\n  type: string,\n  weight: number,\n  quantity: number,\n  itemOptions = {}\n): Item =>\n  // eslint-disable-next-line new-cap\n  new Item.implementation({\n    name: `Mock ${type} ${foundry.utils.randomID()}`,\n    type,\n    system: { ...itemOptions, weight, quantity: { value: quantity } },\n  }) as Item;\n\nexport default ({ describe, it, expect }: QuenchMethods) => {\n  describe(\"Prevent autocalculation when...\", () => {\n    it(\"Autocalculation is off\", () => {\n      const enc = new EncumbranceBasic();\n      const move = new OseDataModelCharacterMove(enc, false);\n      expect(move.base).to.equal(OseDataModelCharacterMove.baseMoveRate);\n    });\n    it(\"Encumbrance is disabled\", () => {\n      const enc = new OseDataModelCharacterEncumbrance(\"disabled\");\n      const move = new OseDataModelCharacterMove(enc);\n      expect(move.base).to.equal(OseDataModelCharacterMove.baseMoveRate);\n    });\n    it(\"Encumbrance is not provided\", () => {\n      const move = new OseDataModelCharacterMove();\n      expect(move.base).to.equal(OseDataModelCharacterMove.baseMoveRate);\n    });\n  });\n\n  describe(\"Correctly calculates from Basic Encumbrance\", () => {\n    it(\"While unarmored\", () => {\n      let enc = new EncumbranceBasic();\n      let move = new OseDataModelCharacterMove(enc);\n      expect(move.base).to.equal(OseDataModelCharacterMove.baseMoveRate);\n\n      enc = new EncumbranceBasic(undefined, [\n        createMockItem(\"armor\", 100, 1, { type: \"unarmored\", equipped: true }),\n        createMockItem(\"armor\", 100, 1, { type: \"light\", equipped: false }),\n        createMockItem(\"armor\", 100, 1, { type: \"heavy\", equipped: false }),\n      ]);\n      move = new OseDataModelCharacterMove(enc);\n      expect(move.base).to.equal(OseDataModelCharacterMove.baseMoveRate);\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      expect(move.encounter).to.equal(\n        OseDataModelCharacterMove.baseMoveRate / 3\n      );\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      expect(move.overland).to.equal(\n        OseDataModelCharacterMove.baseMoveRate / 5\n      );\n    });\n    it(\"While lightly armored\", () => {\n      const enc = new EncumbranceBasic(undefined, [\n        createMockItem(\"armor\", 100, 1, { type: \"unarmored\", equipped: false }),\n        createMockItem(\"armor\", 100, 1, { type: \"light\", equipped: true }),\n        createMockItem(\"armor\", 100, 1, { type: \"heavy\", equipped: false }),\n      ]);\n      const move = new OseDataModelCharacterMove(enc);\n      expect(move.base).to.equal(OseDataModelCharacterMove.baseMoveRate * 0.75);\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      expect(move.encounter).to.equal(\n        (OseDataModelCharacterMove.baseMoveRate * 0.75) / 3\n      );\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      expect(move.overland).to.equal(\n        (OseDataModelCharacterMove.baseMoveRate * 0.75) / 5\n      );\n    });\n    it(\"While heavily armored\", () => {\n      const enc = new EncumbranceBasic(undefined, [\n        createMockItem(\"armor\", 100, 1, { type: \"unarmored\", equipped: false }),\n        createMockItem(\"armor\", 100, 1, { type: \"light\", equipped: false }),\n        createMockItem(\"armor\", 100, 1, { type: \"heavy\", equipped: true }),\n      ]);\n      const move = new OseDataModelCharacterMove(enc);\n      expect(move.base).to.equal(OseDataModelCharacterMove.baseMoveRate * 0.5);\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      expect(move.encounter).to.equal(\n        (OseDataModelCharacterMove.baseMoveRate * 0.5) / 3\n      );\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      expect(move.overland).to.equal(\n        (OseDataModelCharacterMove.baseMoveRate * 0.5) / 5\n      );\n    });\n    it(\"While carrying a significant amount of treasure\", () => {\n      let enc = new EncumbranceBasic(undefined, [\n        createMockItem(\"item\", EncumbranceBasic.significantTreasure - 1, 1, {\n          treasure: true,\n        }),\n      ]);\n      let move = new OseDataModelCharacterMove(enc);\n      expect(move.base).to.equal(OseDataModelCharacterMove.baseMoveRate);\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      expect(move.encounter).to.equal(\n        OseDataModelCharacterMove.baseMoveRate / 3\n      );\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      expect(move.overland).to.equal(\n        OseDataModelCharacterMove.baseMoveRate / 5\n      );\n\n      enc = new EncumbranceBasic(undefined, [\n        createMockItem(\"item\", EncumbranceBasic.significantTreasure, 1, {\n          treasure: true,\n        }),\n      ]);\n      move = new OseDataModelCharacterMove(enc);\n      expect(move.base).to.equal(OseDataModelCharacterMove.baseMoveRate - 30);\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      expect(move.encounter).to.equal(\n        (OseDataModelCharacterMove.baseMoveRate - 30) / 3\n      );\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      expect(move.overland).to.equal(\n        (OseDataModelCharacterMove.baseMoveRate - 30) / 5\n      );\n    });\n  });\n  describe(\"Correctly calculates from Detailed Encumbrance\", () => {\n    it(\"At unencumbered\", () => {\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate;\n      const expectedEncounter = expectedBase / 3;\n      const expectedOverland = expectedBase / 5;\n\n      let enc = new EncumbranceDetailed();\n      let move = new OseDataModelCharacterMove(enc);\n\n      expect(move.base).to.equal(expectedBase);\n      expect(move.encounter).to.equal(expectedEncounter);\n      expect(move.overland).to.equal(expectedOverland);\n\n      enc = new EncumbranceDetailed(undefined, [\n        createMockItem(\"item\", 800, 1),\n      ]);\n      move = new OseDataModelCharacterMove(enc);\n\n      expect(move.base).to.equal(expectedBase);\n      expect(move.encounter).to.equal(expectedEncounter);\n      expect(move.overland).to.equal(expectedOverland);\n    })\n    it('At 12.5% encumbered (100% moverate)', () => {\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate;\n      const expectedEncounter = expectedBase / 3;\n      const expectedOverland = expectedBase / 5;\n\n      const enc = new EncumbranceDetailed(undefined, [\n        createMockItem(\n          \"item\",\n          OseDataModelCharacterEncumbrance.baseEncumbranceCap * 0.125,\n          1,\n          { treasure: true }\n        ),\n      ]);\n      const move = new OseDataModelCharacterMove(enc);\n\n      expect(move.base).to.equal(expectedBase);\n      expect(move.encounter).to.equal(expectedEncounter)\n      expect(move.overland).to.equal(expectedOverland)\n    })\n    it('At 25% encumbered (100% moverate)', () => {\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate;\n      const expectedEncounter = expectedBase / 3;\n      const expectedOverland = expectedBase / 5;\n\n      const enc = new EncumbranceDetailed(undefined, [\n        createMockItem(\n          \"item\",\n          OseDataModelCharacterEncumbrance.baseEncumbranceCap * 0.25,\n          1,\n          { treasure: true }\n        ),\n      ]);\n      const move = new OseDataModelCharacterMove(enc);\n\n      expect(move.base).to.equal(expectedBase);\n      expect(move.encounter).to.equal(expectedEncounter)\n      expect(move.overland).to.equal(expectedOverland)\n    })\n    it('At 25.1% encumbered (75% moverate)', () => {\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .75;\n      const expectedEncounter = expectedBase / 3;\n      const expectedOverland = expectedBase / 5;\n      \n      let enc = new EncumbranceDetailed(undefined, [\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .251, 1, {treasure: true}),\n      ]);\n      let move = new OseDataModelCharacterMove(enc);\n\n      expect(move.base).to.equal(expectedBase);\n      expect(move.encounter).to.equal(expectedEncounter)\n      expect(move.overland).to.equal(expectedOverland)\n    })\n    it('At 37.5% encumbered (75% moverate)', () => {\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .75;\n      const expectedEncounter = expectedBase / 3;\n      const expectedOverland = expectedBase / 5;\n      \n      let enc = new EncumbranceDetailed(undefined, [\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .375, 1, {treasure: true}),\n      ]);\n      let move = new OseDataModelCharacterMove(enc);\n\n      expect(move.base).to.equal(expectedBase);\n      expect(move.encounter).to.equal(expectedEncounter)\n      expect(move.overland).to.equal(expectedOverland)\n    })\n    it('At 37.51% encumbered (50% moverate)', () => {\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .50;\n      const expectedEncounter = expectedBase / 3;\n      const expectedOverland = expectedBase / 5;\n      \n      let enc = new EncumbranceDetailed(undefined, [\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .3751, 1, {treasure: true}),\n      ]);\n      let move = new OseDataModelCharacterMove(enc);\n\n      expect(move.base).to.equal(expectedBase);\n      expect(move.encounter).to.equal(expectedEncounter)\n      expect(move.overland).to.equal(expectedOverland)\n    })\n    it('At 50% encumbered (50% moverate)', () => {\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .50;\n      const expectedEncounter = expectedBase / 3;\n      const expectedOverland = expectedBase / 5;\n      \n      let enc = new EncumbranceDetailed(undefined, [\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .5, 1, {treasure: true}),\n      ]);\n      let move = new OseDataModelCharacterMove(enc);\n\n      expect(move.base).to.equal(expectedBase);\n      expect(move.encounter).to.equal(expectedEncounter)\n      expect(move.overland).to.equal(expectedOverland)\n    })\n    it('At 50.1% encumbered (25% moverate)', () => {\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .25;\n      const expectedEncounter = expectedBase / 3;\n      const expectedOverland = expectedBase / 5;\n      \n      let enc = new EncumbranceDetailed(undefined, [\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .501, 1, {treasure: true}),\n      ]);\n      let move = new OseDataModelCharacterMove(enc);\n\n      expect(move.base).to.equal(expectedBase);\n      expect(move.encounter).to.equal(expectedEncounter)\n      expect(move.overland).to.equal(expectedOverland)\n    })\n    it('At 100% encumbered (25% moverate)', () => {\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .25;\n      const expectedEncounter = expectedBase / 3;\n      const expectedOverland = expectedBase / 5;\n      \n      let enc = new EncumbranceDetailed(undefined, [\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap, 1, {treasure: true}),\n      ]);\n      const move = new OseDataModelCharacterMove(enc);\n\n      expect(move.base).to.equal(expectedBase);\n      expect(move.encounter).to.equal(expectedEncounter)\n      expect(move.overland).to.equal(expectedOverland)\n    })\n    it('At 100.1% encumbered (0% moverate)', () => {\n      const expectedBase = 0;\n      const expectedEncounter = 0;\n      const expectedOverland = 0;\n      \n      let enc = new EncumbranceDetailed(undefined, [\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap, 1.001, {treasure: true}),\n      ]);\n      let move = new OseDataModelCharacterMove(enc);\n\n      expect(move.base).to.equal(expectedBase);\n      expect(move.encounter).to.equal(expectedEncounter)\n      expect(move.overland).to.equal(expectedOverland)\n    })\n  })\n  describe('Correctly calculates from Complete Encumbrance', () => {\n    it('At 0% encumbered (100% moverate)', () => {\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate;\n      const expectedEncounter = expectedBase / 3;\n      const expectedOverland = expectedBase / 5;\n\n      const enc = new EncumbranceComplete();\n      const move = new OseDataModelCharacterMove(enc);\n\n      expect(move.base).to.equal(expectedBase);\n      expect(move.encounter).to.equal(expectedEncounter);\n      expect(move.overland).to.equal(expectedOverland);\n    })\n    it('At 12.5% encumbered (100% moverate)', () => {\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate;\n      const expectedEncounter = expectedBase / 3;\n      const expectedOverland = expectedBase / 5;\n      \n      let enc = new EncumbranceComplete(undefined, [\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .125, 1 ),\n      ]);\n      let move = new OseDataModelCharacterMove(enc);\n\n      expect(move.base).to.equal(expectedBase);\n      expect(move.encounter).to.equal(expectedEncounter)\n      expect(move.overland).to.equal(expectedOverland)\n    })\n    it('At 25% encumbered (100% moverate)', () => {\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate;\n      const expectedEncounter = expectedBase / 3;\n      const expectedOverland = expectedBase / 5;\n      \n      let enc = new EncumbranceComplete(undefined, [\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .25, 1 ),\n      ]);\n      let move = new OseDataModelCharacterMove(enc);\n\n      expect(move.base).to.equal(expectedBase);\n      expect(move.encounter).to.equal(expectedEncounter)\n      expect(move.overland).to.equal(expectedOverland)\n    })\n    it('At 25.1% encumbered (75% moverate)', () => {\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .75;\n      const expectedEncounter = expectedBase / 3;\n      const expectedOverland = expectedBase / 5;\n      \n      let enc = new EncumbranceComplete(undefined, [\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .251, 1 ),\n      ]);\n      const move = new OseDataModelCharacterMove(enc);\n\n      expect(move.base).to.equal(expectedBase);\n      expect(move.encounter).to.equal(expectedEncounter)\n      expect(move.overland).to.equal(expectedOverland)\n    })\n    it('At 37.5% encumbered (75% moverate)', () => {\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .75;\n      const expectedEncounter = expectedBase / 3;\n      const expectedOverland = expectedBase / 5;\n      \n      let enc = new EncumbranceComplete(undefined, [\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .375, 1 ),\n      ]);\n      const move = new OseDataModelCharacterMove(enc);\n\n      expect(move.base).to.equal(expectedBase);\n      expect(move.encounter).to.equal(expectedEncounter)\n      expect(move.overland).to.equal(expectedOverland)\n    })\n    it('At 37.51% encumbered (50% moverate)', () => {\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .50;\n      const expectedEncounter = expectedBase / 3;\n      const expectedOverland = expectedBase / 5;\n      \n      let enc = new EncumbranceComplete(undefined, [\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .3751, 1 ),\n      ]);\n      let move = new OseDataModelCharacterMove(enc);\n\n      expect(move.base).to.equal(expectedBase);\n      expect(move.encounter).to.equal(expectedEncounter)\n      expect(move.overland).to.equal(expectedOverland)\n    })\n    it('At 50% encumbered (50% moverate)', () => {\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .50;\n      const expectedEncounter = expectedBase / 3;\n      const expectedOverland = expectedBase / 5;\n      \n      let enc = new EncumbranceComplete(undefined, [\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .5, 1 ),\n      ]);\n      let move = new OseDataModelCharacterMove(enc);\n\n      expect(move.base).to.equal(expectedBase);\n      expect(move.encounter).to.equal(expectedEncounter)\n      expect(move.overland).to.equal(expectedOverland)\n    })\n    it('At 50.1% encumbered (25% moverate)', () => {\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .25;\n      const expectedEncounter = expectedBase / 3;\n      const expectedOverland = expectedBase / 5;\n      \n      let enc = new EncumbranceComplete(undefined, [\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap * .501, 1 ),\n      ]);\n      let move = new OseDataModelCharacterMove(enc);\n\n      expect(move.base).to.equal(expectedBase);\n      expect(move.encounter).to.equal(expectedEncounter)\n      expect(move.overland).to.equal(expectedOverland)\n    })\n    it('At 100% encumbered (25% moverate)', () => {\n      const expectedBase = OseDataModelCharacterMove.baseMoveRate * .25;\n      const expectedEncounter = expectedBase / 3;\n      const expectedOverland = expectedBase / 5;\n      \n      let enc = new EncumbranceComplete(undefined, [\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap, 1 ),\n      ]);\n      let move = new OseDataModelCharacterMove(enc);\n\n      expect(move.base).to.equal(expectedBase);\n      expect(move.encounter).to.equal(expectedEncounter)\n      expect(move.overland).to.equal(expectedOverland)\n    })\n    it('At 100.1% encumbered (0% moverate)', () => {\n      const expectedBase = 0;\n      const expectedEncounter = 0;\n      const expectedOverland = 0;\n      \n      let enc = new EncumbranceComplete(undefined, [\n        createMockItem('item', OseDataModelCharacterEncumbrance.baseEncumbranceCap, 1.001 ),\n      ]);\n      const move = new OseDataModelCharacterMove(enc);\n\n      expect(move.base).to.equal(expectedBase);\n      expect(move.encounter).to.equal(expectedEncounter);\n      expect(move.overland).to.equal(expectedOverland);\n    });\n  });\n};\n","/**\n * @file Tests for the class represening a character's ability scores\n */\nimport { QuenchMethods } from \"../../../../e2e\";\nimport OseDataModelCharacterScores from \"../data-model-character-scores\";\n\nexport const key = \"ose.actor.datamodel.character.scores\";\nexport const options = {\n  displayName: \"OSE: Actor: Data Model: Character Ability Scores\",\n};\n\nexport default ({ describe, it, expect }: QuenchMethods) => {\n  // An array from 0-\n  const scoreSpread = Array.from({ length: 21 }, (_el, idx) => idx);\n  const scoreKeys = [\"str\", \"int\", \"wis\", \"dex\", \"con\", \"cha\"];\n  const tables = [\n    OseDataModelCharacterScores.standardAttributeMods,\n    OseDataModelCharacterScores.cappedAttributeMods,\n    OseDataModelCharacterScores.openDoorMods,\n    OseDataModelCharacterScores.literacyMods,\n    OseDataModelCharacterScores.spokenMods,\n  ];\n  const fromTable = (tableKey: number, score: number) =>\n    OseDataModelCharacterScores.valueFromTable(tables[tableKey], score);\n  const numberToScores = (number: number) =>\n    Object.fromEntries(\n      scoreKeys.map((scoreKey) => [scoreKey, { value: number, bonus: 0 }])\n    );\n\n  const buildTestCases = (\n    score: number,\n    scoreKey: string,\n    mod: string,\n    table: any\n  ) => {\n    const scoresToUse = numberToScores(score);\n    const scoresObj = new OseDataModelCharacterScores(scoresToUse);\n    return it(`${score}`, () => {\n      expect(scoresObj[scoreKey][mod]).to.equal(fromTable(table, score));\n    });\n  };\n  const buildTestCasesWithModifiers = (\n    score: number,\n    scoreKey: string,\n    mod: string,\n    table: any,\n    added: number\n  ) => {\n    const scoresToUse = numberToScores(score);\n    const scoresObj = new OseDataModelCharacterScores(scoresToUse);\n    return it(`${score}`, () => {\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions\n      expect(scoresObj[scoreKey][mod]).to.equal(\n        fromTable(table, score) + added\n      );\n    });\n  };\n\n  const spreadToModTests = (name: string) =>\n    scoreKeys.map((scoreKey) =>\n      describe(`${name}: ${scoreKey}`, () =>\n        scoreSpread.map((score) => buildTestCases(score, scoreKey, \"mod\", 0)))\n    );\n\n  describe(\"Standard attribute modifiers\", () => spreadToModTests(\"Attribute\"));\n\n  describe(\"Strength modifiers\", () => {\n    describe(\"Open Doors\", () =>\n      scoreSpread.map((score) => buildTestCases(score, \"str\", \"od\", 2)));\n  });\n\n  describe(\"Intelligence modifiers\", () => {\n    describe(\"Literacy\", () =>\n      scoreSpread.map((score) => buildTestCases(score, \"int\", \"literacy\", 3)));\n    describe(\"Spoken Languages\", () =>\n      scoreSpread.map((score) => buildTestCases(score, \"int\", \"spoken\", 4)));\n  });\n\n  describe(\"Dexterity modifiers\", () => {\n    describe(\"Initiative\", () =>\n      scoreSpread.map((score) => buildTestCases(score, \"dex\", \"init\", 1)));\n  });\n\n  describe(\"Charisma modifiers\", () => {\n    describe(\"NPC Reaction\", () =>\n      scoreSpread.map((score) => buildTestCases(score, \"cha\", \"npc\", 1)));\n    describe(\"Loyalty\", () =>\n      scoreSpread.map((score) =>\n        buildTestCasesWithModifiers(score, \"cha\", \"retain\", 0, 4)\n      ));\n    describe(\"Number of Retainers\", () =>\n      scoreSpread.map((score) =>\n        buildTestCasesWithModifiers(score, \"cha\", \"loyalty\", 0, 7)\n      ));\n  });\n};\n","/**\n * @file Quench unit tests for the data model class that drives actor spells.\n */\nimport { QuenchMethods } from \"../../../../e2e\";\nimport OseDataModelCharacterSpells from \"../data-model-character-spells\";\n\nexport const key = \"ose.actor.datamodel.character.spells\";\nexport const options = {\n  displayName: \"OSE: Actor: Data Model: Character Spells\",\n};\n\nconst createMockSpell = (lvl: number, spellOptions?: any): Item =>\n  // eslint-disable-next-line new-cap\n  new Item.implementation({\n    name: `Mock Spell ${foundry.utils.randomID()}`,\n    type: \"spell\",\n    system: { ...spellOptions, lvl },\n  }) as Item;\n\nconst createMockSpellList = (spellOptions: any, ...levels: any) =>\n  levels.reduce(\n    (arr: Item[], lvCount: number, idx: number) => [\n      ...arr,\n      ...Array.from({ length: lvCount }, () =>\n        createMockSpell(idx + 1, spellOptions)\n      ),\n    ],\n    []\n  );\n\n// Core goes to 6, but we'll go to 9 just in case\n// someone wants to implement higher-level spells\nconst spellsPerLevel = [1, 2, 3, 4, 5, 6, 7, 8, 9];\n\nexport default ({ describe, it, expect }: QuenchMethods) => {\n  // Test for spells being sorted into buckets by spell level.\n  describe(\"Spell levels\", () => {\n    it(\"Sorts the incoming spell list into an object with spell level keys\", () => {\n      const spells = createMockSpellList({}, ...spellsPerLevel);\n      const spellData = new OseDataModelCharacterSpells({}, spells);\n      spellsPerLevel.forEach((lv) => {\n        expect(spellData.spellList[lv].length).to.equal(lv);\n      });\n    });\n  });\n  // Test for available/max slots\n  describe(\"Spell slots\", () => {\n    describe(\"Shows committed and max spell slots per level\", () => {\n      it(\"with no spells prepared\", () => {\n        const spells = [createMockSpell(1)];\n        const spellData = new OseDataModelCharacterSpells(\n          { 1: { max: 1 } },\n          spells as Item[]\n        );\n        expect(spellData.slots[1].used).to.equal(0);\n        expect(spellData.slots[1].max).to.equal(1);\n      });\n\n      it(\"with spells prepared, not cast\", () => {\n        const spells = [createMockSpell(1, { memorized: 1, cast: 1 })];\n        const spellData = new OseDataModelCharacterSpells(\n          { 1: { max: 1 } },\n          spells as Item[]\n        );\n        expect(spellData.slots[1].used).to.equal(1);\n        expect(spellData.slots[1].max).to.equal(1);\n      });\n\n      it(\"with spells prepared and cast\", () => {\n        const spells = [createMockSpell(1, { memorized: 1, cast: 0 })];\n        const spellData = new OseDataModelCharacterSpells(\n          { 1: { max: 1 } },\n          spells as Item[]\n        );\n        expect(spellData.slots[1].used).to.equal(0);\n        expect(spellData.slots[1].max).to.equal(1);\n      });\n    });\n  });\n  // Sanity check: can we cast spells?\n  describe(\"Checking for spellcasting\", () => {\n    it(\"Can cast spells when spellcasting is enabled\", () => {\n      const spellData = new OseDataModelCharacterSpells({ enabled: true }, []);\n      expect(spellData.enabled).to.be.true;\n    });\n    it(\"Cannot cast spells when spellcasting is disabled\", () => {\n      const spellData = new OseDataModelCharacterSpells({ enabled: false }, []);\n      expect(spellData.enabled).to.be.false;\n    });\n    it(\"Can toggle between being able and unable to cast spells\", () => {\n      const spellData = new OseDataModelCharacterSpells({ enabled: true }, []);\n      expect(spellData.enabled).to.be.true;\n      spellData.enabled = false;\n      expect(spellData.enabled).to.be.false;\n    });\n  });\n};\n","/**\n * @file Contains tests for Monster Data Model.\n */\n// eslint-disable-next-line import/no-cycle\nimport { QuenchMethods } from \"../../../e2e\";\nimport {\n  cleanUpActorsByKey,\n  createMockActorKey,\n  getMockActorKey,\n} from \"../../../e2e/testUtils\";\nimport OseDataModelMonster from \"../data-model-monster\";\n\nexport const key = \"ose.actor.datamodel.monster\";\nexport const options = { displayName: \"OSE: Actor: Data Model: Monster\" };\n\nconst createMockActor = () => createMockActorKey(\"monster\", {}, key);\n\nexport default ({\n  describe,\n  it,\n  expect,\n  after,\n  afterEach,\n  before,\n}: QuenchMethods) => {\n  const dataModel = new OseDataModelMonster();\n  const ascendingACSetting = game.settings.get(game.system.id, \"ascendingAC\");\n  const initiativeSetting = game.settings.get(game.system.id, \"initiative\");\n\n  after(() => {\n    game.settings.set(game.system.id, \"ascendingAC\", ascendingACSetting);\n    game.settings.set(game.system.id, \"initiative\", initiativeSetting);\n    cleanUpActorsByKey(key);\n  });\n\n  // @todo: Can this be tested without creating an actor?\n  describe(\"prepareDerivedData()\", () => {\n    afterEach(() => {\n      cleanUpActorsByKey(key);\n    });\n\n    it(\"doesnt have scores\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.system.scores).is.undefined;\n    });\n\n    it(\"has encumbrance\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.system.encumbrance).not.undefined;\n      expect(actor?.system.encumbrance.variant).not.undefined;\n      expect(actor?.system.encumbrance.enabled).not.undefined;\n      expect(actor?.system.encumbrance.pct).not.undefined;\n      expect(actor?.system.encumbrance.encumbered).not.undefined;\n      expect(actor?.system.encumbrance.steps).not.undefined;\n      expect(actor?.system.encumbrance.value).not.undefined;\n      expect(actor?.system.encumbrance.max).not.undefined;\n      expect(actor?.system.encumbrance.atFirstBreakpoint).not.undefined;\n      expect(actor?.system.encumbrance.atSecondBreakpoint).not.undefined;\n      expect(actor?.system.encumbrance.atThirdBreakpoint).not.undefined;\n    });\n\n    it(\"have movement\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.system.movement).not.undefined;\n      expect(actor?.system.movement.base).not.undefined;\n    });\n\n    it(\"have ac\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.system.ac).not.undefined;\n      expect(actor?.system.ac.value).not.undefined;\n      expect(actor?.system.ac.mod).not.undefined;\n    });\n\n    it(\"have aac\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.system.aac).not.undefined;\n      expect(actor?.system.aac.value).not.undefined;\n      expect(actor?.system.aac.mod).not.undefined;\n    });\n\n    describe(\"has spells\", () => {\n      // @todo: Should we keep using numbers and keys for spell levels?\n      const spellLevels = new Set([\"1\", \"2\", \"3\", \"4\", \"5\", \"6\"]);\n\n      it(\"has spells\", async () => {\n        const actor = await createMockActor();\n        expect(actor?.system.spells).not.undefined;\n        expect(actor?.system.spells.enabled).not.undefined;\n        expect(actor?.system.spells.spellList).not.undefined;\n        expect(actor?.system.spells.slots).not.undefined;\n      });\n\n      spellLevels.forEach((lvl) => {\n        it(`has spell level ${lvl}`, async () => {\n          const actor = await createMockActor();\n          expect(actor?.system.spells.slots[lvl]).not.undefined;\n          expect(Object.keys(actor?.system.spells.slots[lvl])).contain(\"used\");\n          expect(Object.keys(actor?.system.spells.slots[lvl])).contain(\"max\");\n        });\n      });\n    });\n  });\n\n  describe(\"defineSchema()\", () => {\n    before(async () => {\n      await createMockActor();\n    });\n\n    const flatFields = [\"config\", \"initiative\", \"thac0\", \"languages\"];\n    flatFields.forEach((field) => {\n      it(`has ${field}`, async () => {\n        const actor = await getMockActorKey(key);\n        expect(actor?.system[field]).not.undefined;\n      });\n    });\n\n    const recursiveFields = [\n      { field: \"hp\", subFields: [\"hd\", \"value\", \"max\"] },\n      { field: \"retainer\", subFields: [\"enabled\", \"loyalty\", \"wage\"] },\n    ];\n    recursiveFields.forEach(({ field, subFields }) => {\n      subFields.forEach((subField) => {\n        it(`${field} field has ${subField} subfield`, async () => {\n          const actor = await getMockActorKey(key);\n          expect(actor?.system[field]).not.undefined;\n          expect(actor?.system[field][subField]).not.undefined;\n        });\n      });\n    });\n\n    const doubleRecursiveFields = [\n      {\n        field: \"saves\",\n        subFields: [\n          { subField: \"breath\", subSubField: [\"value\"] },\n          { subField: \"death\", subSubField: [\"value\"] },\n          { subField: \"paralysis\", subSubField: [\"value\"] },\n          { subField: \"spell\", subSubField: [\"value\"] },\n          { subField: \"wand\", subSubField: [\"value\"] },\n        ],\n      },\n    ];\n    doubleRecursiveFields.forEach(({ field, subFields }) => {\n      subFields.forEach(({ subField, subSubField }) => {\n        it(`${field} field has ${subField} subfield, which has ${subSubField} field`, async () => {\n          const actor = await getMockActorKey(key);\n          expect(actor?.system[field]).not.undefined;\n          expect(actor?.system[field][subField]).not.undefined;\n          expect(actor?.system[field][subField][subSubField]).not.undefined;\n        });\n      });\n    });\n\n    after(() => {\n      cleanUpActorsByKey(key);\n    });\n  });\n\n  describe(\"isNew()\", () => {\n    it(\"New when all saves are at 0\", async () => {\n      const testActor = await createMockActorKey(\n        \"monster\",\n        {\n          system: {\n            saves: {\n              breath: { value: 0 },\n              death: { value: 0 },\n              paralysis: { value: 0 },\n              spell: { value: 0 },\n              wand: { value: 0 },\n            },\n          },\n        },\n        key\n      );\n      expect(testActor?.system.isNew).to.be.true;\n    });\n\n    it(\"Not new when any save is above 0\", async () => {\n      const testActor = await createMockActorKey(\n        \"monster\",\n        {\n          system: {\n            saves: {\n              breath: { value: 10 },\n              death: { value: 0 },\n              paralysis: { value: 0 },\n              spell: { value: 0 },\n              wand: { value: 0 },\n            },\n          },\n        },\n        key\n      );\n      expect(testActor?.system.isNew).to.be.false;\n    });\n  });\n\n  describe(\"containers()\", () => {\n    it(\"returns all containers\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.items.contents.length).equal(0);\n      expect(actor?.system.containers.length).equal(0);\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        { type: \"container\", name: \"test container\" },\n      ]);\n      expect(actor?.items.contents.length).equal(1);\n      const container = actor?.items.getName(\"test container\");\n      expect(container).to.not.be.undefined;\n      expect(container?.name).equal(\"test container\");\n      expect(actor?.items.contents[0].name).equal(\"test container\");\n      // eslint-disable-next-line no-underscore-dangle\n      expect(actor?.system.containers[0]._id).equal(container.id);\n      actor?.delete();\n    });\n\n    after(() => {\n      cleanUpActorsByKey(key);\n    });\n  });\n\n  describe(\"treasures()\", () => {\n    it(\"returns treasures on actor\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.items.contents.length).equal(0);\n      expect(actor?.system.treasures.length).equal(0);\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        { type: \"item\", name: \"test treasure\", system: { treasure: true } },\n      ]);\n      expect(actor?.items.contents.length).equal(1);\n      const testTreasure = actor?.items.getName(\"test treasure\");\n      expect(testTreasure).to.not.be.undefined;\n      expect(testTreasure?.name).equal(\"test treasure\");\n      expect(testTreasure?.system.treasure).is.true;\n      expect(actor?.system.treasures.length).equal(1);\n      // eslint-disable-next-line no-underscore-dangle\n      expect(actor?.system.treasures[0]._id).equal(testTreasure.id);\n      actor?.delete();\n    });\n\n    it(\"doesn't return treasures on actor if in container\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.items.contents.length).equal(0);\n      expect(actor?.system.treasures.length).equal(0);\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        { type: \"container\", name: \"test container\" },\n      ]);\n      const container = actor?.items.getName(\"test container\");\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        {\n          type: \"item\",\n          name: \"test treasure\",\n          system: { treasure: true, containerId: container?.id },\n        },\n      ]);\n      expect(actor?.items.contents.length).equal(2);\n      const testContainer = actor?.items.getName(\"test container\");\n      const testTreasure = actor?.items.getName(\"test treasure\");\n      expect(testContainer).to.not.be.undefined;\n      expect(testContainer?.name).equal(\"test container\");\n      expect(testTreasure).to.not.be.undefined;\n      expect(testTreasure?.name).equal(\"test treasure\");\n      expect(testTreasure?.system.treasure).is.true;\n      expect(testTreasure?.system.containerId).equal(container?.id);\n      expect(actor?.system.treasures.length).equal(0);\n      actor?.delete();\n    });\n\n    after(() => {\n      cleanUpActorsByKey(key);\n    });\n  });\n\n  describe(\"items()\", () => {\n    it(\"only returns items other than treasure\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.items.contents.length).equal(0);\n      expect(actor?.system.items.length).equal(0);\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        {\n          type: \"item\",\n          name: \"test item\",\n        },\n        {\n          type: \"item\",\n          name: \"test treasure\",\n          system: { treasure: true, quantity: { value: 3 }, cost: 4 },\n        },\n      ]);\n      expect(actor?.items.contents.length).equal(2);\n      const testItem = actor?.items.getName(\"test item\");\n      const testTreasure = actor?.items.getName(\"test treasure\");\n      expect(testItem).to.not.be.undefined;\n      expect(testItem?.name).equal(\"test item\");\n      expect(testItem?.system.treasure).is.false;\n      expect(testTreasure).to.not.be.undefined;\n      expect(testTreasure?.name).equal(\"test treasure\");\n      expect(testTreasure?.system.treasure).is.true;\n      expect(actor?.system.items.length).equal(1);\n      expect(actor?.system.items[0].name).equal(\"test item\");\n      actor?.delete();\n    });\n\n    it(\"only returns other items than stored in containers\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.items.contents.length).equal(0);\n      expect(actor?.system.items.length).equal(0);\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        {\n          type: \"container\",\n          name: \"test container\",\n        },\n      ]);\n      const container = actor?.items.getName(\"test container\");\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        // eslint-disable-next-line no-underscore-dangle\n        {\n          type: \"item\",\n          name: \"test item in container\",\n          system: { containerId: container?.id },\n        },\n        {\n          type: \"item\",\n          name: \"test item\",\n        },\n      ]);\n      expect(actor?.items.contents.length).equal(3);\n      const testContainer = actor?.items.getName(\"test container\");\n      const testItemInContainer = actor?.items.getName(\"test item in container\");\n      const testItem = actor?.items.getName(\"test item\");\n      expect(testContainer).to.not.be.undefined;\n      expect(testContainer?.name).equal(\"test container\");\n      expect(testItemInContainer).to.not.be.undefined;\n      expect(testItemInContainer?.name).equal(\"test item in container\");\n      expect(testItem).to.not.be.undefined;\n      expect(testItem?.name).equal(\"test item\");\n      expect(actor?.system.items.length).equal(1);\n      expect(actor?.system.items[0].name).equal(\"test item\");\n      actor?.delete();\n    });\n  });\n\n  const testTypes = [\n    { type: \"weapon\", getter: \"weapons\" },\n    { type: \"ability\", getter: \"abilities\" },\n    { type: \"armor\", getter: \"armor\" },\n    // @todo: { type: \"spell\", getter: \"#spellList\" },\n  ];\n  testTypes.forEach(({ type, getter }) => {\n    describe(`${getter}()`, () => {\n      it(`returns all ${getter}`, async () => {\n        const actor = await createMockActor();\n        expect(actor?.items.contents.length).equal(0);\n        expect(actor?.system[getter].length).equal(0);\n        await actor?.createEmbeddedDocuments(\"Item\", [\n          { type, name: `test ${type}` },\n        ]);\n        expect(actor?.items.contents.length).equal(1);\n        const item = actor?.items.getName(`test ${type}`);\n        expect(item).to.not.be.undefined;\n        expect(item?.name).equal(`test ${type}`);\n        expect(actor?.system[getter].length).equal(1);\n        // eslint-disable-next-line no-underscore-dangle\n        expect(actor?.system[getter][0]._id).equal(item.id);\n        actor?.delete();\n      });\n\n      it(`returns all ${getter} except ones in container`, async () => {\n        if (getter === \"abilities\") return;\n        const actor = await createMockActor();\n        expect(actor?.items.contents.length).equal(0);\n        expect(actor?.system[getter].length).equal(0);\n        await actor?.createEmbeddedDocuments(\"Item\", [\n          {\n            type: \"container\",\n            name: \"test container\",\n          },\n        ]);\n        const container = actor?.items.getName(\"test container\");\n        await actor?.createEmbeddedDocuments(\"Item\", [\n          // eslint-disable-next-line no-underscore-dangle\n          {\n            type,\n            name: `test ${type} in container`,\n            system: { containerId: container?.id },\n          },\n          {\n            type,\n            name: `test ${type}`,\n          },\n        ]);\n        expect(actor?.items.contents.length).equal(3);\n        const testContainer = actor?.items.getName(\"test container\");\n        const testItemInContainer = actor?.items.getName(\n          `test ${type} in container`\n        );\n        const testItem = actor?.items.getName(`test ${type}`);\n        expect(testContainer).to.not.be.undefined;\n        expect(testContainer?.name).equal(\"test container\");\n        expect(testItemInContainer).to.not.be.undefined;\n        expect(testItemInContainer?.name).equal(`test ${type} in container`);\n        expect(testItem).to.not.be.undefined;\n        expect(testItem?.name).equal(`test ${type}`);\n        expect(actor?.system[getter].length).equal(1);\n        // eslint-disable-next-line no-underscore-dangle\n        expect(actor?.system[getter][0]._id).equal(testItem.id);\n        actor?.delete();\n      });\n    });\n\n    after(() => {\n      cleanUpActorsByKey(key);\n    });\n  });\n\n  describe(\"attackPatterns()\", () => {\n    it(\"returns all weapons and abilities in transparent when no pattern set\", async () => {\n      const actor = await createMockActor();\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        // eslint-disable-next-line no-underscore-dangle\n        {\n          type: \"ability\",\n          name: \"test ability\",\n        },\n        {\n          type: \"weapon\",\n          name: \"test weapon\",\n        },\n      ]);\n      expect(Object.keys(actor?.system.attackPatterns).length).equal(1);\n      expect(Object.keys(actor?.system.attackPatterns)).contain(\"transparent\");\n      expect(actor?.system.attackPatterns.transparent.length).equal(2);\n      expect(actor?.system.attackPatterns.transparent[0].name).equal(\n        \"test weapon\"\n      );\n      expect(actor?.system.attackPatterns.transparent[1].name).equal(\n        \"test ability\"\n      );\n    });\n\n    it(\"returns separated weapons and abilities whith patterns patterns\", async () => {\n      const actor = await createMockActor();\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        // eslint-disable-next-line no-underscore-dangle\n        {\n          type: \"ability\",\n          name: \"test ability green\",\n          system: { pattern: \"green\" },\n        },\n        {\n          type: \"weapon\",\n          name: \"test weapon green\",\n          system: { pattern: \"green\" },\n        },\n        {\n          type: \"ability\",\n          name: \"test ability\",\n        },\n        {\n          type: \"weapon\",\n          name: \"test weapon\",\n        },\n      ]);\n      expect(Object.keys(actor?.system.attackPatterns).length).equal(2);\n      expect(Object.keys(actor?.system.attackPatterns)).contain(\"transparent\");\n      expect(Object.keys(actor?.system.attackPatterns)).contain(\"green\");\n      expect(actor?.system.attackPatterns.transparent.length).equal(2);\n      expect(actor?.system.attackPatterns.transparent[0].name).equal(\n        \"test ability\"\n      );\n      expect(actor?.system.attackPatterns.transparent[1].name).equal(\n        \"test weapon\"\n      );\n      expect(actor?.system.attackPatterns.green.length).equal(2);\n      expect(actor?.system.attackPatterns.green[0].name).equal(\n        \"test weapon green\"\n      );\n      expect(actor?.system.attackPatterns.green[1].name).equal(\n        \"test ability green\"\n      );\n    });\n  });\n\n  describe(\"isSlow()\", () => {\n    it(\"returns false if no weapons\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.system.isSlow).is.false;\n      actor?.delete();\n    });\n\n    it(\"returns false if weapon that doesn't have slow tag\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.items.contents.length).equal(0);\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        {\n          type: \"weapon\",\n          name: \"test weapon\",\n          system: { slow: false },\n        },\n      ]);\n      expect(actor?.items.contents.length).equal(1);\n      expect(actor?.items.contents[0].name).equal(\"test weapon\");\n      expect(actor?.system.isSlow).is.false;\n      actor?.delete();\n    });\n\n    it(\"returns true if weapon that has slow tag\", async () => {\n      const actor = await createMockActor();\n      expect(actor?.items.contents.length).equal(0);\n      await actor?.createEmbeddedDocuments(\"Item\", [\n        {\n          type: \"weapon\",\n          name: \"test weapon\",\n          system: { slow: true },\n        },\n      ]);\n      expect(actor?.items.contents.length).equal(1);\n      expect(actor?.items.contents[0].name).equal(\"test weapon\");\n      expect(actor?.system.isSlow).is.true;\n      actor?.delete();\n    });\n\n    after(() => {\n      cleanUpActorsByKey(key);\n    });\n  });\n\n  describe(\"init()\", () => {\n    before(async () => {\n      await game.settings.set(game.system.id, \"initiative\", \"individual\");\n    });\n\n    it(\"returns 0 by default\", () => {\n      expect(dataModel.initiative.value).equal(0);\n      expect(dataModel.initiative.mod).equal(0);\n      expect(dataModel.init).equal(0);\n    });\n\n    it(\"returns correctly with initiative value set\", async () => {\n      dataModel.initiative.value = 12;\n      expect(dataModel.init).equal(12);\n      dataModel.initiative.value = 0;\n      expect(dataModel.init).equal(0);\n      expect(dataModel.initiative.value).equal(0);\n    });\n\n    it(\"returns correctly with initiative mod set\", async () => {\n      dataModel.initiative.mod = 10;\n      expect(dataModel.init).equal(10);\n      dataModel.initiative.mod = 0;\n      expect(dataModel.init).equal(0);\n      expect(dataModel.initiative.mod).equal(0);\n    });\n\n    it(\"returns correctly with initiative value and mod set\", async () => {\n      dataModel.initiative.value = 12;\n      dataModel.initiative.mod = 3;\n      expect(dataModel.init).equal(15);\n      dataModel.initiative.value = 0;\n      dataModel.initiative.mod = 0;\n      expect(dataModel.init).equal(0);\n      expect(dataModel.initiative.value).equal(0);\n      expect(dataModel.initiative.mod).equal(0);\n    });\n  });\n};\n","// eslint-disable-next-line eslint-comments/disable-enable-pair\n\n/* eslint-disable simple-import-sort/imports */\n\n/**\n * @file Contains tests for Actor Entity.\n */\n// eslint-disable-next-line import/no-cycle\nimport OseItem from \"../../item/entity\";\n\nimport * as e2e from \"../../../e2e\";\nimport {\n  cleanUpActorsByKey,\n  cleanUpCompendium,\n  cleanUpScenes,\n  cleanUpWorldItems,\n  createMockActorKey,\n  createMockCompendium,\n  createMockScene,\n  createWorldTestItem,\n  delay,\n  itemTypes,\n  rollSpecificNumber,\n  trashChat,\n  waitForInput,\n} from \"../../../e2e/testUtils\";\nimport OseActor from \"../entity\";\n\nexport const key = \"ose.actor.entity\";\nexport const options = {\n  displayName: \"OSE: Actor: Entity\",\n  preSelected: true,\n};\n\nconst createMockActor = async (type: string) =>\n  OseActor.create({\n    name: `Test Actor ${key}`,\n    type,\n  });\n\nexport default ({\n  describe,\n  it,\n  expect,\n  after,\n  afterEach,\n  before,\n  assert,\n}: e2e.QuenchMethods) => {\n  afterEach(async () => {\n    await trashChat();\n    cleanUpActorsByKey(key);\n    cleanUpWorldItems();\n  });\n\n  describe(\"update(data, options)\", () => {\n    // Armor class values cannot be modified directly as they are derived from\n    // armor, shield, and modifier values.\n    it(\"AAC to AC\", async () => {\n      const actor = await createMockActor(\"character\");\n      expect(actor?.system.ac.value).equal(12);\n      expect(actor?.system.aac.value).equal(7);\n      await actor?.update({ \"system.ac.mod\": 1 });\n      expect(actor?.system.ac.value).equal(11);\n      expect(actor?.system.aac.value).equal(19 - 11);\n      await actor?.update({ \"system.ac.mod\": 2 });\n      expect(actor?.system.ac.value).equal(10);\n      expect(actor?.system.aac.value).equal(19 - 10);\n      await actor?.update({ \"system.ac.mod\": -1 });\n      expect(actor?.system.ac.value).equal(13);\n      expect(actor?.system.aac.value).equal(19 - 13);\n    });\n\n    it(\"AC to AAC\", async () => {\n      const actor = await createMockActor(\"character\");\n      expect(actor?.system.ac.value).equal(12);\n      expect(actor?.system.aac.value).equal(7);\n      await actor?.update({ \"system.aac.mod\": 1 });\n      expect(actor?.system.aac.value).equal(8);\n      expect(actor?.system.ac.value).equal(19 - 8);\n      await actor?.update({ \"system.aac.mod\": 2 });\n      expect(actor?.system.aac.value).equal(9);\n      expect(actor?.system.ac.value).equal(19 - 9);\n      await actor?.update({ \"system.aac.mod\": -1 });\n      expect(actor?.system.aac.value).equal(6);\n      expect(actor?.system.ac.value).equal(19 - 6);\n    });\n\n    it(\"THAC0 to BBA\", async () => {\n      const actor = await createMockActor(\"character\");\n      expect(actor?.system.thac0.value).equal(19);\n      expect(actor?.system.thac0.bba).equal(0);\n      await actor?.update({ \"system.thac0.value\": 15 });\n      expect(actor?.system.thac0.value).equal(15);\n      expect(actor?.system.thac0.bba).equal(19 - 15);\n    });\n\n    it(\"BBA to THAC0\", async () => {\n      const actor = await createMockActor(\"character\");\n      expect(actor?.system.thac0.value).equal(19);\n      expect(actor?.system.thac0.bba).equal(0);\n      await actor?.update({ \"system.thac0.bba\": 15 });\n      expect(actor?.system.thac0.bba).equal(15);\n      expect(actor?.system.thac0.value).equal(19 - 15);\n    });\n  });\n\n  describe(\"createEmbeddedDocuments(embeddedName, data, context)\", () => {\n    after(async () => {\n      game.items\n        ?.filter((i) => i?.name?.indexOf(`Test ${key}`) >= 0)\n        .forEach((i) => i.delete());\n    });\n    itemTypes.forEach((itemType) => {\n      it(`Creates ${itemType.capitalize()} with correct default icon`, async () => {\n        const actor = await createMockActor(\"character\");\n        const item = (await OseItem.create({\n          name: `Test ${key} ${itemType.capitalize()}`,\n          type: itemType,\n        })) as OseItem;\n        await actor?.createEmbeddedDocuments(\"Item\", [item]);\n        const actorItem = actor?.items.getName(item?.name);\n        expect(actorItem?.img).equal(OseItem.defaultIcons[itemType]);\n        item?.delete();\n      });\n    });\n  });\n\n  describe(\"getExperience(value, options)\", () => {\n    afterEach(async () => {\n      await trashChat();\n    });\n\n    it(\"Adding positive XP adds to experience\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      expect(actor?.system.details.xp.value).equal(0);\n      expect(game.messages?.size).equal(0);\n      await actor?.getExperience(10);\n      expect(actor?.system.details.xp.value).equal(10);\n      await waitForInput();\n      expect(game.messages?.size).equal(1);\n      await actor?.delete();\n    });\n\n    it(\"Adding negative XP subtracts from experience\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      expect(actor?.system.details.xp.value).equal(0);\n      expect(game.messages?.size).equal(0);\n      await actor?.getExperience(-10);\n      expect(actor?.system.details.xp.value).equal(-10);\n      await waitForInput();\n      expect(game.messages?.size).equal(1);\n      await actor?.delete();\n    });\n\n    it(\"Adding positive XP adds to experience modified by bonus\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      await actor?.update({ system: { details: { xp: { bonus: 10 } } } });\n      expect(actor?.system.details.xp.value).equal(0);\n      expect(game.messages?.size).equal(0);\n      await actor?.getExperience(10);\n      expect(actor?.system.details.xp.value).equal(11);\n      await waitForInput();\n      expect(game.messages?.size).equal(1);\n      await actor?.delete();\n    });\n  });\n\n  describe(\"_preCreate(data, options, user)\", () => {\n    it(\"New character's prototypeToken actorLink defaults to true\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      expect(actor.prototypeToken.actorLink).equal(true);\n    });\n\n    it(\"New monster's prototypeToken actorLink defaults to false\", async () => {\n      const actor = (await createMockActor(\"monster\")) as OseActor;\n      expect(actor.prototypeToken.actorLink).equal(false);\n    });\n\n    it(\"Character from compendium does not have defaults applied on import\", async () => {\n      const compendium = await createMockCompendium(\"Actor\");\n      const actor = await createMockActorKey(\n        \"character\",\n        { \"prototypeToken.actorLink\": false },\n        key\n      );\n\n      // Import Actor into Compendium and remove source actor\n      const actorInCompendium = await compendium.importDocument(actor);\n      await cleanUpActorsByKey(key);\n\n      // Import Compendium Actor into world\n      const importedActor = await game.actors.importFromCompendium(\n        compendium,\n        actorInCompendium.id\n      );\n\n      // Perform test\n      expect(importedActor.prototypeToken.actorLink).equal(false);\n    });\n\n    after(async () => {\n      await cleanUpCompendium();\n      await cleanUpActorsByKey(key);\n    });\n  });\n\n  describe(\"isNew()\", () => {\n    it(\"character\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      expect(actor?.isNew()).equal(true);\n      await actor?.delete();\n    });\n\n    it(\"monster\", async () => {\n      const actor = (await createMockActor(\"monster\")) as OseActor;\n      expect(actor?.isNew()).equal(true);\n      await actor?.delete();\n    });\n  });\n\n  describe(\"generateSave(hd)\", async () => {\n    const saves = [\n      {\n        low: -99,\n        high: 1,\n        death: 14,\n        wands: 15,\n        paralysis: 16,\n        breath: 17,\n        spell: 18,\n      },\n      {\n        low: 1,\n        high: 3,\n        death: 12,\n        wands: 13,\n        paralysis: 14,\n        breath: 15,\n        spell: 16,\n      },\n      {\n        low: 4,\n        high: 6,\n        death: 10,\n        wands: 11,\n        paralysis: 12,\n        breath: 13,\n        spell: 14,\n      },\n      {\n        low: 7,\n        high: 9,\n        death: 8,\n        wands: 9,\n        paralysis: 10,\n        breath: 10,\n        spell: 12,\n      },\n      {\n        low: 10,\n        high: 12,\n        death: 6,\n        wands: 7,\n        paralysis: 8,\n        breath: 8,\n        spell: 10,\n      },\n      {\n        low: 10,\n        high: 12,\n        death: 6,\n        wands: 7,\n        paralysis: 8,\n        breath: 8,\n        spell: 10,\n      },\n      {\n        low: 13,\n        high: 15,\n        death: 4,\n        wands: 5,\n        paralysis: 6,\n        breath: 5,\n        spell: 8,\n      },\n      {\n        low: 16,\n        high: 18,\n        death: 2,\n        wands: 3,\n        paralysis: 4,\n        breath: 3,\n        spell: 6,\n      },\n      {\n        low: 19,\n        high: 21,\n        death: 2,\n        wands: 2,\n        paralysis: 2,\n        breath: 2,\n        spell: 4,\n      },\n      {\n        low: 22,\n        high: 99,\n        death: 2,\n        wands: 2,\n        paralysis: 2,\n        breath: 2,\n        spell: 2,\n      },\n    ];\n\n    const thac0 = [\n      { low: -100, high: 0, value: 20 },\n      { low: 0, high: 1, value: 19 },\n      { low: 1, high: 2, value: 18 },\n      { low: 2, high: 3, value: 17 },\n      { low: 3, high: 4, value: 16 },\n      { low: 4, high: 5, value: 15 },\n      { low: 5, high: 6, value: 14 },\n      { low: 6, high: 7, value: 13 },\n      { low: 7, high: 9, value: 12 },\n      { low: 9, high: 11, value: 11 },\n      { low: 11, high: 13, value: 1 },\n      { low: 13, high: 15, value: 9 },\n      { low: 15, high: 17, value: 8 },\n      { low: 17, high: 19, value: 7 },\n      { low: 19, high: 21, value: 6 },\n      { low: 21, high: 100, value: 5 },\n    ];\n\n    const scoreSpread = Array.from({ length: 23 }, (_el, idx) => idx + 1);\n\n    const actor = (await createMockActor(\"monster\")) as OseActor;\n\n    scoreSpread.forEach((hd) => {\n      const savesData = saves.find((s) => hd >= s.low && hd <= s.high);\n      const thac0Data = thac0.find((s) => hd >= s.low && hd <= s.high);\n      const thac0PlusData = thac0.find(\n        (s) => hd + 1 >= s.low && hd + 1 <= s.high\n      );\n      actor?.generateSave(`${hd}`);\n\n      it(`hd ${hd} generates correct saves`, () => {\n        expect(actor?.system.saves.death.value).equal(savesData?.death);\n        expect(actor?.system.saves.wand.value).equal(savesData?.wands);\n        expect(actor?.system.saves.paralysis.value).equal(savesData?.paralysis);\n        expect(actor?.system.saves.breath.value).equal(savesData?.breath);\n        expect(actor?.system.saves.spell.value).equal(savesData?.spell);\n      });\n\n      it(`hd ${hd} generates correct thac0`, () => {\n        expect(actor?.system.thac0.value).equal(thac0Data?.value);\n        expect(actor?.system.thac0.bba).equal(19 - thac0Data?.value);\n      });\n\n      actor?.generateSave(`${hd}+`);\n      it(`hd ${hd}+ generates correct thac0`, () => {\n        expect(actor?.system.thac0.value).equal(thac0PlusData?.value);\n        expect(actor?.system.thac0.bba).equal(19 - thac0PlusData?.value);\n      });\n    });\n\n    await actor?.delete();\n  });\n\n  describe(\"rollHP(options)\", async () => {\n    const actor = (await createMockActor(\"monster\")) as OseActor;\n    const conScoreSpread = Array.from({ length: 20 }, (_el, idx) => idx + 1);\n    const conBonusSpread = [\n      -3, -3, -3, -2, -2, -1, -1, -1, 0, 0, 0, 0, 1, 1, 1, 2, 2, 3, 3, 3,\n    ];\n    const hdSpread = [4, 6, 8, 10, 12, 20];\n    conScoreSpread.forEach((con, idx) => {\n      hdSpread.forEach((hd) => {\n        it(`${hd} hd with ${con} Con correctly rolls HP`, async () => {\n          await actor?.update({\n            system: { hp: { hd: `1d${hd}` }, scores: { con: { value: con } } },\n          });\n          await actor?.rollHP();\n          assert(actor?.system.hp.max - conBonusSpread[idx] >= 1);\n          assert(actor?.system.hp.value - conBonusSpread[idx] >= 1);\n          assert(actor?.system.hp.max - conBonusSpread[idx] >= hd);\n          assert(actor?.system.hp.value - conBonusSpread[idx] >= hd);\n        });\n      });\n    });\n    await actor?.delete();\n  });\n\n  describe(\"rollSave(save, options)\", () => {\n    afterEach(async () => {\n      await trashChat();\n    });\n\n    const saves = [\"death\", \"wand\", \"paralysis\", \"breath\", \"spell\"];\n    saves.forEach((save) => {\n      it(`is functional for ${save} saves on character`, async () => {\n        const actor = (await createMockActor(\"character\")) as OseActor;\n        expect(game.messages?.size).equal(0);\n        await actor?.rollSave(save, { fastForward: true });\n        await waitForInput();\n        expect(game.messages?.size).equal(1);\n        await actor?.delete();\n      });\n\n      it(`is functional for ${save} saves on monster`, async () => {\n        const actor = (await createMockActor(\"monster\")) as OseActor;\n        expect(game.messages?.size).equal(0);\n        await actor.rollSave(save, { fastForward: true });\n        await waitForInput();\n        expect(game.messages?.size).equal(1);\n        await actor?.delete();\n      });\n    });\n  });\n\n  describe(\"rollMorale(options)\", () => {\n    afterEach(async () => {\n      await trashChat();\n    });\n\n    it(\"for character\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      expect(game.messages?.size).equal(0);\n      await actor.rollMorale();\n      await waitForInput();\n      expect(game.messages?.size).equal(1);\n      await actor?.delete();\n    });\n\n    it(\"for monster\", async () => {\n      const actor = (await createMockActor(\"monster\")) as OseActor;\n      expect(game.messages?.size).equal(0);\n      await actor.rollMorale();\n      await waitForInput();\n      expect(game.messages?.size).equal(1);\n      await actor?.delete();\n    });\n  });\n\n  describe(\"rollLoyalty(options)\", () => {\n    afterEach(async () => {\n      await trashChat();\n    });\n\n    it(\"for character\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      expect(game.messages?.size).equal(0);\n      await actor.rollLoyalty();\n      await waitForInput();\n      expect(game.messages?.size).equal(1);\n      await actor?.delete();\n    });\n\n    it(\"for monster\", async () => {\n      const actor = (await createMockActor(\"monster\")) as OseActor;\n      expect(game.messages?.size).equal(0);\n      await actor.rollLoyalty();\n      await waitForInput();\n      expect(game.messages?.size).equal(1);\n      await actor?.delete();\n    });\n  });\n\n  describe(\"rollReaction(options)\", () => {\n    afterEach(async () => {\n      await trashChat();\n    });\n\n    it(\"for character\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      expect(game.messages?.size).equal(0);\n      await actor.rollReaction({ fastForward: true });\n      await waitForInput();\n      expect(game.messages?.size).equal(1);\n      await actor.delete();\n    });\n\n    it(\"for monster\", async () => {\n      const actor = (await createMockActor(\"monster\")) as OseActor;\n      expect(game.messages?.size).equal(0);\n      await actor.rollReaction({ fastForward: true });\n      await waitForInput();\n      expect(game.messages?.size).equal(1);\n      await actor.delete();\n    });\n  });\n\n  describe(\"rollCheck(score, options)\", () => {\n    const scores = [\"str\", \"int\", \"dex\", \"wis\", \"con\", \"cha\"];\n\n    afterEach(async () => {\n      await trashChat();\n    });\n\n    scores.forEach((score) => {\n      it(`${score} for character`, async () => {\n        const actor = (await createMockActor(\"character\")) as OseActor;\n        expect(game.messages?.size).equal(0);\n        await actor.rollCheck(score, { fastForward: true });\n        await waitForInput();\n        expect(game.messages?.size).equal(1);\n        await actor.delete();\n      });\n\n      it(`${score} for character`, async () => {\n        const actor = (await createMockActor(\"monster\")) as OseActor;\n        expect(game.messages?.size).equal(0);\n        await actor.rollCheck(score, { fastForward: true });\n        await waitForInput();\n        expect(game.messages?.size).equal(0);\n        await actor.delete();\n      });\n    });\n  });\n\n  describe(\"rollHitDice(options)\", () => {\n    const conScoreSpread = Array.from({ length: 20 }, (_el, idx) => idx + 1);\n    const conBonusSpread = [\n      -3, -3, -3, -2, -2, -1, -1, -1, 0, 0, 0, 0, 1, 1, 1, 2, 2, 3, 3, 3,\n    ];\n    const levelSpread = Array.from({ length: 9 }, (_el, idx) => idx + 1);\n\n    conScoreSpread.forEach((con, idx) => {\n      const conMod = conBonusSpread[idx] || 0;\n      const expectedTerms = 3;\n      const modSign = conMod < 0 ? \"-\" : \"+\";\n      const modUnsigned = modSign === \"-\" ? conMod * -1 : conMod;\n      levelSpread.forEach((level) => {\n        it(`constructs the roll terms correctly with level ${level} and con ${con}`, async () => {\n          const actor = (await createMockActor(\"character\")) as OseActor;\n          await actor?.update({\n            system: {\n              details: { level },\n              hp: { hd: `${level}d8` },\n              scores: { con: { value: con } },\n            },\n          });\n          const roll = await actor.rollHitDice();\n\n          expect(roll.terms.length).equal(1); // FunctionTerm: max(1d8 + 0, 1)\n          expect(roll.terms[0].rolls.length).equal(2); // 1d8 + 0, 1\n          expect(roll.terms[0].rolls[0].terms.length).equal(expectedTerms); // 1d8, +, 0\n          expect(roll.terms[0].rolls[0].terms[0].expression).equal(\n            actor?.system.hp.hd // 1d8\n          );\n          expect(roll.terms[0].rolls[0].terms[1].operator).equal(modSign);\n          expect(roll.terms[0].rolls[0].terms[2].expression).equal(\n            (modUnsigned * level).toString()\n          );\n          expect(actor?.system.scores.con.mod).equal(conMod);\n          await actor?.delete();\n        });\n      });\n    });\n\n    after(async () => {\n      await trashChat();\n    });\n  });\n\n  describe(\"rollAppearing(options)\", () => {\n    afterEach(async () => {\n      await trashChat();\n    });\n\n    it(\"for character\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      expect(game.messages?.size).equal(0);\n      await actor.rollAppearing();\n      await waitForInput();\n      expect(game.messages?.size).equal(0);\n      await actor.delete();\n    });\n\n    describe(\"for monster\", () => {\n      it(\"in wilderness\", async () => {\n        const actor = (await createMockActor(\"monster\")) as OseActor;\n        expect(game.messages?.size).equal(0);\n        await actor.rollAppearing({ check: \"wilderness\" });\n        await waitForInput();\n        expect(game.messages?.size).equal(1);\n        expect(game.messages?.contents[0].content).contain(\n          game.i18n.format(\"OSE.roll.appearing\", { type: \"2\" })\n        );\n        await actor.delete();\n      });\n\n      it(\"in other\", async () => {\n        const actor = (await createMockActor(\"monster\")) as OseActor;\n        expect(game.messages?.size).equal(0);\n        await actor.rollAppearing({ check: \"other\" });\n        await waitForInput();\n        expect(game.messages?.size).equal(1);\n        expect(game.messages?.contents[0].content).contain(\n          game.i18n.format(\"OSE.roll.appearing\", { type: \"1\" })\n        );\n        await actor.delete();\n      });\n    });\n  });\n\n  describe(\"rollExploration(expl, options)\", () => {\n    afterEach(async () => {\n      await trashChat();\n    });\n\n    const explorationOptions = [\"ld\", \"od\", \"sd\", \"fs\"];\n    explorationOptions.forEach((expl) => {\n      it(\"for character\", async () => {\n        const actor = (await createMockActor(\"character\")) as OseActor;\n        expect(game.messages?.size).equal(0);\n        await actor.rollExploration(expl, { fastForward: true });\n        await waitForInput();\n        expect(game.messages?.contents[0].content).contain(\n          game.i18n.format(\"OSE.roll.exploration\", {\n            exploration: game.i18n.localize(`OSE.exploration.${expl}.long`),\n          })\n        );\n        await actor.delete();\n      });\n    });\n\n    it(\"for monster\", async () => {\n      const actor = (await createMockActor(\"monster\")) as OseActor;\n      expect(game.messages?.size).equal(0);\n      await actor.rollExploration(\"ld\", { fastForward: true });\n      await waitForInput();\n      expect(game.messages?.size).equal(0);\n      await actor.delete();\n    });\n  });\n\n  describe(\"rollDamage(attData, options)\", () => {\n    afterEach(async () => {\n      await trashChat();\n    });\n\n    it(\"for character\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      expect(game.messages?.size).equal(0);\n      await actor.rollDamage({ label: \"test\" });\n      await waitForInput();\n      expect(game.messages?.size).equal(1);\n      expect(game.messages?.contents[0].content).contain(\n        `test - ${game.i18n.localize(\"OSE.Damage\")}`\n      );\n      await actor.delete();\n    });\n\n    it(\"for monster\", async () => {\n      const actor = (await createMockActor(\"monster\")) as OseActor;\n      expect(game.messages?.size).equal(0);\n      await actor.rollDamage({ label: \"test\" });\n      await waitForInput();\n      expect(game.messages?.size).equal(1);\n      expect(game.messages?.contents[0].content).contain(\n        `test - ${game.i18n.localize(\"OSE.Damage\")}`\n      );\n      await actor.delete();\n    });\n\n    it(\"Adds roll.dmg to damage parts if provided\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      expect(game.messages?.size).equal(0);\n      await actor.rollDamage({\n        label: \"test\",\n        roll: { dmg: \"15\" },\n      });\n      await waitForInput();\n      expect(game.messages?.size).equal(1);\n      expect(game.messages?.contents[0].content).contain(\n        `test - ${game.i18n.localize(\"OSE.Damage\")}`\n      );\n      expect(game.messages?.contents[0].content).contain(\"15\");\n      await actor.delete();\n    });\n\n    it(\"Adds strength bonus if melee damage roll\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      await actor?.update({ system: { scores: { str: { value: 1 } } } });\n      expect(actor.system.scores.str.value).equal(1);\n      expect(game.messages?.size).equal(0);\n      await actor.rollDamage({\n        label: \"test\",\n        roll: { dmg: \"15\", type: \"melee\" },\n      });\n      await waitForInput();\n      expect(game.messages?.size).equal(1);\n      expect(game.messages?.contents[0].content).contain(\n        `test - ${game.i18n.localize(\"OSE.Damage\")}`\n      );\n      expect(game.messages?.contents[0].content).contain(\"15 - 3\");\n      await actor.delete();\n    });\n  });\n\n  describe(\"targetAttack(data, type, options)\", () => {\n    before(async () => {\n      const scene = await createMockScene();\n      await scene?.activate();\n      await delay(500);\n    });\n\n    afterEach(async () => {\n      await trashChat();\n      await waitForInput();\n    });\n\n    it(\"One target causes one attack roll\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      const token = await actor.getTokenDocument();\n      await delay(500);\n      await token.constructor.create(token, { parent: canvas.scene });\n      await waitForInput();\n      expect(game.user?.targets.size).equal(0);\n      canvas.tokens?.placeables.forEach((t: Token) =>\n        t.setTarget(true, { releaseOthers: false, groupSelection: true })\n      );\n      expect(canvas.tokens?.placeables[0].actor).not.null;\n      expect(canvas.tokens?.placeables[0].actor?.system.ac.value).not.null;\n      expect(game.user?.targets.size).equal(1);\n      expect(game.messages?.size).equal(0);\n      await actor.targetAttack({ roll: { target: {} } }, \"melee\", {\n        skipDialog: true,\n      });\n      await waitForInput();\n      expect(game.messages?.size).equal(1);\n      canvas.tokens?.placeables.forEach((t: Token) => t.setTarget(false));\n      expect(game.user?.targets.size).equal(0);\n      await actor.delete();\n    });\n\n    it(\"Multiple target causes multiple attack rolls\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      const token = await actor.getTokenDocument();\n      await token.constructor.create(token, { parent: canvas.scene });\n      await waitForInput();\n      expect(game.user?.targets.size).equal(0);\n      canvas.tokens?.placeables.forEach((t: Token) =>\n        t.setTarget(true, { releaseOthers: false, groupSelection: true })\n      );\n      expect(game.user?.targets.size).equal(2);\n      expect(game.messages?.size).equal(0);\n      await actor.targetAttack({ roll: { target: {} } }, \"melee\", {\n        skipDialog: true,\n      });\n      await waitForInput();\n      expect(game.messages?.size).equal(2);\n      canvas.tokens?.placeables.forEach((t: Token) => t.setTarget(false));\n      expect(game.user?.targets.size).equal(0);\n      await actor.delete();\n    });\n\n    it(\"If no target is given, just roll attack\", async () => {\n      const data = {\n        roll: {\n          blindroll: false,\n          dmg: [\"1d6\"],\n          thac0: 15,\n          target: {\n            actor: { system: { ac: { value: 0 }, aac: { value: 9 } } },\n          },\n        },\n      };\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      expect(game.user?.targets.size).equal(0);\n      expect(game.messages?.size).equal(0);\n      await actor.targetAttack(data, \"melee\", { skipDialog: true });\n      await waitForInput();\n      expect(game.messages?.size).equal(1);\n      await actor.delete();\n    });\n\n    after(async () => {\n      await cleanUpScenes();\n    });\n  });\n\n  describe(\"rollAttack(attdata, options)\", () => {\n    before(async () => {\n      await trashChat();\n    });\n\n    afterEach(async () => {\n      await trashChat();\n      await waitForInput();\n    });\n\n    it(\"rolls a d20 if supplied no data\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      expect(game.messages?.size).equal(0);\n      const rolldata = await actor.rollAttack(\n        { roll: {} },\n        { skipDialog: true }\n      );\n      expect(rolldata.formula).equal(\"1d20\");\n      await waitForInput();\n      expect(game.messages?.size).equal(1);\n      await actor.delete();\n    });\n\n    it(\"Provided an item, adds item damage to dmgParts\", async () => {\n      const actor = await createMockActor(\"character\");\n      const item = await createWorldTestItem(\"weapon\");\n      expect(item?.system.damage).is.not.undefined;\n      expect(game.messages?.size).equal(0);\n      const rolldata = await actor.rollAttack(\n        { roll: {}, item },\n        { skipDialog: true }\n      );\n      expect(rolldata.formula).equal(\"1d20\");\n      await waitForInput();\n      expect(game.messages?.size).equal(1);\n      expect(game.messages?.contents[0].content).contain(\n        game.i18n.format(\"OSE.roll.attacksWith\", { name: item?.name })\n      );\n      expect(game.messages?.contents[0].content).contain(\"1d20\");\n      actor?.delete();\n      item?.delete();\n    });\n\n    it(\"If missile attack, add dex mod to attack roll\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      expect(game.messages?.size).equal(0);\n      const rolldata = await actor.rollAttack(\n        { roll: {} },\n        { type: \"missile\", skipDialog: true }\n      );\n      expect(rolldata.formula).equal(\"1d20 - 3\");\n      await waitForInput();\n      expect(game.messages?.size).equal(1);\n      await actor.delete();\n    });\n\n    it(\"If melee attack, add str mod to attack roll\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      await actor.update({ system: { scores: { str: { value: 18 } } } });\n      expect(game.messages?.size).equal(0);\n      const rolldata = await actor.rollAttack(\n        { roll: {} },\n        { type: \"melee\", skipDialog: true }\n      );\n      expect(rolldata.formula).equal(\"1d20 + 3\");\n      await waitForInput();\n      expect(game.messages?.size).equal(1);\n      await actor.delete();\n    });\n\n    // @todo: How to verify if possible to miss, thus obfuscating dmg roll?\n    it(\"If melee attack, add str mod to damage roll\", async () => {\n      // Ensure the dice roll is a 10 to make sure the attack is successful\n      const existingRandomFunction = CONFIG.Dice.randomUniform;\n      CONFIG.Dice.randomUniform = () => rollSpecificNumber(10, 20);\n\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      await actor.update({ system: { scores: { str: { value: 18 } } } });\n      expect(game.messages?.size).equal(0);\n      const rolldata = await actor.rollAttack(\n        { roll: {} },\n        { type: \"melee\", skipDialog: true }\n      );\n      expect(rolldata.formula).equal(\"1d20 + 3\");\n      await waitForInput();\n      expect(game.messages?.size).equal(1);\n      expect(game.messages?.contents[0].content).contain(\n        game.i18n.localize(\"OSE.messages.InflictsDamage\")\n      );\n      expect(game.messages?.contents[0].content).contain(\"1d6 + 3\");\n      await actor.delete();\n\n      // Restore the original random function\n      CONFIG.Dice.randomUniform = existingRandomFunction;\n    });\n\n    it(\"If item provided with a bonus, it is added as bonus to attack roll\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      const item = await createWorldTestItem(\"weapon\");\n      await item?.update({ system: { bonus: 18 } });\n      expect(game.messages?.size).equal(0);\n      const rolldata = await actor.rollAttack(\n        { roll: {}, item },\n        { skipDialog: true }\n      );\n      expect(rolldata.formula).equal(\"1d20 + 18\");\n      await waitForInput();\n      expect(game.messages?.size).equal(1);\n      await actor.delete();\n    });\n  });\n\n  describe(\"applyDamage(amount, multiplier)\", () => {\n    it(\"doesn't remove hp if no variables are given\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      await actor.update({ system: { hp: { value: 10, max: 10 } } });\n      expect(actor.system.hp.value).equal(10);\n      await actor.applyDamage();\n      expect(actor.system.hp.value).equal(10);\n      await actor.delete();\n    });\n\n    it(\"calculates the amount with amount\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      await actor.update({ system: { hp: { value: 10, max: 10 } } });\n      expect(actor.system.hp.value).equal(10);\n      await actor.applyDamage(3);\n      expect(actor.system.hp.value).equal(7);\n      await actor.delete();\n    });\n\n    it(\"calculates the amount with amount and multiplier\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      await actor.update({ system: { hp: { value: 10, max: 10 } } });\n      expect(actor.system.hp.value).equal(10);\n      await actor.applyDamage(3, 2);\n      expect(actor.system.hp.value).equal(4);\n      await actor.delete();\n    });\n\n    it(\"calculates the amount with amount and negative multiplier\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      await actor.update({ system: { hp: { value: 1, max: 10 } } });\n      expect(actor.system.hp.value).equal(1);\n      await actor.applyDamage(3, -2);\n      expect(actor.system.hp.value).equal(7);\n      await actor.delete();\n    });\n\n    it(\"calculates the amount with negative amount\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      await actor.update({ system: { hp: { value: 1, max: 10 } } });\n      expect(actor.system.hp.value).equal(1);\n      await actor.applyDamage(-3);\n      expect(actor.system.hp.value).equal(4);\n      await actor.delete();\n    });\n\n    it(\"doesn't reduce lower than 0 hp with only amount\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      await actor.update({ system: { hp: { value: 10, max: 10 } } });\n      expect(actor.system.hp.value).equal(10);\n      await actor.applyDamage(20);\n      expect(actor.system.hp.value).equal(0);\n      await actor.delete();\n    });\n\n    it(\"doesn't reduce lower than 0 hp with amount and multiplier\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      await actor.update({ system: { hp: { value: 10, max: 10 } } });\n      expect(actor.system.hp.value).equal(10);\n      await actor.applyDamage(4, 3);\n      expect(actor.system.hp.value).equal(0);\n      await actor.delete();\n    });\n\n    it(\"doesn't increase higher than max hp with only amount\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      await actor.update({ system: { hp: { value: 1, max: 10 } } });\n      expect(actor.system.hp.value).equal(1);\n      await actor.applyDamage(-20);\n      expect(actor.system.hp.value).equal(10);\n      await actor.delete();\n    });\n\n    it(\"doesn't increase higher than max hp with amount and multiplier\", async () => {\n      const actor = (await createMockActor(\"character\")) as OseActor;\n      await actor.update({ system: { hp: { value: 1, max: 10 } } });\n      expect(actor.system.hp.value).equal(1);\n      await actor.applyDamage(4, -3);\n      expect(actor.system.hp.value).equal(10);\n      await actor.delete();\n    });\n  });\n};\n","/**\n * @file Contains tests for Actor Sheet.\n */\n// eslint-disable-next-line import/no-cycle\nimport { QuenchMethods } from \"../../../e2e\";\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport {\n  cleanUpActorsByKey,\n  cleanUpMacros,\n  closeSheets,\n  closeV2Dialogs,\n  createActorTestItem,\n  createMockActorKey,\n  createMockMacro,\n  createWorldTestItem,\n  delay,\n  itemTypes,\n  openV2Dialogs,\n  openWindows,\n  trashChat,\n  waitForInput,\n} from \"../../../e2e/testUtils\";\nimport OseItem from \"../../item/entity\";\nimport OseActorSheet from \"../actor-sheet\";\nimport OseActor from \"../entity\";\n\nexport const key = \"ose.actor.sheet\";\nexport const options = {\n  displayName: \"OSE: Actor: Sheet\",\n  preSelected: true,\n};\n\n/* --------------------------------------------- */\n/* Types for storing data between tests          */\n/* --------------------------------------------- */\ntype DragNDropItem = {\n  item: OseItem | undefined;\n  itemElement: Element | null;\n};\n\ntype DragNDropItems = {\n  source: DragNDropItem;\n  target: DragNDropItem;\n};\n\ntype DragNDropDocuments = {\n  actor: StoredDocument<Actor> | undefined;\n  compendium: CompendiumCollection<any> | undefined;\n};\n\n/* --------------------------------------------- */\n/* Helper Functions                              */\n/* --------------------------------------------- */\nconst getActor = async () => game.actors?.getName(`Test Actor ${key}`);\n\nexport default ({\n  describe,\n  it,\n  expect,\n  after,\n  afterEach,\n  before,\n}: QuenchMethods) => {\n  // Saving settings being modified by tests\n  const originalCtrlSetting = game.settings.get(\n    game.system.id,\n    \"invertedCtrlBehavior\"\n  );\n\n  after(async () => {\n    await cleanUpActorsByKey(key);\n    await closeSheets();\n    game.settings.set(\n      game.system.id,\n      \"invertedCtrlBehavior\",\n      originalCtrlSetting\n    );\n  });\n\n  describe(\"getData()\", () => {\n    it(\"returns the expected data\", async () => {\n      const actor = (await createMockActorKey(\n        \"character\",\n        {},\n        key\n      )) as OseActor;\n      const sheet = new OseActorSheet(actor);\n      const data = await sheet.getData();\n\n      expect(data.owner).equal(actor?.isOwner);\n      expect(data.editable).equal(actor?.sheet?.isEditable);\n      expect(Object.keys(data.config)).contain(\"ascendingAC\");\n      expect(Object.keys(data.config)).contain(\"initiative\");\n      expect(Object.keys(data.config)).contain(\"encumbrance\");\n      expect(data.isNew).equal(actor?.isNew());\n    });\n  });\n\n  // @todo: Refactor to entity and just use event parsing in sheet\n  describe(\"_getItemFromActor(event)\", () => {\n    itemTypes.forEach((itemType) => {\n      it(`Can get an ${itemType.capitalize()} item`, async () => {\n        // Create item\n        const actor = await createMockActorKey(\"character\", {}, key);\n        await actor?.update({ system: { spells: { enabled: true } } });\n        actor?.sheet?.render(true);\n        await delay(200);\n\n        const item = await createActorTestItem(actor, itemType);\n        await waitForInput();\n\n        expect(actor?.items.size).equal(1);\n        const mockedItem = item?.pop();\n        expect(actor?.items.contents.find((o) => o.id === mockedItem?.id)).not\n          .undefined;\n\n        // Select tab to look inside\n        let tab = \"\";\n        switch (itemType) {\n          // eslint-disable-next-line switch-case/no-case-curly\n          case \"spell\": {\n            tab = \".tab[data-tab=spells]\";\n            break;\n          }\n\n          // eslint-disable-next-line switch-case/no-case-curly\n          case \"ability\": {\n            tab = \".tab[data-tab=abilities]\";\n            break;\n          }\n\n          // eslint-disable-next-line switch-case/no-case-curly\n          default: {\n            tab = \".tab[data-tab=inventory]\";\n          }\n        }\n\n        // Setup what to click\n        const clickElement = document.querySelector(`${tab} .item-name`);\n        const descriptionElement =\n          clickElement?.parentElement?.nextElementSibling;\n        expect([...descriptionElement?.classList])\n          .to.be.an(\"array\")\n          .that.does.not.include(\"expanded\");\n\n        // Mock event\n        document\n          .querySelector(`${tab} .item-name`)\n          ?.dispatchEvent(new MouseEvent(\"click\", { bubbles: true }));\n        await delay(200);\n\n        // Verify method\n        expect([...descriptionElement?.classList])\n          .to.be.an(\"array\")\n          .that.includes(\"expanded\");\n\n        // Cleanup\n        await actor?.delete();\n      });\n\n      after(async () => {\n        await cleanUpActorsByKey(key);\n        await closeSheets();\n        await delay(220);\n      });\n    });\n  });\n\n  describe(\"_toggleItemCategory(event)\", () => {\n    // eslint-disable-next-line unicorn/consistent-function-scoping\n    const clickCategory = async () => {\n      document\n        .querySelector(\".tab[data-tab='inventory'] .item-category-title\")\n        ?.dispatchEvent(new MouseEvent(\"click\", { bubbles: true }));\n      await delay(220);\n    };\n\n    before(async () => {\n      const actor = (await createMockActorKey(\n        \"character\",\n        {},\n        key\n      )) as OseActor;\n      await actor.update({ system: { spells: { enabled: true } } });\n      actor?.sheet?.render(true);\n      await delay(220);\n    });\n\n    it(\"clicking the category name hides the item cateogry\", async () => {\n      const sheets = openWindows(\"sheet\");\n      expect(sheets.length).equal(1);\n      const categoryElement = document.querySelector(\n        \".tab[data-tab='inventory'] .item-list\"\n      );\n      expect(categoryElement?.style.display).equal(\"\");\n      await clickCategory();\n      expect(categoryElement?.style.display).equal(\"none\");\n    });\n\n    it(\"clicking the category name again shows the item cateogry\", async () => {\n      const sheets = openWindows(\"sheet\");\n      expect(sheets.length).equal(1);\n      const categoryElement = document.querySelector(\n        \".tab[data-tab='inventory'] .item-list\"\n      );\n      expect(categoryElement?.style.display).equal(\"none\");\n      await clickCategory();\n      expect(categoryElement?.style.display).equal(\"\");\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n      await closeSheets();\n      await delay(220);\n    });\n  });\n\n  describe(\"_toggleContainedItems(event)\", () => {\n    // eslint-disable-next-line unicorn/consistent-function-scoping\n    const clickContainerCaret = async () => {\n      document\n        .querySelector(\".tab[data-tab='inventory'] .container .category-caret\")\n        ?.dispatchEvent(new MouseEvent(\"click\", { bubbles: true }));\n      await delay(220);\n    };\n\n    before(async () => {\n      const actor = await createMockActorKey(\"character\", {}, key);\n      await createActorTestItem(actor, \"container\");\n      await createActorTestItem(actor, \"weapon\");\n      const weapon = actor?.items.getName(\"New Actor Test Weapon\");\n      const container = actor?.items.getName(\"New Actor Test Container\");\n      await weapon?.update({ system: { containerId: container?.id } });\n      actor?.sheet?.render(true);\n    });\n\n    it(\"clicking container caret will hide the content\", async () => {\n      const sheets = openWindows(\"sheet\");\n      expect(sheets.length).equal(1);\n\n      const actor = await getActor();\n      expect(actor?.items.size).equal(2);\n\n      const container = actor?.items?.getName(\"New Actor Test Container\");\n      expect(\n        actor?.items.getName(\"New Actor Test Weapon\")?.system.containerId\n      ).equal(container?.id);\n      const containerElement = document.querySelector(\n        \".tab[data-tab='inventory'] .container .contained-items\"\n      );\n      expect(containerElement?.style.display).equal(\"\");\n\n      await clickContainerCaret();\n      expect(containerElement?.style.display).equal(\"none\");\n    });\n\n    it(\"clicking container caret again will show the content\", async () => {\n      const sheets = openWindows(\"sheet\");\n      expect(sheets.length).equal(1);\n\n      const actor = await getActor();\n      expect(actor?.items.size).equal(2);\n\n      const container = actor?.items?.getName(\"New Actor Test Container\");\n      expect(\n        actor?.items.getName(\"New Actor Test Weapon\")?.system.containerId\n      ).equal(container?.id);\n      const containerElement = document.querySelector(\n        \".tab[data-tab='inventory'] .container .contained-items\"\n      );\n\n      expect(containerElement?.style.display).equal(\"none\");\n      await clickContainerCaret();\n      expect(containerElement?.style.display).equal(\"\");\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n      await closeSheets();\n    });\n  });\n\n  describe(\"_toggleItemSummary(event)\", () => {\n    // eslint-disable-next-line unicorn/consistent-function-scoping\n    const clickItemSummary = async (tab: string) => {\n      const actor = await getActor();\n      document\n        .querySelector(\n          `#OseActorSheetCharacter-Actor-${actor.id} section .tab[data-tab=\"${tab}\"] .item-name`\n        )\n        ?.click();\n      await delay(320);\n    };\n    // eslint-disable-next-line unicorn/consistent-function-scoping\n    const clickNavTab = async (tab: string) => {\n      const actor = await getActor();\n      document\n        .querySelector(\n          `#OseActorSheetCharacter-Actor-${actor.id} nav.sheet-tabs a[data-tab=\"${tab}\"]`\n        )\n        ?.click();\n      await delay(120);\n    };\n\n    before(async () => {\n      const actor = await createMockActorKey(\"character\", {}, key);\n      await actor?.update({ system: { spells: { enabled: true } } });\n      actor?.sheet?.render(true);\n      await delay(220);\n    });\n\n    // eslint-disable-next-line no-restricted-syntax\n    for (const itemType of itemTypes) {\n      let tab = \"\";\n      switch (itemType) {\n        // eslint-disable-next-line switch-case/no-case-curly\n        case \"spell\": {\n          tab = \"spells\";\n          break;\n        }\n\n        // eslint-disable-next-line switch-case/no-case-curly\n        case \"ability\": {\n          tab = \"abilities\";\n          break;\n        }\n\n        // eslint-disable-next-line switch-case/no-case-curly\n        default: {\n          tab = \"inventory\";\n        }\n      }\n\n      describe(`for type ${itemType}`, () => {\n        before(async () => {\n          const actor = await getActor();\n          await createActorTestItem(actor, itemType);\n        });\n\n        it(\"clicking item name will show the content\", async () => {\n          const sheets = openWindows(\"sheet\");\n          expect(sheets.length).equal(1);\n          await clickNavTab(tab);\n\n          const actor = await getActor();\n          expect(actor?.items.size).equal(1);\n\n          const summaryElement = document.querySelector(\n            `#OseActorSheetCharacter-Actor-${actor.id} section .tab[data-tab=\"${tab}\"] .item-summary`\n          );\n          expect([...summaryElement?.classList])\n            .to.be.an(\"array\")\n            .that.does.not.include(\"expanded\");\n\n          await clickItemSummary(tab);\n          expect([...summaryElement?.classList])\n            .to.be.an(\"array\")\n            .that.includes(\"expanded\");\n        });\n        it(\"clicking item name again will hide the content\", async () => {\n          const sheets = openWindows(\"sheet\");\n          expect(sheets.length).equal(1);\n          await clickNavTab(tab);\n\n          const actor = await getActor();\n          expect(actor?.items.size).equal(1);\n\n          const summaryElement = document.querySelector(\n            `#OseActorSheetCharacter-Actor-${actor.id} section .tab[data-tab=\"${tab}\"] .item-summary`\n          );\n          expect([...summaryElement?.classList])\n            .to.be.an(\"array\")\n            .that.includes(\"expanded\");\n          await clickItemSummary(tab);\n          expect([...summaryElement?.classList])\n            .to.be.an(\"array\")\n            .that.does.not.include(\"expanded\");\n        });\n        it(\"item containing description still shows the summary\", async () => {\n          const sheets = openWindows(\"sheet\");\n          expect(sheets.length).equal(1);\n          await clickNavTab(tab);\n\n          const actor = await getActor();\n          const item = actor?.items.getName(\n            `New Actor Test ${itemType.capitalize()}`\n          );\n\n          await clickItemSummary(tab);\n          await item?.update({ system: { description: \"hello world\" } });\n          await waitForInput();\n          expect(item?.system.description).equal(\"hello world\");\n\n          const summaryElement = document.querySelector(\n            `#OseActorSheetCharacter-Actor-${actor.id} section .tab[data-tab=\"${tab}\"] .item-summary`\n          );\n          expect(summaryElement?.innerHTML.indexOf(\"hello world\") >= 0).is.true;\n\n          await item?.update({ system: { description: \"\" } });\n        });\n        it(\"item containing macro reference still shows the summary, Issue #353\", async () => {\n          const sheets = openWindows(\"sheet\");\n          expect(sheets.length).equal(1);\n          await clickNavTab(tab);\n\n          const macro = await createMockMacro();\n          const macroReference = `<p>@UUID[${macro?.uuid}]{Mock Macro}</p>`;\n\n          const actor = await getActor();\n          const item = actor?.items.getName(\n            `New Actor Test ${itemType.capitalize()}`\n          );\n          await item?.update({ system: { description: macroReference } });\n          await waitForInput();\n\n          const summaryElement = document.querySelector(\n            `#OseActorSheetCharacter-Actor-${actor.id} section .tab[data-tab=\"${tab}\"] .item-summary`\n          );\n          expect(summaryElement).is.not.null;\n          expect(summaryElement?.querySelector(`a[data-uuid=\"${macro?.uuid}\"]`))\n            .is.not.null;\n          await macro?.delete();\n          await item?.update({ system: { description: \"\" } });\n        });\n\n        after(async () => {\n          const actor = await getActor();\n          actor?.items.forEach(async (i: OseItem) => {\n            await i.delete();\n          });\n          await cleanUpMacros();\n        });\n      });\n    }\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n      await closeSheets();\n    });\n  });\n\n  // @todo: Refactor to entity and just use event parsing in sheet\n  describe(\"_displayItemInChat(event)\", () => {\n    // eslint-disable-next-line unicorn/consistent-function-scoping\n    const clickItemShow = async (tab: string) => {\n      document\n        .querySelector(`${tab} .item-show`)\n        ?.dispatchEvent(new MouseEvent(\"click\", { bubbles: true }));\n      await delay(220);\n    };\n\n    before(async () => {\n      const actor = await createMockActorKey(\"character\", {}, key);\n      await actor?.update({ system: { spells: { enabled: true } } });\n      actor?.sheet?.render(true);\n      await delay(220);\n    });\n\n    itemTypes.forEach((itemType) => {\n      let tab = \"\";\n      switch (itemType) {\n        // eslint-disable-next-line switch-case/no-case-curly\n        case \"spell\": {\n          tab = \".tab[data-tab='spells']\";\n          break;\n        }\n\n        // eslint-disable-next-line switch-case/no-case-curly\n        case \"ability\": {\n          tab = \".tab[data-tab='abilities']\";\n          break;\n        }\n\n        // eslint-disable-next-line switch-case/no-case-curly\n        default: {\n          tab = \".tab[data-tab='inventory']\";\n        }\n      }\n\n      it(`can show ${itemType}`, async () => {\n        await trashChat();\n        const actor = await getActor();\n        await createActorTestItem(actor, itemType);\n        await waitForInput();\n        await clickItemShow(tab);\n        await waitForInput();\n        expect(game.messages?.size).equal(1);\n        expect(game.messages?.contents[0]?.content).contain(\n          `New Actor Test ${itemType.capitalize()}`\n        );\n        actor?.items.forEach((i: OseItem) => i.delete());\n      });\n\n      after(async () => {\n        await cleanUpActorsByKey(key);\n      });\n    });\n  });\n\n  // @todo: Refactor to entity and just use event parsing in sheet\n  describe(\"_removeItemFromActor(item)\", () => {\n    before(async () => {\n      const actor = await createMockActorKey(\"character\", {}, key);\n      await actor?.update({ system: { spells: { enabled: true } } });\n      actor?.sheet?.render(true);\n    });\n\n    itemTypes.forEach((itemType) => {\n      describe(`${itemType} item`, () => {\n        it(\"can remove item outside container\", async () => {\n          const actor = (await getActor()) as OseActor;\n          expect(actor?.items.size).equal(0);\n\n          await createActorTestItem(actor, itemType);\n          await waitForInput();\n          const item = actor?.items.getName(\n            `New Actor Test ${itemType.capitalize()}`\n          );\n          expect(actor?.items.size).equal(1);\n\n          // eslint-disable-next-line no-underscore-dangle\n          await actor?.sheet?._removeItemFromActor(item);\n          await waitForInput();\n          expect(actor?.items.size).equal(0);\n        });\n\n        if (\n          itemType !== \"container\" &&\n          itemType !== \"spell\" &&\n          itemType !== \"ability\"\n        ) {\n          it(\"can remove item inside container\", async () => {\n            const actor = await getActor();\n            expect(actor?.items.size).equal(0);\n\n            await createActorTestItem(actor, \"container\");\n            await createActorTestItem(actor, itemType);\n            await waitForInput();\n            expect(actor?.items.size).equal(2);\n\n            const item = actor?.items.getName(\n              `New Actor Test ${itemType.capitalize()}`\n            );\n            const container = actor?.items.getName(`New Actor Test Container`);\n            expect(item).not.undefined;\n            expect(container).not.undefined;\n\n            // eslint-disable-next-line no-underscore-dangle\n            await actor?.sheet?._onContainerItemAdd(item, container);\n            await waitForInput();\n\n            // eslint-disable-next-line no-underscore-dangle\n            await actor?.sheet?._removeItemFromActor(item);\n            await waitForInput();\n            expect(actor?.items.size).equal(1);\n            expect(container?.system.itemIds.length).equal(0);\n\n            // eslint-disable-next-line no-underscore-dangle\n            await actor?.sheet?._removeItemFromActor(container);\n            await waitForInput();\n            expect(actor?.items.size).equal(0);\n          });\n          it(\"removing container with item inside deletes just container\", async () => {\n            const actor = await getActor();\n            expect(actor?.items.size).equal(0);\n\n            await createActorTestItem(actor, \"container\");\n            await createActorTestItem(actor, itemType);\n            await waitForInput();\n            expect(actor?.items.size).equal(2);\n\n            const item = actor?.items.getName(\n              `New Actor Test ${itemType.capitalize()}`\n            );\n            const container = actor?.items.getName(`New Actor Test Container`);\n            expect(item).not.undefined;\n            expect(container).not.undefined;\n            expect(actor?.items.size).equal(2);\n\n            // eslint-disable-next-line no-underscore-dangle\n            await actor?.sheet?._removeItemFromActor(container);\n            await waitForInput();\n            expect(actor?.items.size).equal(1);\n            // eslint-disable-next-line no-underscore-dangle\n            await actor?.sheet?._removeItemFromActor(item);\n            await waitForInput();\n            expect(actor?.items.size).equal(0);\n          });\n        }\n      });\n\n      after(async () => {\n        await cleanUpActorsByKey(key);\n      });\n    });\n  });\n  // @todo: Refactor to entity and just use event parsing in sheet\n  describe(\"_useConsumable(event, decrement)\", () => {\n    // eslint-disable-next-line unicorn/consistent-function-scoping\n    const clickConsumableEmpty = async () =>\n      document\n        .querySelector(`.tab[data-tab=\"inventory\"] .empty-mark`)\n        ?.dispatchEvent(new MouseEvent(\"click\", { bubbles: true }));\n\n    // eslint-disable-next-line unicorn/consistent-function-scoping\n    const clickConsumableFull = async () =>\n      document\n        .querySelector(`.tab[data-tab=\"inventory\"] .full-mark`)\n        ?.dispatchEvent(new MouseEvent(\"click\", { bubbles: true }));\n\n    before(async () => {\n      const actor = await createMockActorKey(\"character\", {}, key);\n      await createActorTestItem(actor, \"item\");\n      await waitForInput();\n\n      const item = actor?.items.contents[0];\n      await item?.update({ system: { quantity: { max: 6, value: 3 } } });\n      await waitForInput();\n\n      actor?.sheet?.render(true);\n      await delay(220);\n    });\n\n    // full = true, empty = false\n    it(\"can decrease value\", async () => {\n      const actor = await getActor();\n      const item = actor?.items.contents[0];\n      expect(item?.system.quantity.value).equal(3);\n      await clickConsumableFull();\n      await waitForInput();\n      expect(item?.system.quantity.value).equal(2);\n    });\n    it(\"can increase value\", async () => {\n      const actor = await getActor();\n      const item = actor?.items.contents[0];\n      expect(item?.system.quantity.value).equal(2);\n      await clickConsumableEmpty();\n      await waitForInput();\n      expect(item?.system.quantity.value).equal(3);\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n    });\n  });\n\n  describe(\"_onSpellChange(event)\", () => {\n    before(async () => {\n      const actor = await createMockActorKey(\"character\", {}, key);\n      await actor?.update({ system: { spells: { enabled: true } } });\n      await createActorTestItem(actor, \"spell\");\n      await waitForInput();\n      actor?.sheet?.render(true);\n    });\n\n    it(\"changing the input for cast changes spell cast data\", async () => {\n      const element = document.querySelector(\"input[data-field='cast']\");\n      expect(element).is.not.null;\n      if (element) {\n        element.value = 3;\n        element.dispatchEvent(new Event(\"change\"));\n      }\n      await waitForInput();\n\n      const actor = await getActor();\n      const item = actor?.items.contents[0];\n      expect(item?.system.cast).equal(3);\n    });\n\n    it(\"changing the input for memorize changes spell memorize data\", async () => {\n      const element = document.querySelector(\"input[data-field='memorize']\");\n      expect(element).is.not.null;\n      if (element) {\n        element.value = 3;\n        element.dispatchEvent(new Event(\"change\"));\n      }\n      await waitForInput();\n\n      const actor = await getActor();\n      const item = actor?.items.contents[0];\n      expect(item?.system.memorized).equal(3);\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n      await delay(300);\n    });\n  });\n\n  // @todo: Refactor to entity and just use event parsing in sheet\n  describe(\"_resetSpells(event)\", () => {\n    before(async () => {\n      const actor = await createMockActorKey(\"character\", {}, key);\n      await actor?.update({ system: { spells: { enabled: true } } });\n      await createActorTestItem(actor, \"spell\");\n      await waitForInput();\n      await actor?.items.contents[0].update({\n        system: { cast: 1, memorized: 3 },\n      });\n      actor?.sheet?.render(true);\n    });\n\n    it(\"resetting spells resets the cast field to maximum\", async () => {\n      const actor = await getActor();\n      document\n        .querySelector(\n          `#OseActorSheetCharacter-Actor-${actor.id} a[data-action='reset-spells']`\n        )\n        ?.click();\n      await waitForInput();\n\n      expect(actor?.items.contents[0].system.cast).equal(\n        actor?.items.contents[0].system.memorized\n      );\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n    });\n  });\n\n  // @todo: Refactor to entity and just use event parsing in sheet\n  describe(\"_rollAbility(event) \", () => {\n    // eslint-disable-next-line unicorn/consistent-function-scoping\n    const mockClickItem = async (tab: string) => {\n      document\n        .querySelector(`.tab[data-tab=\"${tab}\"] .item-image`)\n        ?.dispatchEvent(new MouseEvent(\"click\", { bubbles: true }));\n      await delay(220);\n    };\n\n    before(async () => {\n      await game.settings.set(game.system.id, \"invertedCtrlBehavior\", true);\n      await trashChat();\n    });\n\n    afterEach(async () => {\n      await cleanUpActorsByKey(key);\n      await trashChat();\n    });\n\n    it(\"rolling weapon on monster updates the counter value\", async () => {\n      // Sanity checks\n      expect(game.messages?.size).equal(0);\n\n      // Setup\n      const actor = await createMockActorKey(\"monster\", {}, key);\n      await createActorTestItem(actor, \"weapon\");\n      await waitForInput();\n      await actor?.items.contents[0].update({\n        system: { counter: { value: 3, max: 3 } },\n      });\n      expect(actor?.items.size).equal(1);\n      actor?.sheet?.render(true);\n      await waitForInput();\n      await mockClickItem(\"attributes\");\n\n      // Verification\n      expect(game.messages?.size).equal(1);\n      expect(game.messages?.contents[0].content).contain(\n        `<h2>${game.i18n.format(\"OSE.roll.attacksWith\", {\n          name: \"New Actor Test Weapon\",\n        })}</h2>`\n      );\n      expect(actor?.items.contents[0].system.counter.value).equal(2);\n    });\n\n    it(\"rolling weapon on character rolls weapon\", async () => {\n      // Sanity checks\n      expect(game.messages?.size).equal(0);\n\n      // Setup\n      const actor = await createMockActorKey(\"character\", {}, key);\n      await createActorTestItem(actor, \"weapon\");\n      await waitForInput();\n      expect(actor?.items.size).equal(1);\n      actor?.sheet?.render(true);\n      await waitForInput();\n      await mockClickItem(\"inventory\");\n\n      // Verification\n      expect(game.messages?.size).equal(1);\n      expect(game.messages?.contents[0].content).contain(\n        `<h2>${game.i18n.format(\"OSE.roll.attacksWith\", {\n          name: \"New Actor Test Weapon\",\n        })}</h2>`\n      );\n    });\n\n    it(\"rolling spell rolls and spends the spell\", async () => {\n      // Sanity checks\n      expect(game.messages?.size).equal(0);\n\n      // Setup\n      const actor = await createMockActorKey(\"character\", {}, key);\n      await actor?.update({ system: { spells: { enabled: true } } });\n      await createActorTestItem(actor, \"spell\");\n      await waitForInput();\n      expect(actor?.items.size).equal(1);\n      actor?.sheet?.render(true);\n      await waitForInput();\n      await mockClickItem(\"spells\");\n\n      // Verification\n      expect(game.messages?.size).equal(1);\n      expect(game.messages?.contents[0].content).contain(\n        \"<h2>New Actor Test Spell</h2>\"\n      );\n    });\n\n    it(\"rolling anything else rolls the formula\", async () => {\n      // Sanity checks\n      expect(game.messages?.size).equal(0);\n\n      // Setup\n      const actor = await createMockActorKey(\"character\", {}, key);\n      await actor?.update({ system: { spells: { enabled: true } } });\n      await createActorTestItem(actor, \"ability\");\n      await waitForInput();\n      expect(actor?.items.size).equal(1);\n      await actor?.items.contents[0].update({ system: { roll: \"1d6\" } });\n      await waitForInput();\n      expect(actor?.items.contents[0].system.roll).equal(\"1d6\");\n      actor?.sheet?.render(true);\n      await waitForInput();\n      await mockClickItem(\"abilities\");\n\n      // Verification\n      expect(game.messages?.size).equal(1);\n      expect(game.messages?.contents[0].content).contain(\n        `<h2>${game.i18n.format(\"OSE.roll.formula\", {\n          label: \"New Actor Test Ability\",\n        })}</h2>`\n      );\n    });\n\n    it(\"rolling anything else, without a formula, does nothing\", async () => {\n      // Sanity checks\n      expect(game.messages?.size).equal(0);\n\n      // Setup\n      const actor = await createMockActorKey(\"character\", {}, key);\n      await actor?.update({ system: { spells: { enabled: true } } });\n      await createActorTestItem(actor, \"spell\");\n      await waitForInput();\n      expect(actor?.items.size).equal(1);\n      actor?.sheet?.render(true);\n      await waitForInput();\n      await mockClickItem(\"inventory\");\n\n      // Verification\n      expect(game.messages?.size).equal(0);\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n      await trashChat();\n    });\n  });\n\n  // @todo: Refactor to entity and just use event parsing in sheet\n  describe(\"_rollSave(event)\", () => {\n    const saves = [\"death\", \"wand\", \"paralysis\", \"breath\", \"spell\"];\n\n    // eslint-disable-next-line unicorn/consistent-function-scoping\n    const clickSave = async (save: string) => {\n      document\n        .querySelector(`li[data-save=\"${save}\"] a`)\n        ?.dispatchEvent(new MouseEvent(\"click\", { bubbles: true }));\n      await delay(220);\n    };\n\n    describe(`character can roll`, () => {\n      before(async () => {\n        const actor = await createMockActorKey(\"character\", {}, key);\n        await actor?.sheet?.render(true);\n        await game.settings.set(game.system.id, \"invertedCtrlBehavior\", true);\n        await trashChat();\n        await delay(200);\n      });\n\n      saves.forEach((save) => {\n        it(`${save} save`, async () => {\n          await trashChat();\n          await delay(200);\n          expect(game.messages?.size).equal(0);\n          await clickSave(save);\n          expect(game.messages?.size).equal(1);\n          expect(game.messages?.contents[0].content).contain(\n            game.i18n.format(\"OSE.roll.save\", {\n              save: game.i18n.localize(`OSE.saves.${save}.long`),\n            })\n          );\n        });\n      });\n\n      after(async () => {\n        await cleanUpActorsByKey(key);\n        await trashChat();\n        await delay(200);\n      });\n    });\n\n    describe(`monster can roll`, () => {\n      before(async () => {\n        const actor = await createMockActorKey(\"monster\", {}, key);\n        await actor?.sheet?.render(true);\n      });\n\n      saves.forEach((save) => {\n        it(`${save} save`, async () => {\n          await trashChat();\n          await delay(200);\n          expect(game.messages?.size).equal(0);\n          await clickSave(save);\n          expect(game.messages?.size).equal(1);\n          expect(game.messages?.contents[0].content).contain(\n            game.i18n.format(\"OSE.roll.save\", {\n              save: game.i18n.localize(`OSE.saves.${save}.long`),\n            })\n          );\n        });\n      });\n\n      after(async () => {\n        await cleanUpActorsByKey(key);\n        await trashChat();\n        await delay(200);\n      });\n    });\n  });\n\n  // @todo: Refactor to entity and just use event parsing in sheet\n  describe(\"_rollAttack(event)\", () => {\n    const attackTypeClasses = [\"melee\", \"missile\"];\n    // eslint-disable-next-line unicorn/consistent-function-scoping\n    const clickAttack = async (attack: string) => {\n      document\n        .querySelector(`li[data-attack=\"${attack}\"] a`)\n        ?.dispatchEvent(new MouseEvent(\"click\", { bubbles: true }));\n      await delay(200);\n    };\n\n    before(async () => {\n      await game.settings.set(game.system.id, \"invertedCtrlBehavior\", true);\n      const actor = await createMockActorKey(\"character\", {}, key);\n      actor?.sheet?.render(true);\n      await trashChat();\n    });\n\n    attackTypeClasses.forEach((attackClass) => {\n      it(`can attack with ${attackClass}`, async () => {\n        const actor = await getActor();\n        expect(game.messages?.size).equal(0);\n        await clickAttack(attackClass);\n        expect(game.messages?.size).equal(1);\n        expect(game.messages?.contents[0].content).contain(\n          game.i18n.format(\"OSE.roll.attacks\", { name: actor?.name })\n        );\n        await trashChat();\n      });\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n    });\n  });\n\n  /* --------------------------------------------- */\n  /* Check Test Helper functions                   */\n  /* --------------------------------------------- */\n  const dragNDropSanityChecks = (\n    documents: DragNDropDocuments,\n    items: DragNDropItems\n  ) => {\n    // Check Actor constructed properly\n    expect(documents.actor).not.undefined;\n    expect(documents.actor?.documentName).equal(\"Actor\");\n\n    // Check that the target constructed properly\n    expect(items.target.item).not.undefined;\n    expect(items.target.item?.documentName).equal(\"Item\");\n    expect(items.target.item?.name).equal(\"TargetContainer\");\n  };\n\n  const dragNDropCasePreflightCheck = (\n    sourceItemName: string,\n    items: DragNDropItems\n  ) => {\n    expect(items.source.item).not.undefined;\n    expect(items.source.item?.documentName).equal(\"Item\");\n    expect(items.source.item?.name).equal(sourceItemName);\n\n    // Check source and target data\n    expect(items.source.item?.system.containerId).equal(\"\");\n    expect(items.target.item?.system.itemIds.length).equal(0);\n  };\n\n  const dragNDropCasePostflightCheck = (\n    documents: DragNDropDocuments,\n    items: DragNDropItems\n  ) => {\n    // Check item data\n    expect(items.target.item?.system.itemIds.length).equal(1);\n    expect(items.target.item?.system.itemIds).contain(items.source.item?.id);\n    expect(items.source.item?.system.containerId).equal(items.target.item?.id);\n\n    // Check getters\n    const getter =\n      items.source.item?.type === \"armor\"\n        ? items.source.item?.type\n        : `${items.source.item?.type}s`;\n    const amount = getter === \"containers\" ? 1 : 0;\n    expect(documents.actor?.system[getter].length).equal(amount);\n  };\n\n  // @todo: Refactor to entity and just use event parsing in sheet\n  describe(\"_onContainerItemAdd(item, target)\", () => {\n    /* --------------------------------------------- */\n    /* Loop over item types                          */\n    /* --------------------------------------------- */\n    itemTypes.forEach((itemType) => {\n      // Skip items that can't be put in a container\n      if (itemType === \"spell\") return;\n      if (itemType === \"ability\") return;\n\n      const documents: DragNDropDocuments = {} as DragNDropDocuments;\n      const items: DragNDropItems = {\n        source: {} as DragNDropItem,\n        target: {} as DragNDropItem,\n      } as DragNDropItems;\n\n      before(async () => {\n        documents.actor = await createMockActorKey(\"character\", {}, key);\n\n        // Create target container\n        [items.target.item] = await createActorTestItem(\n          documents.actor,\n          \"container\",\n          \"TargetContainer\"\n        );\n      });\n\n      it(`add ${itemType} to container`, async () => {\n        dragNDropSanityChecks(documents, items);\n\n        // Create source item\n        [items.source.item] = await createActorTestItem(\n          documents.actor,\n          itemType\n        );\n\n        // Perform pre-flight checks\n        const sourceItemName = `New Actor Test ${itemType.capitalize()}`;\n        dragNDropCasePreflightCheck(sourceItemName, items);\n\n        // Perform operation\n        // eslint-disable-next-line no-underscore-dangle\n        await documents.actor?.sheet?._onContainerItemAdd(\n          items.source.item,\n          items.target.item\n        );\n\n        // Perform post-flight checks\n        dragNDropCasePostflightCheck(documents, items);\n      });\n\n      after(async () => {\n        await cleanUpActorsByKey(key);\n      });\n    });\n  });\n\n  // @todo: Refactor to entity and just use event parsing in sheet\n  describe(\"_onContainerItemRemove(item, container)\", () => {\n    /* --------------------------------------------- */\n    /* Loop over item types                          */\n    /* --------------------------------------------- */\n    itemTypes.forEach((itemType) => {\n      // Skip items that can't be put in a container\n      if (itemType === \"spell\") return;\n      if (itemType === \"ability\") return;\n\n      const documents: DragNDropDocuments = {} as DragNDropDocuments;\n      const items: DragNDropItems = {\n        source: {} as DragNDropItem,\n        target: {} as DragNDropItem,\n      } as DragNDropItems;\n\n      before(async () => {\n        documents.actor = await createMockActorKey(\"character\", {}, key);\n\n        // Create target container\n        [items.target.item] = await createActorTestItem(\n          documents.actor,\n          \"container\",\n          \"TargetContainer\"\n        );\n\n        // Create source item\n        [items.source.item] = await createActorTestItem(\n          documents.actor,\n          itemType\n        );\n\n        // Perform operation\n        // eslint-disable-next-line no-underscore-dangle\n        await documents.actor?.sheet?._onContainerItemAdd(\n          items.source.item,\n          items.target.item\n        );\n      });\n\n      it(`remove ${itemType} from container`, async () => {\n        // Perform pre-flight checks\n        dragNDropCasePostflightCheck(documents, items);\n\n        // Perform operation\n        // eslint-disable-next-line no-underscore-dangle\n        await documents.actor?.sheet?._onContainerItemRemove(\n          items.source.item,\n          items.target.item\n        );\n\n        // Perform pre-flight checks\n        const sourceItemName = `New Actor Test ${itemType.capitalize()}`;\n        dragNDropCasePreflightCheck(sourceItemName, items);\n      });\n\n      after(async () => {\n        await cleanUpActorsByKey(key);\n      });\n    });\n  });\n\n  // @todo: Refactor to entity and just use event parsing in sheet\n  describe(\"_onDropItemCreate(droppedItem, targetContainer)\", () => {\n    /* --------------------------------------------- */\n    /* Loop over item types                          */\n    /* --------------------------------------------- */\n    itemTypes.forEach((itemType) => {\n      // Skip items that can't be put in a container\n      if (itemType === \"spell\") return;\n      if (itemType === \"ability\") return;\n\n      const documents: DragNDropDocuments = {} as DragNDropDocuments;\n      const items: DragNDropItems = {\n        source: {} as DragNDropItem,\n        target: {} as DragNDropItem,\n      } as DragNDropItems;\n\n      before(async () => {\n        documents.actor = await createMockActorKey(\"character\", {}, key);\n      });\n\n      it(`add non-actor ${itemType} to sheet`, async () => {\n        // Create item in sidebar\n        items.source.item = (await createWorldTestItem(itemType)) as OseItem;\n        const sourceItemName = items.source.item.name || \"test\";\n\n        // eslint-disable-next-line no-underscore-dangle\n        await documents.actor?.sheet?._onDropItemCreate([items.source.item]);\n\n        // Store new item as it recreates in the character sheet\n        items.source.item = documents.actor?.items.getName(\n          sourceItemName\n        ) as OseItem;\n\n        expect(items.source.item).not.undefined;\n      });\n\n      after(async () => {\n        await cleanUpActorsByKey(key);\n      });\n    });\n  });\n\n  describe(\"_chooseItemType(choices)\", () => {\n    const defaultChoices = [\"weapon\", \"armor\", \"shield\", \"gear\"];\n\n    it(\"can create standard dialog\", async () => {\n      const actor = await createMockActorKey(\"monster\", {}, key);\n      // eslint-disable-next-line no-underscore-dangle\n      actor?.sheet?._chooseItemType();\n      await waitForInput();\n\n      const dialogs = openV2Dialogs();\n      expect(dialogs.length).equal(1);\n\n      defaultChoices.forEach((choice) => {\n        expect(dialogs[0]?.element.querySelector(`option[value=\"${choice}\"]`))\n          .is.not.null;\n      });\n      await dialogs[0]?.close();\n    });\n\n    it(\"can create custom dialog\", async () => {\n      const customChoices = [\"test\", \"test2\", \"test3\"];\n      const actor = (await createMockActorKey(\"monster\", {}, key)) as OseActor;\n      // eslint-disable-next-line no-underscore-dangle\n      actor?.sheet?._chooseItemType(customChoices);\n      await waitForInput();\n\n      const dialogs = openV2Dialogs();\n      expect(dialogs.length).equal(1);\n\n      customChoices.forEach((choice) => {\n        expect(dialogs[0]?.element.querySelector(`option[value=\"${choice}\"]`))\n          .is.not.null;\n      });\n      await dialogs[0]?.close();\n    });\n\n    afterEach(async () => {\n      await closeV2Dialogs();\n      await cleanUpActorsByKey(key);\n    });\n  });\n\n  // @todo: Refactor to entity and just use event parsing in sheet\n  describe(\"_createItem(event)\", () => {\n    for (const itemType of itemTypes) {\n      it(`can create ${itemType}`, async () => {\n        const actor = await createMockActorKey(\"character\", {}, key);\n        await actor?.update({ system: { spells: { enabled: true } } });\n        await actor?.sheet?.render(true);\n        await delay(200);\n        expect(actor?.items.size).equal(0);\n\n        let selector = `.sheet .item-create[data-type=\"${itemType}\"]`;\n        // Treasure is also an item, so we need to use a different selector\n        if (itemType === \"item\") {\n          selector += `:not([data-treasure=\"true\"]`;\n        } else if (itemType === \"treasure\") {\n          selector = `.sheet .item-create[data-type=\"item\"][data-treasure=\"true\"]`;\n        }\n        document\n          .querySelector(selector)\n          ?.dispatchEvent(new MouseEvent(\"click\", { bubbles: true }));\n        await waitForInput();\n\n        expect(actor?.items.size).equal(1);\n        const item: OseItem = actor?.items.contents[0];\n        expect(item).not.undefined;\n        expect(item?.type).equal(itemType);\n      });\n    }\n\n    afterEach(async () => {\n      await cleanUpActorsByKey(key);\n      await waitForInput();\n    });\n  });\n\n  // @todo: Refactor to entity and just use event parsing in sheet\n  describe(\"_updateItemQuantity(event)\", () => {\n    const updateQuantity = (element: HTMLInputElement, modifier: number) => {\n      // eslint-disable-next-line no-param-reassign\n      element.value = String(parseInt(element.value, 10) + modifier);\n      const event = new InputEvent(\"change\");\n      element.dispatchEvent(event);\n    };\n\n    it(\"can add to the quantity\", async () => {\n      const actor = await createMockActorKey(\"character\", {}, key);\n      actor?.sheet?.render(true);\n      const [item] = (await createActorTestItem(\n        actor,\n        \"item\"\n      )) as unknown as OseItem;\n      await item.update({ system: { quantity: { value: 2, max: 4 } } });\n      await waitForInput();\n\n      const quantityElement = document.querySelector(\n        `.sheet .item[data-item-id=\"${item.id}\"] input[data-field=\"value\"]`\n      ) as HTMLInputElement;\n\n      expect(item.system.quantity.value).equal(2);\n      updateQuantity(quantityElement, 1);\n      await waitForInput();\n      expect(item.system.quantity.value).equal(3);\n    });\n\n    it(\"can subtract from the quantity\", async () => {\n      const actor = await createMockActorKey(\"character\", {}, key);\n      actor?.sheet?.render(true);\n      const [item] = (await createActorTestItem(\n        actor,\n        \"item\"\n      )) as unknown as OseItem;\n      await item.update({ system: { quantity: { value: 2, max: 4 } } });\n      await waitForInput();\n\n      const quantityElement = document.querySelector(\n        `.sheet .item[data-item-id=\"${item.id}\"] input[data-field=\"value\"]`\n      ) as HTMLInputElement;\n\n      expect(item.system.quantity.value).equal(2);\n      updateQuantity(quantityElement, -1);\n      await waitForInput();\n      expect(item.system.quantity.value).equal(1);\n    });\n\n    afterEach(async () => {\n      await cleanUpActorsByKey(key);\n      await delay(300);\n    });\n  });\n\n  // @todo: How to test?\n  describe(\"_renderInner(...args)\", () => {});\n  // @todo: How to test?\n  describe(\"_onResize(event)\", () => {});\n\n  describe(\"_onConfigureActor(event)\", () => {\n    for (const actorType of [\"character\", \"monster\"]) {\n      it(`Entity Tweaks renders for ${actorType}`, async () => {\n        const actor = await createMockActorKey(actorType, {}, `${key} ${actorType}`);\n        await actor?.sheet?.render(true);\n        // Wait for sheet to render - the header buttons are not available for the first 500ms\n        await delay(600);\n\n        document\n          .querySelector(\n            `#OseActorSheet${actorType.capitalize()}-Actor-${actor?.id} .configure-actor`\n          )\n          ?.dispatchEvent(new MouseEvent(\"click\", { bubbles: true }));\n        await waitForInput();\n\n        const windows = openWindows(\"sheet-tweaks\");\n        const w = windows.filter(\n          (win) => win.object?.name === `Test Actor ${key} ${actorType}`\n        );\n        expect(w.length).equal(1);\n        const windowElement = w?.[0]?.element?.[0];\n        expect(windowElement).not.undefined;\n        expect(\n          windowElement.querySelector(\"h4.window-title\").innerHTML\n        ).to.include(`Test Actor ${key} ${actorType}`);\n        // eslint-disable-next-line no-restricted-syntax\n        await w?.[0]?.close();\n        await actor?.delete();\n      });\n    }\n  });\n\n  // @todo: How to test?\n  describe(\"_getHeaderButtons()\", () => {});\n};\n","/**\n * @file Contains tests for dragging and dropping items to and from Actor Sheet.\n */\n// eslint-disable-next-line prettier/prettier\nimport { QuenchMethods } from \"../../../../e2e\";\nimport {\n  cleanUpActorsByKey,\n  cleanUpCompendium,\n  cleanUpWorldItems,\n  createActorTestItem,\n  createMockActorKey,\n  createMockCompendium,\n  createWorldTestItem,\n  itemTypes,\n  waitForInput, // eslint-disable-next-line prettier/prettier\n} from \"../../../../e2e/testUtils\";\nimport OseItem from \"../../../item/entity\";\nimport OseActor from \"../../entity\";\n\nexport const key = \"ose.actor.sheet.e2e.dragndrop\";\nexport const options = {\n  displayName: \"OSE: Actor: Sheet E2E Drag'n'Drop\",\n  preSelected: true,\n};\n\n/* --------------------------------------------- */\n/* Types for storing data between tests          */\n/* --------------------------------------------- */\ntype DragNDropItem = {\n  item: OseItem | undefined;\n  itemElement: Element | null;\n};\n\ntype DragNDropItems = {\n  source: DragNDropItem;\n  target: DragNDropItem;\n};\n\ntype DragNDropDocuments = {\n  actor: StoredDocument<Actor> | undefined;\n  compendium: CompendiumCollection<any> | undefined;\n};\n\n/* --------------------------------------------- */\n/* DOM Manipulation Helper functions             */\n/* --------------------------------------------- */\nconst executeDrag = (sourceElement: Element | null) => {\n  const mockDragStartEvent = new DragEvent(\"dragstart\", {\n    dataTransfer: new DataTransfer(),\n    bubbles: true,\n    cancelable: true,\n  });\n  sourceElement?.dispatchEvent(mockDragStartEvent);\n  return mockDragStartEvent;\n};\n\nconst executeDragNDrop = async (items: DragNDropItems) => {\n  const mockDragStartEvent = new DragEvent(\"dragstart\", {\n    dataTransfer: new DataTransfer(),\n    bubbles: true,\n    cancelable: true,\n  });\n  items.source.itemElement?.dispatchEvent(mockDragStartEvent);\n\n  const mockDropEvent = new DragEvent(\"drop\", {\n    dataTransfer: mockDragStartEvent.dataTransfer,\n    bubbles: true,\n    cancelable: true,\n  });\n  items.target.itemElement?.dispatchEvent(mockDropEvent);\n};\n\nexport default ({\n  describe,\n  it,\n  expect,\n  after,\n  afterEach,\n  beforeEach,\n}: QuenchMethods) => {\n  describe(\"_onDragStart(event)\", () => {\n    it(\"populates dataTransfer correctly\", async () => {\n      const actor = (await createMockActorKey(\n        \"character\",\n        {},\n        key\n      )) as OseActor;\n      expect(actor).not.undefined;\n\n      await actor.sheet?.render(true);\n\n      const [item] = await createActorTestItem(actor, \"weapon\");\n      expect(item).not.undefined;\n      await waitForInput();\n\n      const itemElement = document.querySelector(\n        `.sheet .inventory li.item[data-item-id=\"${item?.id}\"]`\n      );\n      expect(itemElement).not.null;\n\n      const event = executeDrag(itemElement);\n      const parsedData = foundry.applications.ux.TextEditor.implementation.getDragEventData(event);\n      expect(Object.keys(parsedData)).contain(\"item\");\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n    });\n  });\n\n  // This is tested in the combined _onDragStart & _onDrop test\n  describe(\"_onDropItem(event, data)\", () => {});\n\n  describe(\"_onDragStart(event, data) & _onDrop(event, data) - Containers\", () => {\n    /* --------------------------------------------- */\n    /* Check Test Helper functions                   */\n    /* --------------------------------------------- */\n    const dragNDropSanityChecks = (\n      documents: DragNDropDocuments,\n      items: DragNDropItems\n    ) => {\n      // Check Actor constructed properly\n      expect(documents.actor).not.undefined;\n      expect(documents.actor?.documentName).equal(\"Actor\");\n\n      // Check Compendium constructed properly\n      expect(documents.compendium).not.undefined;\n      expect(documents.compendium?.documentName).equal(\"Item\");\n\n      // Check that the target constructed properly\n      expect(items.target.item).not.undefined;\n      expect(items.target.item?.documentName).equal(\"Item\");\n      expect(items.target.item?.name).equal(\"TargetContainer\");\n\n      // Check the target DOM is stored correctly\n      expect(items.target.itemElement).not.null;\n      expect(items.target.itemElement?.constructor.name).equal(\"HTMLLIElement\");\n    };\n\n    const dragNDropCasePreflightCheck = (\n      sourceItemName: string,\n      items: DragNDropItems\n    ) => {\n      expect(items.source.item).not.undefined;\n      expect(items.source.item?.documentName).equal(\"Item\");\n      expect(items.source.item?.name).equal(sourceItemName);\n\n      expect(items.source.itemElement).not.null;\n      expect(items.source.itemElement?.constructor.name).equal(\"HTMLLIElement\");\n\n      // Check source and target data\n      expect(items.source.item?.system.containerId).equal(\"\");\n      expect(items.target.item?.system.itemIds.length).equal(0);\n    };\n\n    const dragNDropCasePostflightCheck = (\n      documents: DragNDropDocuments,\n      items: DragNDropItems\n    ) => {\n      // Check item data\n      expect(items.target.item?.system.itemIds.length).equal(1);\n      expect(items.target.item?.system.itemIds).contain(items.source.item?.id);\n      expect(items.source.item?.system.containerId).equal(\n        items.target.item?.id\n      );\n\n      // Check getters\n      const getter =\n        items.source.item?.type === \"armor\"\n          ? items.source.item?.type\n          : `${items.source.item?.type}s`;\n      const amount = getter === \"containers\" ? 1 : 0;\n      expect(documents.actor?.system[getter].length).equal(amount);\n    };\n\n    /* --------------------------------------------- */\n    /* Specific cases                                */\n    /* --------------------------------------------- */\n    // Issue#357\n    it(\"Issue#357 Dragging container onto itself should retain container in inventory\", async () => {\n      const items: DragNDropItems = {\n        source: {} as DragNDropItem,\n        target: {} as DragNDropItem,\n      } as DragNDropItems;\n\n      // Setup actor & items\n      const actor = await createMockActorKey(\"character\", {}, key);\n      [items.target.item] = await createActorTestItem(\n        actor,\n        \"container\",\n        \"TargetContainer\"\n      );\n      [items.source.item] = await createActorTestItem(actor, \"weapon\");\n\n      // Render UI elements\n      actor?.sheet?.render(true);\n      await waitForInput();\n\n      // Set the DOM elements\n      items.source.itemElement = document.querySelector(\n        `.sheet .inventory li.item[data-item-id=\"${items.source?.item?.id}\"]`\n      );\n      items.target.itemElement = document.querySelector(\n        `.sheet .inventory li.item[data-item-id=\"${items.target?.item?.id}\"]`\n      );\n\n      // Execute drag'n'drop of stored item\n      dragNDropCasePreflightCheck(\"New Actor Test Weapon\", items);\n      await executeDragNDrop(items);\n      await waitForInput();\n\n      // Check items\n      expect(items.target.item?.system.itemIds.length).equal(1);\n      expect(items.target.item?.system.itemIds).contain(items.source.item?.id);\n      expect(items.source.item?.system.containerId).equal(\n        items.target.item?.id\n      );\n\n      // Re-form the source item to use the target container\n      items.source.itemElement = items.target.itemElement;\n      items.source.item = items.target.item;\n\n      // Execute drag'n'drop again\n      await executeDragNDrop(items);\n      await waitForInput();\n\n      // Verify that the target container is still present\n      const finalElement = document.querySelector(\n        `.sheet .inventory li.item[data-item-id=\"${items.target?.item?.id}\"]`\n      );\n      expect(finalElement).not.null;\n    });\n\n    /* --------------------------------------------- */\n    /* Loop over item types                          */\n    /* --------------------------------------------- */\n    for (const itemType of itemTypes) {\n      // Skip items that can't be put in a container\n      if (itemType === \"spell\") continue;\n      if (itemType === \"ability\") continue;\n\n      // Initiate storage of actor, items, and DOM elements\n      const documents: DragNDropDocuments = {} as DragNDropDocuments;\n      const items: DragNDropItems = {\n        source: {} as DragNDropItem,\n        target: {} as DragNDropItem,\n      } as DragNDropItems;\n\n      describe(`manipulating ${itemType} item type`, () => {\n        beforeEach(async () => {\n          await cleanUpActorsByKey(key);\n          await cleanUpCompendium();\n          await cleanUpWorldItems();\n          await waitForInput(); // Wait for cleanup to complete\n\n          // Set up actor & compendium\n          documents.actor = await createMockActorKey(\"character\", {}, key);\n          documents.compendium = await createMockCompendium(\"Item\");\n\n          // Create target container\n          [items.target.item] = await createActorTestItem(\n            documents.actor,\n            \"container\",\n            \"TargetContainer\"\n          );\n\n          // Render UI elements\n          documents.actor?.sheet?.render(true);\n          documents.compendium?.render(true);\n          await waitForInput();\n          document\n            .querySelector(\n              `#OseActorSheetCharacter-Actor-${documents.actor.id} nav.sheet-tabs a[data-tab=\"inventory\"]`\n            )\n            ?.click();\n          await waitForInput();\n\n          // Record Target DOM\n          items.target.itemElement = document.querySelector(\n            `#OseActorSheetCharacter-Actor-${documents.actor.id} .inventory li.item[data-item-id=\"${items.target.item?.id}\"]`\n          );\n        });\n\n        it(`drag ${itemType} from actor sheet into a container in a character sheet`, async () => {\n          dragNDropSanityChecks(documents, items);\n\n          // Create item in actor sheet\n          [items.source.item] = await createActorTestItem(\n            documents.actor,\n            itemType\n          );\n\n          // Wait for UI to keep up\n          await waitForInput();\n\n          // Create DOM element\n          items.source.itemElement = document.querySelector(\n            `#OseActorSheetCharacter-Actor-${documents.actor.id} .inventory li.item[data-item-id=\"${items.source.item?.id}\"]`\n          );\n\n          if (!items.target.itemElement?.isConnected) {\n            // Reallocate the target item element\n            items.target.itemElement = document.querySelector(\n              `#OseActorSheetCharacter-Actor-${documents.actor.id} .inventory li.item[data-item-id=\"${items.target.item?.id}\"]`\n            );\n          }\n\n          // Perform pre-flight checks\n          const sourceItemName = `New Actor Test ${itemType.capitalize()}`;\n          dragNDropCasePreflightCheck(sourceItemName, items);\n\n          // Drag N Drop\n          await executeDragNDrop(items);\n          await waitForInput();\n\n          // Perform post-flight checks\n          dragNDropCasePostflightCheck(documents, items);\n        });\n\n        it(`drag ${itemType} from item sidebar into a container in a character sheet`, async () => {\n          dragNDropSanityChecks(documents, items);\n\n          // Create item in sidebar\n          items.source.item = (await createWorldTestItem(itemType)) as OseItem;\n\n          // Wait for UI to keep up\n          await waitForInput();\n\n          // Create DOM element\n          items.source.itemElement = document.querySelector(\n            `#items li.item[data-entry-id=\"${items.source.item?.id}\"]`\n          );\n\n          // Perform pre-flight checks\n          const sourceItemName = `New World Test ${itemType.capitalize()}`;\n          dragNDropCasePreflightCheck(sourceItemName, items);\n\n          // Drag N Drop\n          await executeDragNDrop(items);\n          await waitForInput();\n\n          // Store new item as it recreates in the character sheet\n          items.source.item = documents.actor?.items.getName(\n            items.source.item?.name\n          ) as OseItem;\n\n          // Perform post-flight checks\n          dragNDropCasePostflightCheck(documents, items);\n        });\n\n        it(`drag ${itemType} from compendium into a container in a character sheet`, async () => {\n          dragNDropSanityChecks(documents, items);\n\n          // Create item in compendium\n          const worldItem = (await createWorldTestItem(itemType)) as OseItem;\n          items.source.item = await documents.compendium?.importDocument(\n            worldItem\n          );\n\n          // Wait for UI to keep up\n          await waitForInput();\n\n          // Create DOM element\n          items.source.itemElement = document.querySelector(\n            `.compendium-directory li.item[data-entry-id=\"${items.source.item?.id}\"]`\n          );\n\n          // Perform pre-flight checks\n          const sourceItemName = `New World Test ${itemType.capitalize()}`;\n          dragNDropCasePreflightCheck(sourceItemName, items);\n\n          // Drag N Drop\n          await executeDragNDrop(items);\n          await waitForInput();\n\n          // Store new item as it recreates in the character sheet\n          items.source.item = documents.actor?.items.getName(\n            items.source.item?.name\n          ) as OseItem;\n\n          // Perform post-flight checks\n          dragNDropCasePostflightCheck(documents, items);\n        });\n\n        after(async () => {\n          await cleanUpActorsByKey(key);\n          await cleanUpCompendium();\n          await cleanUpWorldItems();\n          await waitForInput(); // Wait for cleanup to complete\n        });\n      });\n    }\n  });\n};\n","/**\n * @file Contains tests for Character Sheet.\n */\n// eslint-disable-next-line import/no-cycle\nimport { QuenchMethods } from \"../../../e2e\";\nimport {\n  cleanUpActorsByKey,\n  closeDialogs,\n  closeSheets,\n  closeV2Dialogs,\n  createMockActorKey,\n  delay,\n  openDialogs,\n  openV2Dialogs,\n  openWindows,\n  trashChat,\n  waitForInput,\n} from \"../../../e2e/testUtils\";\nimport OseActorSheetCharacter from \"../character-sheet\";\n\nexport const key = \"ose.actor.sheet.character\";\nexport const options = { displayName: \"OSE: Actor: Sheet: Character\" };\n\nexport default ({ describe, it, expect, after, afterEach }: QuenchMethods) => {\n  after(async () => {\n    await cleanUpActorsByKey(key);\n    await closeSheets();\n  });\n\n  describe(\"defaultOptions()\", () => {\n    it(\"Has correctly set defaultOptions\", async () => {\n      const actor = await createMockActorKey(\"character\", {}, key);\n      const sheet = actor?.sheet as unknown as OseActorSheetCharacter;\n\n      expect(sheet.options.classes).contain(\"ose\");\n      expect(sheet.options.classes).contain(\"sheet\");\n      expect(sheet.options.classes).contain(\"actor\");\n      expect(sheet.options.classes).contain(\"character\");\n\n      expect(sheet.options.template).contain(\n        \"/templates/actors/character-sheet.html\"\n      );\n      expect(sheet.options.width).equal(450);\n      expect(sheet.options.height).equal(530);\n      expect(sheet.options.resizable).is.true;\n\n      expect(sheet.options.tabs.length).equal(1);\n      expect(Object.keys(sheet.options.tabs[0])).contain(\"navSelector\");\n      expect(sheet.options.tabs[0].navSelector).equal(\".sheet-tabs\");\n      expect(Object.keys(sheet.options.tabs[0])).contain(\"contentSelector\");\n      expect(sheet.options.tabs[0].contentSelector).equal(\".sheet-body\");\n      expect(Object.keys(sheet.options.tabs[0])).contain(\"initial\");\n      expect(sheet.options.tabs[0].initial).equal(\"attributes\");\n\n      expect(sheet.options.scrollY.length).equal(1);\n      expect(sheet.options.scrollY[0]).equal(\".inventory\");\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n    });\n  });\n\n  // @todo: Do we need separate test sfor this, or is getData() enough?\n  describe(\"_prepareItems(data)\", () => {});\n\n  // @todo: this is not tested separately as a dialog, should we test it more?\n  describe(\"generateScores()\", () => {\n    const scores = {\n      str: 0,\n      int: 0,\n      dex: 0,\n      wis: 0,\n      con: 0,\n      cha: 0,\n    };\n\n    it(\"renders the character creator\", async () => {\n      const actor = await createMockActorKey(\"character\", {}, key);\n      const sheet = actor?.sheet as unknown as OseActorSheetCharacter;\n\n      sheet.generateScores();\n      await waitForInput();\n\n      const windows = openWindows(\"creator\");\n      expect(windows.length).equal(1);\n\n      for (const window of windows) {\n        await window.close();\n      }\n    });\n\n    it(\"clicking on the dices generates scores\", async () => {\n      const actor = await createMockActorKey(\"character\", {}, key);\n      const sheet = actor?.sheet as unknown as OseActorSheetCharacter;\n\n      sheet.generateScores();\n      await delay(400);\n\n      const windows = openWindows(\"creator\");\n      expect(windows.length).equal(1);\n\n      Object.keys(scores).forEach(async (score) => {\n        $(`.creator div[data-score=\"${score}\"] a.score-roll`).trigger(\"click\");\n        await waitForInput();\n\n        const scoreValue = document.querySelector(\n          `.creator div[data-score=\"${score}\"] input.score-value`\n        );\n        const { value } = scoreValue;\n        expect(parseInt(value, 10) > 0).equal(true);\n      });\n\n      for (const window of windows) {\n        await window.close();\n      }\n    });\n\n    // @todo: this needs fixing\n    it(\"saving scores records data to actor\", async () => {\n      const actor = await createMockActorKey(\"character\", {}, key);\n      const sheet = actor?.sheet as unknown as OseActorSheetCharacter;\n\n      sheet.generateScores();\n      await delay(400);\n\n      const windows = openWindows(\"creator\");\n      expect(windows.length).equal(1);\n\n      for (const score of Object.keys(scores)) {\n        $(`.creator div[data-score=\"${score}\"] a.score-roll`).trigger(\"click\");\n        await waitForInput();\n\n        const scoreValue = document.querySelector(\n          `.creator div[data-score=\"${score}\"] input.score-value`\n        );\n        const { value } = scoreValue;\n        expect(parseInt(value, 10) > 0).equal(true);\n        scores[score] = parseInt(value, 10);\n      }\n\n      $(`.creator footer button`).trigger(\"submit\");\n      await waitForInput();\n\n      expect(actor?.system.scores.str.value).equal(scores.str);\n      expect(actor?.system.scores.dex.value).equal(scores.dex);\n      expect(actor?.system.scores.wis.value).equal(scores.wis);\n      expect(actor?.system.scores.int.value).equal(scores.int);\n      expect(actor?.system.scores.con.value).equal(scores.con);\n      expect(actor?.system.scores.cha.value).equal(scores.cha);\n    });\n\n    // @todo: Auto-roll testing\n    // @todo: Gold rolling testing\n\n    afterEach(async () => {\n      // Don't delete actors or close windows in bulk, as it interferes with the\n      // tests still running.\n      await trashChat();\n      await delay(300);\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n    });\n  });\n\n  describe(\"getData()\", () => {\n    it(\"returns the expected data\", async () => {\n      const actor = await createMockActorKey(\"character\", {}, key);\n      const data = await actor?.sheet?.getData();\n\n      expect(Object.keys(data)).contain(\"enrichedBiography\");\n      expect(Object.keys(data)).contain(\"enrichedNotes\");\n\n      // _prepareItems tests\n      expect(Object.keys(data)).contain(\"owned\");\n      expect(Object.keys(data?.owned)).contain(\"weapons\");\n      expect(Object.keys(data?.owned)).contain(\"items\");\n      expect(Object.keys(data?.owned)).contain(\"containers\");\n      expect(Object.keys(data?.owned)).contain(\"armors\");\n      expect(Object.keys(data?.owned)).contain(\"treasures\");\n      expect(Object.keys(data)).contain(\"containers\");\n      expect(Object.keys(data)).contain(\"abilities\");\n      expect(Object.keys(data)).contain(\"spells\");\n      expect(Object.keys(data)).contain(\"slots\");\n      expect(Object.keys(data)).contain(\"system\");\n      expect(Object.keys(data?.system)).contain(\"usesAscendingAC\");\n      expect(Object.keys(data?.system)).contain(\"meleeMod\");\n      expect(Object.keys(data?.system)).contain(\"rangedMod\");\n      expect(Object.keys(data?.system)).contain(\"init\");\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n    });\n  });\n\n  describe(\"_chooseLang()\", () => {\n    it(\"renders a dialog\", async () => {\n      const actor = await createMockActorKey(\"character\", {}, key);\n      // eslint-disable-next-line no-underscore-dangle\n      actor?.sheet?._chooseLang();\n      await waitForInput();\n\n      const dialogs = openV2Dialogs();\n      expect(dialogs.length).equal(1);\n      dialogs[0].close();\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n      await closeV2Dialogs();\n      await delay(300);\n    });\n  });\n\n  describe(\"_pushLang(table)\", () => {\n    const table = \"languages\";\n\n    it(\"renders a dialog\", async () => {\n      const actor = await createMockActorKey(\"character\", {}, key);\n      // eslint-disable-next-line no-underscore-dangle\n      actor?.sheet?._pushLang(table);\n      await waitForInput();\n\n      const dialogs = openV2Dialogs();\n      expect(dialogs.length).equal(1);\n      dialogs[0].close();\n    });\n\n    it(\"adds language on OK\", async () => {\n      const actor = await createMockActorKey(\"character\", {}, key);\n      // eslint-disable-next-line no-underscore-dangle\n      actor?.sheet?._pushLang(table);\n      await delay(220);\n\n      $(`button[data-action=\"ok\"]`).trigger(\"click\");\n      await delay(500);\n\n      const dialogs = openV2Dialogs();\n      expect(dialogs.length).equal(0);\n\n      expect(actor?.system.languages.value.length).equal(1);\n      expect(actor?.system.languages.value[0]).equal(\"Common\");\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n      await closeV2Dialogs();\n    });\n  });\n\n  describe(\"_popLang(table, lang)\", () => {\n    const table = \"languages\";\n\n    it(\"can remove added language\", async () => {\n      const actor = await createMockActorKey(\"character\", {}, key);\n      await actor?.update({ \"system.languages.value\": [\"Common\"] });\n      await waitForInput();\n\n      expect(actor?.system.languages.value.length).equal(1);\n      expect(actor?.system.languages.value[0]).equal(\"Common\");\n\n      // eslint-disable-next-line no-underscore-dangle\n      actor?.sheet?._popLang(table, \"Common\");\n      await waitForInput();\n\n      expect(actor?.system.languages.value.length).equal(0);\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n    });\n  });\n\n  describe(\"_onShowModifiers(event)\", () => {\n    it(\"renders a dialog\", async () => {\n      const actor = await createMockActorKey(\"character\", {}, key);\n      await actor?.update({\n        system: {\n          scores: {\n            str: { value: 10 },\n            dex: { value: 10 },\n            int: { value: 10 },\n            con: { value: 10 },\n            wis: { value: 10 },\n            cha: { value: 10 },\n          },\n        },\n      });\n      actor?.sheet?.render(true);\n      await waitForInput();\n\n      $(`.sheet .profile a[data-action=\"modifiers\"]`).trigger(\"click\");\n      await delay(200);\n\n      const dialogs = openDialogs();\n      expect(dialogs.length).equal(1);\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n      await closeDialogs();\n      await delay(400);\n    });\n  });\n\n  describe(\"_onShowGpCost(event, preparedData)\", () => {\n    it(\"renders a dialog\", async () => {\n      const actor = await createMockActorKey(\"character\", {}, key);\n      await actor?.update({\n        system: {\n          scores: {\n            str: { value: 10 },\n            dex: { value: 10 },\n            int: { value: 10 },\n            con: { value: 10 },\n            wis: { value: 10 },\n            cha: { value: 10 },\n          },\n        },\n      });\n      actor?.sheet?.render(true);\n      await waitForInput();\n\n      $(`.sheet .profile a[data-action=\"gp-cost\"]`).trigger(\"click\");\n      await delay(200);\n\n      const dialogs = openDialogs();\n      expect(dialogs.length).equal(1);\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n      await closeDialogs();\n      await delay(400);\n    });\n  });\n\n  // @todo: This seems unfinished\n  describe(\"_onShowItemTooltip(event)\", () => {});\n};\n","/**\n * @file Contains tests for Monster Sheet.\n */\n// eslint-disable-next-line import/no-cycle\nimport { QuenchMethods } from \"../../../e2e\";\nimport {\n  cleanUpActorsByKey,\n  closeSheets,\n  closeV2Dialogs,\n  createActorTestItem,\n  createMockActorKey,\n  delay,\n  getMockActorKey,\n  openV2Dialogs,\n  waitForInput,\n} from \"../../../e2e/testUtils\";\nimport OseActorSheetMonster from \"../monster-sheet\";\n\nexport const key = \"ose.actor.sheet.monster\";\nexport const options = { displayName: \"OSE: Actor: Sheet: Monster\" };\n\nexport default ({ describe, it, expect, after, before }: QuenchMethods) => {\n  const orginalCtrlSetting = game.settings.get(\n    game.system.id,\n    \"invertedCtrlBehavior\"\n  );\n\n  after(async () => {\n    await game.settings.set(\n      game.system.id,\n      \"invertedCtrlBehavior\",\n      orginalCtrlSetting\n    );\n    await cleanUpActorsByKey(key);\n    await closeSheets();\n  });\n\n  describe(\"defaultOptions()\", () => {\n    it(\"Has correctly set defaultOptions\", async () => {\n      const actor = await createMockActorKey(\"monster\", {}, key);\n      const sheet = actor?.sheet as unknown as OseActorSheetMonster;\n\n      expect(sheet.options.classes).contain(\"ose\");\n      expect(sheet.options.classes).contain(\"sheet\");\n      expect(sheet.options.classes).contain(\"actor\");\n      expect(sheet.options.classes).contain(\"monster\");\n\n      expect(sheet.options.template).contain(\n        \"/templates/actors/monster-sheet.html\"\n      );\n      expect(sheet.options.width).equal(450);\n      expect(sheet.options.height).equal(560);\n      expect(sheet.options.resizable).is.true;\n\n      expect(sheet.options.tabs.length).equal(1);\n      expect(Object.keys(sheet.options.tabs[0])).contain(\"navSelector\");\n      expect(sheet.options.tabs[0].navSelector).equal(\".tabs\");\n      expect(Object.keys(sheet.options.tabs[0])).contain(\"contentSelector\");\n      expect(sheet.options.tabs[0].contentSelector).equal(\".sheet-body\");\n      expect(Object.keys(sheet.options.tabs[0])).contain(\"initial\");\n      expect(sheet.options.tabs[0].initial).equal(\"attributes\");\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n    });\n  });\n\n  // @todo: Do we need separate tests for this, or is getData() enough?\n  describe(\"_prepareItems(data)\", () => {});\n\n  describe(\"getData()\", () => {\n    it(\"returns the expected data\", async () => {\n      const actor = await createMockActorKey(\"monster\", {}, key);\n      const data = await actor?.sheet?.getData();\n\n      // _prepareItems tests\n      expect(Object.keys(data)).contain(\"owned\");\n      expect(Object.keys(data?.owned)).contain(\"weapons\");\n      expect(Object.keys(data?.owned)).contain(\"items\");\n      expect(Object.keys(data?.owned)).contain(\"containers\");\n      expect(Object.keys(data?.owned)).contain(\"armors\");\n      expect(Object.keys(data?.owned)).contain(\"treasures\");\n      expect(Object.keys(data)).contain(\"attackPatterns\");\n      expect(Object.keys(data)).contain(\"spells\");\n      expect(Object.keys(data)).contain(\"isNew\");\n\n      expect(data?.config.morale).equal(\n        game.settings.get(game.system.id, \"morale\")\n      );\n      expect(Object.keys(data)).contain(\"system\");\n      expect(Object.keys(data?.system)).contain(\"details\");\n      expect(Object.keys(data?.system.details)).contain(\"treasure\");\n      expect(Object.keys(data?.system.details.treasure)).contain(\"link\");\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n    });\n  });\n\n  describe(\"generateSave()\", () => {\n    it(\"renders a dialog\", async () => {\n      const actor = await createMockActorKey(\"monster\", {}, key);\n      actor?.sheet?.generateSave();\n      await waitForInput();\n\n      const dialogs = openV2Dialogs();\n      expect(dialogs.length).equal(1);\n      dialogs[0].close();\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n      await closeV2Dialogs();\n      await delay(300);\n    });\n  });\n\n  describe(\"_onDrop(event)\", () => {\n    const createMockRollTable = async () =>\n      CONFIG.RollTable.documentClass.create({ name: \"Test RollTable\" });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n      game.tables\n        ?.filter((rt) => rt.name === \"Test RollTable\")\n        .forEach((rt) => rt.delete());\n    });\n\n    it(\"Can drag testing RollTable to Monster\", async () => {\n      const actor = await createMockActorKey(\"monster\", {}, key);\n      const rollTable = await createMockRollTable();\n      actor?.sheet?.render(true);\n      await delay(500); // Wait for sheet to render and the roll table to exist in the DOM\n\n      // Setup DOM elements\n      const dragElement = document.querySelector(\n        `#tables li[data-entry-id=\"${rollTable?.id}\"]`\n      );\n      const dropElement = document.querySelector(`.monster .window-content`);\n\n      // Check DOM elements\n      expect(dragElement).not.null;\n      expect(dropElement).not.null;\n\n      // Perform Drag\n      const mockDragStartEvent = new DragEvent(\"dragstart\", {\n        dataTransfer: new DataTransfer(),\n        bubbles: true,\n        cancelable: true,\n      });\n      dragElement?.dispatchEvent(mockDragStartEvent);\n\n      // Drop it\n      // eslint-disable-next-line no-underscore-dangle\n      actor?.sheet?._onDrop(mockDragStartEvent);\n      await waitForInput();\n\n      // Verify\n      expect(actor?.system.details.treasure.table).equal(\n        `@UUID[RollTable.${rollTable?.id}]`\n      );\n    });\n  });\n\n  describe(\"_resetAttacks(event)\", () => {\n    it(\"resets the counter to max\", async () => {\n      const actor = await createMockActorKey(\"monster\", {}, key);\n      actor?.sheet?.render(true);\n      const [item] = await createActorTestItem(actor, \"weapon\");\n      item.update({\n        system: {\n          counter: {\n            max: 4,\n            value: 1,\n          },\n        },\n      });\n      await delay(400);\n\n      expect(item.system.counter.value).equal(1);\n\n      // Click on reset\n      $(`.item-reset`).trigger(\"click\");\n      await waitForInput();\n\n      expect(item.system.counter.value).equal(4);\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n    });\n  });\n\n  describe(\"_updateAttackCounter(event)\", () => {\n    before(() => {\n      game.settings.set(game.system.id, \"invertedCtrlBehavior\", true);\n    });\n\n    it(\"updates counter when rolling\", async () => {\n      const actor = await createMockActorKey(\"monster\", {}, key);\n      actor?.sheet?.render(true);\n      const [item] = await createActorTestItem(actor, \"weapon\");\n      item.update({\n        system: {\n          counter: {\n            max: 4,\n            value: 4,\n          },\n        },\n      });\n      await delay(400);\n\n      expect(item.system.counter.value).equal(4);\n\n      // Click on reset\n      $(`.tab .item[data-item-id=\"${item.id}\"] .item-image`).trigger(\"click\");\n      await waitForInput();\n\n      expect(item.system.counter.value).equal(3);\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n    });\n  });\n\n  describe(\"_cycleAttackPatterns(event)\", () => {\n    const colors = Object.keys(CONFIG.OSE.colors);\n    colors.push(\"transparent\");\n\n    before(async () => {\n      const actor = await createMockActorKey(\"monster\", {}, key);\n      actor?.sheet?.render(true);\n      await createActorTestItem(actor, \"weapon\");\n      await delay(300);\n    });\n\n    describe(\"properly cycles between colors\", () => {\n      colors.forEach((color) => {\n        it(`works for color ${color}`, async () => {\n          const actor = await getMockActorKey(key);\n          const item = actor?.items.contents[0];\n          const currentPattern = item?.system.pattern;\n\n          expect(currentPattern).not.undefined;\n          const patternIndex = colors.indexOf(currentPattern);\n          const nextIndex =\n            patternIndex + 1 === colors.length ? 0 : patternIndex + 1;\n\n          // Click the thing\n          $(`.item-pattern`).trigger(\"click\");\n          await delay(200);\n\n          // Verify\n          expect(item?.system.pattern).equal(colors[nextIndex]);\n        });\n      });\n    });\n\n    after(async () => {\n      await cleanUpActorsByKey(key);\n    });\n  });\n};\n","/**\n * @file Combat tests for OSE module\n */\n// eslint-disable-next-line import/no-cycle\nimport OseActor from \"../../actor/entity\";\n\nimport { QuenchMethods } from \"../../../e2e\";\nimport {\n  cleanUpActorsByKey,\n  cleanUpScenes,\n  createMockActorKey,\n  createMockScene,\n  trashChat,\n  waitForInput,\n} from \"../../../e2e/testUtils\";\nimport { OSECombat } from \"../combat\";\n\nexport const key = \"ose.combat\";\nexport const options = {\n  displayName: \"OSE: Combat\",\n};\n\nexport default ({\n  describe,\n  it,\n  expect,\n  after,\n  afterEach,\n  before,\n}: QuenchMethods) => {\n  const oseCombat = new OSECombat();\n  let pc1: OseActor | Document | null = null;\n  let pc2: OseActor | Document | null = null;\n  let friendlyCharacter1: OseActor | Document | null = null;\n  let friendlyCharacter2: OseActor | Document | null = null;\n  let neutralCharacter1: OseActor | Document | null = null;\n  let neutralCharacter2: OseActor | Document | null = null;\n  let hostileCharacter1: OseActor | Document | null = null;\n  let hostileCharacter2: OseActor | Document | null = null;\n  let friendlyMonster1: OseActor | Document | null = null;\n  let friendlyMonster2: OseActor | Document | null = null;\n  let neutralMonster1: OseActor | Document | null = null;\n  let neutralMonster2: OseActor | Document | null = null;\n  let hostileMonster1: OseActor | Document | null = null;\n  let hostileMonster2: OseActor | Document | null = null;\n  let friendlyRetainer1: OseActor | Document | null = null;\n  let friendlyRetainer2: OseActor | Document | null = null;\n  let neutralRetainer1: OseActor | Document | null = null;\n  let neutralRetainer2: OseActor | Document | null = null;\n  let hostileRetainer1: OseActor | Document | null = null;\n  let hostileRetainer2: OseActor | Document | null = null;\n\n  const createCombatant = async (actor: OseActor) => {\n    const token = await actor.getTokenDocument();\n    await token.constructor.create(token, { parent: canvas.scene });\n  };\n\n  const controlAllTokens = () => {\n    const tokens = game.canvas?.scene?.tokens?.contents || [];\n    if (tokens.length === 0) return;\n    tokens[0].object.control({ releaseOthers: true });\n    tokens.slice(1).forEach((t) => {\n      t.object.control({ releaseOthers: false });\n    });\n  };\n\n  const addAllTokensToCombat = async () => {\n    controlAllTokens();\n    const tokens = canvas.tokens.controlled.map((t) => t.document);\n    await TokenDocument.implementation.createCombatants(tokens);\n  };\n\n  const getCombatTrackerElement = () =>\n    document.querySelector(\"#combat ol.combat-tracker\");\n\n  const getCombatantElements = () =>\n    getCombatTrackerElement()?.querySelectorAll(\"li.combatant\");\n\n  const cleanupCombat = async () => {\n    await game.combat?.delete();\n    await waitForInput();\n  };\n\n  before(async () => {\n    await trashChat();\n    await cleanupCombat();\n    const scene = await createMockScene();\n    await scene?.activate();\n    await waitForInput();\n\n    const nonGMUser = game.users?.find((u) => !u.isGM);\n\n    // Create mock actors for testing\n    pc1 = await createMockActorKey(\n      \"character\",\n      {\n        ...(nonGMUser?.id && {\n          ownership: {\n            [nonGMUser.id]: foundry.CONST.DOCUMENT_OWNERSHIP_LEVELS.OWNER,\n          },\n        }),\n      },\n      key\n    );\n    pc2 = await createMockActorKey(\n      \"character\",\n      {\n        ...(nonGMUser?.id && {\n          ownership: {\n            [nonGMUser.id]: foundry.CONST.DOCUMENT_OWNERSHIP_LEVELS.OWNER,\n          },\n        }),\n      },\n      key\n    );\n    friendlyCharacter1 = await createMockActorKey(\n      \"character\",\n      {\n        prototypeToken: {\n          disposition: foundry.CONST.TOKEN_DISPOSITIONS.FRIENDLY,\n        },\n      },\n      key\n    );\n    friendlyCharacter2 = await createMockActorKey(\n      \"character\",\n      {\n        prototypeToken: {\n          disposition: foundry.CONST.TOKEN_DISPOSITIONS.FRIENDLY,\n        },\n      },\n      key\n    );\n    neutralCharacter1 = await createMockActorKey(\n      \"character\",\n      {\n        prototypeToken: {\n          disposition: foundry.CONST.TOKEN_DISPOSITIONS.NEUTRAL,\n        },\n      },\n      key\n    );\n    neutralCharacter2 = await createMockActorKey(\n      \"character\",\n      {\n        prototypeToken: {\n          disposition: foundry.CONST.TOKEN_DISPOSITIONS.NEUTRAL,\n        },\n      },\n      key\n    );\n    hostileCharacter1 = await createMockActorKey(\n      \"character\",\n      {\n        prototypeToken: {\n          disposition: foundry.CONST.TOKEN_DISPOSITIONS.HOSTILE,\n        },\n      },\n      key\n    );\n    hostileCharacter2 = await createMockActorKey(\n      \"character\",\n      {\n        prototypeToken: {\n          disposition: foundry.CONST.TOKEN_DISPOSITIONS.HOSTILE,\n        },\n      },\n      key\n    );\n    friendlyMonster1 = await createMockActorKey(\n      \"monster\",\n      {\n        prototypeToken: {\n          disposition: foundry.CONST.TOKEN_DISPOSITIONS.FRIENDLY,\n        },\n      },\n      key\n    );\n    friendlyMonster2 = await createMockActorKey(\n      \"monster\",\n      {\n        prototypeToken: {\n          disposition: foundry.CONST.TOKEN_DISPOSITIONS.FRIENDLY,\n        },\n      },\n      key\n    );\n    neutralMonster1 = await createMockActorKey(\n      \"monster\",\n      {\n        prototypeToken: {\n          disposition: foundry.CONST.TOKEN_DISPOSITIONS.NEUTRAL,\n        },\n      },\n      key\n    );\n    neutralMonster2 = await createMockActorKey(\n      \"monster\",\n      {\n        prototypeToken: {\n          disposition: foundry.CONST.TOKEN_DISPOSITIONS.NEUTRAL,\n        },\n      },\n      key\n    );\n    hostileMonster1 = await createMockActorKey(\n      \"monster\",\n      {\n        prototypeToken: {\n          disposition: foundry.CONST.TOKEN_DISPOSITIONS.HOSTILE,\n        },\n      },\n      key\n    );\n    hostileMonster2 = await createMockActorKey(\n      \"monster\",\n      {\n        prototypeToken: {\n          disposition: foundry.CONST.TOKEN_DISPOSITIONS.HOSTILE,\n        },\n      },\n      key\n    );\n    friendlyRetainer1 = await createMockActorKey(\n      \"character\",\n      {\n        prototypeToken: {\n          disposition: foundry.CONST.TOKEN_DISPOSITIONS.FRIENDLY,\n        },\n        system: {\n          retainer: { enabled: true },\n        },\n      },\n      key\n    );\n    friendlyRetainer2 = await createMockActorKey(\n      \"character\",\n      {\n        prototypeToken: {\n          disposition: foundry.CONST.TOKEN_DISPOSITIONS.FRIENDLY,\n        },\n        system: {\n          retainer: { enabled: true },\n        },\n      },\n      key\n    );\n    neutralRetainer1 = await createMockActorKey(\n      \"character\",\n      {\n        prototypeToken: {\n          disposition: foundry.CONST.TOKEN_DISPOSITIONS.NEUTRAL,\n        },\n        system: {\n          retainer: { enabled: true },\n        },\n      },\n      key\n    );\n    neutralRetainer2 = await createMockActorKey(\n      \"character\",\n      {\n        prototypeToken: {\n          disposition: foundry.CONST.TOKEN_DISPOSITIONS.NEUTRAL,\n        },\n        system: {\n          retainer: { enabled: true },\n        },\n      },\n      key\n    );\n    hostileRetainer1 = await createMockActorKey(\n      \"character\",\n      {\n        prototypeToken: {\n          disposition: foundry.CONST.TOKEN_DISPOSITIONS.HOSTILE,\n        },\n        system: {\n          retainer: { enabled: true },\n        },\n      },\n      key\n    );\n    hostileRetainer2 = await createMockActorKey(\n      \"character\",\n      {\n        prototypeToken: {\n          disposition: foundry.CONST.TOKEN_DISPOSITIONS.HOSTILE,\n        },\n        system: {\n          retainer: { enabled: true },\n        },\n      },\n      key\n    );\n\n    await waitForInput();\n  });\n\n  after(async () => {\n    await cleanupCombat();\n    await cleanUpActorsByKey(key);\n    await cleanUpScenes();\n  });\n\n  describe(\"Static properties\", () => {\n    it(\"should have the correct initiative formula\", () => {\n      expect(OSECombat.FORMULA).to.equal(\"1d6 + @init\");\n      expect(OSECombat.GROUP_FORMULA).to.equal(\"1d6\");\n    });\n\n    it(\"GROUPS should combine OSE colors with action groups\", () => {\n      expect(OSECombat.GROUPS).to.eql({\n        green: game.i18n.localize(\"OSE.colors.green\"),\n        red: game.i18n.localize(\"OSE.colors.red\"),\n        yellow: game.i18n.localize(\"OSE.colors.yellow\"),\n        purple: game.i18n.localize(\"OSE.colors.purple\"),\n        blue: game.i18n.localize(\"OSE.colors.blue\"),\n        orange: game.i18n.localize(\"OSE.colors.orange\"),\n        white: game.i18n.localize(\"OSE.colors.white\"),\n        slow: game.i18n.localize(\"OSE.items.Slow\"),\n        cast: game.i18n.localize(\"OSE.spells.Cast\"),\n      });\n    });\n  });\n\n  describe(\"isGroupInitiative\", () => {\n    let previousInitiativeSetting: string;\n\n    before(async () => {\n      previousInitiativeSetting = game.settings.get(\n        game.system.id,\n        \"initiative\"\n      );\n      await game.settings.set(game.system.id, \"initiative\", \"group\");\n    });\n\n    after(async () => {\n      await game.settings.set(\n        game.system.id,\n        \"initiative\",\n        previousInitiativeSetting\n      );\n    });\n\n    it('should return true when initiative setting is \"group\"', () => {\n      expect(game.settings.get(game.system.id, \"initiative\")).to.equal(\"group\");\n      expect(oseCombat.isGroupInitiative).to.be.true;\n    });\n\n    it('should return false when initiative setting is not \"group\"', async () => {\n      await game.settings.set(game.system.id, \"initiative\", \"individual\");\n      expect(game.settings.get(game.system.id, \"initiative\")).to.equal(\n        \"individual\"\n      );\n      expect(oseCombat.isGroupInitiative).to.be.false;\n    });\n  });\n\n  describe(\"mockActors\", async () => {\n    it(\"should have created valid actors\", async () => {\n      expect(pc1?.type).to.equal(\"character\");\n      expect(\n        pc1?.hasPlayerOwner,\n        \"test can only pass if a non-GM user exists on this world\"\n      ).to.be.true;\n      expect(pc2?.type).to.equal(\"character\");\n      expect(\n        pc2?.hasPlayerOwner,\n        \"test can only pass if a non-GM user exists on this world\"\n      ).to.be.true;\n      expect(friendlyCharacter1?.type).to.equal(\"character\");\n      expect(friendlyCharacter1?.prototypeToken?.disposition).to.equal(\n        foundry.CONST.TOKEN_DISPOSITIONS.FRIENDLY,\n        \"Friendly Character 1 should have friendly disposition\"\n      );\n      expect(friendlyCharacter1?.hasPlayerOwner).to.be.false;\n      expect(friendlyCharacter2?.type).to.equal(\"character\");\n      expect(friendlyCharacter2?.prototypeToken?.disposition).to.equal(\n        foundry.CONST.TOKEN_DISPOSITIONS.FRIENDLY,\n        \"Friendly Character 2 should have friendly disposition\"\n      );\n      expect(friendlyCharacter2?.hasPlayerOwner).to.be.false;\n      expect(neutralCharacter1?.type).to.equal(\"character\");\n      expect(neutralCharacter1?.prototypeToken?.disposition).to.equal(\n        foundry.CONST.TOKEN_DISPOSITIONS.NEUTRAL,\n        \"Neutral Character 1 should have neutral disposition\"\n      );\n      expect(neutralCharacter1?.hasPlayerOwner).to.be.false;\n      expect(neutralCharacter2?.type).to.equal(\"character\");\n      expect(neutralCharacter2?.prototypeToken?.disposition).to.equal(\n        foundry.CONST.TOKEN_DISPOSITIONS.NEUTRAL,\n        \"Neutral Character 2 should have neutral disposition\"\n      );\n      expect(neutralCharacter2?.hasPlayerOwner).to.be.false;\n      expect(hostileCharacter1?.type).to.equal(\"character\");\n      expect(hostileCharacter1?.prototypeToken?.disposition).to.equal(\n        foundry.CONST.TOKEN_DISPOSITIONS.HOSTILE,\n        \"Hostile Character 1 should have hostile disposition\"\n      );\n      expect(hostileCharacter1?.hasPlayerOwner).to.be.false;\n      expect(hostileCharacter2?.type).to.equal(\"character\");\n      expect(hostileCharacter2?.prototypeToken?.disposition).to.equal(\n        foundry.CONST.TOKEN_DISPOSITIONS.HOSTILE,\n        \"Hostile Character 2 should have hostile disposition\"\n      );\n      expect(hostileCharacter2?.hasPlayerOwner).to.be.false;\n      expect(friendlyMonster1?.type).to.equal(\"monster\");\n      expect(friendlyMonster1?.prototypeToken?.disposition).to.equal(\n        foundry.CONST.TOKEN_DISPOSITIONS.FRIENDLY,\n        \"Friendly Monster 1 should have friendly disposition\"\n      );\n      expect(friendlyMonster1?.hasPlayerOwner).to.be.false;\n      expect(friendlyMonster2?.type).to.equal(\"monster\");\n      expect(friendlyMonster2?.prototypeToken?.disposition).to.equal(\n        foundry.CONST.TOKEN_DISPOSITIONS.FRIENDLY,\n        \"Friendly Monster 2 should have friendly disposition\"\n      );\n      expect(friendlyMonster2?.hasPlayerOwner).to.be.false;\n      expect(neutralMonster1?.type).to.equal(\"monster\");\n      expect(neutralMonster1?.prototypeToken?.disposition).to.equal(\n        foundry.CONST.TOKEN_DISPOSITIONS.NEUTRAL,\n        \"Neutral Monster 1 should have neutral disposition\"\n      );\n      expect(neutralMonster1?.hasPlayerOwner).to.be.false;\n      expect(neutralMonster2?.type).to.equal(\"monster\");\n      expect(neutralMonster2?.prototypeToken?.disposition).to.equal(\n        foundry.CONST.TOKEN_DISPOSITIONS.NEUTRAL,\n        \"Neutral Monster 2 should have neutral disposition\"\n      );\n      expect(neutralMonster2?.hasPlayerOwner).to.be.false;\n      expect(hostileMonster1?.type).to.equal(\"monster\");\n      expect(hostileMonster1?.prototypeToken?.disposition).to.equal(\n        foundry.CONST.TOKEN_DISPOSITIONS.HOSTILE,\n        \"Hostile Monster 1 should have hostile disposition\"\n      );\n      expect(hostileMonster1?.hasPlayerOwner).to.be.false;\n      expect(hostileMonster2?.type).to.equal(\"monster\");\n      expect(hostileMonster2?.prototypeToken?.disposition).to.equal(\n        foundry.CONST.TOKEN_DISPOSITIONS.HOSTILE,\n        \"Hostile Monster 2 should have hostile disposition\"\n      );\n      expect(hostileMonster2?.hasPlayerOwner).to.be.false;\n      expect(friendlyRetainer1?.type).to.equal(\"character\");\n      expect(friendlyRetainer1?.prototypeToken?.disposition).to.equal(\n        foundry.CONST.TOKEN_DISPOSITIONS.FRIENDLY,\n        \"Friendly Retainer 1 should have friendly disposition\"\n      );\n      expect(friendlyRetainer1?.hasPlayerOwner).to.be.false;\n      expect(friendlyRetainer2?.type).to.equal(\"character\");\n      expect(friendlyRetainer2?.prototypeToken?.disposition).to.equal(\n        foundry.CONST.TOKEN_DISPOSITIONS.FRIENDLY,\n        \"Friendly Retainer 2 should have friendly disposition\"\n      );\n      expect(friendlyRetainer2?.hasPlayerOwner).to.be.false;\n      expect(neutralRetainer1?.type).to.equal(\"character\");\n      expect(neutralRetainer1?.prototypeToken?.disposition).to.equal(\n        foundry.CONST.TOKEN_DISPOSITIONS.NEUTRAL,\n        \"Neutral Retainer 1 should have neutral disposition\"\n      );\n      expect(neutralRetainer1?.hasPlayerOwner).to.be.false;\n      expect(neutralRetainer2?.type).to.equal(\"character\");\n      expect(neutralRetainer2?.prototypeToken?.disposition).to.equal(\n        foundry.CONST.TOKEN_DISPOSITIONS.NEUTRAL,\n        \"Neutral Retainer 2 should have neutral disposition\"\n      );\n      expect(neutralRetainer2?.hasPlayerOwner).to.be.false;\n      expect(hostileRetainer1?.type).to.equal(\"character\");\n      expect(hostileRetainer1?.prototypeToken?.disposition).to.equal(\n        foundry.CONST.TOKEN_DISPOSITIONS.HOSTILE,\n        \"Hostile Retainer 1 should have hostile disposition\"\n      );\n      expect(hostileRetainer1?.hasPlayerOwner).to.be.false;\n      expect(hostileRetainer2?.type).to.equal(\"character\");\n      expect(hostileRetainer2?.prototypeToken?.disposition).to.equal(\n        foundry.CONST.TOKEN_DISPOSITIONS.HOSTILE,\n        \"Hostile Retainer 2 should have hostile disposition\"\n      );\n      expect(hostileRetainer2?.hasPlayerOwner).to.be.false;\n\n      await createCombatant(pc1 as OseActor);\n      await createCombatant(pc2 as OseActor);\n      await createCombatant(friendlyCharacter1 as OseActor);\n      await createCombatant(friendlyCharacter2 as OseActor);\n      await createCombatant(neutralCharacter1 as OseActor);\n      await createCombatant(neutralCharacter2 as OseActor);\n      await createCombatant(hostileCharacter1 as OseActor);\n      await createCombatant(hostileCharacter2 as OseActor);\n      await createCombatant(friendlyMonster1 as OseActor);\n      await createCombatant(friendlyMonster2 as OseActor);\n      await createCombatant(neutralMonster1 as OseActor);\n      await createCombatant(neutralMonster2 as OseActor);\n      await createCombatant(hostileMonster1 as OseActor);\n      await createCombatant(hostileMonster2 as OseActor);\n      await createCombatant(friendlyRetainer1 as OseActor);\n      await createCombatant(friendlyRetainer2 as OseActor);\n      await createCombatant(neutralRetainer1 as OseActor);\n      await createCombatant(neutralRetainer2 as OseActor);\n      await createCombatant(hostileRetainer1 as OseActor);\n      await createCombatant(hostileRetainer2 as OseActor);\n      await waitForInput();\n    });\n  });\n\n  describe(\"groupCombat(reroll)\", async () => {\n    let previousInitiativeSetting: string;\n    let previousCombatRerollBehavior: string;\n\n    before(async () => {\n      previousInitiativeSetting = game.settings.get(\n        game.system.id,\n        \"initiative\"\n      );\n      await game.settings.set(game.system.id, \"initiative\", \"group\");\n\n      previousCombatRerollBehavior = game.settings.get(\n        game.system.id,\n        \"rerollInitiative\"\n      );\n      await game.settings.set(game.system.id, \"rerollInitiative\", \"reroll\");\n\n      await trashChat();\n    });\n\n    after(async () => {\n      await cleanupCombat();\n      await game.settings.set(\n        game.system.id,\n        \"initiative\",\n        previousInitiativeSetting\n      );\n      await game.settings.set(\n        game.system.id,\n        \"rerollInitiative\",\n        previousCombatRerollBehavior\n      );\n      await cleanUpActorsByKey(key);\n      await waitForInput();\n    });\n\n    afterEach(async () => {\n      await trashChat();\n    });\n\n    it(\"should render groups\", async () => {\n      await addAllTokensToCombat();\n      await waitForInput();\n\n      expect(game.combat).to.not.be.null;\n      expect(game.combat?.combatants?.size).to.equal(20);\n      expect(game.combat?.groups?.size).to.equal(3);\n\n      const combatTracker = getCombatTrackerElement();\n      expect(combatTracker).to.not.be.null;\n      expect(combatTracker?.children?.length).to.equal(3);\n      for (const group of game.combat.groups.contents) {\n        const groupHeader = combatTracker?.querySelector(\n          `li[data-group-key=\"${group.name}\"]`\n        );\n        expect(groupHeader).to.not.be.null;\n        expect(groupHeader?.querySelector(\"ol.group-children\")).to.not.be.null;\n        expect(\n          groupHeader?.querySelector(\"ol.group-children\")?.children?.length\n        ).to.equal(group.members?.size);\n      }\n    });\n\n    it(\"should roll initiative for all groups\", async () => {\n      expect(game.messages.size).to.equal(0);\n      const smartRerollInitiativeButton = document.querySelector(\n        \".combat-tracker-header .combat-control[data-action='smartRerollInitiative']\"\n      );\n      expect(smartRerollInitiativeButton).to.not.be.null;\n      smartRerollInitiativeButton?.dispatchEvent(\n        new MouseEvent(\"click\", { bubbles: true, cancelable: true })\n      );\n      await waitForInput();\n      expect(game.messages.size).to.equal(3);\n      for (const group of game.combat.groups.contents.map(g => g.name)) {\n        expect(\n          game.messages.contents.some((cm) =>\n            cm.flavor.includes(\n              game.i18n.format(\"OSE.roll.initiative\", { group })\n            )\n          )\n        ).to.be.true;\n      }\n      expect(game.combat?.groups?.some((g) => g.initiative === null)).to.be\n        .false;\n\n      const combatTracker = getCombatTrackerElement();\n      const greenHeader = combatTracker?.querySelector(\n        \"li[data-group-key='green']\"\n      );\n      expect(greenHeader).to.not.be.null;\n      expect(greenHeader?.dataset?.initiative).to.not.be.undefined;\n      expect(\n        greenHeader?.querySelector(\".group-header .create-button\")?.textContent\n      ).to.equal(greenHeader?.dataset?.initiative);\n      const purpleHeader = combatTracker?.querySelector(\n        \"li[data-group-key='purple']\"\n      );\n      expect(purpleHeader).to.not.be.null;\n      expect(purpleHeader?.dataset?.initiative).to.not.be.undefined;\n      expect(\n        purpleHeader?.querySelector(\".group-header .create-button\")?.textContent\n      ).to.equal(purpleHeader?.dataset?.initiative);\n      const redHeader = combatTracker?.querySelector(\n        \"li[data-group-key='red']\"\n      );\n      expect(redHeader).to.not.be.null;\n      expect(redHeader?.dataset?.initiative).to.not.be.undefined;\n      expect(\n        redHeader?.querySelector(\".group-header .create-button\")?.textContent\n      ).to.equal(redHeader?.dataset?.initiative);\n    });\n\n    it(\"should not reroll initiative for rolled groups on combat start\", async () => {\n      const groupInitiatives: Map<string, number> = new Map();\n      for (const group of game.combat?.groups) {\n        groupInitiatives.set(group.name, group.initiative);\n      }\n      await game.combat.startCombat();\n      await waitForInput();\n      expect(game.combat?.started).to.be.true;\n      expect(game.combat?.round).to.equal(1);\n      expect(game.combat?.turn).to.equal(0);\n      expect(game.combat?.groups?.size).to.equal(3);\n      expect(game.combat?.combatants?.size).to.equal(20);\n      expect(game.messages.size).to.equal(0);\n      expect(\n        game.combat?.groups?.some(\n          (g) => g.initiative !== groupInitiatives.get(g.name)\n        )\n      ).to.be.false;\n    });\n\n    it(\"should roll initiative for unrolled groups on combat start\", async () => {\n      await cleanupCombat();\n      await waitForInput();\n      await addAllTokensToCombat();\n      await waitForInput();\n\n      expect(game.messages.size).to.equal(0);\n      expect(game.combat?.groups?.some((g) => g.initiative === null)).to.be\n        .true;\n      await game.combat.startCombat();\n      await waitForInput();\n      expect(game.combat?.started).to.be.true;\n      expect(game.combat?.round).to.equal(1);\n      expect(game.combat?.turn).to.equal(0);\n      expect(game.combat?.groups?.size).to.equal(3);\n      expect(game.combat?.combatants?.size).to.equal(20);\n      expect(game.messages.size).to.equal(3);\n      for (const group of game.combat.groups.contents.map(g => g.name)) {\n        expect(\n          game.messages.contents.some((cm) =>\n            cm.flavor.includes(\n              game.i18n.format(\"OSE.roll.initiative\", { group })\n            )\n          )\n        ).to.be.true;\n      }\n      expect(game.combat?.groups?.some((g) => g.initiative === null)).to.be\n        .false;\n\n      const combatTracker = getCombatTrackerElement();\n      const greenHeader = combatTracker?.querySelector(\n        \"li[data-group-key='green']\"\n      );\n      expect(greenHeader).to.not.be.null;\n      expect(greenHeader?.dataset?.initiative).to.not.be.undefined;\n      expect(\n        greenHeader?.querySelector(\".group-header .create-button\")?.textContent\n      ).to.equal(greenHeader?.dataset?.initiative);\n      const purpleHeader = combatTracker?.querySelector(\n        \"li[data-group-key='purple']\"\n      );\n      expect(purpleHeader).to.not.be.null;\n      expect(purpleHeader?.dataset?.initiative).to.not.be.undefined;\n      expect(\n        purpleHeader?.querySelector(\".group-header .create-button\")?.textContent\n      ).to.equal(purpleHeader?.dataset?.initiative);\n      const redHeader = combatTracker?.querySelector(\n        \"li[data-group-key='red']\"\n      );\n      expect(redHeader).to.not.be.null;\n      expect(redHeader?.dataset?.initiative).to.not.be.undefined;\n      expect(\n        redHeader?.querySelector(\".group-header .create-button\")?.textContent\n      ).to.equal(redHeader?.dataset?.initiative);\n    });\n\n    it(\"should mark combatants as active\", async () => {\n      let combatants = getCombatantElements();\n      expect(combatants).to.not.be.null;\n      expect(combatants?.length).to.equal(20);\n      expect(combatants?.[0]?.classList.contains(\"active\")).to.be.true;\n\n      await game.combat?.nextTurn();\n      await waitForInput();\n      expect(game.combat?.turn).to.equal(1);\n      combatants = getCombatantElements();\n      expect(combatants?.[0]?.classList.contains(\"active\")).to.be.false;\n      expect(combatants?.[1]?.classList.contains(\"active\")).to.be.true;\n    });\n\n    it(\"should reroll initiative for all groups on new round\", async () => {\n      await game?.combat?.nextRound();\n      await waitForInput();\n      expect(game.combat?.started).to.be.true;\n      expect(game.combat?.round).to.equal(2);\n      expect(game.combat?.turn).to.equal(0);\n      expect(game.combat?.groups?.size).to.equal(3);\n      expect(game.combat?.combatants?.size).to.equal(20);\n      expect(game.messages.size).to.equal(3);\n      expect(getCombatantElements()?.[0]?.classList.contains(\"active\")).to.be\n        .true;\n    });\n  });\n\n  describe(\"groupCombat(reset)\", async () => {\n    let previousInitiativeSetting: string;\n    let previousCombatRerollBehavior: string;\n\n    before(async () => {\n      previousInitiativeSetting = game.settings.get(\n        game.system.id,\n        \"initiative\"\n      );\n      await game.settings.set(game.system.id, \"initiative\", \"group\");\n\n      previousCombatRerollBehavior = game.settings.get(\n        game.system.id,\n        \"rerollInitiative\"\n      );\n      await game.settings.set(game.system.id, \"rerollInitiative\", \"reset\");\n\n      await trashChat();\n    });\n\n    after(async () => {\n      await cleanupCombat();\n      await game.settings.set(\n        game.system.id,\n        \"initiative\",\n        previousInitiativeSetting\n      );\n      await game.settings.set(\n        game.system.id,\n        \"rerollInitiative\",\n        previousCombatRerollBehavior\n      );\n      await cleanUpActorsByKey(key);\n      await waitForInput();\n    });\n\n    afterEach(async () => {\n      await trashChat();\n    });\n\n    it(\"should not roll initiative for groups on combat start\", async () => {\n      await addAllTokensToCombat();\n      await waitForInput();\n\n      await game.combat.startCombat();\n      await waitForInput();\n      expect(game.combat?.started).to.be.true;\n      expect(game.combat?.round).to.equal(1);\n      expect(game.combat?.turn).to.equal(0);\n      expect(game.combat?.groups?.size).to.equal(3);\n      expect(game.combat?.combatants?.size).to.equal(20);\n      expect(game.messages.size).to.equal(0);\n      expect(game.combat?.groups?.some((g) => g.initiative !== null)).to.be\n        .false;\n    });\n\n    it(\"should mark combatants as active\", async () => {\n      let combatants = getCombatantElements();\n      expect(combatants).to.not.be.null;\n      expect(combatants?.length).to.equal(20);\n      expect(combatants?.[0]?.classList.contains(\"active\")).to.be.true;\n\n      await game.combat?.nextTurn();\n      await waitForInput();\n      expect(game.combat?.turn).to.equal(1);\n      combatants = getCombatantElements();\n      expect(combatants?.[0]?.classList.contains(\"active\")).to.be.false;\n      expect(combatants?.[1]?.classList.contains(\"active\")).to.be.true;\n    });\n\n    it(\"should reset initiative for all groups on new round\", async () => {\n      await game?.combat?.smartRerollInitiative();\n      await waitForInput();\n      expect(game.messages.size).to.equal(3);\n      expect(game.combat?.groups?.some((g) => g.initiative === null)).to.be\n        .false;\n\n      await game?.combat?.nextRound();\n      await waitForInput();\n      expect(game.combat?.started).to.be.true;\n      expect(game.combat?.round).to.equal(2);\n      expect(game.combat?.turn).to.equal(0);\n      expect(game.combat?.groups?.size).to.equal(3);\n      expect(game.combat?.combatants?.size).to.equal(20);\n      expect(game.messages.size).to.equal(3);\n      expect(game.combat?.groups?.some((g) => g.initiative !== null)).to.be\n        .false;\n      expect(getCombatantElements()?.[0]?.classList.contains(\"active\")).to.be\n        .true;\n    });\n  });\n\n  describe(\"groupCombat(keep)\", async () => {\n    let previousInitiativeSetting: string;\n    let previousCombatRerollBehavior: string;\n\n    before(async () => {\n      previousInitiativeSetting = game.settings.get(\n        game.system.id,\n        \"initiative\"\n      );\n      await game.settings.set(game.system.id, \"initiative\", \"group\");\n\n      previousCombatRerollBehavior = game.settings.get(\n        game.system.id,\n        \"rerollInitiative\"\n      );\n      await game.settings.set(game.system.id, \"rerollInitiative\", \"keep\");\n\n      await trashChat();\n    });\n\n    after(async () => {\n      await cleanupCombat();\n      await game.settings.set(\n        game.system.id,\n        \"initiative\",\n        previousInitiativeSetting\n      );\n      await game.settings.set(\n        game.system.id,\n        \"rerollInitiative\",\n        previousCombatRerollBehavior\n      );\n      await cleanUpActorsByKey(key);\n      await waitForInput();\n    });\n\n    afterEach(async () => {\n      await trashChat();\n    });\n\n    it(\"should roll initiative for all groups on combat start\", async () => {\n      await addAllTokensToCombat();\n      await waitForInput();\n\n      await game.combat.startCombat();\n      await waitForInput();\n      expect(game.combat?.started).to.be.true;\n      expect(game.combat?.round).to.equal(1);\n      expect(game.combat?.turn).to.equal(0);\n      expect(game.combat?.groups?.size).to.equal(3);\n      expect(game.combat?.combatants?.size).to.equal(20);\n      expect(game.messages.size).to.equal(3);\n      expect(game.combat?.groups?.some((g) => g.initiative === null)).to.be\n        .false;\n    });\n\n    it(\"should mark combatants as active\", async () => {\n      let combatants = getCombatantElements();\n      expect(combatants).to.not.be.null;\n      expect(combatants?.length).to.equal(20);\n      expect(combatants?.[0]?.classList.contains(\"active\")).to.be.true;\n\n      await game.combat?.nextTurn();\n      await waitForInput();\n      expect(game.combat?.turn).to.equal(1);\n      combatants = getCombatantElements();\n      expect(combatants?.[0]?.classList.contains(\"active\")).to.be.false;\n      expect(combatants?.[1]?.classList.contains(\"active\")).to.be.true;\n    });\n\n    it(\"should keep initiative for all groups on new round\", async () => {\n      expect(game.combat?.groups?.some((g) => g.initiative === null)).to.be\n        .false;\n      const groupInitiatives: Map<string, number> = new Map();\n      for (const group of game.combat?.groups) {\n        groupInitiatives.set(group.name, group.initiative);\n      }\n\n      await game?.combat?.nextRound();\n      await waitForInput();\n      expect(game.combat?.started).to.be.true;\n      expect(game.combat?.round).to.equal(2);\n      expect(game.combat?.turn).to.equal(0);\n      expect(game.combat?.groups?.size).to.equal(3);\n      expect(game.combat?.combatants?.size).to.equal(20);\n      expect(game.messages.size).to.equal(0);\n      expect(\n        game.combat?.groups?.some(\n          (g) => g.initiative !== groupInitiatives.get(g.name)\n        )\n      ).to.be.false;\n      expect(getCombatantElements()?.[0]?.classList.contains(\"active\")).to.be\n        .true;\n    });\n  });\n\n  describe(\"individualCombat(reroll)\", async () => {\n    let previousInitiativeSetting: string;\n    let previousCombatRerollBehavior: string;\n\n    before(async () => {\n      previousInitiativeSetting = game.settings.get(\n        game.system.id,\n        \"initiative\"\n      );\n      await game.settings.set(game.system.id, \"initiative\", \"individual\");\n\n      previousCombatRerollBehavior = game.settings.get(\n        game.system.id,\n        \"rerollInitiative\"\n      );\n      await game.settings.set(game.system.id, \"rerollInitiative\", \"reroll\");\n\n      await trashChat();\n    });\n\n    after(async () => {\n      await cleanupCombat();\n      await game.settings.set(\n        game.system.id,\n        \"initiative\",\n        previousInitiativeSetting\n      );\n      await game.settings.set(\n        game.system.id,\n        \"rerollInitiative\",\n        previousCombatRerollBehavior\n      );\n      await cleanUpActorsByKey(key);\n      await waitForInput();\n    });\n\n    afterEach(async () => {\n      await trashChat();\n    });\n\n    it(\"should not render groups\", async () => {\n      await addAllTokensToCombat();\n      await waitForInput();\n\n      expect(game.combat).to.not.be.null;\n      expect(game.combat?.combatants?.size).to.equal(20);\n      expect(game.combat?.groups?.size).to.equal(0);\n\n      const combatTracker = getCombatTrackerElement();\n      expect(combatTracker).to.not.be.null;\n      expect(combatTracker?.children?.length).to.equal(20);\n    });\n\n    it(\"should roll initiative for all combatants\", async () => {\n      expect(game.messages.size).to.equal(0);\n      const rollAllButton = document.querySelector(\n        \".combat-tracker-header .combat-control[data-action='rollAll']\"\n      );\n      expect(rollAllButton).to.not.be.null;\n      rollAllButton?.dispatchEvent(\n        new MouseEvent(\"click\", { bubbles: true, cancelable: true })\n      );\n      await waitForInput();\n      expect(game.messages.size).to.equal(20);\n      for (const combatant of game.combat.combatants.contents.map(g => g.name)) {\n        expect(\n          game.messages.contents.some((cm) =>\n            cm.flavor.includes(\n              game.i18n.format(\"OSE.roll.individualInit\", {\n                name: combatant,\n              })\n            )\n          )\n        ).to.be.true;\n      }\n      expect(game.combat?.combatants?.some((c) => c.initiative === null)).to.be\n        .false;\n    });\n\n    it(\"should not reroll initiative for all combatants on combat start\", async () => {\n      const individualInitiatives: Map<string, number> = new Map();\n      for (const combatant of game.combat?.combatants) {\n        individualInitiatives.set(combatant.id, combatant.initiative);\n      }\n      await game.combat.startCombat();\n      await waitForInput();\n      expect(game.combat?.started).to.be.true;\n      expect(game.combat?.round).to.equal(1);\n      expect(game.combat?.turn).to.equal(0);\n      expect(game.combat?.groups?.size).to.equal(0);\n      expect(game.combat?.combatants?.size).to.equal(20);\n      expect(game.messages.size).to.equal(0);\n      expect(\n        game.combat?.combatants?.some(\n          (c) => c.initiative !== individualInitiatives.get(c.id)\n        )\n      ).to.be.false;\n    });\n\n    it(\"should mark combatants as active\", async () => {\n      let combatants = getCombatantElements();\n      expect(combatants).to.not.be.null;\n      expect(combatants?.length).to.equal(20);\n      expect(combatants?.[0]?.classList.contains(\"active\")).to.be.true;\n\n      await game.combat?.nextTurn();\n      await waitForInput();\n      expect(game.combat?.turn).to.equal(1);\n      combatants = getCombatantElements();\n      expect(combatants?.[0]?.classList.contains(\"active\")).to.be.false;\n      expect(combatants?.[1]?.classList.contains(\"active\")).to.be.true;\n    });\n\n    it(\"should reroll initiative for all combatants on new round\", async () => {\n      await game?.combat?.nextRound();\n      await waitForInput();\n      expect(game.combat?.started).to.be.true;\n      expect(game.combat?.round).to.equal(2);\n      expect(game.combat?.turn).to.equal(0);\n      expect(game.combat?.groups?.size).to.equal(0);\n      expect(game.combat?.combatants?.size).to.equal(20);\n      expect(game.messages.size).to.equal(20);\n      expect(getCombatantElements()?.[0]?.classList.contains(\"active\")).to.be\n        .true;\n    });\n  });\n\n  describe(\"individualCombat(reset)\", async () => {\n    let previousInitiativeSetting: string;\n    let previousCombatRerollBehavior: string;\n\n    before(async () => {\n      previousInitiativeSetting = game.settings.get(\n        game.system.id,\n        \"initiative\"\n      );\n      await game.settings.set(game.system.id, \"initiative\", \"individual\");\n\n      previousCombatRerollBehavior = game.settings.get(\n        game.system.id,\n        \"rerollInitiative\"\n      );\n      await game.settings.set(game.system.id, \"rerollInitiative\", \"reset\");\n\n      await trashChat();\n    });\n\n    after(async () => {\n      await cleanupCombat();\n      await game.settings.set(\n        game.system.id,\n        \"initiative\",\n        previousInitiativeSetting\n      );\n      await game.settings.set(\n        game.system.id,\n        \"rerollInitiative\",\n        previousCombatRerollBehavior\n      );\n      await cleanUpActorsByKey(key);\n      await waitForInput();\n    });\n\n    afterEach(async () => {\n      await trashChat();\n    });\n\n    it(\"should not roll initiative for all combatants on combat start\", async () => {\n      await addAllTokensToCombat();\n      await waitForInput();\n\n      await game.combat.startCombat();\n      await waitForInput();\n      expect(game.combat?.started).to.be.true;\n      expect(game.combat?.round).to.equal(1);\n      expect(game.combat?.turn).to.equal(0);\n      expect(game.combat?.groups?.size).to.equal(0);\n      expect(game.combat?.combatants?.size).to.equal(20);\n      expect(game.messages.size).to.equal(0);\n      expect(game.combat?.combatants?.some((c) => c.initiative !== null)).to.be\n        .false;\n    });\n\n    it(\"should mark combatants as active\", async () => {\n      let combatants = getCombatantElements();\n      expect(combatants).to.not.be.null;\n      expect(combatants?.length).to.equal(20);\n      expect(combatants?.[0]?.classList.contains(\"active\")).to.be.true;\n\n      await game.combat?.nextTurn();\n      await waitForInput();\n      expect(game.combat?.turn).to.equal(1);\n      combatants = getCombatantElements();\n      expect(combatants?.[0]?.classList.contains(\"active\")).to.be.false;\n      expect(combatants?.[1]?.classList.contains(\"active\")).to.be.true;\n    });\n\n    it(\"should reset initiative for all combatants on new round\", async () => {\n      await game?.combat?.smartRerollInitiative();\n      await waitForInput();\n      expect(game.messages.size).to.equal(20);\n      for (const group of game.combat?.groups) {\n        expect(group?.initiative).to.not.be.null;\n      }\n\n      await game?.combat?.nextRound();\n      await waitForInput();\n      expect(game.combat?.started).to.be.true;\n      expect(game.combat?.round).to.equal(2);\n      expect(game.combat?.turn).to.equal(0);\n      expect(game.combat?.groups?.size).to.equal(0);\n      expect(game.combat?.combatants?.size).to.equal(20);\n      expect(game.messages.size).to.equal(20);\n      expect(game.combat?.combatants?.some((c) => c.initiative !== null)).to.be\n        .false;\n      expect(getCombatantElements()?.[0]?.classList.contains(\"active\")).to.be\n        .true;\n    });\n  });\n\n  describe(\"individualCombat(keep)\", async () => {\n    let previousInitiativeSetting: string;\n    let previousCombatRerollBehavior: string;\n\n    before(async () => {\n      previousInitiativeSetting = game.settings.get(\n        game.system.id,\n        \"initiative\"\n      );\n      await game.settings.set(game.system.id, \"initiative\", \"individual\");\n\n      previousCombatRerollBehavior = game.settings.get(\n        game.system.id,\n        \"rerollInitiative\"\n      );\n      await game.settings.set(game.system.id, \"rerollInitiative\", \"keep\");\n\n      await trashChat();\n    });\n\n    after(async () => {\n      await cleanupCombat();\n      await game.settings.set(\n        game.system.id,\n        \"initiative\",\n        previousInitiativeSetting\n      );\n      await game.settings.set(\n        game.system.id,\n        \"rerollInitiative\",\n        previousCombatRerollBehavior\n      );\n      await cleanUpActorsByKey(key);\n      await waitForInput();\n    });\n\n    afterEach(async () => {\n      await trashChat();\n    });\n\n    it(\"should roll initiative for all combatants on combat start\", async () => {\n      await addAllTokensToCombat();\n      await waitForInput();\n\n      await game.combat.startCombat();\n      await waitForInput();\n      expect(game.combat?.started).to.be.true;\n      expect(game.combat?.round).to.equal(1);\n      expect(game.combat?.turn).to.equal(0);\n      expect(game.combat?.groups?.size).to.equal(0);\n      expect(game.combat?.combatants?.size).to.equal(20);\n      expect(game.messages.size).to.equal(20);\n      expect(game.combat?.combatants?.some((c) => c.initiative === null)).to.be\n        .false;\n    });\n\n    it(\"should mark combatants as active\", async () => {\n      let combatants = getCombatantElements();\n      expect(combatants).to.not.be.null;\n      expect(combatants?.length).to.equal(20);\n      expect(combatants?.[0]?.classList.contains(\"active\")).to.be.true;\n\n      await game.combat?.nextTurn();\n      await waitForInput();\n      expect(game.combat?.turn).to.equal(1);\n      combatants = getCombatantElements();\n      expect(combatants?.[0]?.classList.contains(\"active\")).to.be.false;\n      expect(combatants?.[1]?.classList.contains(\"active\")).to.be.true;\n    });\n\n    it(\"should keep initiative for all groups on new round\", async () => {\n      expect(game.combat?.combatants?.some((c) => c.initiative === null)).to.be\n        .false;\n      const individualInitiatives: Map<string, number> = new Map();\n      for (const combatant of game.combat?.combatants) {\n        individualInitiatives.set(combatant.id, combatant.initiative);\n      }\n\n      await game?.combat?.nextRound();\n      await waitForInput();\n      expect(game.combat?.started).to.be.true;\n      expect(game.combat?.round).to.equal(2);\n      expect(game.combat?.turn).to.equal(0);\n      expect(game.combat?.groups?.size).to.equal(0);\n      expect(game.combat?.combatants?.size).to.equal(20);\n      expect(game.messages.size).to.equal(0);\n      expect(\n        game.combat?.combatants?.some(\n          (c) => c.initiative !== individualInitiatives.get(c.id)\n        )\n      ).to.be.false;\n      expect(getCombatantElements()?.[0]?.classList.contains(\"active\")).to.be\n        .true;\n    });\n  });\n};\n","/**\n * @file Contains tests for Character Modifiers sheet.\n */\n// eslint-disable-next-line prettier/prettier, import/no-cycle\nimport { QuenchMethods } from \"../../../e2e\";\nimport {\n  cleanUpActorsByKey,\n  createMockActorKey,\n  openWindows,\n  waitForInput,\n} from \"../../../e2e/testUtils\";\nimport OseCharacterModifiers from \"../character-modifiers\";\n\nexport const key = \"ose.actor.sheet.character.dialog.modifiers\";\nexport const options = {\n  displayName: \"OSE: Actor: Dialog Sheet: Character Modifiers\",\n};\n\nconst createMockActor = async (type: string, data: object = {}) =>\n  createMockActorKey(type, data, key);\n\nexport default ({ describe, it, expect, assert, after }: QuenchMethods) => {\n  describe(\"defaultOptions()\", () => {\n    it(\"Has correctly set defaultOptions\", () => {\n      const sheet = new OseCharacterModifiers();\n      expect(sheet.options.id).equal(\"sheet-modifiers\");\n      expect(sheet.options.classes).contain(\"ose\");\n      expect(sheet.options.classes).contain(\"dialog\");\n      expect(sheet.options.classes).contain(\"modifiers\");\n      expect(sheet.options.template).contain(\n        \"/templates/actors/dialogs/modifiers-dialog.html\"\n      );\n      expect(sheet.options.width).equal(240);\n    });\n  });\n\n  describe(\"title()\", () => {\n    it(\"Creates string in dialog window title\", async () => {\n      const actor = await createMockActor(\"character\");\n      const sheet = new OseCharacterModifiers(actor);\n      sheet.render(true);\n      await waitForInput();\n      const dialogTitle = document.querySelector(\n        \"div.modifiers .window-title\"\n      )?.innerHTML;\n      expect(typeof dialogTitle).equal(\"string\");\n      const dialogs = openWindows(\"modifiers\");\n      expect(dialogs.length).equal(1);\n      await dialogs[0].close();\n      expect(openWindows(\"modifiers\").length).equal(0);\n    });\n  });\n\n  describe(\"getData()\", () => {\n    it(\"Returns proper data\", async () => {\n      const actor = await createMockActor(\"character\");\n      const sheet = new OseCharacterModifiers(actor);\n      const data = sheet.getData();\n      const keys = Object.keys(data);\n      assert(keys.length > 0);\n      expect(keys).contain(\"user\");\n    });\n  });\n\n  after(async () => {\n    await cleanUpActorsByKey(key);\n  });\n};\n","/**\n * @file Contains tests for Entity Tweaks sheet.\n */\n// eslint-disable-next-line prettier/prettier, import/no-cycle\nimport { QuenchMethods } from \"../../../e2e\";\nimport {\n  cleanUpActorsByKey,\n  createMockActorKey,\n  openWindows,\n  waitForInput,\n} from \"../../../e2e/testUtils\";\nimport OseEntityTweaks from \"../entity-tweaks\";\n\nexport const key = \"ose.actor.sheet.dialog.entity-tweaks\";\nexport const options = {\n  displayName: \"OSE: Actor: Dialog Sheet: Entity Tweaks\",\n};\n\nconst createMockActor = async (type: string, data: object = {}) =>\n  createMockActorKey(type, data, key);\n\nexport default ({ describe, it, expect, assert, after }: QuenchMethods) => {\n  describe(\"defaultOptions()\", () => {\n    it(\"Has correctly set defaultOptions\", () => {\n      const entityTweaks = new OseEntityTweaks();\n      expect(entityTweaks.options.classes).contain(\"sheet-tweaks\");\n      expect(entityTweaks.options.template).contain(\n        \"/templates/actors/dialogs/tweaks-dialog.html\"\n      );\n      expect(entityTweaks.options.width).equal(380);\n    });\n  });\n\n  describe(\"title()\", () => {\n    it(\"Creates string in dialog window title\", async () => {\n      const actor = await createMockActor(\"character\");\n      const entityTweaks = new OseEntityTweaks(actor);\n      entityTweaks.render(true);\n      await waitForInput();\n      const dialogTitle = document.querySelector(\n        \"div.sheet-tweaks .window-title\"\n      )?.innerHTML;\n      expect(typeof dialogTitle).equal(\"string\");\n      const dialogs = openWindows(\"sheet-tweaks\");\n      expect(dialogs.length).equal(1);\n      await dialogs[0].close();\n      expect(openWindows(\"sheet-tweaks\").length).equal(0);\n    });\n  });\n\n  describe(\"getData()\", () => {\n    it(\"Returns proper data\", async () => {\n      const actor = await createMockActor(\"character\");\n      const entityTweaks = new OseEntityTweaks(actor);\n      const data = entityTweaks.getData();\n      const keys = Object.keys(data);\n      assert(keys.length >= 2);\n      expect(keys).contain(\"config\");\n      expect(keys).contain(\"user\");\n      assert(data.isCharacter);\n    });\n  });\n\n  // @todo: Test with Cypress or mock event\n  describe(\"_updateObject(event, formData)\", () => {});\n\n  after(async () => {\n    await cleanUpActorsByKey(key);\n  });\n};\n","/**\n * @file Contains tests for Ability Data Model.\n */\n// eslint-disable-next-line prettier/prettier, import/no-cycle\nimport { QuenchMethods } from \"../../../e2e\";\nimport OseDataModelAbility from \"../data-model-ability\";\n\n\nexport const key = \"ose.item.datamodel.ability\";\nexport const options = { displayName: \"OSE: Item: Data Model: Ability\" };\n\nexport default ({ describe, it, expect }: QuenchMethods) => {\n  describe(\"manualTags\", () => {\n    const ability = new OseDataModelAbility();\n    it(\"By default return empty array\", () => {\n      expect(ability.manualTags.length).equal(0);\n    });\n\n    it(\"Can write tags to tags field\", () => {\n      ability.tags = [{ title: \"title\", value: \"value\" }];\n      expect(ability.tags.length).equal(1);\n      expect(Object.keys(ability.tags[0]).length).equal(2);\n      expect(ability.tags[0].title).equal(\"title\");\n      expect(ability.tags[0].value).equal(\"value\");\n      expect(ability.tags[0].label).is.undefined;\n    });\n\n    it(\"Can retrieve tags\", () => {\n      expect(ability.manualTags.length).equal(1);\n      expect(ability.manualTags[0].title).equal(\"title\");\n      expect(ability.manualTags[0].value).equal(\"value\");\n      expect(ability.tags[0].label).is.undefined;\n    });\n  });\n\n  describe(\"autoTags\", () => {\n    const ability = new OseDataModelAbility();\n    // A true ability item has default values set.\n    ability.updateSource({\n      blindroll: false,\n      description: \"\",\n      pattern: \"transparent\",\n      requirements: \"\",\n      roll: \"\",\n      rollTarget: 0,\n      rollType: \"result\",\n      save: \"\",\n      tags: [],\n    });\n\n    it(\"By default return tshirt icon\", () => {\n      expect(ability.autoTags[0].icon).is.undefined;\n    });\n\n    it(\"Requirements create autoTags\", () => {\n      ability.updateSource({ requirements: \"magic-user,slow\" });\n      expect(ability.autoTags.length).equal(2);\n      expect(Object.keys(ability.autoTags[0]).length).equal(1);\n      expect(ability.autoTags[0].label).equal(\"magic-user\");\n      expect(Object.keys(ability.autoTags[1]).length).equal(1);\n      expect(ability.autoTags[1].label).equal(\"slow\");\n    });\n\n    it(\"Save create autoTags\", () => {\n      ability.updateSource({ save: \"death\" });\n      expect(ability.autoTags.length).equal(3);\n      expect(Object.keys(ability.autoTags[2]).length).equal(2);\n      expect(ability.autoTags[2].label).equal(\n        game.i18n.localize(\"OSE.saves.death.long\")\n      );\n      expect(ability.autoTags[2].icon).equal(\"fa-skull\");\n    });\n\n    it(\"Roll create autoTags\", () => {\n      ability.updateSource({ roll: \"1d20+1\" });\n      expect(ability.autoTags.length).equal(4);\n      expect(Object.keys(ability.autoTags[3]).length).equal(2);\n      expect(ability.autoTags[2].label).equal(\n        `${game.i18n.localize(\"OSE.items.Roll\")} 1d20 + 1 =0`\n      );\n    });\n  });\n};\n","/**\n * @file Contains tests for Armor Item Data Model.\n */\n// eslint-disable-next-line prettier/prettier, import/no-cycle\nimport { QuenchMethods } from \"../../../e2e\";\nimport OseDataModelArmor from \"../data-model-armor\";\n\nexport const key = \"ose.item.datamodel.armor\";\nexport const options = { displayName: \"OSE: Item: Data Model: Armor\" };\n\nexport default ({ describe, it, expect }: QuenchMethods) => {\n  describe(\"ArmorTypes\", () => {\n    const dataTypes = OseDataModelArmor.ArmorTypes;\n\n    it(\"Has 4 armor types\", () => {\n      expect(Object.keys(dataTypes).length).equal(4);\n    });\n    it(\"Has unarmored\", () => {\n      expect(dataTypes.unarmored).equal(\"OSE.armor.unarmored\");\n    });\n    it(\"Has light\", () => {\n      expect(dataTypes.light).equal(\"OSE.armor.light\");\n    });\n    it(\"Has heavy\", () => {\n      expect(dataTypes.heavy).equal(\"OSE.armor.heavy\");\n    });\n    it(\"Has shield\", () => {\n      expect(dataTypes.shield).equal(\"OSE.armor.shield\");\n    });\n  });\n\n  describe(\"manualTags\", () => {\n    const item = new OseDataModelArmor();\n\n    it(\"By default return empty array\", () => {\n      expect(item.manualTags.length).equal(0);\n    });\n\n    it(\"Can write tags to tags field\", () => {\n      item.tags = [{ title: \"title\", value: \"value\" }];\n      expect(item.tags.length).equal(1);\n      expect(Object.keys(item.tags[0]).length).equal(2);\n      expect(item.tags[0].title).equal(\"title\");\n      expect(item.tags[0].value).equal(\"value\");\n      expect(item.tags[0].label).is.undefined;\n    });\n\n    it(\"Can retrieve tags\", () => {\n      expect(item.manualTags.length).equal(1);\n      expect(Object.keys(item.tags[0]).length).equal(2);\n      expect(item.manualTags[0].title).equal(\"title\");\n      expect(item.manualTags[0].value).equal(\"value\");\n      expect(item.manualTags[0].label).equal(\"value\");\n    });\n  });\n\n  describe(\"autoTags\", () => {\n    const item = new OseDataModelArmor();\n\n    it(\"By default return auto-tags\", () => {\n      expect(item.autoTags.length).equal(1);\n      expect(Object.keys(item.autoTags[0]).length).equal(2);\n    });\n    it(\"By default return light armor\", () => {\n      expect(item.autoTags[0].label).equal(\"OSE.armor.light\");\n    });\n    it(\"By default return tshirt icon\", () => {\n      expect(item.autoTags[0].icon).equal(\"fa-tshirt\");\n    });\n  });\n};\n","/**\n * @file Contains tests for Container Item Data Model.\n */\n// eslint-disable-next-line prettier/prettier, import/no-cycle\nimport { QuenchMethods } from \"../../../e2e\";\nimport OseDataModelContainer from \"../data-model-container\";\n\nexport const key = \"ose.item.datamodel.container\";\nexport const options = { displayName: \"OSE: Item: Data Model: Container\" };\n\nexport default ({ describe, it, expect }: QuenchMethods) => {\n  describe(\"contents()\", () => {\n    it(\"Returns null if itemIds is empty Array\", () => {\n      const container = new OseDataModelContainer();\n      expect(container.contents).is.null;\n    });\n  });\n\n  describe(\"totalWeight()\", () => {\n    it(\"Returns 0 with no items\", () => {\n      const container = new OseDataModelContainer();\n      expect(container.totalWeight).equal(0);\n    });\n  });\n\n  describe(\"manualTags()\", () => {\n    const container = new OseDataModelContainer();\n    it(\"By default return empty array\", () => {\n      expect(container.manualTags.length).equal(0);\n    });\n\n    it(\"Can write tags to tags field\", () => {\n      container.tags = [{ value: \"value\", title: \"title\" }];\n      expect(container.tags.length).equal(1);\n      expect(Object.keys(container.tags[0]).length).equal(2);\n      expect(container.tags[0].title).equal(\"title\");\n      expect(container.tags[0].value).equal(\"value\");\n      expect(container.tags[0].label).is.undefined;\n    });\n\n    it(\"Can retrieve tags\", () => {\n      expect(container.manualTags.length).equal(1);\n      expect(container.manualTags[0].title).equal(\"title\");\n      expect(container.manualTags[0].value).equal(\"value\");\n      expect(container.tags[0].label).is.undefined;\n    });\n  });\n\n  describe(\"autoTags()\", () => {\n    const container = new OseDataModelContainer();\n    it(\"By default return no auto-tags\", () => {\n      expect(container.autoTags.length).equal(0);\n    });\n\n    it(\"Can create autoTags\", () => {\n      container.tags = [{ value: CONFIG.OSE.tags.blunt }];\n      expect(container.tags.length).equal(1);\n      expect(container.autoTags[0].label).equal(CONFIG.OSE.tags.blunt);\n      expect(container.autoTags[0].icon).equal(\"fa-hammer-crash\");\n      expect(container.autoTags[0].image).equal(\n        `${CONFIG.OSE.assetsPath}/blunt.png`\n      );\n    });\n  });\n};\n","/**\n * @file Contains tests for Misc Item Data Model.\n */\n// eslint-disable-next-line prettier/prettier, import/no-cycle\nimport { QuenchMethods } from \"../../../e2e\";\nimport OseDataModelItem from \"../data-model-item\";\n\nexport const key = \"ose.item.datamodel.misc\";\nexport const options = { displayName: \"OSE: Item: Data Model: Misc\" };\n\nexport default ({ describe, it, expect }: QuenchMethods) => {\n  describe(\"manualTags()\", () => {\n    const miscItem = new OseDataModelItem();\n    it(\"By default return empty array\", () => {\n      expect(miscItem.manualTags.length).equal(0);\n    });\n\n    it(\"Can write tags to tags field\", () => {\n      miscItem.tags = [{ title: \"title\", value: \"value\" }];\n      expect(miscItem.tags.length).equal(1);\n      expect(Object.keys(miscItem.tags[0]).length).equal(2);\n      expect(miscItem.tags[0].title).equal(\"title\");\n      expect(miscItem.tags[0].value).equal(\"value\");\n      expect(miscItem.tags[0].label).is.undefined;\n    });\n\n    it(\"Can retrieve tags\", () => {\n      expect(miscItem.manualTags.length).equal(1);\n      expect(miscItem.manualTags[0].title).equal(\"title\");\n      expect(miscItem.manualTags[0].value).equal(\"value\");\n      expect(miscItem.tags[0].label).is.undefined;\n    });\n  });\n\n  describe(\"autoTags()\", () => {\n    const miscItem = new OseDataModelItem();\n    it(\"By default return no auto-tags\", () => {\n      expect(miscItem.autoTags.length).equal(0);\n    });\n\n    it(\"Can create autoTags\", () => {\n      miscItem.tags = [{ value: CONFIG.OSE.tags.blunt }];\n      expect(miscItem.tags.length).equal(1);\n      expect(miscItem.autoTags[0].label).equal(CONFIG.OSE.tags.blunt);\n      expect(miscItem.autoTags[0].icon).equal(\"fa-hammer-crash\");\n      expect(miscItem.autoTags[0].image).equal(\n        `${CONFIG.OSE.assetsPath}/blunt.png`\n      );\n    });\n  });\n};\n","/**\n * @file Contains tests for Spell Item Data Model.\n */\n// eslint-disable-next-line prettier/prettier, import/no-cycle\nimport { QuenchMethods } from \"../../../e2e\";\nimport OseDataModelSpell from \"../data-model-spell\";\n\nexport const key = \"ose.item.datamodel.spell\";\nexport const options = { displayName: \"OSE: Item: Data Model: Spell\" };\n\nexport default ({ describe, it, expect }: QuenchMethods) => {\n  describe(\"manualTags()\", () => {\n    const spell = new OseDataModelSpell();\n    it(\"By default return empty array\", () => {\n      expect(spell.manualTags.length).equal(0);\n    });\n\n    it(\"Can write tags to tags field\", () => {\n      spell.tags = [{ title: \"title\", value: \"value\" }];\n      expect(spell.tags.length).equal(1);\n      expect(Object.keys(spell.tags[0]).length).equal(2);\n      expect(spell.tags[0].title).equal(\"title\");\n      expect(spell.tags[0].value).equal(\"value\");\n      expect(spell.tags[0].label).is.undefined;\n    });\n\n    it(\"Can retrieve tags\", () => {\n      expect(spell.manualTags.length).equal(1);\n      expect(spell.manualTags[0].title).equal(\"title\");\n      expect(spell.manualTags[0].value).equal(\"value\");\n      expect(spell.tags[0].label).is.undefined;\n    });\n  });\n\n  describe(\"autoTags()\", () => {\n    const spell = new OseDataModelSpell();\n    it(\"By default return 3 auto-tags\", () => {\n      expect(spell.autoTags.length).equal(3);\n      spell.autoTags.forEach((t) => {\n        expect(t).not.null;\n        expect(t?.label).equal(\"\");\n      });\n    });\n\n    it(\"Save create autoTags\", () => {\n      spell.save = \"death\";\n      expect(spell.autoTags.length).equal(4);\n      expect(Object.keys(spell.autoTags[3]).length).equal(2);\n      expect(spell.autoTags[3].label).equal(\n        game.i18n.localize(\"OSE.saves.death.long\")\n      );\n      expect(spell.autoTags[3].icon).equal(\"fa-skull\");\n    });\n\n    it(\"Roll create autoTags\", () => {\n      spell.updateSource({ roll: \"1d20+1\" });\n      expect(spell.autoTags.length).equal(4);\n      expect(Object.keys(spell.autoTags[3]).length).equal(1);\n      expect(spell.autoTags[3].label).equal(\n        `${game.i18n.localize(\"OSE.items.Roll\")} 1d20 + 1`\n      );\n    });\n  });\n};\n","/**\n * @file Contains tests for Weapon Item Data Model.\n */\n// eslint-disable-next-line prettier/prettier, import/no-cycle\nimport { QuenchMethods } from \"../../../e2e\";\nimport OseDataModelWeapon from \"../data-model-weapon\";\n\nexport const key = \"ose.item.datamodel.weapon\";\nexport const options = { displayName: \"OSE: Item: Data Model: Weapon\" };\n\nexport default ({ describe, it, expect }: QuenchMethods) => {\n  describe(\"manualTags()\", () => {\n    const item = new OseDataModelWeapon();\n    it(\"By default return empty array\", () => {\n      expect(item.manualTags.length).equal(0);\n    });\n\n    it(\"Can write tags to tags field\", () => {\n      item.tags = [{ title: \"title\", value: \"value\" }];\n      expect(item.tags.length).equal(1);\n      expect(Object.keys(item.tags[0]).length).equal(2);\n      expect(item.tags[0].title).equal(\"title\");\n      expect(item.tags[0].value).equal(\"value\");\n      expect(item.tags[0].label).is.undefined;\n    });\n\n    it(\"Can retrieve tags\", () => {\n      expect(item.manualTags.length).equal(1);\n      expect(Object.keys(item.tags[0]).length).equal(2);\n      expect(item.manualTags[0].title).equal(\"title\");\n      expect(item.manualTags[0].value).equal(\"value\");\n      expect(item.manualTags[0].label).is.undefined;\n    });\n  });\n  describe(\"qualities()\", () => {\n    it(\"By default returns an array with Melee tag\", () => {\n      const item = new OseDataModelWeapon();\n      expect(item.qualities.length).equal(1);\n      expect(item.qualities[0].label).equal(\"Melee\");\n    });\n\n    it(\"Given a manual tag, it returns an array containing said tag\", () => {\n      const item = new OseDataModelWeapon();\n      item.tags = [{ value: \"slow\", label: \"slow\" }];\n      expect(item.qualities.length).equal(2);\n      expect(Object.keys(item.qualities[1]).length).equal(2);\n      expect(item.qualities[1].label).equal(item.manualTags[0].label);\n      expect(item.qualities[1].value).equal(item.manualTags[0].value);\n    });\n\n    it(\"Given an autoTag, it returns an array containing said autoTag\", () => {\n      const item = new OseDataModelWeapon();\n      item.slow = true;\n      expect(item.qualities.length).equal(2);\n      expect(Object.keys(item.qualities[1]).length).equal(4);\n      expect(item.qualities[1].label).equal(\"Slow\");\n      expect(item.qualities[1].title).equal(\"Slow\");\n      expect(item.qualities[1].icon).equal(\"fa-weight-hanging\");\n      expect(item.qualities[1].image).contain(\"assets/slow.png\");\n    });\n  });\n\n  describe(\"autotags()\", () => {\n    it(\"Returns a flattened array with damage and autotags\", () => {\n      const item = new OseDataModelWeapon();\n      expect(item.autoTags.length).equal(2);\n      expect(Object.keys(item.autoTags[0]).length).equal(2);\n      expect(item.autoTags[0].icon).equal(\"fa-tint\");\n      expect(item.autoTags[0].label).equal(\"\");\n    });\n\n    it(\"Damage is present in flattened array\", () => {\n      const item = new OseDataModelWeapon();\n      item.damage = \"1d13\";\n      expect(item.autoTags.length).equal(2);\n      expect(Object.keys(item.autoTags[0]).length).equal(2);\n      expect(item.autoTags[0].icon).equal(\"fa-tint\");\n      expect(item.autoTags[0].label).equal(\"1d13\");\n    });\n\n    it(\"A melee tag is returned as expected\", () => {\n      const item = new OseDataModelWeapon();\n      item.melee = true;\n      expect(item.autoTags.length).equal(2);\n      expect(Object.keys(item.autoTags[0]).length).equal(2);\n      expect(item.autoTags[0].icon).equal(\"fa-tint\");\n      expect(item.autoTags[0].label).equal(\"\");\n      expect(Object.keys(item.autoTags[1]).length).equal(3);\n      expect(item.autoTags[1].label).equal(\"Melee\");\n      expect(item.autoTags[1].icon).equal(\"fa-sword\");\n      expect(item.autoTags[1].image).contain(\"assets/melee.png\");\n    });\n\n    it(\"A missile tag is returned as expected\", () => {\n      const item = new OseDataModelWeapon();\n      item.melee = false;\n      item.missile = true;\n      expect(item.autoTags.length).equal(3);\n      expect(Object.keys(item.autoTags[0]).length).equal(2);\n      expect(item.autoTags[0].icon).equal(\"fa-tint\");\n      expect(item.autoTags[0].label).equal(\"\");\n      expect(Object.keys(item.autoTags[1]).length).equal(3);\n      expect(item.autoTags[1].label).equal(\"Missile\");\n      expect(item.autoTags[1].icon).equal(\"fa-bow-arrow\");\n      expect(item.autoTags[1].image).contain(\"assets/missile.png\");\n      expect(Object.keys(item.autoTags[2]).length).equal(2);\n      expect(item.autoTags[2].label).equal(\"0/0/0\");\n      expect(item.autoTags[2].icon).equal(\"fa-bullseye\");\n    });\n\n    it(\"A missile tag with ranges is returned as expected\", () => {\n      const item = new OseDataModelWeapon();\n      item.melee = false;\n      item.missile = true;\n      item.range.short = 30;\n      item.range.medium = 60;\n      item.range.long = 90;\n      expect(item.autoTags.length).equal(3);\n      expect(Object.keys(item.autoTags[0]).length).equal(2);\n      expect(item.autoTags[0].icon).equal(\"fa-tint\");\n      expect(item.autoTags[0].label).equal(\"\");\n      expect(Object.keys(item.autoTags[1]).length).equal(3);\n      expect(item.autoTags[1].label).equal(\"Missile\");\n      expect(item.autoTags[1].icon).equal(\"fa-bow-arrow\");\n      expect(item.autoTags[1].image).contain(\"assets/missile.png\");\n      expect(Object.keys(item.autoTags[2]).length).equal(2);\n      expect(item.autoTags[2].label).equal(\"30/60/90\");\n      expect(item.autoTags[2].icon).equal(\"fa-bullseye\");\n    });\n\n    it(\"A slow tag is returned as expected\", () => {\n      const item = new OseDataModelWeapon();\n      item.slow = true;\n      expect(item.autoTags.length).equal(3);\n      expect(Object.keys(item.autoTags[0]).length).equal(2);\n      expect(item.autoTags[0].icon).equal(\"fa-tint\");\n      expect(item.autoTags[0].label).equal(\"\");\n      expect(Object.keys(item.autoTags[2]).length).equal(3);\n      expect(item.autoTags[2].label).equal(\"Slow\");\n      expect(item.autoTags[2].icon).equal(\"fa-weight-hanging\");\n      expect(item.autoTags[2].image).contain(\"assets/slow.png\");\n    });\n\n    it(\"A save tag is returned as expected\", () => {\n      const item = new OseDataModelWeapon();\n      item.save = \"death\";\n      expect(item.autoTags.length).equal(3);\n      expect(Object.keys(item.autoTags[0]).length).equal(2);\n      expect(item.autoTags[0].icon).equal(\"fa-tint\");\n      expect(item.autoTags[0].label).equal(\"\");\n      expect(Object.keys(item.autoTags[2]).length).equal(2);\n      expect(item.autoTags[2].label).equal(\n        game.i18n.localize(\"OSE.saves.death.long\")\n      );\n      expect(item.autoTags[2].icon).equal(\"fa-skull\");\n    });\n  });\n};\n","/**\n * @file Contains tests for Item Data Model.\n */\n// eslint-disable-next-line prettier/prettier, import/no-cycle\nimport { QuenchMethods } from \"../../../e2e\";\nimport {\n  cleanUpWorldItems,\n  closeV2Dialogs,\n  createActorTestItem,\n  createMockActorKey,\n  createWorldTestItem,\n  getActiveNotifications,\n  openV2Dialogs,\n  trashChat,\n  waitForInput,\n} from \"../../../e2e/testUtils\";\nimport OseItem from \"../entity\";\n\nexport const key = \"ose.item.entity\";\nexport const options = { displayName: \"OSE: Item: Entity\" };\n\nconst createMockActor = async (data: object = {}) =>\n  createMockActorKey(\"character\", data, key);\n\nexport default ({\n  describe,\n  it,\n  expect,\n  after,\n  beforeEach,\n  assert,\n}: QuenchMethods) => {\n  const itemTypes = new Set([\n    \"spell\",\n    \"ability\",\n    \"armor\",\n    \"weapon\",\n    \"item\",\n    \"container\",\n  ]);\n\n  const { defaultIcons } = OseItem;\n\n  after(async () => {\n    cleanUpWorldItems();\n  });\n\n  describe(\"defaultIcons()\", () => {\n    it(\"There are 6 default icons\", () =>\n      expect(Object.keys(defaultIcons).length).equal(6));\n\n    itemTypes.forEach((type: string) => {\n      it(`Has ${type} icon`, () => expect(defaultIcons[type]).is.not.undefined);\n    });\n\n    it(\"Asking for other items return null\", () =>\n      expect(defaultIcons.non_existing).is.undefined);\n  });\n\n  describe(\"create()\", () => {\n    const testItemCreate = async (type: string) => {\n      const item = await createWorldTestItem(type);\n      expect(item).is.not.undefined;\n      expect(item?.img).equals(defaultIcons[type]);\n      const itemName = item?.name;\n      await item?.delete();\n      expect(game.items?.find((o) => o.name === itemName)).is.undefined;\n    };\n\n    it(\"Can create weapon OseItem\", async () => {\n      await testItemCreate(\"weapon\");\n    });\n    it(\"Can create armor OseItem\", async () => {\n      await testItemCreate(\"armor\");\n    });\n    it(\"Can create item OseItem\", async () => {\n      await testItemCreate(\"item\");\n    });\n    it(\"Can create spell OseItem\", async () => {\n      await testItemCreate(\"spell\");\n    });\n    it(\"Can create ability OseItem\", async () => {\n      await testItemCreate(\"ability\");\n    });\n    it(\"Can create container OseItem\", async () => {\n      await testItemCreate(\"container\");\n    });\n\n    // Requires chai-as-promised\n    it(\"Can't create without name\", async () => {\n      const item = await OseItem.create({ type: \"container\" });\n      await expect(item).is.undefined;\n      expect(getActiveNotifications().map((li) => li?.textContent?.trim()))\n        .to.be.an(\"array\")\n        .that.includes(\n          'OseItem validation errors:\\n  name: may not be undefined'\n        );\n      await ui.notifications?.clear();\n    });\n    it(\"Can't create without type\", async () => {\n      const item = await OseItem.create({ name: \"Test Item\" });\n      await expect(item).is.undefined;\n      expect(getActiveNotifications().map((li) => li?.textContent?.trim()))\n        .to.be.an(\"array\")\n        .that.includes(\n          'OseItem validation errors:\\n  type: may not be undefined'\n        );\n      await ui.notifications?.clear();\n    });\n    it(\"Can't create without acceptable type\", async () => {\n      const item = await OseItem.create({ name: \"Test Item\", type: \"TEST\" });\n      await expect(item).is.undefined;\n      expect(getActiveNotifications().map((li) => li?.textContent?.trim()))\n        .to.be.an(\"array\")\n        .that.includes(\n          'OseItem validation errors:\\n  type: \"TEST\" is not a valid type for the Item Document class'\n        );\n      await ui.notifications?.clear();\n    });\n  });\n\n  // @todo: How to test?\n  describe(\"prepareData()\", () => {});\n\n  describe(\"prepareDerivedData()\", () => {\n    it(\"has the expected fields\", async () => {\n      const item = (await createWorldTestItem(\"weapon\")) as OseItem;\n      expect(item?.system.enrichedDescription).not.undefined;\n      await item?.delete();\n    });\n  });\n\n  // @todo: How to mock html?\n  describe(\"chatListeners(html)\", () => {\n    it(\"Correctly binds _onChatCardAction to element\", () => {});\n    it(\"Correctly binds _onChatCardToggleContent to element\", () => {});\n  });\n\n  /// @todo: How to test?\n  describe(\"getChatData(htmlOptions)\", () => {\n    it(\"Weapon with tags correctly stored in item.system.properties\", () => {});\n    it(\"Spell stores class, level, range, and duration in item.system.properties\", () => {});\n    it('Equipped item stores \"Equipped\" in item.system.properties', () => {});\n    it(\"Properly returns itemData\", () => {});\n  });\n\n  describe(\"rollWeapon(options)\", () => {\n    it(\"Actor with melee & missile weapon renders dialog\", async () => {\n      const actor: OseActor = await createMockActor();\n      await createActorTestItem(actor, \"weapon\");\n      const weapon: OseItem = actor?.items.contents[0];\n      await weapon?.update({ system: { melee: true, missile: true } });\n      const result = weapon.rollWeapon();\n      await waitForInput();\n      await actor.delete();\n      expect(openV2Dialogs().length).equal(1);\n      assert(result);\n      await closeV2Dialogs();\n      await waitForInput();\n      await waitForInput();\n      await waitForInput();\n      expect(openV2Dialogs().length).equal(0);\n    });\n\n    it(\"Actor with weapon with \", async () => {\n      const actor: OseActor = await createMockActor();\n      await createActorTestItem(actor, \"weapon\");\n      const weapon: OseItem = actor?.items.contents[0];\n      await weapon?.update({ system: { missile: true, melee: false } });\n      const result = weapon.rollWeapon();\n      await actor.delete();\n      assert(result);\n    });\n  });\n\n  describe(\"rollFormula(options)\", () => {\n    it(\"Missing item.system.roll throws error\", async () => {\n      const item: OseItem = await createWorldTestItem(\"item\");\n      try {\n        await item.rollFormula();\n      } catch (error: any) {\n        expect(error.name).equal(\"Error\");\n      }\n    });\n    it(\"Casting a spell trigger a dialog\", async () => {\n      const item: OseItem = await createWorldTestItem(\"spell\");\n      await item.update({ system: { roll: \"1d20+12\" } });\n      await item.rollFormula();\n      await waitForInput();\n      await waitForInput();\n      await waitForInput();\n      expect(openV2Dialogs().length).equal(1);\n      await closeV2Dialogs();\n      await trashChat();\n    });\n    it(\"A OseDice.Roll is returned from method\", async () => {\n      const item: OseItem = await createWorldTestItem(\"spell\");\n      await item.update({ system: { roll: \"1d20+12\" } });\n      const result: any = await item.rollFormula();\n      assert(result instanceof Roll);\n    });\n  });\n\n  describe(\"spendSpell()\", () => {\n    it(\"Calling using non-spell item throws an error\", async () => {\n      const item: OseItem = await createWorldTestItem(\"weapon\");\n      try {\n        await item.spendSpell();\n      } catch (error: unknown) {\n        expect(error.name).equal(\"Error\");\n      }\n    });\n    it(\"Calling function reduces item.system.cast by one\", async () => {\n      const item: OseItem = await createWorldTestItem(\"spell\");\n      const initialSlots: Number = 3;\n      await item.update({ system: { cast: initialSlots } });\n      await item.spendSpell();\n      expect(item?.system?.cast).equal(initialSlots - 1);\n    });\n  });\n\n  describe(\"_getRollTag(data)\", () => {\n    it(\"Data provided without a roll key returns void\", async () => {\n      const item: OseItem = await createWorldTestItem(\"weapon\");\n      // eslint-disable-next-line no-underscore-dangle\n      const tag = item._getRollTag({});\n      expect(tag).to.be.undefined;\n    });\n    it(\"Returns ab object with value containing roll-info\", async () => {\n      const item: OseItem = await createWorldTestItem(\"weapon\");\n      // eslint-disable-next-line no-underscore-dangle\n      const tag = item._getRollTag({ roll: \"1d12+4\" });\n      expect(tag).not.to.be.undefined;\n      expect(tag?.label).equal(\"Roll 1d12+4\");\n    });\n  });\n\n  describe(\"_getSaveTag(data)\", () => {\n    it(\"Data provided without a save key returns void\", async () => {\n      const item: OseItem = await createWorldTestItem(\"weapon\");\n      // eslint-disable-next-line no-underscore-dangle\n      const tag = item._getSaveTag({});\n      expect(tag).to.be.undefined;\n    });\n    it(\"Returns an object with two keys; label and icon\", async () => {\n      const item: OseItem = await createWorldTestItem(\"weapon\");\n      // eslint-disable-next-line no-underscore-dangle\n      const tag = item._getSaveTag({ save: \"death\" });\n      expect(tag).not.to.be.undefined;\n      expect(tag?.label).equal(\"Death Poison\");\n      expect(tag?.icon).equal(\"fa-skull\");\n    });\n  });\n\n  describe(\"pushManualTag(values)\", () => {\n    const testPushManualTag = async (\n      item: OseItem,\n      tag: string,\n      itemTagData: { label: string; title: string; value: string }\n      // eslint-disable-next-line unicorn/consistent-function-scoping\n    ) => {\n      expect(item?.system?.tags.length).equal(0);\n      await item?.pushManualTag([tag]);\n      expect(item?.system?.tags.length).equal(1);\n      const itemTag = item?.system?.tags?.pop();\n      expect(itemTag.label).equal(itemTagData.label);\n      expect(itemTag.title).equal(itemTagData.title);\n      expect(itemTag.value).equal(itemTagData.value);\n    };\n\n    // eslint-disable-next-line unicorn/consistent-function-scoping\n    const pushManualTag = async (item: OseItem, tag: string) => {\n      expect(item?.system?.tags.length).equal(0);\n      await item?.pushManualTag([tag]);\n    };\n\n    const testSystemBooleans = (\n      item: OseItem,\n      flags: { melee: boolean; slow: boolean; missile: boolean }\n    ) => {\n      expect(item.system.melee).equal(flags.melee);\n      expect(item.system.slow).equal(flags.slow);\n      expect(item.system.missile).equal(flags.missile);\n    };\n\n    it(\"Provided value without () adds value to all keys\", async () => {\n      const item: OseItem = await createWorldTestItem(\"weapon\");\n      await testPushManualTag(item, \"test\", {\n        label: \"test\",\n        title: \"test\",\n        value: \"test\",\n      });\n      item.delete();\n    });\n    it(\"Provided values have tags within () added to array as title\", async () => {\n      const item: OseItem = await createWorldTestItem(\"weapon\");\n      await testPushManualTag(item, \"test (test2)\", {\n        label: \"test\",\n        title: \"test2\",\n        value: \"test\",\n      });\n      item.delete();\n    });\n\n    // Default\n    it(\"Weapons are automatically melee\", async () => {\n      const item: OseItem = await createWorldTestItem(\"weapon\");\n      testSystemBooleans(item, { melee: true, slow: false, missile: false });\n      await item?.delete();\n    });\n\n    // Boolean tags\n    const booleanTags = new Set([\n      CONFIG.OSE.tags.melee,\n      CONFIG.OSE.tags.slow,\n      CONFIG.OSE.tags.missile,\n    ]);\n\n    booleanTags.forEach((t) => {\n      it(`\"${t}\" tag activates the boolean but not a tag`, async () => {\n        const item: OseItem = await createWorldTestItem(\"weapon\");\n        await pushManualTag(item, t);\n        testSystemBooleans(item, {\n          melee: true,\n          slow: t === CONFIG.OSE.tags.slow,\n          missile: t === CONFIG.OSE.tags.missile,\n        });\n        item.delete();\n      });\n      it(`\"${t.toUpperCase()}\" tag activates the boolean but not a tag`, async () => {\n        const item: OseItem = await createWorldTestItem(\"weapon\");\n        await pushManualTag(item, t.toUpperCase());\n        testSystemBooleans(item, {\n          melee: true,\n          slow: t.toLowerCase() === CONFIG.OSE.tags.slow.toLowerCase(),\n          missile: t.toLowerCase() === CONFIG.OSE.tags.missile.toLowerCase(),\n        });\n        item.delete();\n      });\n      it(`\"Test (${t})\" tags activates the boolean and adds a tag`, async () => {\n        const item: OseItem = await createWorldTestItem(\"weapon\");\n        await testPushManualTag(item, `Test (${t})`, {\n          label: \"Test\",\n          title: t,\n          value: \"Test\",\n        });\n        testSystemBooleans(item, {\n          melee: true,\n          slow: t === CONFIG.OSE.tags.slow,\n          missile: t === CONFIG.OSE.tags.missile,\n        });\n        item.delete();\n      });\n      it(`\"Test (${t.toUpperCase()})\" tags activates the boolean and adds a tag`, async () => {\n        const item: OseItem = await createWorldTestItem(\"weapon\");\n        await testPushManualTag(item, `Test (${t.toUpperCase()})`, {\n          label: \"Test\",\n          title: t.toUpperCase(),\n          value: \"Test\",\n        });\n        testSystemBooleans(item, {\n          melee: true,\n          slow: t.toLowerCase() === CONFIG.OSE.tags.slow.toLowerCase(),\n          missile: t.toLowerCase() === CONFIG.OSE.tags.missile.toLowerCase(),\n        });\n        item.delete();\n      });\n    });\n  });\n\n  describe(\"popManualTag(value)\", () => {\n    it(\"Item without system.tags return undefined\", async () => {\n      const item: OseItem = await createWorldTestItem(\"weapon\");\n      expect(item.system.tags.length).equal(0);\n      const poppedTag = await item.popManualTag(\"test\");\n      expect(poppedTag).equal(undefined);\n    });\n    it(\"Tags matching input value are removed from item.system.tags\", async () => {\n      const item: OseItem = await createWorldTestItem(\"weapon\");\n      expect(item.system.tags.length).equal(0);\n\n      await item.pushManualTag([\"test\", \"test2\"]);\n      expect(item.system.tags.length).equal(2);\n\n      await item.popManualTag(\"test\");\n      expect(item.system.tags.length).equal(1);\n      expect(item.system.tags.pop().title).equal(\"test2\");\n    });\n  });\n\n  describe(\"getAutoTagList()\", () => {\n    it(\"Container does nothing\", async () => {\n      const item: OseItem = await createWorldTestItem(\"container\");\n      const tagList = item.getAutoTagList();\n      expect(tagList.length).equal(0);\n      item.delete();\n    });\n    it(\"Item does nothing\", async () => {\n      const item: OseItem = await createWorldTestItem(\"item\");\n      const tagList = item.getAutoTagList();\n      expect(tagList.length).equal(0);\n      item.delete();\n    });\n    it(\"Weapon has damage label applied\", async () => {\n      const item: OseItem = await createWorldTestItem(\"weapon\");\n      const tagList = item.getAutoTagList();\n      expect(tagList.length).equal(1);\n      expect(tagList[0].icon).equal(\"fa-tint\");\n      expect(tagList[0].label).equal(\"1d6\");\n      item.delete();\n    });\n    it(\"Missile weapon has ranges applied\", async () => {\n      const item: OseItem = await createWorldTestItem(\"weapon\");\n      await item.pushManualTag([CONFIG.OSE.tags.missile]);\n      assert(item.system.missile);\n      const tagList = item.getAutoTagList();\n      expect(tagList.length).equal(2);\n      expect(tagList[0].icon).equal(\"fa-tint\");\n      expect(tagList[0].label).equal(\"1d6\");\n      expect(tagList[1].icon).equal(\"fa-bullseye\");\n      expect(tagList[1].label).equal(\"0/0/0\");\n      item.delete();\n    });\n    it(\"Manual weapon tags are applied\", async () => {\n      const item: OseItem = await createWorldTestItem(\"weapon\");\n      await item.pushManualTag([\"Test\"]);\n      const tagList = item.getAutoTagList();\n      expect(tagList.length).equal(2);\n      expect(tagList[0].icon).equal(\"fa-tint\");\n      expect(tagList[0].label).equal(\"1d6\");\n      expect(tagList[1].label).equal(\"Test\");\n      item.delete();\n    });\n    it(\"Default Armor has armor type applied\", async () => {\n      const item: OseItem = await createWorldTestItem(\"armor\");\n      const tagList = item.getAutoTagList();\n      expect(tagList.length).equal(1);\n      expect(tagList[0].icon).equal(\"fa-tshirt\");\n      expect(tagList[0].label).equal(\"Light\");\n      item.delete();\n    });\n    it(\"Heavy Armor has armor type applied\", async () => {\n      const item: OseItem = await createWorldTestItem(\"armor\");\n      await item.update({ system: { type: \"heavy\" } });\n      const tagList = item.getAutoTagList();\n      expect(tagList.length).equal(1);\n      expect(tagList[0].icon).equal(\"fa-tshirt\");\n      expect(tagList[0].label).equal(\"Heavy\");\n      item.delete();\n    });\n    it(\"Spells have class, range, and duration applied\", async () => {\n      const item: OseItem = await createWorldTestItem(\"spell\");\n      const tagList = item.getAutoTagList();\n      expect(tagList.length).equal(3);\n      expect(tagList[0].label).equal(\"Magic-User\");\n      expect(tagList[1].label).equal(\"\");\n      expect(tagList[2].label).equal(\"\");\n      item.delete();\n    });\n    it(\"Abilities have requirements applied\", async () => {\n      const item: OseItem = await createWorldTestItem(\"ability\");\n      await item.update({ system: { requirements: \"alice,bob\" } });\n      const tagList = item.getAutoTagList();\n      expect(tagList.length).equal(2);\n      expect(tagList[0].label).equal(\"alice\");\n      expect(tagList[1].label).equal(\"bob\");\n      item.delete();\n    });\n    it(\"If rollTag exists, it is applied\", async () => {\n      const item: OseItem = await createWorldTestItem(\"spell\");\n      await item.update({ system: { roll: \"1d20+12\" } });\n      const tagList = item.getAutoTagList();\n      expect(tagList.length).equal(4);\n      expect(tagList[3].label).equal(\"Roll 1d20+12\");\n      item.delete();\n    });\n    it(\"If saveTag exists, it is applied\", async () => {\n      const item: OseItem = await createWorldTestItem(\"spell\");\n      await item.update({ system: { save: \"death\" } });\n      const tagList = item.getAutoTagList();\n      expect(tagList.length).equal(4);\n      expect(tagList[3].label).equal(\"Death Poison\");\n      expect(tagList[3].icon).equal(\"fa-skull\");\n      item.delete();\n    });\n  });\n\n  // @todo How to test?\n  describe(\"roll(options)\", () => {\n    it(\"Item of weapon type activates rollWeapon\", async () => {});\n    it(\"Item of spell type activates spendSpell\", () => {});\n    it(\"Item of ability type activates rollFormula if it has associated item.system.roll\", () => {});\n    it(\"Item of ability type shows chat card if no item.system.roll associated\", () => {});\n    it(\"Item of item type shows chat card\", () => {});\n    it(\"Item of armor type shows chat card\", () => {});\n  });\n\n  describe(\"show()\", () => {\n    beforeEach(async () => {\n      await trashChat();\n    });\n\n    after(async () => {\n      game.items\n        ?.filter((o) => o?.name?.indexOf(\"Test Weapon Item \") >= 0 || false)\n        .forEach(async (i) => i.delete());\n      await trashChat();\n    });\n\n    // eslint-disable-next-line unicorn/consistent-function-scoping\n    const rollMessageTest = async (rollMode: string) => {\n      assert(\n        [\"publicroll\", \"gmroll\", \"blindroll\", \"selfroll\"].includes(rollMode)\n      );\n      expect(game.messages?.size).equal(0);\n      game.settings.set(\"core\", \"rollMode\", rollMode);\n      expect(game.settings.get(\"core\", \"rollMode\")).equal(rollMode);\n      const item: OseItem = await createWorldTestItem(\"weapon\");\n      await item?.show();\n      expect(game.messages?.size).equal(1);\n      const chatMessage = game.messages?.contents.pop();\n      expect(chatMessage?.blind).equal(rollMode === \"blindroll\");\n      expect(chatMessage?.style).equal(0);\n      if (rollMode === \"publicroll\") {\n        expect(chatMessage?.whisper?.length).equal(0);\n      } else {\n        chatMessage?.whisper?.forEach((o: string) => {\n          // eslint-disable-next-line no-underscore-dangle\n          assert(game.users?.find((u: User) => u._id === o)?.isGM);\n        });\n      }\n      await item?.delete();\n    };\n\n    it(\"Private GM Roll whispers chat message to GM\", async () => {\n      await rollMessageTest(\"gmroll\");\n    });\n\n    it(\"Blindroll whispers chat message to GM and is blind\", async () => {\n      await rollMessageTest(\"blindroll\");\n    });\n\n    it(\"Selfroll whispers chat message to user\", async () => {\n      await rollMessageTest(\"selfroll\");\n    });\n    it(\"Public messages is not a whisper and is not blind\", async () => {\n      await rollMessageTest(\"publicroll\");\n    });\n  });\n\n  // @todo: How to test? Mock Event?\n  describe(\"_onChatCardToggleContent(event)\", () => {});\n  describe(\"_onChatCardAction(event)\", () => {});\n\n  // @todo: How to mock?\n  describe(\"_getChatCardActor(card)\", () => {\n    it(\"Returns actor if tokenId is properly set\", () => {});\n    it(\"Returns actor if actorId is properly set\", () => {});\n    it(\"Returns null if neither tokenId nor actorId is properly set\", () => {});\n  });\n\n  // @todo: How to mock?\n  describe(\"_getChatCardTargets(card)\", () => {});\n};\n","/**\n * @file Contains tests for Ability Data Model.\n */\n// eslint-disable-next-line prettier/prettier, import/no-cycle\nimport { QuenchMethods } from \"../../../e2e\";\nimport { cleanUpWorldItems, createWorldTestItem } from \"../../../e2e/testUtils\";\n\nexport const key = \"ose.item.sheet\";\nexport const options = { displayName: \"OSE: Item: Sheet\" };\n\nexport default ({ describe, it, expect, after, assert }: QuenchMethods) => {\n  after(() => {\n    cleanUpWorldItems();\n  });\n\n  describe(\"defaultOptions() \", () => {\n    it(\"Has correctly set defaultOptions\", async () => {\n      const item = await createWorldTestItem(\"item\");\n      const sheet = item?.sheet;\n      expect(sheet).is.not.undefined;\n      expect(sheet?.options.classes.length).to.be.above(3); // Foundry adds its own classes\n      expect(sheet?.options.classes).contain(\"ose\");\n      expect(sheet?.options.classes).contain(\"sheet\");\n      expect(sheet?.options.classes).contain(\"item\");\n      expect(sheet?.options.width).equal(520);\n      expect(sheet?.options.height).equal(390);\n      assert(sheet?.options.resizable);\n      expect(sheet?.options.tabs.length).equal(1);\n      expect(Object.keys(sheet?.options.tabs[0]).length).equal(4);\n      expect(Object.keys(sheet?.options.tabs[0])).contain(\"callback\");\n      expect(typeof sheet?.options.tabs[0].callback).equal(\"function\");\n      expect(sheet?.options.tabs[0].callback.name).contain(\"_onChangeTab\");\n      expect(Object.keys(sheet?.options.tabs[0])).contain(\"navSelector\");\n      expect(sheet?.options.tabs[0].navSelector).equal(\".tabs\");\n      expect(Object.keys(sheet?.options.tabs[0])).contain(\"contentSelector\");\n      expect(sheet?.options.tabs[0].contentSelector).equal(\".sheet-body\");\n      expect(Object.keys(sheet?.options.tabs[0])).contain(\"initial\");\n      expect(sheet?.options.tabs[0].initial).equal(\"description\");\n    });\n  });\n\n  describe(\"template()\", () => {\n    it(\"Returns html path\", async () => {\n      const item = await createWorldTestItem(\"item\");\n      const sheet = item?.sheet;\n      expect(sheet).is.not.undefined;\n      expect(sheet?.template).contain(\"templates/items\");\n      expect(sheet?.template).contain(\"-sheet.html\");\n    });\n  });\n\n  describe(\"getData()\", () => {\n    it(\"Returns data\", async () => {\n      const item = await createWorldTestItem(\"item\");\n      const sheet = item?.sheet;\n      expect(sheet).is.not.undefined;\n      const data = await sheet?.getData();\n      expect(Object.keys(data)).contain(\"_id\");\n      expect(Object.keys(data)).contain(\"editable\");\n      expect(Object.keys(data)).contain(\"config\");\n      expect(Object.keys(data)).contain(\"enriched\");\n    });\n  });\n};\n","/**\n * @file Contains tests for Party Entity.\n */\n// eslint-disable-next-line prettier/prettier, import/no-cycle\nimport { QuenchMethods } from \"../../../e2e\";\nimport { cleanUpActorsByKey, createMockActorKey } from \"../../../e2e/testUtils\";\nimport OseParty from \"../party\";\nimport OsePartySheet from \"../party-sheet\";\n\nexport const key = \"ose.party.entity\";\nexport const options = { displayName: \"OSE: Party: Entity\" };\n\nconst createMockActor = async (type: string, data: object = {}) =>\n  createMockActorKey(type, data, key);\n\nexport default ({ describe, it, expect, assert, after }: QuenchMethods) => {\n  describe(\"currentParty()\", () => {\n    it(\"Returns all characters in a party\", async () => {\n      const actor = await createMockActor(\"character\");\n      const partySheet = new OsePartySheet();\n      // eslint-disable-next-line no-underscore-dangle\n      const promisedAnswer = await partySheet._addActorToParty(actor);\n      expect(promisedAnswer).is.undefined;\n      assert(actor?.getFlag(game.system.id, \"party\"));\n\n      const party = OseParty;\n      const actorsInParty = game.actors?.filter(\n        (o) => o.flags[game.system.id]?.party\n      );\n      expect(party.currentParty.length).equal(actorsInParty?.length);\n      await actor?.delete();\n    });\n  });\n\n  after(async () => {\n    await cleanUpActorsByKey(key);\n  });\n};\n","/**\n * @file Contains tests for Party Sheet.\n */\n// eslint-disable-next-line prettier/prettier, import/no-cycle\nimport { QuenchMethods } from \"../../../e2e\";\nimport {\n  cleanUpActorsByKey,\n  createMockActorKey,\n  openWindows,\n  waitForInput,\n} from \"../../../e2e/testUtils\";\nimport OsePartySheet from \"../party-sheet\";\n\nexport const key = \"ose.party.sheet\";\nexport const options = { displayName: \"OSE: Party: Sheet\" };\n\nconst createMockActor = async (type: string, data: object = {}) =>\n  createMockActorKey(type, data, key);\n\nexport default ({ describe, it, expect, assert, after }: QuenchMethods) => {\n  describe(\"defaultOptions()\", () => {\n    it(\"Has correctly set defaultOptions\", () => {\n      const partySheet = new OsePartySheet();\n      expect(partySheet.options.classes).contain(\"ose\");\n      expect(partySheet.options.classes).contain(\"dialog\");\n      expect(partySheet.options.classes).contain(\"party-sheet\");\n      expect(partySheet.options.template).contain(\n        \"/templates/apps/party-sheet.html\"\n      );\n      expect(partySheet.options.width).equal(280);\n      expect(partySheet.options.height).equal(400);\n      assert(partySheet.options.resizable);\n      expect(partySheet.options.dragDrop[0].dragSelector).equal(\n        \".actor-list .actor\"\n      );\n      expect(partySheet.options.dragDrop[0].dropSelector).equal(\n        \".party-members\"\n      );\n      assert(!partySheet.options.closeOnSubmit);\n    });\n  });\n\n  // @todo: How to test?\n  describe(\"init()\", () => {});\n\n  describe(\"showPartySheet(options = {})\", () => {\n    it(\"Can render party sheet\", async () => {\n      OsePartySheet.showPartySheet();\n      await waitForInput();\n      const dialogs = openWindows(\"party-sheet\");\n      expect(dialogs.length).equal(1);\n      expect(dialogs[0].options.classes).contain(\"party-sheet\");\n      await dialogs[0].close();\n      expect(openWindows(\"party-sheet\").length).equal(0);\n    });\n  });\n\n  describe(\"partySheet()\", () => {\n    it(\"Returns a partysheet\", () => {\n      const { partySheet } = OsePartySheet;\n      expect(partySheet).is.not.undefined;\n      expect(partySheet?.options.classes).contain(\"party-sheet\");\n    });\n  });\n\n  describe(\"title()\", () => {\n    it(\"Creates string in dialog window title\", async () => {\n      OsePartySheet.showPartySheet();\n      await waitForInput();\n      const dialogTitle = document.querySelector(\n        \"div.party-sheet .window-title\"\n      )?.innerHTML;\n      expect(typeof dialogTitle).equal(\"string\");\n      const dialogs = openWindows(\"party-sheet\");\n      expect(dialogs.length).equal(1);\n      await dialogs[0].close();\n      expect(openWindows(\"party-sheet\").length).equal(0);\n    });\n  });\n\n  describe(\"getData()\", () => {\n    it(\"Returns proper data\", () => {\n      const sheet = new OsePartySheet();\n      const data = sheet.getData();\n      const keys = Object.keys(data);\n      expect(keys.length).equal(4);\n      expect(keys).contain(\"partyActors\");\n      expect(keys).contain(\"config\");\n      expect(keys).contain(\"user\");\n      expect(keys).contain(\"settings\");\n    });\n  });\n\n  describe(\"_addActorToParty(actor)\", () => {\n    it(\"Monster returns undefined\", async () => {\n      const actor = await createMockActor(\"monster\");\n      const partySheet = new OsePartySheet();\n      // eslint-disable-next-line no-underscore-dangle\n      const promisedAnswer = await partySheet._addActorToParty(actor);\n      expect(promisedAnswer).is.undefined;\n      await actor.delete();\n    });\n\n    it(\"Adding a character updates the actor\", async () => {\n      const actor = await createMockActor(\"character\");\n      const partySheet = new OsePartySheet();\n      // eslint-disable-next-line no-underscore-dangle\n      const promisedAnswer = await partySheet._addActorToParty(actor);\n      expect(promisedAnswer).is.undefined;\n      await waitForInput();\n      assert(actor?.getFlag(game.system.id, \"party\"));\n      await actor.delete();\n    });\n  });\n\n  describe(\"_removeActorFromParty(actor)\", async () => {\n    it(\"Removing a character updates the actor flags\", async () => {\n      const actor = await createMockActor(\"character\");\n      const partySheet = new OsePartySheet();\n      // eslint-disable-next-line no-underscore-dangle\n      const promisedAddAnswer = await partySheet._addActorToParty(actor);\n      expect(promisedAddAnswer).is.undefined;\n      await waitForInput();\n      assert(actor?.getFlag(game.system.id, \"party\"));\n      // eslint-disable-next-line no-underscore-dangle\n      const promisedRemoveAnswer = await partySheet._removeActorFromParty(actor);\n      expect(promisedRemoveAnswer).is.undefined;\n      await waitForInput();\n      assert(!actor?.getFlag(game.system.id, \"party\"));\n      await actor.delete();\n    });\n  });\n\n  // @todo: Test with Cypress or mock event\n  describe(\"_onDrop(event)\", () => {});\n\n  describe(\"_onDropActor(event, data)\", () => {\n    const event = \"\";\n    it(\"Dropping a non-actor type returns nothing\", async () => {\n      const partySheet = new OsePartySheet();\n      // eslint-disable-next-line no-underscore-dangle\n      const resolvedResponse = await partySheet._onDropActor(event, {\n        type: \"not-actor\",\n      });\n      expect(resolvedResponse).is.undefined;\n    });\n\n    it(\"Dropping an actor type updates the actor\", async () => {\n      const actor = await createMockActor(\"character\");\n      const data = {\n        type: actor?.documentName,\n        uuid: actor?.uuid,\n      };\n      const partySheet = new OsePartySheet();\n      // eslint-disable-next-line no-underscore-dangle\n      const promisedAnswer = await partySheet._onDropActor(event, data);\n      await waitForInput();\n      expect(promisedAnswer).is.undefined;\n      assert(actor?.getFlag(game.system.id, \"party\"));\n      await actor?.delete();\n    });\n  });\n\n  describe(\"_recursiveAddFolder(folder)\", () => {\n    it(\"Folder of actors add actors to party\", async () => {\n      const partySheet = new OsePartySheet();\n      const folder = await Folder.create({\n        name: `Test Folder ${key}`,\n        type: \"Actor\",\n      });\n      let actor = await createMockActor(\"character\");\n      // eslint-disable-next-line no-underscore-dangle\n      actor = await actor?.update({ folder: folder?._id });\n      expect(actor?.folder).equal(folder);\n      // eslint-disable-next-line no-underscore-dangle\n      partySheet._recursiveAddFolder(folder);\n      await waitForInput();\n      assert(actor?.getFlag(game.system.id, \"party\"));\n      await actor?.delete();\n      await folder?.delete();\n    });\n\n    it(\"Folder with sub-folders of actors add actors to party\", async () => {\n      const partySheet = new OsePartySheet();\n      const folder = await Folder.create({\n        name: `Test Folder ${key}`,\n        type: \"Actor\",\n      });\n      const subFolder = await Folder.create({\n        name: `Test Folder ${key} subfolder`,\n        type: \"Actor\",\n        folder: folder._id,\n      });\n      const actor = await createMockActor(\"character\");\n      // eslint-disable-next-line no-underscore-dangle\n      await actor?.update({ folder: subFolder?._id });\n      expect(actor?.folder).equal(subFolder);\n      // eslint-disable-next-line no-underscore-dangle\n      partySheet._recursiveAddFolder(folder);\n      await waitForInput();\n      assert(actor?.getFlag(game.system.id, \"party\"));\n      await actor?.delete();\n    });\n  });\n\n  describe(\"_onDropFolder(event, data)\", () => {\n    it(\"Dropping with documentName that is not Actor returns undefined\", async () => {\n      const mockData = {\n        documentName: \"Not-Actor\",\n      };\n      const partySheet = new OsePartySheet();\n      const response = await partySheet._onDropFolder(\"\", mockData);\n      expect(response).is.undefined;\n    });\n\n    it(\"Dropping a folder with an actor in it adds it to the party\", async () => {\n      const partySheet = new OsePartySheet();\n      const folder = await Folder.create({\n        name: `Test Folder ${key}`,\n        type: \"Actor\",\n      });\n      let actor = await createMockActor(\"character\");\n      // eslint-disable-next-line no-underscore-dangle\n      actor = await actor?.update({ folder: folder?._id });\n      expect(actor?.folder).equal(folder);\n      // eslint-disable-next-line no-underscore-dangle\n      await partySheet._onDropFolder(\"\", folder);\n      await waitForInput();\n      assert(actor?.getFlag(game.system.id, \"party\"));\n      await actor?.delete();\n      await folder?.delete();\n    });\n  });\n\n  // @todo: Test with Cypress or Mock event\n  describe(\"_onDragStart(event)\", () => {});\n\n  // Tested in OsePartyXP\n  describe(\"_dealXP(event)\", () => {});\n\n  after(async () => {\n    cleanUpActorsByKey(key);\n    game.folders?.contents\n      ?.filter((a) => a.name?.includes(`Test Folder ${key}`))\n      ?.forEach((a) => a.delete());\n  });\n};\n","/**\n * @file Contains tests for Party XP Sheet.\n */\n// eslint-disable-next-line prettier/prettier, import/no-cycle\nimport { QuenchMethods } from \"../../../e2e\";\nimport { openWindows, waitForInput } from \"../../../e2e/testUtils\";\nimport OsePartyXP from \"../party-xp\";\n\nexport const key = \"ose.party-xp.sheet\";\nexport const options = { displayName: \"OSE: Party XP: Sheet\" };\n\nexport default ({ describe, it, expect, assert }: QuenchMethods) => {\n  describe(\"defaultOptions()\", () => {\n    it(\"Has correctly set defaultOptions\", () => {\n      const partyXP = new OsePartyXP();\n      expect(partyXP.options.classes).contain(\"ose\");\n      expect(partyXP.options.classes).contain(\"dialog\");\n      expect(partyXP.options.classes).contain(\"party-xp\");\n      expect(partyXP.options.template).contain(\"/templates/apps/party-xp.html\");\n      expect(partyXP.options.width).equal(300);\n      expect(partyXP.options.height).equal(\"auto\");\n      assert(!partyXP.options.resizable);\n      assert(partyXP.options.closeOnSubmit);\n    });\n  });\n\n  describe(\"title()\", () => {\n    it(\"Creates string in dialog window title\", async () => {\n      const partyXP = new OsePartyXP();\n      partyXP.render(true);\n      await waitForInput();\n      const dialogTitle = document.querySelector(\n        \"div.party-xp .window-title\"\n      )?.innerHTML;\n      expect(typeof dialogTitle).equal(\"string\");\n      const dialogs = openWindows(\"party-xp\");\n      expect(dialogs.length).equal(1);\n      await dialogs[0].close();\n      expect(openWindows(\"party-xp\").length).equal(0);\n    });\n  });\n\n  describe(\"getData()\", () => {\n    it(\"Returns proper data\", () => {\n      const sheet = new OsePartyXP();\n      const data = sheet.getData();\n      const keys = Object.keys(data);\n      expect(keys.length).equal(5);\n      expect(keys).contain(\"actors\");\n      expect(keys).contain(\"data\");\n      expect(keys).contain(\"config\");\n      expect(keys).contain(\"user\");\n      expect(keys).contain(\"settings\");\n    });\n  });\n\n  // @todo: Test with Cypress or similar, or mock event (see actor-sheet-e2e)\n  describe(\"_onDrop(event)\", () => {});\n  describe(\"_updateObject(event)\", () => {});\n  describe(\"_calculateShare()\", () => {});\n  describe(\"_dealXP(event)\", () => {});\n};\n","/**\n * @file Contains tests for behaviour helpers\n */\n// eslint-disable-next-line prettier/prettier, import/no-cycle\nimport { QuenchMethods } from \"../../e2e\";\nimport skipRollDialogCheck from \"../helpers-behaviour\";\n\nexport const key = \"ose.helpers.behaviour\";\nexport const options = {\n  displayName: \"OSE: Helpers: Behaviour\",\n};\n\nexport default ({ describe, it, before, after, assert }: QuenchMethods) => {\n  describe(\"skipRollDialogCheck(event)\", () => {\n    const originalSetting = game.settings.get(\n      game.system.id,\n      \"invertedCtrlBehavior\"\n    );\n\n    describe(\"invertedCtrlBehavior is set to false\", () => {\n      before(async () => {\n        await game.settings.set(game.system.id, \"invertedCtrlBehavior\", false);\n      });\n\n      it(\"Setting is false\", async () => {\n        const setting = await game.settings.get(\n          game.system.id,\n          \"invertedCtrlBehavior\"\n        );\n        assert(!setting);\n      });\n\n      it(\"Not holding ctrl should not skip dialog\", () => {\n        const event = new KeyboardEvent(\"keydown\", { ctrlKey: false });\n        assert(!skipRollDialogCheck(event));\n      });\n\n      it(\"Not holding meta should not skip dialog\", () => {\n        const event = new KeyboardEvent(\"keydown\", { metaKey: false });\n        assert(!skipRollDialogCheck(event));\n      });\n\n      it(\"Holding ctrl should not skip dialog\", () => {\n        const event = new KeyboardEvent(\"keydown\", { ctrlKey: true });\n        assert(skipRollDialogCheck(event));\n      });\n\n      it(\"Holding meta should not skip dialog\", () => {\n        const event = new KeyboardEvent(\"keydown\", { metaKey: true });\n        assert(skipRollDialogCheck(event));\n      });\n    });\n\n    describe(\"invertedCtrlBehavior is set to true\", () => {\n      before(async () => {\n        await game.settings.set(game.system.id, \"invertedCtrlBehavior\", true);\n      });\n\n      it(\"Setting is false\", async () => {\n        const setting = await game.settings.get(\n          game.system.id,\n          \"invertedCtrlBehavior\"\n        );\n        assert(setting);\n      });\n\n      it(\"Not holding ctrl should skip dialog\", () => {\n        const event = new KeyboardEvent(\"keydown\", { ctrlKey: false });\n        assert(skipRollDialogCheck(event));\n      });\n\n      it(\"Not holding meta should skip dialog\", () => {\n        const event = new KeyboardEvent(\"keydown\", { ctrlKey: false });\n        assert(skipRollDialogCheck(event));\n      });\n\n      it(\"Holding ctrl should not skip dialog\", () => {\n        const event = new KeyboardEvent(\"keydown\", { ctrlKey: true });\n        assert(!skipRollDialogCheck(event));\n      });\n\n      it(\"Holding meta should not skip dialog\", () => {\n        const event = new KeyboardEvent(\"keydown\", { metaKey: true });\n        assert(!skipRollDialogCheck(event));\n      });\n    });\n\n    after(async () => {\n      await game.settings.set(\n        game.system.id,\n        \"invertedCtrlBehavior\",\n        originalSetting\n      );\n    });\n  });\n};\n","/**\n * @file Contains tests for chat helpers\n */\n// eslint-disable-next-line prettier/prettier, import/no-cycle\nimport { QuenchMethods } from \"../../e2e\";\nimport {\n  addChatMessageButtons,\n  addChatMessageContextOptions,\n  functionsForTesting,\n} from \"../helpers-chat\";\n\nconst { applyChatCardDamage } = functionsForTesting;\n\nexport const key = \"ose.helpers.chat\";\nexport const options = {\n  displayName: \"OSE: Helpers: Chat\",\n};\n\nexport default ({ describe, it, before, after, expect }: QuenchMethods) => {\n  // @todo: How do we test these properly?\n  describe(\"applyChatCardDamage(roll, multiplier)\", () => {});\n  describe(\"addChatMessageContextOptions(_, options)\", () => {});\n  describe(\"addChatMessageButtons(msg. html)\", () => {});\n};\n","/**\n * @file Contains tests for dice helpers\n */\n// eslint-disable-next-line prettier/prettier, import/no-cycle\nimport { QuenchMethods } from \"../../e2e\";\nimport {\n  closeV2Dialogs,\n  getActiveNotifications,\n  rollSpecificNumber,\n  trashChat,\n  waitForInput,\n} from \"../../e2e/testUtils\";\nimport OseDice from \"../helpers-dice\";\n\nexport const key = \"ose.helpers.dice\";\nexport const options = {\n  displayName: \"OSE: Helpers: Dice\",\n};\n\nconst createMockRoll = (\n  target: number,\n  resultArray: Array<number | string> = [target]\n) => {\n  const results: Array<object> = [];\n  resultArray.forEach((r: number | string) => {\n    results.push({ result: r });\n  });\n  return {\n    terms: [{ results }],\n    total: target,\n  };\n};\n\nexport default ({\n  describe,\n  it,\n  after,\n  afterEach,\n  before,\n  expect,\n}: QuenchMethods) => {\n  const acSetting = game.settings.get(game.system.id, \"ascendingAC\");\n\n  before(async () => {\n    await ui.notifications?.clear();\n  });\n\n  after(async () => {\n    game.settings.set(game.system.id, \"ascendingAC\", acSetting);\n    await ui.notifications?.clear();\n  });\n\n  describe(\"sendRoll(parts, data, title, flavor, speaker, form, chatMessage)\", () => {\n    before(async () => {\n      await trashChat();\n    });\n\n    it(\"Can roll with single part\", async () => {\n      const dice = await OseDice.sendRoll({\n        parts: [\"1d10\"],\n        data: { roll: { blindroll: false } },\n      });\n      await waitForInput();\n      await waitForInput();\n      const chatCard = document.querySelector(\n        \".chat-message .dice-formula\"\n      )?.innerHTML;\n      expect(Object.keys(dice)).contain(\"_evaluated\");\n      expect(dice._evaluated).equal(true);\n      expect(Object.keys(dice)).contain(\"_formula\");\n      expect(dice._formula).equal(\"1d10\");\n      expect(chatCard).equal(\"1d10\");\n    });\n\n    it(\"Can roll with multiple parts\", async () => {\n      const dice = await OseDice.sendRoll({\n        parts: [\"1d10\", \"1d20\"],\n        data: { roll: { blindroll: false } },\n      });\n      await waitForInput();\n      await waitForInput();\n      const chatCard = document.querySelector(\n        \".chat-message .dice-formula\"\n      )?.innerHTML;\n      expect(Object.keys(dice)).contain(\"_evaluated\");\n      expect(dice._evaluated).equal(true);\n      expect(Object.keys(dice)).contain(\"_formula\");\n      expect(dice._formula).equal(\"1d10 + 1d20\");\n      expect(chatCard).equal(\"1d10 + 1d20\");\n    });\n\n    afterEach(async () => {\n      await trashChat();\n    });\n  });\n\n  describe(\"digestResult(data, roll)\", () => {\n    // eslint-disable-next-line unicorn/consistent-function-scoping\n    const createMockData = (\n      type: string,\n      target: number,\n      thac0: number = 0\n    ) => ({\n      roll: { type, target, thac0 },\n    });\n    describe(\"result type\", () => {\n      const data = createMockData(\"result\", 10);\n      it(\"Successful roll hitting target\", () => {\n        const roll = createMockRoll(10);\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(true);\n        expect(OseDice.digestResult(data, roll).isFailure).equal(false);\n      });\n\n      it(\"Unsuccessful roll under\", () => {\n        const roll = createMockRoll(9);\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(false);\n        expect(OseDice.digestResult(data, roll).isFailure).equal(true);\n      });\n\n      it(\"Unsuccessful roll over\", () => {\n        const roll = createMockRoll(11);\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(false);\n        expect(OseDice.digestResult(data, roll).isFailure).equal(true);\n      });\n    });\n\n    describe(\"above type\", () => {\n      const data = createMockData(\"above\", 10);\n      it(\"Successful roll hitting target\", () => {\n        const roll = createMockRoll(10);\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(true);\n        expect(OseDice.digestResult(data, roll).isFailure).equal(false);\n      });\n\n      it(\"Unsuccessful roll under\", () => {\n        const roll = createMockRoll(9);\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(false);\n        expect(OseDice.digestResult(data, roll).isFailure).equal(true);\n      });\n\n      it(\"Successful roll over\", () => {\n        const roll = createMockRoll(11);\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(true);\n        expect(OseDice.digestResult(data, roll).isFailure).equal(false);\n      });\n    });\n\n    describe(\"below type\", () => {\n      const data = createMockData(\"below\", 10);\n      it(\"Successful roll hitting target\", () => {\n        const roll = createMockRoll(10);\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(true);\n        expect(OseDice.digestResult(data, roll).isFailure).equal(false);\n      });\n\n      it(\"Successful roll under\", () => {\n        const roll = createMockRoll(9);\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(true);\n        expect(OseDice.digestResult(data, roll).isFailure).equal(false);\n      });\n\n      it(\"Unsuccessful roll over\", () => {\n        const roll = createMockRoll(11);\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(false);\n        expect(OseDice.digestResult(data, roll).isFailure).equal(true);\n      });\n    });\n\n    describe(\"check type\", () => {\n      const data = createMockData(\"check\", 10);\n      it(\"Successful roll on a nat 1\", () => {\n        const roll = createMockRoll(1);\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(true);\n        expect(OseDice.digestResult(data, roll).isFailure).equal(false);\n      });\n\n      it(\"Unsuccessful roll on a nat 20\", () => {\n        const dataNat20 = createMockData(\"check\", 20);\n        const roll = createMockRoll(20);\n        expect(OseDice.digestResult(dataNat20, roll).isSuccess).equal(false);\n        expect(OseDice.digestResult(dataNat20, roll).isFailure).equal(true);\n      });\n\n      it(\"Successful roll hitting target\", () => {\n        const roll = createMockRoll(10);\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(true);\n        expect(OseDice.digestResult(data, roll).isFailure).equal(false);\n      });\n\n      it(\"Successful roll under\", () => {\n        const roll = createMockRoll(9);\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(true);\n        expect(OseDice.digestResult(data, roll).isFailure).equal(false);\n      });\n\n      it(\"Unsuccessful roll over\", () => {\n        const roll = createMockRoll(11);\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(false);\n        expect(OseDice.digestResult(data, roll).isFailure).equal(true);\n      });\n    });\n\n    describe(\"table type\", () => {\n      const data = {\n        roll: {\n          type: \"table\",\n          target: 10,\n          table: {\n            9: \"Success\",\n            10: \"Failure\",\n          },\n        },\n      };\n\n      it(\"Successful roll hitting target\", () => {\n        const roll = createMockRoll(9);\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(false);\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(false);\n        expect(OseDice.digestResult(data, roll).details).equal(\"Success\");\n      });\n\n      it(\"Successful roll under\", () => {\n        const roll = createMockRoll(10);\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(false);\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(false);\n        expect(OseDice.digestResult(data, roll).details).equal(\"Failure\");\n      });\n    });\n\n    describe(\"unknown type\", () => {\n      const data = createMockData(\"unknown\", 10);\n      it(\"Returns default result\", () => {\n        const roll = createMockRoll(4);\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(false);\n        expect(OseDice.digestResult(data, roll).isSuccess).equal(false);\n        expect(OseDice.digestResult(data, roll).target).equal(10);\n        expect(OseDice.digestResult(data, roll).total).equal(4);\n      });\n    });\n  });\n\n  describe(\"attackIsSuccess(roll, target, bonus)\", () => {\n    describe(\"Ascending AC\", () => {\n      before(async () => {\n        await game.settings.set(game.system.id, \"ascendingAC\", true);\n      });\n\n      it(\"Natural 1 always fails\", () => {\n        const rollTargetOne = createMockRoll(1, [1]);\n        expect(OseDice.attackIsSuccess(rollTargetOne, 100, 0)).equal(false);\n        const rollTargetTwenty = createMockRoll(20, [1]);\n        expect(OseDice.attackIsSuccess(rollTargetTwenty, 100, 0)).equal(false);\n      });\n\n      it(\"Natural 20 always succeeds\", () => {\n        const rollTargetOne = createMockRoll(1, [20]);\n        expect(OseDice.attackIsSuccess(rollTargetOne, 0, 100)).equal(true);\n        const rollTargetTwenty = createMockRoll(20, [20]);\n        expect(OseDice.attackIsSuccess(rollTargetTwenty, 0, 100)).equal(true);\n      });\n\n      it(\"Roll + bonus equal target is successful\", () => {\n        const roll = createMockRoll(10);\n        const target = 20;\n        const bonus = 10;\n        expect(OseDice.attackIsSuccess(roll, target, bonus)).equal(true);\n      });\n\n      it(\"Roll + bonus above target is successful\", () => {\n        const roll = createMockRoll(10);\n        const target = 19;\n        const bonus = 10;\n        expect(OseDice.attackIsSuccess(roll, target, bonus)).equal(true);\n      });\n\n      it(\"Roll + bonus under target is unsuccessful\", () => {\n        const roll = createMockRoll(10);\n        const target = 21;\n        const bonus = 10;\n        expect(OseDice.attackIsSuccess(roll, target, bonus)).equal(false);\n      });\n    });\n\n    describe(\"Descending AC\", () => {\n      before(async () => {\n        await game.settings.set(game.system.id, \"ascendingAC\", false);\n      });\n\n      it(\"Natural 1 always fails\", () => {\n        const rollTargetOne = createMockRoll(1, [1]);\n        expect(OseDice.attackIsSuccess(rollTargetOne, 100, 0)).equal(false);\n        const rollTargetTwenty = createMockRoll(20, [1]);\n        expect(OseDice.attackIsSuccess(rollTargetTwenty, 100, 0)).equal(false);\n      });\n\n      it(\"Natural 20 always succeeds\", () => {\n        const rollTargetOne = createMockRoll(1, [20]);\n        expect(OseDice.attackIsSuccess(rollTargetOne, 0, 100)).equal(true);\n        const rollTargetTwenty = createMockRoll(20, [20]);\n        expect(OseDice.attackIsSuccess(rollTargetTwenty, 0, 100)).equal(true);\n      });\n\n      it(\"Roll + ac equal thac0 is successful\", () => {\n        const roll = createMockRoll(10);\n        const thac0 = 20;\n        const ac = 10;\n        expect(OseDice.attackIsSuccess(roll, thac0, ac)).equal(true);\n      });\n\n      it(\"Roll + ac above thac0 is successful\", () => {\n        const roll = createMockRoll(10);\n        const thac0 = 19;\n        const ac = 10;\n        expect(OseDice.attackIsSuccess(roll, thac0, ac)).equal(true);\n      });\n\n      it(\"Roll + ac under thac0 is unsuccessful\", () => {\n        const roll = createMockRoll(10);\n        const thac0 = 21;\n        const ac = 10;\n        expect(OseDice.attackIsSuccess(roll, thac0, ac)).equal(false);\n      });\n    });\n  });\n\n  describe(\"digestAttackResult(data, roll)\", () => {\n    const data = {\n      roll: {\n        thac0: 15,\n        target: {\n          actor: {\n            system: {\n              ac: { value: 0 },\n              aac: { value: 9 },\n            },\n          },\n        },\n      },\n    };\n\n    describe(\"Ascending AC\", () => {\n      before(async () => {\n        await game.settings.set(game.system.id, \"ascendingAC\", true);\n      });\n\n      it(\"Natural 1 terms is unsuccessful\", async () => {\n        expect(game.settings.get(game.system.id, \"ascendingAC\")).equal(true);\n        const rollTargetOne = createMockRoll(1, [1]);\n        expect(OseDice.digestAttackResult(data, rollTargetOne).isSuccess).equal(\n          false\n        );\n        expect(OseDice.digestAttackResult(data, rollTargetOne).isFailure).equal(\n          true\n        );\n        const rollTargetTwenty = createMockRoll(20, [1]);\n        expect(\n          OseDice.digestAttackResult(data, rollTargetTwenty).isSuccess\n        ).equal(false);\n        expect(\n          OseDice.digestAttackResult(data, rollTargetTwenty).isFailure\n        ).equal(true);\n      });\n\n      it(\"Attack rolls with a modified result of 1 are allowed to succeed if hits target AC. Issue#340\", () => {\n        const attackBonus = -1;\n        const targetData = {\n          roll: {\n            thac0: 19,\n            target: {\n              actor: {\n                system: {\n                  ac: { value: 0 },\n                  aac: { value: 1 },\n                },\n              },\n            },\n          },\n        };\n\n        const roll = createMockRoll(1, [2, attackBonus]);\n        expect(OseDice.digestAttackResult(targetData, roll).isSuccess).equal(\n          true\n        );\n        expect(OseDice.digestAttackResult(targetData, roll).isFailure).equal(\n          false\n        );\n      });\n\n      it(\"Lower than target AC is unsuccessful\", () => {\n        const roll = createMockRoll(\n          data.roll.target.actor.system.aac.value - 1\n        );\n        expect(OseDice.digestAttackResult(data, roll).isSuccess).equal(false);\n        expect(OseDice.digestAttackResult(data, roll).isFailure).equal(true);\n      });\n\n      it(\"Equal than target AC is successful\", () => {\n        const roll = createMockRoll(\n          data.roll.target.actor.system.aac.value\n        );\n        expect(OseDice.digestAttackResult(data, roll).isSuccess).equal(true);\n        expect(OseDice.digestAttackResult(data, roll).isFailure).equal(false);\n      });\n\n      it(\"Higher than target AC is successful\", () => {\n        const roll = createMockRoll(\n          data.roll.target.actor.system.aac.value + 1\n        );\n        expect(OseDice.digestAttackResult(data, roll).isSuccess).equal(true);\n        expect(OseDice.digestAttackResult(data, roll).isFailure).equal(false);\n      });\n\n      it(\"Attack rolls with a modified result of 20 are allowed to fail if doesn't hit target AC. Issue#340\", () => {\n        const attackBonus = 1;\n        const targetData = {\n          roll: {\n            thac0: 19,\n            target: {\n              actor: {\n                system: {\n                  ac: { value: 0 },\n                  aac: { value: 21 },\n                },\n              },\n            },\n          },\n        };\n\n        const roll = createMockRoll(20, [19, attackBonus]);\n        expect(OseDice.digestAttackResult(targetData, roll).isSuccess).equal(\n          false\n        );\n        expect(OseDice.digestAttackResult(targetData, roll).isFailure).equal(\n          true\n        );\n      });\n\n      it(\"Natural 20 is successful\", () => {\n        const rollTargetOne = createMockRoll(1, [20]);\n        expect(OseDice.digestAttackResult(data, rollTargetOne).isSuccess).equal(\n          true\n        );\n        expect(OseDice.digestAttackResult(data, rollTargetOne).isFailure).equal(\n          false\n        );\n        const rollTargetTwenty = createMockRoll(20, [20]);\n        expect(\n          OseDice.digestAttackResult(data, rollTargetTwenty).isSuccess\n        ).equal(true);\n        expect(\n          OseDice.digestAttackResult(data, rollTargetTwenty).isFailure\n        ).equal(false);\n      });\n    });\n\n    describe(\"Descending AC, ac=0\", () => {\n      before(async () => {\n        await game.settings.set(game.system.id, \"ascendingAC\", false);\n      });\n\n      it(\"Natural 1 terms is unsuccessful\", async () => {\n        expect(game.settings.get(game.system.id, \"ascendingAC\")).equal(false);\n        const rollTargetOne = createMockRoll(1, [1]);\n        expect(OseDice.digestAttackResult(data, rollTargetOne).isSuccess).equal(\n          false\n        );\n        expect(OseDice.digestAttackResult(data, rollTargetOne).isFailure).equal(\n          true\n        );\n        const rollTargetTwenty = createMockRoll(20, [1]);\n        expect(\n          OseDice.digestAttackResult(data, rollTargetTwenty).isSuccess\n        ).equal(false);\n        expect(\n          OseDice.digestAttackResult(data, rollTargetTwenty).isFailure\n        ).equal(true);\n      });\n\n      it(\"Lower than thac0 is unsuccessful\", () => {\n        const roll = createMockRoll(data.roll.thac0 - 1);\n        expect(OseDice.digestAttackResult(data, roll).isSuccess).equal(false);\n        expect(OseDice.digestAttackResult(data, roll).isFailure).equal(true);\n      });\n\n      it(\"Equal to thac0 is successful\", () => {\n        const roll = createMockRoll(data.roll.thac0);\n        expect(OseDice.digestAttackResult(data, roll).isSuccess).equal(true);\n        expect(OseDice.digestAttackResult(data, roll).isFailure).equal(false);\n      });\n\n      it(\"Higher than thac0 is successful\", () => {\n        const roll = createMockRoll(data.roll.thac0 + 1);\n        expect(OseDice.digestAttackResult(data, roll).isSuccess).equal(true);\n        expect(OseDice.digestAttackResult(data, roll).isFailure).equal(false);\n      });\n\n      it(\"Natural 20 is successful\", () => {\n        const rollTargetOne = createMockRoll(1, [20]);\n        expect(OseDice.digestAttackResult(data, rollTargetOne).isSuccess).equal(\n          true\n        );\n        expect(OseDice.digestAttackResult(data, rollTargetOne).isFailure).equal(\n          false\n        );\n        const rollTargetTwenty = createMockRoll(20, [20]);\n        expect(\n          OseDice.digestAttackResult(data, rollTargetTwenty).isSuccess\n        ).equal(true);\n        expect(\n          OseDice.digestAttackResult(data, rollTargetTwenty).isFailure\n        ).equal(false);\n      });\n    });\n  });\n\n  describe(\"sendAttackRoll(parts, data, flags, title, flavor, speaker, form)\", () => {\n    // eslint-disable-next-line unicorn/consistent-function-scoping\n    const createMockAttackData = () => ({\n      parts: [\"1d20\", \"0\", \"0\", \"0\"],\n      data: {\n        roll: {\n          type: \"melee\",\n          dmg: [\"1d6\"],\n          thac0: 15,\n          target: {\n            actor: { system: { ac: { value: 0 }, aac: { value: 9 } } },\n          },\n        },\n      },\n    });\n\n    before(async () => {\n      await trashChat();\n      await game.settings.set(game.system.id, \"ascendingAC\", true);\n    });\n\n    it(\"Missing dmg roll shows notification\", async () => {\n      ui.notifications?.clear();\n      const rollData = createMockAttackData();\n      rollData.data.roll.dmg = [];\n      await OseDice.sendAttackRoll(rollData);\n      await waitForInput();\n      expect(getActiveNotifications().map((li) => li?.textContent?.trim()))\n        .to.be.an(\"array\")\n        .that.includes(\n          \"Attack has no damage dice terms; be sure to set the attack's damage\"\n        );\n    });\n\n    it(\"Can roll with single part and single dmg die\", async () => {\n      // Ensure the dice roll is a 10 to make sure the attack is successful\n      const existingRandomFunction = CONFIG.Dice.randomUniform;\n      CONFIG.Dice.randomUniform = () => rollSpecificNumber(10, 20);\n\n      const rollData = createMockAttackData();\n      await OseDice.sendAttackRoll(rollData);\n      await waitForInput();\n      await waitForInput();\n      await waitForInput();\n      await waitForInput();\n      const attackDiceResult =\n        document.querySelector(\".dice-formula\")?.innerHTML;\n      expect(attackDiceResult).equal(\"1d20 + 0 + 0 + 0\");\n      const damageDiceResult = document.querySelector(\n        \".damage-roll .dice-formula\"\n      )?.innerHTML;\n      expect(damageDiceResult).equal(\"1d6\");\n\n      // Restore the original random function\n      CONFIG.Dice.randomUniform = existingRandomFunction;\n    });\n    afterEach(async () => {\n      await trashChat();\n    });\n  });\n\n  describe(\"RollSave(parts, data, skipDialog, speaker, flavor, title, chatMessage)\", () => {\n    describe(\"Skipping dialog\", () => {\n      const skipDialog = true;\n      it(\"produces a roll chat message\", async () => {\n        await OseDice.RollSave({\n          parts: [\"1d10\"],\n          skipDialog,\n          data: { roll: { blindroll: false } },\n        });\n        await waitForInput();\n        expect(game.messages.size).equal(1);\n        expect(document.querySelector(\".roll-result\")).not.undefined;\n      });\n    });\n\n    describe(\"Not skipping dialog\", () => {\n      it(\"produces a dialog\", async () => {\n        OseDice.RollSave({\n          parts: [\"1d10\"],\n          data: { roll: { blindroll: false } },\n        });\n        await waitForInput();\n        const dialog = document.querySelector(\".dialog\");\n        expect(dialog?.querySelector(\"button[data-action='ok']\")).not.null;\n        expect(dialog?.querySelector(\"button[data-action='magic']\")).not.null;\n        expect(dialog?.querySelector(\"button[data-action='cancel']\")).not.null;\n        await closeV2Dialogs();\n      });\n    });\n\n    afterEach(async () => {\n      await trashChat();\n      await closeV2Dialogs();\n    });\n  });\n\n  describe(\"Roll(parts, data, skipDialog, speaker, flavor, title, chatMessage, flags)\", () => {\n    describe(\"Skipping dialog\", () => {\n      const skipDialog = true;\n      it(\"produces a roll chat message\", async () => {\n        await OseDice.Roll({\n          parts: [\"1d10\"],\n          skipDialog,\n          data: { roll: { blindroll: false } },\n        });\n        await waitForInput();\n        expect(game.messages.size).equal(1);\n        expect(document.querySelector(\".roll-result\")).not.undefined;\n      });\n    });\n\n    describe(\"Not skipping dialog\", () => {\n      it(\"produces a dialog\", async () => {\n        OseDice.Roll({\n          parts: [\"1d10\"],\n          data: { roll: { blindroll: false } },\n        });\n        await waitForInput();\n        const dialog = document.querySelector(\".dialog\");\n        expect(dialog?.querySelector(\"button[data-action='ok']\")).not.null;\n        expect(dialog?.querySelector(\"button[data-action='magic']\")).is.null;\n        expect(dialog?.querySelector(\"button[data-action='cancel']\")).not.null;\n        await closeV2Dialogs();\n      });\n    });\n\n    afterEach(async () => {\n      await trashChat();\n      await closeV2Dialogs();\n      await waitForInput();\n    });\n  });\n};\n","/**\n * @file Contains tests for handlebars helpers\n */\n// eslint-disable-next-line prettier/prettier, import/no-cycle\nimport { QuenchMethods } from \"../../e2e\";\n\nexport const key = \"ose.helpers.handlebars\";\nexport const options = {\n  displayName: \"OSE: Helpers: Handlebars\",\n};\n\nexport default ({ describe, it, expect }: QuenchMethods) => {\n  describe(\"registerHelpers()\", () => {\n    describe(\"eq helper\", () => {\n      const helper = \"eq\";\n      it(\"is registered\", () => {\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\n      });\n\n      it(\"is functional\", () => {\n        expect(Handlebars.helpers.eq(1, 1)).equal(true);\n        expect(Handlebars.helpers.eq(\"test\", \"test\")).equal(true);\n        expect(Handlebars.helpers.eq(1, 2)).equal(false);\n        expect(Handlebars.helpers.eq(\"test\", 1)).equal(false);\n        expect(Handlebars.helpers.eq([], [])).equal(false);\n      });\n    });\n\n    describe(\"mod helper\", () => {\n      const helper = \"mod\";\n      it(\"is registered\", () => {\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\n      });\n\n      it(\"is functional\", () => {\n        expect(Handlebars.helpers.mod(0)).equal(\"0\");\n        expect(Handlebars.helpers.mod(1)).equal(\"+1\");\n        expect(Handlebars.helpers.mod(-1)).equal(\"-1\");\n        expect(Handlebars.helpers.mod(\"1\")).equal(\"+1\");\n        expect(Handlebars.helpers.mod(\"-1\")).equal(\"-1\");\n        expect(Handlebars.helpers.mod(\"a\")).equal(\"0\");\n      });\n    });\n\n    describe(\"add helper\", () => {\n      const helper = \"add\";\n      it(\"is registered\", () => {\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\n      });\n\n      it(\"is functional\", () => {\n        expect(Handlebars.helpers.add(1, 2)).equal(3);\n        expect(Handlebars.helpers.add(1, -2)).equal(-1);\n        expect(Handlebars.helpers.add(\"1\", \"3\")).equal(4);\n        expect(Handlebars.helpers.add(\"1\", \"-3\")).equal(-2);\n      });\n    });\n\n    describe(\"subtract helper\", () => {\n      const helper = \"subtract\";\n      it(\"is registered\", () => {\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\n      });\n\n      it(\"is functional\", () => {\n        expect(Handlebars.helpers.subtract(1, 2)).equal(-1);\n        expect(Handlebars.helpers.subtract(1, -2)).equal(3);\n        expect(Handlebars.helpers.subtract(\"1\", \"3\")).equal(-2);\n        expect(Handlebars.helpers.subtract(\"1\", \"-3\")).equal(4);\n      });\n    });\n\n    describe(\"divide helper\", () => {\n      const helper = \"divide\";\n      it(\"is registered\", () => {\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\n      });\n\n      it(\"is functional\", () => {\n        expect(Handlebars.helpers.divide(1, 2)).equal(0);\n        expect(Handlebars.helpers.divide(1, -2)).equal(-1);\n        expect(Handlebars.helpers.divide(10, 3)).equal(3);\n        expect(Handlebars.helpers.divide(\"10\", \"3\")).equal(3);\n        expect(Handlebars.helpers.divide(\"10\", \"-3\")).equal(-4);\n      });\n    });\n\n    describe(\"mult helper\", () => {\n      const helper = \"mult\";\n      it(\"is registered\", () => {\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\n      });\n\n      it(\"is functional\", () => {\n        expect(Handlebars.helpers.mult(1, 2)).equal(2);\n        expect(Handlebars.helpers.mult(1, -2)).equal(-2);\n        expect(Handlebars.helpers.mult(10, 3)).equal(30);\n        expect(Handlebars.helpers.mult(\"10\", \"3\")).equal(30);\n        expect(Handlebars.helpers.mult(\"10\", \"-3\")).equal(-30);\n        expect(Handlebars.helpers.mult(0.1, 2)).equal(0.2);\n        expect(Handlebars.helpers.mult(0.01, 1)).equal(0.01);\n        expect(Handlebars.helpers.mult(0.001, 1)).equal(0);\n      });\n    });\n\n    describe(\"roundWeight helper\", () => {\n      const helper = \"roundWeight\";\n      it(\"is registered\", () => {\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\n      });\n\n      it(\"is functional\", () => {\n        expect(Handlebars.helpers.roundWeight(10.1)).equal(0);\n        expect(Handlebars.helpers.roundWeight(100.1)).equal(0.1);\n        expect(Handlebars.helpers.roundWeight(1000.1)).equal(1);\n      });\n    });\n\n    describe(\"getTagIcon helper\", () => {\n      const helper = \"getTagIcon\";\n      it(\"is registered\", () => {\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\n      });\n\n      describe(\"is functional\", () => {\n        const tags = Object.keys(CONFIG.OSE.tags);\n        tags.forEach((tag) => {\n          it(`for ${tag} tag`, async () => {\n            expect(Handlebars.helpers.getTagIcon(CONFIG.OSE.tags[tag])).equal(\n              CONFIG.OSE.tag_images[tag]\n            );\n          });\n        });\n      });\n    });\n\n    describe(\"counter helper\", () => {\n      const helper = \"counter\";\n      it(\"is registered\", () => {\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\n      });\n\n      it(\"is functional\", () => {\n        expect(Handlebars.helpers.counter(true, 12, 10)).equal(100);\n        expect(Handlebars.helpers.counter(true, -10, 10)).equal(0);\n        expect(Handlebars.helpers.counter(true, 3, 10)).equal(30);\n        expect(Handlebars.helpers.counter(true, 33, 100)).equal(33);\n        expect(Handlebars.helpers.counter(true, 100, 400)).equal(25);\n        expect(Handlebars.helpers.counter(false, 12, 10)).equal(0);\n        expect(Handlebars.helpers.counter(false, -10, 10)).equal(100);\n        expect(Handlebars.helpers.counter(false, 3, 10)).equal(70);\n        expect(Handlebars.helpers.counter(false, 33, 100)).equal(67);\n        expect(Handlebars.helpers.counter(false, 100, 400)).equal(75);\n      });\n    });\n\n    describe(\"times helper\", () => {\n      const helper = \"times\";\n      it(\"is registered\", () => {\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\n      });\n\n      it(\"is functional\", () => {\n        const block = {\n          fn: (i) => i,\n        };\n        expect(Handlebars.helpers.times(2, block)).equal(\"01\");\n        expect(Handlebars.helpers.times(5, block)).equal(\"01234\");\n      });\n    });\n\n    describe(\"path helper\", () => {\n      const helper = \"path\";\n      it(\"is registered\", () => {\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\n      });\n\n      it(\"is functional\", () => {\n        expect(Handlebars.helpers.path(\"/test\")).equal(\n          `${CONFIG.OSE.systemPath()}/test`\n        );\n      });\n    });\n\n    describe(\"asset helper\", () => {\n      const helper = \"asset\";\n      it(\"is registered\", () => {\n        expect(Object.keys(Handlebars.helpers)).contain(helper);\n      });\n\n      it(\"is functional\", () => {\n        expect(Handlebars.helpers.asset(\"/test\")).equal(\n          `${CONFIG.OSE.assetsPath}/test`\n        );\n      });\n    });\n  });\n};\n","/**\n * @file Contains tests for Quench for testing macros\n */\n// eslint-disable-next-line import/no-cycle\nimport { QuenchMethods } from \"../../e2e\";\nimport {\n  cleanUpActorsByKey,\n  cleanUpMacros,\n  cleanUpScenes,\n  cleanUpWorldItems,\n  closeDialogs,\n  closeV2Dialogs,\n  createActorTestItem,\n  createMockActorKey,\n  createMockMacro,\n  createMockScene,\n  createWorldTestItem,\n  getActiveNotifications,\n  objectIsNotification,\n  openV2Dialogs,\n  waitForInput,\n} from \"../../e2e/testUtils\";\nimport { createOseMacro, rollItemMacro } from \"../helpers-macros\";\n\nexport const key = \"ose.helpers.macro\";\nexport const options = { displayName: \"OSE: Helpers: Macro\" };\n\n/* MOCKING HELPERS */\nconst createMockActor = async (type: string, data: object = {}) =>\n  createMockActorKey(type, data, key);\n\n/* CLEAN UP HELPERS */\nconst cleanUpActors = () => cleanUpActorsByKey(key);\n\nexport default ({\n  describe,\n  it,\n  expect,\n  before,\n  after,\n  afterEach,\n}: QuenchMethods) => {\n  before(async () => {\n    game?.scenes?.active?.update({ active: false });\n    await ui.notifications?.clear();\n  });\n\n  afterEach(async () => {\n    await closeV2Dialogs();\n    await cleanUpMacros();\n    await cleanUpActors();\n    await cleanUpWorldItems();\n    await cleanUpScenes();\n    await ui.notifications?.clear();\n  });\n\n  after(async () => {\n    await closeDialogs();\n    await closeV2Dialogs();\n    await cleanUpMacros();\n    await cleanUpActors();\n    await cleanUpWorldItems();\n    await cleanUpScenes();\n    await ui.notifications?.clear();\n  });\n\n  describe(\"createOseMacro(data, slot)\", () => {\n    it(\"Can create macro\", async () => {\n      const macro = await createMockMacro();\n      expect(game.macros?.contents.find((m) => m.uuid === macro?.uuid)).not\n        .undefined;\n    });\n\n    it(\"Can drag Macro to hotbar\", async () => {\n      const macro = await createMockMacro();\n      const data = { type: \"Macro\", uuid: macro?.uuid };\n      const macroSlot = 9;\n\n      await createOseMacro(data, macroSlot);\n      const hotbar = game.user?.getHotbarMacros(1);\n\n      expect(hotbar[macroSlot - 1].macro).equal(macro);\n    });\n\n    it(\"Dragging Actor to hotbar send notification\", async () => {\n      const actor = await createMockActor(\"character\");\n      const data = { type: actor?.type, uuid: actor?.uuid };\n      const macroSlot = 9;\n      const notification = await createOseMacro(data, macroSlot);\n      expect(objectIsNotification(notification)).equal(true);\n      expect(notification.message).equal(\n        game.i18n.localize(\"OSE.warn.macrosNotAnItem\")\n      );\n      await actor?.delete();\n    });\n\n    it(\"Dragging World Item to hotbar send notification\", async () => {\n      const actor = await createMockActor(\"character\");\n      const worldItem = await createWorldTestItem(\"weapon\");\n      const data = { type: \"Item\", uuid: worldItem?.uuid };\n      const macroSlot = 9;\n      const notification = await createOseMacro(data, macroSlot);\n      expect(objectIsNotification(notification)).equal(true);\n      expect(notification.message).equal(\n        game.i18n.localize(\"OSE.warn.macrosOnlyForOwnedItems\")\n      );\n      await actor?.delete();\n      await worldItem?.delete();\n    });\n\n    describe(\"Dragging all item types creates macros\", () => {\n      const itemTypes = new Set([\n        \"spell\",\n        \"ability\",\n        \"armor\",\n        \"weapon\",\n        \"item\",\n        \"container\",\n      ]);\n      itemTypes.forEach((type) => {\n        it(`Dragging Actor ${type.capitalize()} to hotbar craetes macro`, async () => {\n          const actor = await createMockActor(\"character\");\n          await createActorTestItem(actor, type);\n          const item = actor?.items.contents[0];\n          const data = {\n            type: \"Item\",\n            uuid: item?.uuid,\n            item: {\n              name: item?.name,\n              img: \"\",\n            },\n          };\n          const macroSlot = 9;\n\n          await createOseMacro(data, macroSlot);\n          const macro = game.user?.getHotbarMacros()[macroSlot - 1];\n          expect(macro?.macro?.command).equal(\n            `game.ose.rollItemMacro(\"New Actor Test ${type.capitalize()}\");`\n          );\n          await actor?.delete();\n        });\n      });\n    });\n  });\n\n  describe(\"rollItemMacro(itemName)\", () => {\n    it(\"No scene creates warning\", async () => {\n      const type = \"weapon\";\n      const actor = await createMockActor(\"character\");\n      await createActorTestItem(actor, type);\n      await game.user?.update({ character: actor?.id });\n      expect(ChatMessage.getSpeaker().scene).is.null;\n      expect(ChatMessage.getSpeaker().actor).is.not.null;\n      const notification = await rollItemMacro(\n        `New Actor Test ${type.capitalize()}`\n      );\n      expect(objectIsNotification(notification)).equal(true);\n      expect(notification.message).equal(\n        game.i18n.localize(\"OSE.warn.macrosNoTokenOwnedInScene\")\n      );\n      await actor?.delete();\n    });\n\n    it(\"No assigned actor creates warning\", async () => {\n      const type = \"weapon\";\n      const actor = await createMockActor(\"character\");\n      const scene = await createMockScene();\n      expect(scene?.tokenVision).equal(true);\n      await createActorTestItem(actor, type);\n      await game.user?.update({ character: null });\n      expect(ChatMessage.getSpeaker().scene).is.not.null;\n      expect(ChatMessage.getSpeaker().actor).is.null;\n      const notification = await rollItemMacro(\n        `New Actor Test ${type.capitalize()}`\n      );\n      expect(objectIsNotification(notification)).equal(true);\n      expect(notification.message).equal(\n        game.i18n.localize(\"OSE.warn.macrosNoTokenOwnedInScene\")\n      );\n      await actor?.delete();\n      await scene?.delete();\n    });\n\n    it(\"Scene & assigned actor creates roll\", async () => {\n      const type = \"weapon\";\n      const actor = await createMockActor(\"character\");\n      const scene = await createMockScene();\n      expect(scene?.tokenVision).equal(true);\n      await createActorTestItem(actor, type);\n      await game.user?.update({ character: actor?.id });\n      expect(ChatMessage.getSpeaker().scene).is.not.null;\n      expect(ChatMessage.getSpeaker().actor).is.not.null;\n      await rollItemMacro(`New Actor Test ${type.capitalize()}`);\n      await waitForInput();\n      expect(openV2Dialogs().length).equal(1);\n      await closeV2Dialogs();\n      await actor?.delete();\n      await scene?.delete();\n    });\n\n    it(\"Duplicate item creates warning but also creates rolls\", async () => {\n      const type = \"weapon\";\n      const actor = await createMockActor(\"character\");\n      const scene = await createMockScene();\n      expect(scene?.tokenVision).equal(true);\n      await createActorTestItem(actor, type);\n      await createActorTestItem(actor, type);\n      await game.user?.update({ character: actor?.id });\n      await rollItemMacro(`New Actor Test ${type.capitalize()}`);\n      await waitForInput();\n      expect(getActiveNotifications().map((li) => li?.textContent?.trim()))\n        .to.be.an(\"array\")\n        .that.includes(\n          game.i18n.format(\"OSE.warn.moreThanOneItemWithName\", {\n            actorName: actor?.name,\n            itemName: `New Actor Test ${type.capitalize()}`,\n          })\n        );\n      await waitForInput();\n      expect(openV2Dialogs().length).equal(1);\n      await closeV2Dialogs();\n      await actor?.delete();\n      await scene?.delete();\n    });\n\n    it(\"Missing item creates warning\", async () => {\n      const type = \"weapon\";\n      const actor = await createMockActor(\"character\");\n      const scene = await createMockScene();\n      expect(scene?.tokenVision).equal(true);\n      await createActorTestItem(actor, type);\n      await game.user?.update({ character: actor?.id });\n      await actor?.items\n        .getName(`New Actor Test ${type.capitalize()}`)\n        ?.delete();\n      const notification = await rollItemMacro(\n        `New Actor Test ${type.capitalize()}`\n      );\n      await waitForInput();\n      expect(objectIsNotification(notification)).equal(true);\n      expect(notification.type).equal(\"error\");\n      expect(notification.message).equal(\n        game.i18n.format(\"OSE.error.noItemWithName\", {\n          actorName: actor?.name,\n          itemName: `New Actor Test ${type.capitalize()}`,\n        })\n      );\n      await actor?.delete();\n      await scene?.delete();\n    });\n  });\n};\n","/**\n * @file Contains tests for party helpers\n */\n// eslint-disable-next-line prettier/prettier, import/no-cycle\nimport { QuenchMethods } from \"../../e2e\";\nimport {\n  cleanUpActorsByKey,\n  closeDialogs,\n  createMockActorKey,\n  openDialogs,\n  waitForInput,\n} from \"../../e2e/testUtils\";\nimport { update } from \"../helpers-party\";\nimport OsePartySheet from \"../party/party-sheet\";\n\nexport const key = \"ose.helpers.party\";\nexport const options = {\n  displayName: \"OSE: Helpers: Party\",\n};\n\n/* MOCKING HELPERS */\nconst createMockActor = async (type: string, data: object = {}) =>\n  createMockActorKey(type, data, key);\n\n/* CLEAN UP HELPERS */\nconst cleanUpActors = () => cleanUpActorsByKey(key);\n\nexport default ({ describe, it, expect, after }: QuenchMethods) => {\n  after(() => {\n    cleanUpActors();\n  });\n\n  // @todo: How to test?\n  describe(\"addControl(object, html)\", () => {});\n\n  describe(\"update(actor)\", () => {\n    it(\"Doesn't render a partysheet when not in party\", async () => {\n      const actor = await createMockActor(\"character\");\n      update(actor);\n      expect(openDialogs().length).equal(0);\n      await actor?.delete();\n    });\n\n    it(\"Opens a partysheet when in party\", async () => {\n      const actor = await createMockActor(\"character\");\n      await actor?.setFlag(game.system.id, \"party\", true);\n      update(actor);\n      await waitForInput();\n      await OsePartySheet?.partySheet?.render(true);\n      await waitForInput();\n      const partyMember = document\n        .querySelector(\".party-members .actor\")\n        ?.getAttribute(\"data-actor-id\");\n      expect(partyMember).equal(actor?.id);\n      expect(openDialogs().length).equal(1);\n      await closeDialogs();\n      actor?.delete();\n    });\n  });\n};\n","/**\n * @file Contains tests for treasure helpers\n */\n// eslint-disable-next-line prettier/prettier, import/no-cycle\nimport { QuenchMethods } from \"../../e2e\";\nimport { rollSpecificNumber, trashChat, waitForInput } from \"../../e2e/testUtils\";\nimport { functionsForTesting } from \"../helpers-treasure\";\n\nconst { drawTreasure, rollTreasure } = functionsForTesting;\n\nexport const key = \"ose.helpers.treasure\";\nexport const options = {\n  displayName: \"OSE: Helpers: Treasure\",\n};\n\nconst createMockTable = async () =>\n  RollTable.create({\n    name: `Mock Table ${key}`,\n  });\n\nconst createMockTreasureTable = async () => {\n  const table: RollTable = (await createMockTable()) as RollTable;\n  await table.update({ name: `Mock Treasure Table ${key}` });\n  await table.setFlag(game.system.id, \"treasure\", true);\n  return table;\n};\n\nconst cleanUpTables = async () => {\n  const tables = game.tables?.filter(\n    (t) =>\n      t.name === `Mock Table ${key}` || t.name === `Mock Treasure Table ${key}`\n  );\n  tables?.forEach((t) => t.delete());\n};\n\nexport default ({ describe, it, expect, after }: QuenchMethods) => {\n  // @todo: how to test?\n  describe(\"augmentTable(table, html)\", () => {});\n\n  describe(\"drawTreasure(table, data)\", () => {\n    it(\"Can create table\", async () => {\n      const table = await createMockTreasureTable();\n      await table.createEmbeddedDocuments(\"TableResult\", [\n        {\n          text: \"50% Chance\",\n          range: [1, 1],\n          weight: 50,\n        },\n      ]);\n      expect(table.results.size).equal(1);\n      await table.delete();\n    });\n\n    it(\"Draws successfully from a treasure table\", async () => {\n      const table = await createMockTreasureTable();\n      await table.createEmbeddedDocuments(\"TableResult\", [\n        {\n          text: \"100% Chance\",\n          range: [1, 1],\n          weight: 100,\n        },\n      ]);\n      const data = await drawTreasure(table, {});\n      await waitForInput();\n      expect(data.treasure).is.not.undefined;\n      const resultKey = Object.keys(data.treasure)[0];\n      expect(data.treasure[resultKey].text).to.include(\"100% Chance\");\n    });\n\n    it(\"Draws unsuccessfully from a treasure table\", async () => {\n      // Ensure the dice roll is greater than 1\n      const existingRandomFunction = CONFIG.Dice.randomUniform;\n      CONFIG.Dice.randomUniform = () => rollSpecificNumber(2, 100);\n\n      const table = await createMockTreasureTable();\n      await table.createEmbeddedDocuments(\"TableResult\", [\n        {\n          text: \"1% Chance\",\n          range: [1, 1],\n          weight: 1,\n        },\n      ]);\n      const data = await drawTreasure(table, {});\n      expect(Object.keys(data.treasure).length).equal(0);\n\n      // Restore the original random function\n      CONFIG.Dice.randomUniform = existingRandomFunction;\n    });\n\n    it(\"Just draws from a non-treasure table\", async () => {\n      const table = await createMockTable();\n      table?.update({ formula: \"1d100\" });\n      await table?.createEmbeddedDocuments(\"TableResult\", [\n        {\n          text: \"100% Chance\",\n          range: [1, 100],\n        },\n      ]);\n      const data = await drawTreasure(table, {});\n      await waitForInput();\n      expect(data.treasure).is.not.undefined;\n      const resultKey = Object.keys(data.treasure)[0];\n      expect(data.treasure[resultKey].text).to.include(\"100% Chance\");\n    });\n  });\n\n  describe(\"rollTreasure(table, options)\", () => {\n    it(\"Rolling on treasure table produces a chat message\", async () => {\n      trashChat();\n      const table = await createMockTreasureTable();\n      await table.createEmbeddedDocuments(\"TableResult\", [\n        {\n          text: \"100% Chance\",\n          range: [1, 1],\n          weight: 100,\n        },\n      ]);\n      await rollTreasure(table);\n      await waitForInput();\n      expect(game.messages?.size).equal(1);\n      expect(game.messages?.contents[0].content).contains(\"100% Chance\");\n    });\n  });\n\n  after(() => {\n    cleanUpTables();\n    trashChat();\n  });\n};\n","/* eslint-disable import/no-cycle */\n/* eslint-disable simple-import-sort/imports */\n/**\n * @file Orchestration for our Quench tests\n */\n// ACTOR TESTING IMPORTS\nimport actorDataModelCharacterTests, {\n  key as actorDataModelCharacterKey,\n  options as actorDataModelCharacterOptions,\n} from \"../module/actor/__tests__/data-model-character.test\";\nimport actorDataModelCharacterACTests, {\n  key as actorDataModelCharacterACKey,\n  options as actorDataModelCharacterACOptions,\n} from \"../module/actor/data-model-classes/__tests__/data-model-character-ac.test\";\nimport actorDataModelCharacterEncumbranceTests, {\n  key as actorDataModelCharacterEncumbranceKey,\n  options as actorDataModelCharacterEncumbranceOptions,\n} from \"../module/actor/data-model-classes/__tests__/data-model-character-encumbrance.test\";\nimport actorDataModelCharacterMoveTests, {\n  key as actorDataModelCharacterMoveKey,\n  options as actorDataModelCharacterMoveOptions,\n} from \"../module/actor/data-model-classes/__tests__/data-model-character-move.test\";\nimport actorDataModelCharacterScoresTests, {\n  key as actorDataModelCharacterScoresKey,\n  options as actorDataModelCharacterScoresOptions,\n} from \"../module/actor/data-model-classes/__tests__/data-model-character-scores.test\";\nimport actorDataModelCharacterSpellsTests, {\n  key as actorDataModelCharacterSpellsKey,\n  options as actorDataModelCharacterSpellsOptions,\n} from \"../module/actor/data-model-classes/__tests__/data-model-character-spells.test\";\nimport actorDataModelMonsterTests, {\n  key as actorDataModelMonsterKey,\n  options as actorDataModelMonsterOptions,\n} from \"../module/actor/__tests__/data-model-monster.test\";\nimport actorEntityTests, {\n  key as actorEntityKey,\n  options as actorEntityOptions,\n} from \"../module/actor/__tests__/entity-actor.test\";\nimport actorSheetTests, {\n  key as actorSheetKey,\n  options as actorSheetOptions,\n} from \"../module/actor/__tests__/sheet-actor.test\";\nimport actorSheetDragNDropTests, {\n  key as actorSheetDragNDropKey,\n  options as actorSheetDragNDropOptions,\n} from \"../module/actor/__tests__/sheet-actor/sheet-actor-e2e-dragndrop.test\";\nimport actorSheetCharacterTests, {\n  key as actorSheetCharacterKey,\n  options as actorSheetCharacterOptions,\n} from \"../module/actor/__tests__/sheet-character.test\";\nimport actorSheetMonsterTests, {\n  key as actorSheetMonsterKey,\n  options as actorSheetMonsterOptions,\n} from \"../module/actor/__tests__/sheet-monster.test\";\n\n// COMBAT TESTING IMPORTS\nimport combatTests, {\n  key as combatKey,\n  options as combatOptions,\n} from \"../module/combat/__tests__/combat.test\";\n\n// DIALOG TESTING IMPORTS\nimport actorSheetCharacterDialogModifiersTest, {\n  key as actorSheetCharacterDialogModifiersKey,\n  options as actorSheetCharacterDialogModifiersOptions,\n} from \"../module/dialog/__tests__/sheet-character-modifiers.test\";\nimport actorSheetDialogEntityTweaksTests, {\n  key as actorSheetDialogEntityTweaksKey,\n  options as actorSheetDialogEntityTweaksOptions,\n} from \"../module/dialog/__tests__/sheet-entity-tweaks.test\";\n\n// ITEM TESTING IMPORTS\nimport itemDataModelAbilityTests, {\n  key as itemDataModelAbilityKey,\n  options as itemDataModelAbilityOptions,\n} from \"../module/item/__tests__/data-model-item-ability.test\";\nimport itemDataModelArmorTests, {\n  key as itemDataModelArmorKey,\n  options as itemDataModelArmorOptions,\n} from \"../module/item/__tests__/data-model-item-armor.test\";\nimport itemDataModelContainerTests, {\n  key as itemDataModelContainerKey,\n  options as itemDataModelContainerOptions,\n} from \"../module/item/__tests__/data-model-item-container.test\";\nimport itemDataModelMiscTests, {\n  key as itemDataModelMiscKey,\n  options as itemDataModelMiscOptions,\n} from \"../module/item/__tests__/data-model-item-misc.test\";\nimport itemDataModelSpellTests, {\n  key as itemDataModelSpellKey,\n  options as itemDataModelSpellOptions,\n} from \"../module/item/__tests__/data-model-item-spell.test\";\nimport itemDataModelWeaponTests, {\n  key as itemDataModelWeaponKey,\n  options as itemDataModelWeaponOptions,\n} from \"../module/item/__tests__/data-model-item-weapon.test\";\nimport itemEntityTests, {\n  key as itemEntityKey,\n  options as itemEntityOptions,\n} from \"../module/item/__tests__/entity-item.test\";\nimport itemSheetTests, {\n  key as itemSheetKey,\n  options as itemSheetOptions,\n} from \"../module/item/__tests__/sheet-item.test\";\n\n// PARTY TESTING IMPORTS\nimport partyEntityTests, {\n  key as partyEntityKey,\n  options as partyEntityOptions,\n} from \"../module/party/__tests__/entity-party.test\";\nimport partySheetTests, {\n  key as partySheetKey,\n  options as partySheetOptions,\n} from \"../module/party/__tests__/sheet-party.test\";\nimport partyXpSheetTests, {\n  key as partyXpSheetKey,\n  options as partyXpSheetOptions,\n} from \"../module/party/__tests__/sheet-party-xp.test\";\n\n// HELPER TESTING IMPORTS\nimport helpersBehaviourTests, {\n  key as helpersBehaviourKey,\n  options as helpersBehaviourOptions,\n} from \"../module/__tests__/helpers-behaviour.test\";\nimport helpersChatTests, {\n  key as helpersChatKey,\n  options as helpersChatOptions,\n} from \"../module/__tests__/helpers-chat.test\";\nimport helpersDiceTests, {\n  key as helpersDiceKey,\n  options as helpersDiceOptions,\n} from \"../module/__tests__/helpers-dice.test\";\nimport helpersHandlebarsTests, {\n  key as helpersHandlebarsKey,\n  options as helpersHandlebarsOptions,\n} from \"../module/__tests__/helpers-handlebars.test\";\nimport helpersMacrosTests, {\n  key as helpersMacrosKey,\n  options as helpersMacrosOptions,\n} from \"../module/__tests__/helpers-macros.test\";\nimport helpersPartyTests, {\n  key as helpersPartyKey,\n  options as helpersPartyOptions,\n} from \"../module/__tests__/helpers-party.test\";\nimport helpersTreasureTests, {\n  key as helpersTreasureKey,\n  options as helpersTreasureOptions,\n} from \"../module/__tests__/helpers-treasure.test\";\n\nexport type QuenchMethods = {\n  [s: string]: any;\n};\n\ntype Quench = {\n  registerBatch: (key: string, tests: Function, options: any) => void;\n};\n\nHooks.on(\"quenchReady\", async (quench: Quench) => {\n  /* ------------------------------------------- */\n  /* ACTOR TESTING                               */\n  /* ------------------------------------------- */\n  quench.registerBatch(\n    actorDataModelCharacterKey,\n    actorDataModelCharacterTests,\n    actorDataModelCharacterOptions\n  );\n  quench.registerBatch(\n    actorDataModelCharacterACKey,\n    actorDataModelCharacterACTests,\n    actorDataModelCharacterACOptions\n  );\n  quench.registerBatch(\n    actorDataModelCharacterEncumbranceKey,\n    actorDataModelCharacterEncumbranceTests,\n    actorDataModelCharacterEncumbranceOptions\n  );\n  quench.registerBatch(\n    actorDataModelCharacterMoveKey,\n    actorDataModelCharacterMoveTests,\n    actorDataModelCharacterMoveOptions\n  );\n  quench.registerBatch(\n    actorDataModelCharacterScoresKey,\n    actorDataModelCharacterScoresTests,\n    actorDataModelCharacterScoresOptions\n  );\n  quench.registerBatch(\n    actorDataModelCharacterSpellsKey,\n    actorDataModelCharacterSpellsTests,\n    actorDataModelCharacterSpellsOptions\n  );\n  quench.registerBatch(\n    actorDataModelMonsterKey,\n    actorDataModelMonsterTests,\n    actorDataModelMonsterOptions\n  );\n\n  quench.registerBatch(actorEntityKey, actorEntityTests, actorEntityOptions);\n\n  quench.registerBatch(actorSheetKey, actorSheetTests, actorSheetOptions);\n  quench.registerBatch(\n    actorSheetDragNDropKey,\n    actorSheetDragNDropTests,\n    actorSheetDragNDropOptions\n  );\n  quench.registerBatch(\n    actorSheetCharacterKey,\n    actorSheetCharacterTests,\n    actorSheetCharacterOptions\n  );\n  quench.registerBatch(\n    actorSheetMonsterKey,\n    actorSheetMonsterTests,\n    actorSheetMonsterOptions\n  );\n\n  /* ------------------------------------------- */\n  /* COMBAT TESTING                              */\n  /* ------------------------------------------- */\n\n  quench.registerBatch(combatKey, combatTests, combatOptions);\n\n  /* ------------------------------------------- */\n  /* DIALOG TESTING                              */\n  /* ------------------------------------------- */\n\n  quench.registerBatch(\n    actorSheetCharacterDialogModifiersKey,\n    actorSheetCharacterDialogModifiersTest,\n    actorSheetCharacterDialogModifiersOptions\n  );\n  quench.registerBatch(\n    actorSheetDialogEntityTweaksKey,\n    actorSheetDialogEntityTweaksTests,\n    actorSheetDialogEntityTweaksOptions\n  );\n\n  /* ------------------------------------------- */\n  /* ITEM TESTING                                */\n  /* ------------------------------------------- */\n\n  quench.registerBatch(\n    itemDataModelAbilityKey,\n    itemDataModelAbilityTests,\n    itemDataModelAbilityOptions\n  );\n  quench.registerBatch(\n    itemDataModelArmorKey,\n    itemDataModelArmorTests,\n    itemDataModelArmorOptions\n  );\n  quench.registerBatch(\n    itemDataModelContainerKey,\n    itemDataModelContainerTests,\n    itemDataModelContainerOptions\n  );\n  quench.registerBatch(\n    itemDataModelMiscKey,\n    itemDataModelMiscTests,\n    itemDataModelMiscOptions\n  );\n  quench.registerBatch(\n    itemDataModelSpellKey,\n    itemDataModelSpellTests,\n    itemDataModelSpellOptions\n  );\n  quench.registerBatch(\n    itemDataModelWeaponKey,\n    itemDataModelWeaponTests,\n    itemDataModelWeaponOptions\n  );\n\n  quench.registerBatch(itemEntityKey, itemEntityTests, itemEntityOptions);\n\n  quench.registerBatch(itemSheetKey, itemSheetTests, itemSheetOptions);\n\n  /* ------------------------------------------- */\n  /* PARTY TESTING                         */\n  /* ------------------------------------------- */\n\n  quench.registerBatch(partyEntityKey, partyEntityTests, partyEntityOptions);\n  quench.registerBatch(partySheetKey, partySheetTests, partySheetOptions);\n  quench.registerBatch(partyXpSheetKey, partyXpSheetTests, partyXpSheetOptions);\n\n  /* ------------------------------------------- */\n  /* HELPER TESTING                               */\n  /* ------------------------------------------- */\n\n  quench.registerBatch(\n    helpersBehaviourKey,\n    helpersBehaviourTests,\n    helpersBehaviourOptions\n  );\n  quench.registerBatch(helpersChatKey, helpersChatTests, helpersChatOptions);\n  quench.registerBatch(helpersDiceKey, helpersDiceTests, helpersDiceOptions);\n  quench.registerBatch(\n    helpersHandlebarsKey,\n    helpersHandlebarsTests,\n    helpersHandlebarsOptions\n  );\n  quench.registerBatch(\n    helpersMacrosKey,\n    helpersMacrosTests,\n    helpersMacrosOptions\n  );\n  quench.registerBatch(helpersPartyKey, helpersPartyTests, helpersPartyOptions);\n  quench.registerBatch(\n    helpersTreasureKey,\n    helpersTreasureTests,\n    helpersTreasureOptions\n  );\n});","/**\n * @file The entry point for the OSE system\n *       We should handle most of our setup here.\n */\nimport OseActorSheetCharacter from \"./module/actor/character-sheet\";\nimport OseDataModelCharacter from \"./module/actor/data-model-character\";\nimport OseDataModelMonster from \"./module/actor/data-model-monster\";\nimport OseActor from \"./module/actor/entity\";\nimport OseActorSheetMonster from \"./module/actor/monster-sheet\";\n\nimport OseDataModelAbility from \"./module/item/data-model-ability\";\nimport OseDataModelArmor from \"./module/item/data-model-armor\";\nimport OseDataModelContainer from \"./module/item/data-model-container\";\nimport OseDataModelItem from \"./module/item/data-model-item\";\nimport OseDataModelSpell from \"./module/item/data-model-spell\";\nimport OseDataModelWeapon from \"./module/item/data-model-weapon\";\nimport OseItem from \"./module/item/entity\";\nimport OseItemSheet from \"./module/item/item-sheet\";\n\nimport { OSE } from \"./module/config\";\nimport registerFVTTModuleAPIs from \"./module/fvttModuleAPIs\";\nimport * as chat from \"./module/helpers-chat\";\nimport handlebarsHelpers from \"./module/helpers-handlebars\";\nimport * as macros from \"./module/helpers-macros\";\nimport * as party from \"./module/helpers-party\";\nimport * as treasure from \"./module/helpers-treasure\";\nimport OsePartySheet from \"./module/party/party-sheet\";\nimport templates from \"./module/preloadTemplates\";\nimport * as renderList from \"./module/renderList\";\nimport { initializeTokenRing, promptTokenRingSelection } from \"./module/rings\";\nimport registerSettings from \"./module/settings\";\n\nimport { OSECombat } from \"./module/combat/combat\";\nimport OSECombatTracker from \"./module/combat/combat-tracker\";\nimport { OSECombatant } from \"./module/combat/combatant\";\nimport TokenRulerOSE from \"./module/actor/token-ruler\";\n\nimport \"./e2e\";\n\n/* -------------------------------------------- */\n/*  Foundry VTT Initialization                  */\n/* -------------------------------------------- */\n\nHooks.once(\"init\", async () => {\n  CONFIG.OSE = OSE;\n\n  // Give modules a chance to add encumbrance schemes\n  // They can do so by adding their encumbrance schemes\n  // to CONFIG.OSE.encumbranceOptions\n  Hooks.call(\"ose-setup-encumbrance\");\n\n  if (game.system.id === \"ose\") {\n    CONFIG.debug = {\n      ...CONFIG.debug,\n      combat: true,\n    };\n  }\n\n  // Register custom system settings\n  registerSettings();\n\n  CONFIG.Combat.documentClass = OSECombat;\n  CONFIG.Combatant.documentClass = OSECombatant;\n  const isGroupInitiative =\n    game.settings.get(game.system.id, \"initiative\") === \"group\";\n  CONFIG.Combat.initiative = {\n    decimals: 2,\n    formula: isGroupInitiative ? OSECombat.GROUP_FORMULA : OSECombat.FORMULA,\n  };\n\n  CONFIG.Combat.fallbackTurnMarker = \"icons/svg/circle.svg\";\n  CONFIG.ui.combat = OSECombatTracker;\n  CONFIG.Token.rulerClass = TokenRulerOSE;\n\n  game.ose = {\n    rollItemMacro: macros.rollItemMacro,\n    rollTableMacro: macros.rollTableMacro,\n  };\n\n  // Init Party Sheet handler\n  OsePartySheet.init();\n\n  // Custom Handlebars helpers\n  handlebarsHelpers();\n\n  // Register APIs of Foundry VTT Modules we explicitly support that provide custom hooks\n  registerFVTTModuleAPIs();\n\n  CONFIG.Actor.documentClass = OseActor;\n  CONFIG.Item.documentClass = OseItem;\n\n  CONFIG.Actor.dataModels = {\n    character: OseDataModelCharacter,\n    monster: OseDataModelMonster,\n  };\n  CONFIG.Item.dataModels = {\n    weapon: OseDataModelWeapon,\n    armor: OseDataModelArmor,\n    item: OseDataModelItem,\n    spell: OseDataModelSpell,\n    ability: OseDataModelAbility,\n    container: OseDataModelContainer,\n  };\n\n  // Register sheet application classes\n  foundry.documents.collections.Actors.unregisterSheet(\n    \"core\",\n    foundry.appv1.sheets.ActorSheet\n  );\n  foundry.documents.collections.Actors.registerSheet(\n    game.system.id,\n    OseActorSheetCharacter,\n    {\n      types: [\"character\"],\n      makeDefault: true,\n      label: \"OSE.SheetClassCharacter\",\n    }\n  );\n  foundry.documents.collections.Actors.registerSheet(\n    game.system.id,\n    OseActorSheetMonster,\n    {\n      types: [\"monster\"],\n      makeDefault: true,\n      label: \"OSE.SheetClassMonster\",\n    }\n  );\n\n  foundry.documents.collections.Items.unregisterSheet(\n    \"core\",\n    foundry.appv1.sheets.ItemSheet\n  );\n  foundry.documents.collections.Items.registerSheet(\n    game.system.id,\n    OseItemSheet,\n    {\n      makeDefault: true,\n      label: \"OSE.SheetClassItem\",\n    }\n  );\n\n  await templates();\n});\n\n/**\n * This function runs after game data has been requested and loaded from the servers, so entities exist\n */\nHooks.once(\"setup\", () => {\n  // Localize CONFIG objects once up-front\n  [\"saves_short\", \"saves_long\", \"scores\", \"armor\", \"colors\", \"tags\"].forEach(\n    (o) => {\n      CONFIG.OSE[o] = Object.entries(CONFIG.OSE[o]).reduce((obj, e) => {\n        const localized = { ...obj };\n        localized[e[0]] = game.i18n.localize(e[1]);\n        return localized;\n      }, {});\n    }\n  );\n\n  // Custom languages\n  const languages = game.settings.get(game.system.id, \"languages\");\n  if (languages !== \"\") {\n    const langArray = languages.split(\",\").map((s) => s.trim());\n    CONFIG.OSE.languages = langArray;\n  }\n});\n\nHooks.once(\"ready\", async () => {\n  Hooks.on(\"hotbarDrop\", (bar, data, slot) => {\n    if ([\"Macro\", \"RollTable\", \"Item\"].includes(data.type)) {\n      macros.createOseMacro(data, slot);\n      // Returning false to stop the rest of hotbarDrop handling.\n      return false;\n    }\n    // Any other type of drop can continue to be handled normally.\n    return true;\n  });\n\n  await promptTokenRingSelection();\n});\n\n// Party sheet control\nHooks.on(\"activateActorDirectory\", party.addControl);\n\n/**\n * @param {Application} app\n * @param {HTMLElement} html\n */\nHooks.on(\"renderSettings\", async (app, html) => {\n  const gamesystem = html.querySelector(\"section.info\");\n  const template = `${OSE.systemPath()}/templates/chat/license.html`;\n  const rendered = await foundry.applications.handlebars.renderTemplate(\n    template\n  );\n  gamesystem.insertAdjacentHTML(\"afterend\", rendered);\n});\n\nHooks.on(\"renderChatLog\", (app, html) => OseItem.chatListeners(html));\nHooks.on(\"getChatLogEntryContext\", chat.addChatMessageContextOptions);\nHooks.on(\"getChatMessageContextOptions\", chat.addChatMessageContextOptions);\nHooks.on(\"renderChatMessageHTML\", chat.addChatMessageButtons);\nHooks.on(\"renderRollTableSheet\", treasure.augmentTable);\nHooks.on(\"updateActor\", party.update);\n/**\n * @param {OSECombatTracker} app - The combat tracker application\n * @param {HTMLElement} html - The HTML element of the combat tracker\n */\nHooks.on(\"renderCombatTracker\", (app, html) =>\n  app.renderGroups(html instanceof HTMLElement ? html : html[0])\n);\n/**\n * @param {foundry.documents.CombatantGroup} combatantGroup - The combatant group being updated\n */\nHooks.on(\"updateCombatantGroup\", async (combatantGroup) => {\n  await combatantGroup.parent?.onUpdateCombatantGroup();\n});\n/** @param {OSECombatant} combatant */\nHooks.on(\"createCombatant\", (combatant) => {\n  if (\n    game.settings.get(game.system.id, \"initiative\") !== \"group\" ||\n    !game.user.isGM\n  ) {\n    return;\n  }\n  combatant.assignGroup();\n});\n\nHooks.on(\"renderActorSheet\", (app, html) => {\n  if (!app?.object?.isOwnerOrObserver) return;\n\n  new foundry.applications.ux.ContextMenu(\n    html,\n    \".item\",\n    [\n      {\n        name: \"OSE.Show\",\n        icon: \"<i class='fas fa-eye'></i>\",\n        callback: (el) => {\n          const id = el.dataset?.itemId;\n          const item = app.actor?.items?.get(id);\n          if (item) {\n            item.show();\n          }\n        },\n      },\n      {\n        name: \"OSE.items.Equip\",\n        icon: \"<i class='fas fa-hand'></i>\",\n        condition: (el) => {\n          if (\n            app.actor?.type !== \"character\" ||\n            !app.object?.sheet?.isEditable\n          ) {\n            return false;\n          }\n\n          const id = el.dataset?.itemId;\n          const item = app.actor?.items?.get(id);\n          return [\"item\", \"armor\", \"weapon\", \"treasure\", \"container\"].includes(\n            item?.type\n          );\n        },\n        callback: async (el) => {\n          const id = el.dataset?.itemId;\n          const item = app.actor?.items?.get(id);\n          if (item) {\n            await item.update({\n              system: {\n                equipped: !item.system.equipped,\n              },\n            });\n          }\n        },\n      },\n      {\n        name: \"OSE.Edit\",\n        icon: \"<i class='fas fa-edit'></i>\",\n        condition: () => !!app.object?.sheet?.isEditable,\n        callback: (el) => {\n          const id = el.dataset?.itemId;\n          const item = app.actor?.items?.get(id);\n          if (item) {\n            item.sheet.render(true);\n          }\n        },\n      },\n      {\n        name: \"OSE.Delete\",\n        icon: \"<i class='fas fa-trash'></i>\",\n        condition: () => !!app.object?.sheet?.isEditable,\n        callback: (el) => {\n          const id = el.dataset?.itemId;\n          const item = app.actor?.items?.get(id);\n          if (item) {\n            app._promptRemoveItemFromActor(item);\n          }\n        },\n      },\n    ],\n    {\n      jQuery: false,\n    }\n  );\n});\n\nHooks.on(\"renderCompendium\", renderList.RenderCompendium);\nHooks.on(\"activateItemDirectory\", renderList.RenderItemDirectory);\n\nHooks.on(\"OSE.Party.showSheet\", OsePartySheet.showPartySheet);\nHooks.once(\"initializeDynamicTokenRingConfig\", initializeTokenRing);","/**\n * @file A place to store Handlebars helpers for our templates\n */\nimport OSE, { InventoryItemTag } from \"./config\";\n\nconst registerHelpers = async () => {\n  // Handlebars template helpers\n  Handlebars.registerHelper(\"eq\", (a, b) => a === b);\n\n  Handlebars.registerHelper(\"mod\", (val) => {\n    if (val > 0) {\n      return `+${val}`;\n    }\n    if (val < 0) {\n      return `${val}`;\n    }\n    return \"0\";\n  });\n\n  Handlebars.registerHelper(\n    \"add\",\n    (lh, rh) => parseInt(lh, 10) + parseInt(rh, 10)\n  );\n\n  Handlebars.registerHelper(\n    \"subtract\",\n    (lh, rh) => parseInt(lh, 10) - parseInt(rh, 10)\n  );\n\n  Handlebars.registerHelper(\"divide\", (lh, rh) =>\n    Math.floor(parseFloat(lh) / parseFloat(rh))\n  );\n\n  Handlebars.registerHelper(\n    \"mult\",\n    (lh, rh) => Math.round(100 * parseFloat(lh) * parseFloat(rh)) / 100\n  );\n\n  Handlebars.registerHelper(\n    \"roundWeight\",\n    (weight) => Math.round(parseFloat(weight) / 100) / 10\n  );\n\n  Handlebars.registerHelper(\"getTagIcon\", (tagValue: string) => {\n    const tagKey = (Object.keys(CONFIG.OSE.tags) as InventoryItemTag[])\n      // find key for the tag display name who's name matches the provided tag text.\n      .find((findTagName) => CONFIG.OSE.tags[findTagName] === tagValue);\n    // if that tag key is found, return the image for the tag key\n    return tagKey ? CONFIG.OSE.tag_images[tagKey] : null;\n  });\n\n  Handlebars.registerHelper(\"counter\", (status, value, max) =>\n    status\n      ? Math.clamp((100 * value) / max, 0, 100)\n      : Math.clamp(100 - (100 * value) / max, 0, 100)\n  );\n\n  Handlebars.registerHelper(\"times\", (n, block) => {\n    let accum = \"\";\n    // eslint-disable-next-line no-plusplus\n    for (let i = 0; i < n; ++i) accum += block.fn(i);\n    return accum;\n  });\n\n  Handlebars.registerHelper(\n    \"path\",\n    (relativePath) => `${OSE.systemPath()}${relativePath}`\n  );\n\n  Handlebars.registerHelper(\n    \"asset\",\n    (relativePath) => `${OSE.assetsPath}${relativePath}`\n  );\n\n  Handlebars.registerHelper(\"ceil\", (val) => Math.ceil(val));\n\n  Handlebars.registerHelper(\n    \"partial\",\n    (path) => `${OSE.systemPath()}/templates/${path}`\n  );\n};\n\nexport default registerHelpers;\n","/**\n * @file Register APIs that help the system more gracefully integrate with other modules\n */\n\nconst registerFVTTModuleAPIs = () => {\n  // see docs for more info https://github.com/fantasycalendar/FoundryVTT-ItemPiles/blob/master/docs/api.md\n  Hooks.once(\"item-piles-ready\", async () => {\n    game.itempiles.API.addSystemIntegration({\n      VERSION: \"1.0.1\",\n\n      // The actor class type is the type of actor that will be used for the default item pile actor that is created on first item drop.\n      ACTOR_CLASS_TYPE: \"character\",\n\n      // The item quantity attribute is the path to the attribute on items that denote how many of that item that exists\n      ITEM_QUANTITY_ATTRIBUTE: \"system.quantity.value\",\n\n      // The item price attribute is the path to the attribute on each item that determine how much it costs\n      ITEM_PRICE_ATTRIBUTE: \"system.cost\",\n\n      // Item types and the filters actively remove items from the item pile inventory UI that users cannot loot, such as spells, feats, and classes\n      ITEM_FILTERS: [\n        {\n          path: \"type\",\n          filters: \"spell,ability\",\n        },\n      ],\n\n      UNSTACKABLE_ITEM_TYPES: [\"weapon\", \"armor\", \"container\"],\n\n      // Item similarities determines how item piles detect similarities and differences in the system\n      ITEM_SIMILARITIES: [\"name\", \"type\", \"system.treasure\"],\n\n      // Currencies in item piles is a versatile system that can accept actor attributes (a number field on the actor's sheet) or items (actual items in their inventory)\n      // In the case of attributes, the path is relative to the \"actor.system\"\n      // In the case of items, it is recommended you export the item with `.toObject()` and strip out any module data\n      CURRENCIES: [\n        {\n          type: \"item\",\n          name: \"OSE.items.gp.long\",\n          img: \"systems/ose/assets/gold.png\",\n          abbreviation: \"{#}GP\",\n          data: {\n            item: {\n              name: \"Gold Coins\",\n              type: \"item\",\n              img: \"systems/ose/assets/gold.png\",\n              system: {\n                quantity: { value: 1, max: null },\n                weight: 0.1,\n                cost: 1,\n                treasure: true,\n              },\n            },\n          },\n          primary: true,\n          exchangeRate: 1,\n        },\n      ],\n    });\n  });\n};\n\nexport default registerFVTTModuleAPIs;\n","/**\n * @file A file that manages preloading our system templates\n */\nimport OSE from \"./config\";\n\nconst preloadHandlebarsTemplates = async () => {\n  const templatePaths = [\n    // Character Sheets\n    `${OSE.systemPath()}/templates/actors/character-sheet.html`,\n    `${OSE.systemPath()}/templates/actors/monster-sheet.html`,\n    // Character Sheets Partials\n    `${OSE.systemPath()}/templates/actors/partials/character-header.html`,\n    `${OSE.systemPath()}/templates/actors/partials/character-attributes-tab.html`,\n    `${OSE.systemPath()}/templates/actors/partials/character-encumbrance.html`,\n    `${OSE.systemPath()}/templates/actors/partials/character-abilities-tab.html`,\n    `${OSE.systemPath()}/templates/actors/partials/character-spells-tab.html`,\n    `${OSE.systemPath()}/templates/actors/partials/character-inventory-tab.html`,\n    `${OSE.systemPath()}/templates/actors/partials/actor-item-summary.html`,\n    `${OSE.systemPath()}/templates/actors/partials/character-notes-tab.html`,\n    `${OSE.systemPath()}/templates/actors/partials/monster-header.html`,\n    `${OSE.systemPath()}/templates/actors/partials/monster-attributes-tab.html`,\n    // Item Display\n    `${OSE.systemPath()}/templates/actors/partials/item-auto-tags-partial.html`,\n    // Party Sheet\n    `${OSE.systemPath()}/templates/apps/party-sheet.html`,\n    // `${OSE.systemPath()}/templates/apps/party-xp.html`,\n    // Combat Tab\n    `${OSE.systemPath()}/templates/sidebar/combat-tracker-combatant.hbs`,\n    `${OSE.systemPath()}/templates/apps/combat-set-groups.hbs`,\n  ];\n  return foundry.applications.handlebars.loadTemplates(templatePaths);\n};\n\nexport default preloadHandlebarsTemplates;\n","import OSE from \"./config\";\n\n/**\n * Adds custom dynamic token ring option.\n * @param {foundry.canvas.tokens.TokenRingConfig} config - The TokenRingConfig to modify\n */\nexport function initializeTokenRing(\n  config: foundry.canvas.tokens.TokenRingConfig\n) {\n  config.addConfig(\n    \"ose-default-black-white\",\n    new foundry.canvas.placeables.tokens.DynamicRingData({\n      label: \"OSE.rings.BlackWhite\",\n      spritesheet: `${OSE.assetsPath}/rings/black-white.json`,\n    })\n  );\n}\n\n/**\n * Prompts the user to select the default OSE dynamic token ring.\n * Will do nothing if the user has previously been prompted.\n */\nexport async function promptTokenRingSelection() {\n  const hasPrompted = game.settings.get(\n    game.system.id,\n    \"hasPromptedDefaultOSETokenRing\"\n  );\n  if (hasPrompted) return;\n\n  if (\n    await foundry.applications.api.DialogV2.confirm({\n      window: {\n        title: game.i18n.localize(\"OSE.dialog.TokenRingPrompt.Title\"),\n      },\n      content: game.i18n.localize(\"OSE.dialog.TokenRingPrompt.Content\"),\n    })\n  ) {\n    await game.settings.set(\n      \"core\",\n      \"dynamicTokenRing\",\n      \"ose-default-black-white\"\n    );\n  }\n  await game.settings.set(\n    game.system.id,\n    \"hasPromptedDefaultOSETokenRing\",\n    true\n  );\n}\n","/**\n * @file Functions that alter the way that sidebar and compendium lists render\n */\nimport OSE from \"./config\";\n\n/**\n * Called when a compendium directory is rendered\n *\n * @param {foundry.applications.sidebar.tabs.DocumentDirectory} object - The compendium directory object\n */\nexport const RenderCompendium = async (object) => {\n  if (object.documentName !== \"Item\") {\n    return;\n  }\n\n  const html = object.element;\n  const render = html.querySelectorAll(\".item\");\n  const content = await object.collection.getDocuments();\n\n  for (const item of render) {\n    const foundryDocument = content.find(\n      (e) => e.id === item.dataset.entryId\n    );\n\n    const tagsHtml = await foundry.applications.handlebars.renderTemplate(\n      `${OSE.systemPath()}/templates/actors/partials/item-auto-tags-partial.html`,\n      { tags: foundryDocument.system.autoTags || [] }\n    );\n    item.insertAdjacentHTML(\"beforeend\", tagsHtml);\n  }\n};\n\n/**\n * Called when the sidebar item directory is rendered\n *\n * @param {foundry.applications.sidebar.tabs.ItemDirectory} object - The item directory object\n */\nexport const RenderItemDirectory = async (object) => {\n  const html = object.element;\n  const render = html.querySelectorAll(\".item\");\n  const content = object.collection;\n\n  for (const item of render) {\n    const foundryDocument = content.find(\n      (e) => e.id === item.dataset.entryId\n    );\n\n    const tagsHtml = await foundry.applications.handlebars.renderTemplate(\n      `${OSE.systemPath()}/templates/actors/partials/item-auto-tags-partial.html`,\n      { tags: foundryDocument.system.autoTags || [] }\n    );\n    item.insertAdjacentHTML(\"beforeend\", tagsHtml);\n  }\n};\n"],"names":["OseDataModelCharacterEncumbrance","static","quarter","threeEighths","half","encumbranceVariant","max","weight","constructor","variant","baseEncumbranceCap","this","ArrayField","BooleanField","NumberField","SchemaField","StringField","foundry","data","fields","initial","enabled","encumbered","pct","integer","min","steps","value","atFirstBreakpoint","atSecondBreakpoint","atThirdBreakpoint","Math","clamp","delta","encumbranceSteps","defaultMax","alternateMax","OseDataModelCharacterEncumbranceBasic","unarmored","light","heavy","treasureEncumbrance","heaviestArmor","items","options","super","type","significantTreasure","reduce","acc","system","treasure","quantity","heaviest","armorType","equipped","armorWeight","overTreasureThreshold","overSignificantTreasureThreshold","isHeavy","isLightWithTreasure","OseDataModelCharacterEncumbranceComplete","includes","Object","values","OseDataModelCharacterEncumbranceDetailed","hasAdventuringGear","some","i","gearWeight","OseDataModelCharacterEncumbranceDisabled","OseDataModelCharacterEncumbranceItemBased","fiveEighths","threeQuarters","sevenEighths","stepOne","stepTwo","stepThree","oneThird","fiveNinths","sevenNinths","equippedMax","packedMax","atFiveEighths","atThreeQuarters","atSevenEights","atOneThird","atFiveNinths","atSevenNinths","equippedWeight","packedWeight","weightMod","game","settings","get","id","scores","str","mod","isDefaultMax","alternateBaseEncumbranceCap","ceil","item","isCoinsOrGems","itemslots","usingEquippedEncumbrance","packedStepCounts","equippedStepCounts","equippedSteps","packedSteps","equippedPct","packedPct","equippedValue","packedValue","equippedLabel","packedLabel","equippedEncumbranceSteps","packedEncumbranceSteps","equippedValues","packedValues","equippedIndex","findIndex","step","packedIndex","OSE","systemPath","systemRoot","assetsPath","encumbrance","encumbranceOptions","disabled","basic","detailed","complete","itembased","int","dex","wis","con","cha","scores_short","exploration_skills","ld","od","sd","fs","exploration_skills_short","roll_type","result","above","below","saves_short","death","wand","paralysis","breath","spell","saves_long","armor","shield","apply_damage_options","selected","targeted","originalTarget","colors","green","red","yellow","purple","blue","orange","white","languages","tags","melee","missile","slow","twohanded","blunt","brace","splash","reload","charge","auto_tags","label","CONFIG","image","icon","tag_images","monster_saves","d","w","p","b","s","monster_thac0","OseDice","async","parts","title","flavor","speaker","form","chatMessage","template","chatData","user","templateData","config","bonus","push","roll","Roll","join","evaluate","allowStrings","rollMode","blindroll","isGM","whisper","ChatMessage","getWhisperRecipients","_id","blind","digestResult","Promise","resolve","render","then","r","rollOSE","applications","handlebars","renderTemplate","content","dice3d","showForRoll","create","sound","sounds","dice","isSuccess","isFailure","target","total","die","results","table","output","details","attackIsSuccess","thac0","ac","terms","digestAttackResult","targetActorData","actor","targetAc","targetAac","aac","victim","attackBonus","i18n","format","flags","dmg","filter","v","length","ui","notifications","error","dmgRoll","dr","rollDamage","skipDialog","rolled","dialogData","formula","rollModes","Dice","rollData","sendRoll","buttons","action","localize","callback","event","button","magic","html","api","DialogV2","window","default","submit","sendAttackRoll","OseCharacterCreator","FormApplication","defaultOptions","classes","width","submitOnClose","object","name","getData","utils","deepClone","counters","gold","stats","sum","avg","std","doStats","ev","list","$","currentTarget","closest","n","next","mean","parseFloat","sqrt","map","x","siblings","find","text","round","removeAttr","score","rollParts","skipMessage","skipMessagRoll","getSpeaker","count","activateListeners","click","el","parentElement","dataset","rollScore","val","trigger","change","char","updateData","preventClose","preventRender","extendedData","_onSubmit","itemData","img","cost","createEmbeddedDocuments","formData","preventDefault","update","sheet","OseCharacterGpCost","Set","preparedData","position","totalCost","getTotalCost","inventory","close","gp","newGP","updateEmbeddedDocuments","markItemsAsPaid","physicalItemTypes","has","ose","paid","updates","forEach","OseCharacterModifiers","OseEntityTweaks","isCharacter","ascendingAC","encumbranceMax","_render","skipRollDialogCheck","ctrlKey","metaKey","OseActorSheet","appv1","sheets","ActorSheet","_expanded","isExpanded","prepareDerivedData","owner","isOwner","editable","isEditable","isOwnerOrObserver","initiative","encumbranceStrengthMod","isNew","encumbranceTemplate","templateEncumbranceBar","activateEditor","initialContent","_getItemFromActor","li","itemId","_toggleItemCategory","css","removeClass","addClass","slideDown","slideUp","_toggleContainedItems","targetItems","_toggleItemSummary","itemSummary","querySelector","classList","contains","delete","add","toggle","show","confirm","yes","_removeItemFromActor","defaultYes","deleteEmbeddedDocuments","containerId","newItemIds","itemIds","o","_useConsumable","decrement","field","parseInt","spellElements","querySelectorAll","memorized","counter","rollWeapon","spendSpell","rollFormula","actorObject","element","save","rollSave","attack","targetAttack","_onSortItem","source","dropTarget","targetId","Error","targetData","_onDragStart","dragData","itemIdsArray","toDragData","actorId","sceneId","isToken","canvas","scene","tokenId","token","pack","effectId","effect","effects","dataTransfer","setData","JSON","stringify","key","folder","fromUuid","uuid","itemArray","contents","getSubfolders","subfolder","_onDropItemCreate","targetItem","targetIsContainer","Item","implementation","fromDropData","toObject","exists","isContainer","_onContainerItemRemove","_onContainerItemAdd","container","newList","itemObj","alreadyExistsInActor","parent","latestItem","newItem","pop","droppedItem","targetContainer","Array","isArray","containedItems","parse","containedItem","choices","types","obj","choice","dlg","ux","FormDataExtended","_createItem","header","lvl","createItem","capitalize","split","_chooseItemType","dialogInput","args","_renderInner","resizable","each","_","heightDelta","height","style","baseSize","_onResize","editor","editorSize","_onConfigureActor","top","left","_getHeaderButtons","canConfigure","class","onclick","_rollSave","_rollAttack","rollHitDice","_rollAbility","stopPropagation","_displayItemInChat","_promptRemoveItemFromActor","select","_updateItemQuantity","bind","_onSpellChange","_resetSpells","OseActorSheetCharacter","mergeObject","tabs","navSelector","contentSelector","scrollY","_prepareItems","owned","armors","weapons","treasures","containers","carriedTreasure","abilities","spells","spellList","slots","spellSlots","usesAscendingAC","meleeMod","rangedMod","init","sort","a","generateScores","enrichedBiography","TextEditor","enrichHTML","biography","enrichedNotes","notes","_pushLang","_chooseLang","newData","_popLang","lang","_onShowModifiers","filterUnpaidItems","cartData","_prepareShoppingCartData","stat","rollCheck","rollLoyalty","expl","exploration","rollExploration","_onShowGpCost","array","parents","OseDataModelCharacterAC","dexMod","acProp","isAscending","propAscending","propDescending","getShieldBonus","base","baseAscending","baseDescending","naked","armored","_change","OseDataModelCharacterMove","moveBase","autocalculate","overEncumbranceLimit","shouldCalculateMovement","baseMoveRate","derivedSpeed","encounter","overland","OseDataModelCharacterScores","undefined","strMod","strOpenDoorsMod","valueFromTable","standardAttributeMods","openDoorMods","intMod","literacy","intLiteracyMod","spoken","intSpokenLanguagesMod","literacyMods","spokenMods","wisMod","dexInitMod","cappedAttributeMods","conMod","chaMod","loyalty","chaLoyaltyMod","retain","chaRetainMod","npc","chaReactionMod","OseDataModelCharacterSpells","maxSlots","usedSlots","reducedUsedSlots","keys","idx","usedAndMaxSlots","state","othersAtLvl","localeCompare","reducedSpells","cast","Number","isNaN","usedAtLvl","lv","used","getItemsOfActorOfType","filterType","filterFn","OseDataModelCharacter","abstract","TypeDataModel","movement","movementAuto","ObjectField","defineSchema","hp","hd","saves","ft","positive","retainer","wage","migrateCantrips","migrateData","ascendingAcMod","bba","isSlow","OseDataModelMonster","migrateMonsterLanguages","Symbol","iterator","prev","curr","attackPatterns","pattern","updated","every","OseItem","defaultIcons","ability","weapon","context","tag","prepareData","enrichedDescription","description","addEventListener","_onChatCardAction","_onChatCardToggleContent","htmlOptions","itemType","props","t","range","duration","hasOwnProperty","properties","isNPC","_source","rollType","autoTags","rollTarget","_getRollTag","_getSaveTag","getAutoTagList","tagList","damage","short","medium","long","requirements","req","rollTag","saveTag","regExp","matches","exec","slice","index","trim","toLowerCase","popManualTag","getChatData","labels","isHealing","hasDamage","isSpell","hasSave","CONST","CHAT_MESSAGE_STYLES","OTHER","alias","display","card","messageId","message","messages","isTargetted","isAuthor","_getChatCardActor","actorName","targets","_getChatCardTargets","tokenKey","scenes","tokenData","getEmbeddedDocument","Token","actors","character","controlled","tokens","arr","removeFalsyElements","OseActor","Actor","prototypeToken","texture","acValue","aacValue","acMod","aacMod","bbaValue","thac0Value","embeddedName","getExperience","actorData","modified","floor","xp","_preCreate","_stats","compendiumSource","startsWith","assign","actorLink","disposition","TOKEN_DISPOSITIONS","FRIENDLY","updateSource","testUserPermission","DOCUMENT_OWNERSHIP_LEVELS","OBSERVER","generateSave","tmp","k","actorType","RollSave","fastForward","rollMorale","morale","rollReaction","attribute","level","rollAppearing","check","appearing","attData","dmgParts","size","rollAttack","ignoreBonusDamage","attackMods","amount","multiplier","OseActorSheetMonster","monsterData","link","replace","_onDrop","tableDatum","packs","all","_cycleAttackPatterns","currentColor","indexOf","contextmenu","_resetAttacks","_updateAttackCounter","rollHP","OseTags","rollTagFormula","formulaData","rollTagTarget","OseDataModelAbility","manualTags","OseDataModelArmor","ArmorTypes","tagNames","flat","OseDataModelContainer","totalWeight","OseDataModelItem","cumulativeWeight","cumulativeCost","cumulativeItemslots","itemName","endsWith","OseDataModelSpell","OseDataModelWeapon","missileTag","meleeTag","slowTag","qualities","OseItemSheet","ItemSheet","document","enriched","keypress","which","pushManualTag","applyDamageToTarget","nameOrId","applyDamage","applyChatCardDamage","diceTotalTargets","textContent","dmgTgt","victimId","canApplyDamage","applyDamageOption","chatTargets","configName","configValue","canApply","addChatMessageContextOptions","condition","drawTreasure","percent","chance","getFlag","getHTML","parsedUuid","parseUuid","documentUuid","documentCollection","collection","metadata","documentType","TABLE_RESULT_TYPES","DOCUMENT","embeddedTable","rollTreasure","remove","resultId","requestAnimationFrame","functionsForTesting","createOseMacro","slot","assignHotbarMacro","command","macro","Macro","warn","macros","m","ownership","userId","rollItemMacro","rollTableMacro","tableUuId","draw","displayChat","OseParty","currentParty","act","party","OsePartyXP","closeOnSubmit","_updateObject","_dealXP","_calculateShare","totalXP","baseXpShare","xpShare","share","row","qRow","e","on","Party","partySheet","OsePartySheet","dragDrop","dragSelector","dropSelector","focus","ascending","partyActors","setFlag","_onDropActor","_onDropFolder","droppedActor","_addActorToParty","_recursiveAddFolder","children","getActor","_removeActorFromParty","HandlebarsApplicationMixin","ApplicationV2","OSECombatGroupSelector","_highlighted","frame","positioned","controls","minimizable","contentTag","contentClasses","actions","handler","submitOnChange","main","groups","combatants","combat","_onRender","onCombatantHoverIn","onCombatantHoverOut","input","combatant","assignGroup","ready","combatantId","isVisible","_onHoverIn","hoverOutOthers","_onHoverOut","actionGroups","OSECombat","documents","Combat","GROUPS","entries","combatantGroups","Map","rerollBehavior","isGroupInitiative","excludeAlreadyRolled","updateTurn","GROUP_FORMULA","FORMULA","rollInitiative","c","defeated","rollAbsolutelyEveryone","group","members","messageData","escapeHTML","toMessage","setupTurns","rollAll","turn","turns","skipDefeated","isDefeated","startCombat","smartRerollInitiative","_onEndRound","resetAll","resetActions","groupUpdates","g","groupName","groupCreation","set","groupRaw","setCombatantGroups","_sortCombatants","ia","isNumeric","Infinity","initiativeDiff","colorsKeys","colorDiff","dispositionA","dispositionB","hasPlayerOwner","isRetainerA","OSECombatant","Combatant","isCasting","getInitiativeRoll","term","INITIATIVE_VALUE_SLOWED","INITIATIVE_VALUE_DEFEATED","getRollData","casting","assignedGroup","OSECombatTracker","sidebar","CombatTracker","DEFAULT_OPTIONS","onCombatantControl","retreat","_prepareTrackerContext","isSlowed","isRetreating","isOwnedByUser","_onCombatantControl","btn","viewed","control","toggleFlag","_configureRenderOptions","PARTS","tracker","flag","isActive","_getEntryContextOptions","turnToActivate","activateCombatant","headerButtonContainer","reRollButton","createElement","tooltip","ariaLabel","setCombatantGroupsButton","replaceChildren","combatantGroup","groupContainer","initiativeCounter","fontSize","fontWeight","flex","textAlign","innerHTML","groupHeader","className","background","tokenName","nameStrong","diceIcon","append","cloneNode","wrapper","groupChildren","groupKey","before","TokenRulerOSE","placeables","TokenRuler","_getGridHighlightStyle","waypoint","offset","color","measurement","inCombat","delay","ms","setTimeout","trashChat","documentClass","deleteDocuments","deleteAll","waitForInput","openWindows","windows","openDialogs","openV2Dialogs","from","instances","closeDialogs","closeV2Dialogs","closeSheets","getActiveNotifications","objectIsNotification","rollSpecificNumber","requiredResult","diceFaces","createMockActorKey","createWorldTestItem","createActorTestItem","createMockMacro","randomID","createMockScene","Scene","tokenVision","getMockActorKey","getName","createMockCompendium","collections","CompendiumCollection","createCompendium","path","private","package","cleanUpCompendium","deleteCompendium","cleanUpMacros","mockMacros","cleanUpActorsByKey","cleanUpWorldItems","cleanUpScenes","itemTypes","displayName","createMockActor","actorDataModelCharacterTests","describe","it","expect","after","dataModel","ascendingACSetting","initiativeSetting","encumbranceSetting","not","spellLevels","contain","subFields","subField","subSubField","equal","testActor","to","be","true","false","itemContainer","itemTreasure","is","itemTreasure2","testItem","testTreasure","itemInContainer","getter","actorDataModelCharacterACTests","itemsArmor","itemsShield","itemsBoth","negativeDexMod","negativeArbitraryMod","armorAC","toPct","createMockItem","itemOptions","actorDataModelCharacterEncumbranceTests","enc","EncumbranceDisabled","EncumbranceBasic","expectedSteps","have","EncumbranceDetailed","EncumbranceComplete","console","info","EncumbranceItemBased","matrix","actorDataModelCharacterMoveTests","move","expectedBase","expectedEncounter","expectedOverland","actorDataModelCharacterScoresTests","scoreSpread","_el","scoreKeys","tables","fromTable","tableKey","numberToScores","number","fromEntries","scoreKey","buildTestCases","scoresToUse","scoresObj","buildTestCasesWithModifiers","added","spreadToModTests","createMockSpell","spellOptions","spellsPerLevel","actorDataModelCharacterSpellsTests","levels","lvCount","createMockSpellList","spellData","actorDataModelMonsterTests","afterEach","testContainer","testItemInContainer","transparent","preSelected","actorEntityTests","assert","actorItem","compendium","actorInCompendium","importDocument","importedActor","importFromCompendium","low","high","wands","savesData","thac0Data","thac0PlusData","conScoreSpread","conBonusSpread","hdSpread","levelSpread","modSign","modUnsigned","rolls","expression","operator","toString","activate","getTokenDocument","setTarget","releaseOthers","groupSelection","null","rolldata","existingRandomFunction","randomUniform","actorSheetTests","originalCtrlSetting","mockedItem","tab","descriptionElement","nextElementSibling","an","that","does","include","dispatchEvent","MouseEvent","bubbles","clickCategory","categoryElement","clickContainerCaret","containerElement","clickItemSummary","clickNavTab","summaryElement","macroReference","clickItemShow","clickConsumableFull","clickConsumableEmpty","Event","mockClickItem","clickSave","attackClass","clickAttack","dragNDropCasePreflightCheck","sourceItemName","documentName","dragNDropCasePostflightCheck","dragNDropSanityChecks","defaultChoices","dialogs","customChoices","selector","updateQuantity","modifier","String","InputEvent","quantityElement","win","windowElement","executeDragNDrop","mockDragStartEvent","DragEvent","DataTransfer","cancelable","itemElement","mockDropEvent","actorSheetDragNDropTests","beforeEach","sourceElement","executeDrag","parsedData","getDragEventData","finalElement","isConnected","worldItem","actorSheetCharacterTests","scoreValue","actorSheetMonsterTests","orginalCtrlSetting","rt","rollTable","RollTable","createMockRollTable","dragElement","dropElement","currentPattern","patternIndex","nextIndex","combatTests","oseCombat","pc1","pc2","friendlyCharacter1","friendlyCharacter2","neutralCharacter1","neutralCharacter2","hostileCharacter1","hostileCharacter2","friendlyMonster1","friendlyMonster2","neutralMonster1","neutralMonster2","hostileMonster1","hostileMonster2","friendlyRetainer1","friendlyRetainer2","neutralRetainer1","neutralRetainer2","hostileRetainer1","hostileRetainer2","createCombatant","addAllTokensToCombat","controlAllTokens","TokenDocument","createCombatants","getCombatTrackerElement","getCombatantElements","cleanupCombat","nonGMUser","users","u","OWNER","NEUTRAL","HOSTILE","eql","previousInitiativeSetting","previousCombatRerollBehavior","combatTracker","smartRerollInitiativeButton","cm","greenHeader","purpleHeader","redHeader","groupInitiatives","started","nextTurn","nextRound","rollAllButton","individualInitiatives","actorSheetCharacterDialogModifiersTest","dialogTitle","actorSheetDialogEntityTweaksTests","entityTweaks","itemDataModelAbilityTests","itemDataModelArmorTests","dataTypes","itemDataModelContainerTests","itemDataModelMiscTests","miscItem","itemDataModelSpellTests","itemDataModelWeaponTests","itemEntityTests","non_existing","testItemCreate","equals","clear","initialSlots","testPushManualTag","itemTagData","itemTag","testSystemBooleans","toUpperCase","poppedTag","rollMessageTest","itemSheetTests","partyEntityTests","promisedAnswer","actorsInParty","partySheetTests","showPartySheet","promisedAddAnswer","promisedRemoveAnswer","resolvedResponse","Folder","subFolder","response","folders","partyXpSheetTests","partyXP","helpersBehaviourTests","originalSetting","setting","KeyboardEvent","helpersChatTests","createMockRoll","resultArray","helpersDiceTests","acSetting","chatCard","_evaluated","_formula","createMockData","dataNat20","rollTargetOne","rollTargetTwenty","attackDiceResult","damageDiceResult","dialog","helpersHandlebarsTests","Handlebars","helpers","eq","subtract","divide","mult","roundWeight","getTagIcon","block","fn","times","asset","cleanUpActors","helpersMacrosTests","active","hotbar","getHotbarMacros","macroSlot","notification","helpersPartyTests","partyMember","getAttribute","createMockTable","createMockTreasureTable","helpersTreasureTests","resultKey","cleanUpTables","Hooks","quench","registerBatch","actorDataModelCharacterKey","actorDataModelCharacterOptions","actorDataModelCharacterACOptions","actorDataModelCharacterEncumbranceOptions","actorDataModelCharacterMoveOptions","actorDataModelCharacterScoresOptions","actorDataModelCharacterSpellsOptions","actorDataModelMonsterKey","actorDataModelMonsterOptions","actorEntityKey","actorEntityOptions","actorSheetKey","actorSheetOptions","actorSheetDragNDropKey","actorSheetDragNDropOptions","actorSheetCharacterKey","actorSheetCharacterOptions","actorSheetMonsterKey","actorSheetMonsterOptions","combatKey","combatOptions","actorSheetCharacterDialogModifiersKey","actorSheetCharacterDialogModifiersOptions","actorSheetDialogEntityTweaksKey","actorSheetDialogEntityTweaksOptions","itemDataModelAbilityOptions","itemDataModelArmorOptions","itemDataModelContainerOptions","itemDataModelMiscOptions","itemDataModelSpellOptions","itemDataModelWeaponOptions","itemEntityOptions","itemSheetOptions","partyEntityKey","partyEntityOptions","partySheetKey","partySheetOptions","partyXpSheetOptions","helpersBehaviourOptions","helpersChatOptions","helpersDiceOptions","helpersHandlebarsOptions","helpersMacrosKey","helpersMacrosOptions","helpersPartyKey","helpersPartyOptions","helpersTreasureKey","helpersTreasureOptions","once","call","debug","register","hint","scope","requiresReload","individual","keep","reset","reroll","Boolean","localizedLabel","decimals","fallbackTurnMarker","rulerClass","macros.rollItemMacro","macros.rollTableMacro","registerHelper","lh","rh","tagValue","tagKey","findTagName","status","accum","relativePath","handlebarsHelpers","itempiles","API","addSystemIntegration","VERSION","ACTOR_CLASS_TYPE","ITEM_QUANTITY_ATTRIBUTE","ITEM_PRICE_ATTRIBUTE","ITEM_FILTERS","filters","UNSTACKABLE_ITEM_TYPES","ITEM_SIMILARITIES","CURRENCIES","abbreviation","primary","exchangeRate","dataModels","monster","Actors","unregisterSheet","registerSheet","makeDefault","Items","templatePaths","loadTemplates","templates","localized","langArray","bar","macros.createOseMacro","promptTokenRingSelection","searchToggle","parentNode","insertBefore","app","gamesystem","rendered","insertAdjacentHTML","chatListeners","chat.addChatMessageContextOptions","msg","blindable","outerHTML","diceDamageDiv","isTreasureTable","treasureTableToggle","isTreasure","normalizeResults","chanceHeader","col","rollButton","replaceWith","party.update","renderGroups","HTMLElement","onUpdateCombatantGroup","ContextMenu","jQuery","getDocuments","foundryDocument","entryId","tagsHtml","addConfig","DynamicRingData","spritesheet"],"mappings":"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"}