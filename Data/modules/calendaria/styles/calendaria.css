/* ======================================== */
/* Theme System - CSS Custom Properties     */
/* ======================================== */

:root {
  --calendaria-accent: rgb(168 144 96);
  --calendaria-bg: rgb(31 31 31);
  --calendaria-bg-hover: rgb(53 53 53);
  --calendaria-bg-lighter: rgb(42 42 42);
  --calendaria-border: rgb(74 74 74);
  --calendaria-border-light: rgb(58 58 58);
  --calendaria-button-active: rgb(255 100 0);
  --calendaria-button-active-text: rgb(255 255 255);
  --calendaria-button-bg: rgb(58 58 58);
  --calendaria-button-border: rgb(74 74 74);
  --calendaria-button-hover: rgb(74 74 74);
  --calendaria-button-text: rgb(224 224 224);
  --calendaria-cool-3: rgb(65 65 65);
  --calendaria-cool-4: rgb(55 55 55);
  --calendaria-cool-5: rgb(45 45 45);
  --calendaria-cool-5-50: rgb(45 45 45 / 50%);
  --calendaria-cool-5-75: rgb(45 45 45 / 75%);
  --calendaria-current-hour: rgb(255 100 0 / 12%);
  --calendaria-day-gap: 0.125rem;
  --calendaria-day-number: rgb(224 224 224);
  --calendaria-day-size: 5.625rem;
  --calendaria-error: rgb(244 67 54);
  --calendaria-event-shadow: rgb(0 0 0 / 20%);
  --calendaria-festival-bg: rgb(212 175 55 / 15%);
  --calendaria-festival-border: rgb(212 175 55);
  --calendaria-festival-text: rgb(255 215 0);
  --calendaria-highlight: rgb(255 255 255 / 20%);
  --calendaria-input-bg: rgb(48 48 48);
  --calendaria-input-border: rgb(74 74 74);
  --calendaria-link: rgb(74 144 226);
  --calendaria-note-badge-bg: rgb(225 180 56);
  --calendaria-note-badge-text: rgb(0 0 0);
  --calendaria-note-bg: var(--calendaria-bg);
  --calendaria-note-header-bg: var(--calendaria-bg-lighter);
  --calendaria-overlay: rgb(0 0 0 / 50%);
  --calendaria-positive-bg: rgb(76 175 80 / 20%);
  --calendaria-positive-fg: rgb(76 175 80);
  --calendaria-primary: rgb(74 144 226);
  --calendaria-selected-bg: rgb(74 144 226 / 15%);
  --calendaria-shadow: rgb(0 0 0 / 40%);
  --calendaria-shadow-light: rgb(0 0 0 / 20%);
  --calendaria-success: rgb(76 175 80);
  --calendaria-text: rgb(224 224 224);
  --calendaria-text-dim: rgb(153 153 153);
  --calendaria-text-heading: rgb(238 238 238);
  --calendaria-text-highlight: rgb(255 255 255);
  --calendaria-text-on-color: rgb(255 255 255);
  --calendaria-text-secondary: rgb(170 170 170);
  --calendaria-text-shadow-on-color: rgb(0 0 0 / 50%);
  --calendaria-title-text: rgb(255 255 255);
  --calendaria-today: rgb(255 100 0);
  --calendaria-today-bg: rgb(255 100 0 / 20%);
  --calendaria-toggle: rgb(234 179 8);
  --calendaria-toggle-active: rgb(76 175 80);

  /* ======================================== */
  /* Layout Dimensions (Content-Aware Sizing) */
  /* ======================================== */

  --calendaria-warning: rgb(255 193 7);
  --calendaria-week-day-width: 6.25rem;
  --calendaria-week-header-height: 1.5rem;
  --calendaria-week-hour-height: 1.5rem;
  --calendaria-week-hour-width: 1.5625rem;
  --calendaria-weekday-header: rgb(224 224 224);
  --calendaria-weekday-height: 1.75rem;
  --calendaria-year-cell-padding: 0.5rem;
  --calendaria-year-gap: 0.75rem;
  --calendaria-year-header-height: 2rem;
  --calendaria-year-month-gap: 0.25rem;
  --calendaria-year-month-height: 1.5rem;
  --calendaria-year-month-width: 3.125rem;
}

/* ======================================== */
/* Light Theme Overrides                     */
/* ======================================== */

.theme-light {
  --calendaria-accent: rgb(139 112 0);
  --calendaria-bg: rgb(245 245 245);
  --calendaria-bg-hover: rgb(235 235 235);
  --calendaria-bg-lighter: rgb(255 255 255);
  --calendaria-border: rgb(200 200 200);
  --calendaria-border-light: rgb(220 220 220);
  --calendaria-button-active: rgb(230 80 0);
  --calendaria-button-active-text: rgb(255 255 255);
  --calendaria-button-bg: rgb(230 230 230);
  --calendaria-button-border: rgb(200 200 200);
  --calendaria-button-hover: rgb(215 215 215);
  --calendaria-button-text: rgb(32 32 32);
  --calendaria-cool-3: rgb(210 210 210);
  --calendaria-cool-4: rgb(200 200 200);
  --calendaria-cool-5: rgb(240 240 240);
  --calendaria-cool-5-50: rgb(240 240 240 / 50%);
  --calendaria-cool-5-75: rgb(240 240 240 / 75%);
  --calendaria-current-hour: rgb(230 80 0 / 10%);
  --calendaria-day-number: rgb(32 32 32);
  --calendaria-error: rgb(211 47 47);
  --calendaria-event-shadow: rgb(0 0 0 / 10%);
  --calendaria-festival-bg: rgb(212 175 55 / 12%);
  --calendaria-festival-border: rgb(180 145 25);
  --calendaria-festival-text: rgb(140 110 0);
  --calendaria-highlight: rgb(255 255 255 / 40%);
  --calendaria-input-bg: rgb(248 248 248);
  --calendaria-input-border: rgb(200 200 200);
  --calendaria-link: rgb(59 130 206);
  --calendaria-note-badge-bg: rgb(225 180 56);
  --calendaria-note-badge-text: rgb(0 0 0);
  --calendaria-note-bg: var(--calendaria-bg);
  --calendaria-note-header-bg: var(--calendaria-bg-lighter);
  --calendaria-overlay: rgb(0 0 0 / 40%);
  --calendaria-positive-bg: rgb(56 142 60 / 20%);
  --calendaria-positive-fg: rgb(56 142 60);
  --calendaria-primary: rgb(59 130 206);
  --calendaria-selected-bg: rgb(59 130 206 / 12%);
  --calendaria-shadow: rgb(0 0 0 / 25%);
  --calendaria-shadow-light: rgb(0 0 0 / 12%);
  --calendaria-success: rgb(56 142 60);
  --calendaria-text: rgb(32 32 32);
  --calendaria-text-dim: rgb(100 100 100);
  --calendaria-text-heading: rgb(32 32 32);
  --calendaria-text-highlight: rgb(0 0 0);
  --calendaria-text-on-color: rgb(255 255 255);
  --calendaria-text-secondary: rgb(80 80 80);
  --calendaria-text-shadow-on-color: rgb(0 0 0 / 40%);
  --calendaria-title-text: rgb(0 0 0);
  --calendaria-today: rgb(230 80 0);
  --calendaria-today-bg: rgb(230 80 0 / 15%);
  --calendaria-toggle: rgb(161 98 7);
  --calendaria-toggle-active: rgb(21 128 61);
  --calendaria-warning: rgb(245 180 0);
  --calendaria-weekday-header: rgb(64 64 64);
}

/* ======================================== */
/* Global Calendaria Styles                  */
/* ======================================== */

[class*='calendaria'] input[type='color'] {
  -webkit-appearance: none;
  appearance: none;
  height: 1.75rem;
  padding: 0;
  border: 0.0625rem solid var(--color-border-light-tertiary);
  border-radius: 0.25rem;
  cursor: pointer;

  &::-webkit-color-swatch-wrapper {
    padding: 0;
  }

  &::-webkit-color-swatch {
    border: none;
    border-radius: 0.1875rem;
  }

  &::-moz-color-swatch {
    border: none;
    border-radius: 0.1875rem;
  }
}

/* ======================================== */
/* Time Rotation Dial Styles                */
/* ======================================== */

.calendaria-time-dial {
  --dial-sun-size: 0.9375rem;
  --sky-bottom-color: rgb(161 176 209);
  --sky-top-color: rgb(0 115 188);

  z-index: 10000;
  position: fixed;
  pointer-events: none;

  .dial-backdrop {
    inset: 0;
    z-index: -1;
    position: fixed;
    pointer-events: all;
    background: rgb(0 0 0 / 50%);
  }

  .dial-container {
    position: relative;
    width: 18.75rem;
    height: 18.75rem;
    pointer-events: all;
  }

  .dial-sky {
    isolation: isolate;
    position: relative;
    width: 100%;
    height: 100%;
    border: 0.1875rem solid rgb(201 170 113);
    border-radius: 50%;
    overflow: hidden;
    box-shadow:
      0 0 2.5rem rgb(0 0 0 / 90%),
      0 0 1.25rem rgb(201 170 113 / 40%);

    &::after {
      inset: 0;
      opacity: calc(0.75 + sin((var(--calendar-day-progress, 0) * pi)));
      z-index: -1;
      position: absolute;
      content: '';
      background: linear-gradient(to bottom, var(--sky-top-color), var(--sky-bottom-color));
    }
  }

  .dial-stars {
    rotate: calc(var(--calendar-night-progress, 0) * -0.5turn);
    z-index: -2;
    position: absolute;
    top: -0.9375rem;
    left: -0.9375rem;
    width: 18.75rem;
    height: 18.75rem;
    border-radius: 50%;

    &::before {
      inset: -1.875rem;
      position: absolute;
      border-radius: 50%;
      content: '';
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 256'%3E%3Cfilter id='filter'%3E%3CfeTurbulence baseFrequency='0.3'/%3E%3CfeColorMatrix values='0 0 0 9 -4 0 0 0 9 -4 0 0 0 9 -4 0 0 0 0 1'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23filter)'/%3E%3C/svg%3E%0A");
    }
  }

  .dial-sun {
    position: absolute;
    top: -0.9375rem;
    left: -0.9375rem;
    width: 18.75rem;
    height: 18.75rem;
    border-radius: 50%;

    &::before {
      opacity: var(--sun-opacity, 0);
      position: absolute;
      left: 50%;
      width: 100%;
      height: 100%;
      content: '';
      background:
        radial-gradient(1.875rem 0.9375rem, rgb(252 249 214 / 70%), transparent), radial-gradient(2.8125rem 1.875rem, rgb(248 243 161 / 50%), transparent),
        radial-gradient(3.25rem 2.375rem, rgb(250 188 90 / 30%), transparent), radial-gradient(3.75rem 2.8125rem, rgb(234 158 111 / 20%), transparent);
    }

    &::after {
      opacity: var(--sun-opacity, 0);
      position: absolute;
      right: 20%;
      bottom: calc(var(--dial-sun-size) * -0.5 + 50%);
      width: var(--dial-sun-size);
      height: var(--dial-sun-size);
      border-radius: 50%;
      content: '';
      background: rgb(255 255 0);
      box-shadow: 0 0 0.625rem rgb(255 255 0 / 80%);
    }
  }

  .dial-moon-orb {
    opacity: var(--moon-opacity, 0);
    position: absolute;
    bottom: calc(var(--dial-sun-size) * -0.5 + 50%);
    left: 20%;
    width: var(--dial-sun-size);
    height: var(--dial-sun-size);
    border-radius: 50%;
    background: rgb(230 230 240);
    box-shadow:
      0 0 0.9375rem rgb(200 200 220 / 90%),
      0 0 0.5rem rgb(255 255 255 / 60%);
  }

  .dial-markers {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }

  .dial-handle-container {
    position: absolute;
    top: 0;
    left: 50%;
    width: 0;
    height: 50%;
    pointer-events: none;
    transform-origin: bottom center;
  }

  .dial-handle {
    clip-path: polygon(50% 100%, 0% 0%, 50% 15%, 100% 0%);
    position: absolute;
    top: -0.625rem;
    left: -0.75rem;
    width: 1.5rem;
    height: 1.875rem;
    cursor: grab;
    pointer-events: all;
    background: rgb(255 100 0);
    box-shadow:
      0 0 0.625rem rgb(0 0 0 / 50%),
      0 0 0.3125rem rgb(255 100 0 / 50%);
    filter: drop-shadow(0 0 0.125rem rgb(255 255 255));

    &:hover {
      background: rgb(255 132 51);
      box-shadow:
        0 0 0.9375rem rgb(0 0 0 / 70%),
        0 0 0.5rem rgb(255 100 0 / 80%);
      transform: scale(1.1);
    }

    &:active {
      cursor: grabbing;
      transform: scale(1.05);
    }
  }

  .dial-time-display {
    position: absolute;
    top: 50%;
    left: 50%;
    text-align: center;
    transform: translate(-50%, -50%);
  }

  .dial-time {
    width: 6ch;
    padding: 0;
    border: none;
    outline: none;
    color: rgb(255 100 0);
    font-weight: bold;
    font-size: 2.25rem;
    line-height: 1;
    font-family: 'Modesto Condensed', 'Palatino Linotype', serif;
    text-align: center;
    text-shadow: 0 0 0.625rem rgb(255 100 0 / 80%);
    cursor: text;
    background: transparent;

    &:focus {
      text-shadow: 0 0 0.9375rem rgb(255 100 0);
    }
  }
}

/* ======================================== */
/* BigCal Application Styles                */
/* ======================================== */

.big-cal {
  display: flex;
  flex-direction: column;
  color: var(--calendaria-text);
  background: var(--calendaria-bg);

  .window-content {
    gap: 0.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0.5rem;
    overflow: hidden;
    background: var(--calendaria-bg);
  }
}

.calendar-main-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: fit-content;
  height: fit-content;
}

.calendar-nav {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
  margin-bottom: 0.25rem;

  button {
    min-width: 1.75rem;
    height: 1.75rem;
    padding: 0.25rem;
  }
}

.calendar-title {
  margin: 0;
  color: var(--calendaria-title-text);
  font-weight: bold;
  font-size: 1.1rem;
  font-family: var(--font-body);
}

.calendar-indicators {
  gap: 0.75rem;
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: -0.2rem;
  color: var(--calendaria-text-dim);
  font-size: var(--font-size-12, 0.75rem);

  .weather-indicator i,
  .season-indicator i,
  .era-indicator i,
  .cycle-indicator i {
    display: inline-flex;
    justify-content: center;
    align-items: center;
  }
}

.weather-indicator,
.season-indicator,
.era-indicator,
.cycle-indicator {
  gap: 0.25rem;
  display: inline-flex;
  align-items: center;

  > * {
    display: inline-flex;
    align-items: center;
  }

  i {
    font-size: 0.85em;
  }
}

.weather-indicator {
  padding: 0.25rem 0.5rem;
  border: 0.0625rem solid color-mix(in srgb, var(--weather-color, var(--calendaria-text-dim)) 30%, transparent);
  border-radius: 0.25rem;
  color: var(--calendaria-text);
  background: color-mix(in srgb, var(--weather-color, var(--calendaria-text-dim)) 15%, transparent);

  i {
    color: var(--weather-color, var(--calendaria-text-dim));
  }
}

.weather-indicator.clickable {
  cursor: pointer;
  transition:
    background 0.15s ease,
    border-color 0.15s ease;
}

.weather-indicator.clickable:hover {
  border-color: var(--weather-color, var(--calendaria-text-dim));
  background: color-mix(in srgb, var(--weather-color, var(--calendaria-text-dim)) 30%, transparent);
}

.weather-indicator.no-weather {
  border: 0.0625rem dashed var(--calendaria-border);
  color: var(--calendaria-text-dim);
  background: transparent;
}

.weather-indicator.no-weather:hover {
  border-color: var(--color-positive-fg, var(--calendaria-positive-fg));
  background: color-mix(in srgb, var(--color-positive-bg, var(--calendaria-positive-bg)) 20%, transparent);
}

.weather-indicator .weather-temp {
  opacity: 0.8;
  margin-left: 0.25rem;
  font-size: 0.85em;
}

.season-indicator {
  color: var(--season-color, var(--calendaria-text-dim));

  i {
    color: var(--season-color, var(--calendaria-text-dim));
  }
}

.calendar-header {
  gap: 0.5rem;
  display: flex;
  position: relative;
  justify-content: center;
  align-items: center;
  padding-bottom: 0.25rem;
  border-bottom: 0.125rem solid var(--calendaria-border);
}

.big-cal .calendaria-hud-search-panel {
  position: absolute;
  top: 100%;
  left: 50%;
  margin-top: 0.25rem;
  transform: translateX(-50%);
}

.big-cal button:not(.view-selector button.active, .add-note-btn) {
  border-color: var(--calendaria-button-border);
  color: var(--calendaria-button-text);
  background: var(--calendaria-button-bg);
}

.day-moons {
  gap: 0.125rem;
  display: inline-flex;
  flex-wrap: wrap;
  align-items: center;
  max-height: 1.5rem;
  overflow: hidden;
}

.moon-phase {
  display: inline-flex;
  align-items: center;
  height: 0.625rem;

  img {
    width: auto;
    height: 100%;
  }

  &.tinted {
    border-radius: 50%;
    overflow: hidden;
    background-color: color-mix(in srgb, var(--moon-color, transparent) 50%, rgb(255 255 255));

    img {
      mix-blend-mode: multiply;
    }
  }
}

.moon-overflow {
  display: inline-flex;
  justify-content: center;
  align-items: center;
  min-width: 1rem;
  height: 0.875rem;
  padding: 0 0.1875rem;
  border-radius: 0.1875rem;
  color: var(--calendaria-text);
  font-weight: 600;
  font-size: 0.625rem;
  cursor: help;
  background: var(--calendaria-bg-lighter);
}

/* Moon icon for [moonIcon] format token */
img.calendaria-moon-icon {
  display: inline;
  width: auto;
  height: 1em;
  vertical-align: middle;
}

span.calendaria-moon-icon {
  display: inline-flex;
  align-items: center;
  height: 1em;
  vertical-align: middle;

  img {
    width: auto;
    height: 100%;
  }

  &.tinted {
    border-radius: 50%;
    overflow: hidden;
    background-color: color-mix(in srgb, var(--moon-color, transparent) 50%, rgb(255 255 255));

    img {
      mix-blend-mode: multiply;
    }
  }
}

.moon-tooltip-row {
  gap: 0.375rem;
  display: flex;
  align-items: center;
  padding: 0.125rem 0;

  img {
    width: 0.875rem;
    height: 0.875rem;
  }
}

.calendar-actions {
  gap: 0.5rem;
  display: flex;
  align-items: center;
}

.view-selector {
  gap: 0.25rem;
  display: flex;

  button.active {
    background: var(--calendaria-primary);
  }
}

.calendar-grid {
  display: flex;
  flex-direction: column;
  width: fit-content;
  height: fit-content;
  margin-top: 0.25rem;
  padding-top: 0.25rem;
}

.calendar-weekdays {
  gap: var(--calendaria-day-gap);
  display: grid;
  margin-bottom: 0.5rem;
  font-weight: bold;
  text-align: center;
}

.weekday-header {
  display: flex;
  justify-content: center;
  align-items: center;
  width: var(--calendaria-day-size);
  height: var(--calendaria-weekday-height);
  padding: 0.25rem;
  overflow: hidden;
  color: var(--calendaria-weekday-header);
  font-size: 0.9rem;
  text-overflow: ellipsis;
  white-space: nowrap;
  background: var(--calendaria-bg-lighter);

  &.rest-day {
    color: var(--calendaria-rest-day, rgb(139 157 195));
  }
}

.calendar-days {
  gap: var(--calendaria-day-gap);
  display: flex;
  flex-direction: column;
}

.calendar-week {
  gap: var(--calendaria-day-gap);
  display: grid;
  position: relative;

  &.intercalary-row {
    display: flex;
    justify-content: center;

    .calendar-day.intercalary {
      justify-content: center;
      width: 100%;

      .day-number {
        justify-content: center;
      }

      .festival-name {
        font-weight: 500;
      }
    }
  }
}

.calendar-day {
  display: flex;
  position: relative;
  flex-direction: column;
  box-sizing: border-box;
  width: var(--calendaria-day-size);
  height: var(--calendaria-day-size);
  padding: 0.25rem;
  border: 0.0625rem solid var(--calendaria-border-light);
  cursor: pointer;
  background: var(--calendaria-bg);
  transition: background 0.2s ease;

  &:not(.empty):hover {
    background: var(--calendaria-bg-hover);
  }

  &.odd-day {
    background: rgb(0 0 0 / 20%);
  }

  &.empty {
    opacity: 0.3;
    background: var(--calendaria-bg-lighter);
  }

  &.other-month,
  &.other-week {
    opacity: 0.4;
    cursor: pointer;
    background: transparent;

    &:hover {
      opacity: 0.6;
      background: var(--calendaria-bg-hover);
    }
  }

  &.today {
    z-index: 1;
    position: relative;
    border: 0.0625rem solid var(--calendaria-today);
    background: var(--calendaria-today-bg);
  }

  &.selected {
    z-index: 1;
    position: relative;
    border: 0.0625rem solid var(--calendaria-primary);
    cursor: pointer;
  }

  &.has-notes {
    border-color: var(--calendaria-border);
  }

  &.festival-day {
    position: relative;
    border-color: var(--festival-color, var(--calendaria-festival-border));
    background: color-mix(in srgb, var(--festival-color, var(--calendaria-festival-border)) 15%, var(--calendaria-bg));

    &::after {
      opacity: 0.6;
      position: absolute;
      top: 0;
      right: 0;
      left: 0;
      height: 0.1875rem;
      content: '';
      background: linear-gradient(90deg, transparent, var(--festival-color, var(--calendaria-festival-text)) 50%, transparent);
    }

    .day-number {
      color: var(--festival-color, var(--calendaria-festival-text));
    }
  }
}

.day-number {
  gap: 0.25rem;
  display: flex;
  align-items: center;
  margin-bottom: 0.25rem;
  color: var(--calendaria-day-number);
  font-weight: bold;
}

.festival-icon {
  color: var(--festival-color, var(--calendaria-festival-text));
  font-size: 0.75rem;
}

.day-notes {
  gap: 0.25rem;
  display: flex;
  flex-wrap: nowrap;
  align-items: center;
  margin-top: auto;
  overflow: hidden;

  .add-note-btn {
    opacity: 0;
    position: static;
    flex-shrink: 0;
    margin-left: auto;
    transform: none;

    &:hover {
      transform: scale(1.2);
    }
  }
}

.calendar-day:hover .day-notes .add-note-btn {
  opacity: 1;
}

.note-indicator {
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  transition: transform 0.1s ease;

  i {
    font-size: 0.875rem;
  }

  img {
    object-fit: contain;
    width: 1rem;
    height: 1rem;
  }

  &:hover {
    transform: scale(1.2);
  }
}

.add-note-btn {
  display: flex;
  opacity: 0;
  z-index: 5;
  position: absolute;
  right: 0.125rem;
  bottom: 0.125rem;
  justify-content: center;
  align-items: center;
  width: 0.875rem;
  height: 0.875rem;
  min-height: 0.875rem;
  padding: 0;
  border: none;
  border-radius: 0;
  color: var(--calendaria-text-muted);
  font-size: 0.875rem;
  cursor: pointer;
  pointer-events: auto;
  background: none;
  box-shadow: none;
  transition:
    opacity 0.2s,
    color 0.15s,
    transform 0.1s;

  i {
    margin: 0;
  }

  &:hover {
    background: none;
    box-shadow: none;
    transform: scale(1.2);
  }

  &:active {
    background: none;
  }
}

/* ======================================== */
/* Multi-Day Event Bar Styles (Month View) */
/* ======================================== */

.event-bar {
  -webkit-text-stroke: 0.0313rem var(--calendaria-shadow-light);
  display: flex;
  z-index: 10;
  position: absolute;
  align-items: center;
  height: 1rem;
  padding: 0.125rem 0.625rem;
  border: 0.0625rem solid var(--calendaria-shadow-light);
  border-radius: 0.75rem;
  overflow: hidden;
  color: var(--calendaria-text-on-color);
  font-weight: 600;
  font-size: 0.625rem;
  text-overflow: ellipsis;
  text-shadow:
    -0.0625rem -0.0625rem 0 var(--calendaria-text-shadow-on-color),
    0.0625rem -0.0625rem 0 var(--calendaria-text-shadow-on-color),
    -0.0625rem 0.0625rem 0 var(--calendaria-text-shadow-on-color),
    0.0625rem 0.0625rem 0 var(--calendaria-text-shadow-on-color),
    0 0.125rem 0.25rem var(--calendaria-text-shadow-on-color);
  white-space: nowrap;
  cursor: pointer;
  pointer-events: auto;
  box-shadow: 0 0.125rem 0.25rem var(--calendaria-shadow-light);
  transition:
    box-shadow 0.15s ease,
    filter 0.15s ease,
    transform 0.15s ease;

  &:hover {
    z-index: 20;
    box-shadow: 0 0.25rem 0.5rem var(--calendaria-shadow);
    filter: brightness(1.1);
    transform: translateY(-0.125rem);
  }

  .event-bar-icon {
    flex-shrink: 0;
    margin-right: 0.375rem;
    color: var(--calendaria-text-on-color);
    filter: drop-shadow(0 0.0625rem 0.125rem var(--calendaria-text-shadow-on-color));

    &:is(img) {
      width: 0.875rem;
      height: 0.875rem;
    }
  }

  .event-bar-text {
    flex: 1;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .event-bar-continuation {
    flex-shrink: 0;
    margin-right: 0.375rem;
    color: var(--calendaria-text-on-color);
    font-size: 0.75rem;
    filter: drop-shadow(0 0.0625rem 0.125rem var(--calendaria-text-shadow-on-color));
  }
}

/* ======================================== */
/* Week View Styles - 24-Hour Grid         */
/* ======================================== */

.calendar-week-view {
  width: fit-content;
  height: fit-content;
  background: var(--calendaria-bg);
}

.week-grid {
  gap: 0.0625rem;
  grid-template-columns: var(--calendaria-week-day-width) repeat(var(--hours-per-day, 24), var(--calendaria-week-hour-width));
  display: grid;
  width: fit-content;
  height: fit-content;
  margin-top: 0.5rem;
  border: 0.0625rem solid var(--calendaria-border);
  border-radius: 0.25rem;
  background: var(--calendaria-border-light);
}

.week-corner-header {
  border-right: 0.125rem solid var(--calendaria-border);
  border-bottom: 0.125rem solid var(--calendaria-border);
  background: var(--calendaria-bg-lighter);
}

.week-hour-label {
  gap: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 0;
  padding: 0;
  border-bottom: 0.125rem solid var(--calendaria-border);
  overflow: hidden;
  color: var(--calendaria-text-dim);
  font-weight: 600;
  font-size: 0.75rem;
  text-align: center;
  text-overflow: ellipsis;
  white-space: nowrap;
  background: var(--calendaria-bg-lighter);
}

.week-day-header {
  display: flex;
  z-index: 5;
  position: sticky;
  left: 0;
  justify-content: flex-start;
  align-items: center;
  padding: 0.25rem 0.5rem;
  border-right: 0.125rem solid var(--calendaria-border);
  font-size: 0.85rem;
  white-space: nowrap;
  background: var(--calendaria-bg);

  &.today {
    border-right: 0.1875rem solid var(--calendaria-today);
    background: var(--calendaria-today-bg);
  }

  &.rest-day {
    color: var(--calendaria-rest-day, rgb(139 157 195));
  }
}

.week-time-cell {
  position: relative;
  border-right: 0.0625rem solid var(--calendaria-border-light);
  overflow: visible;
  cursor: pointer;
  background: var(--calendaria-bg);
  transition: background 0.15s ease;

  &:hover {
    background: var(--calendaria-bg-hover);

    .add-note-btn {
      opacity: 1;
    }
  }

  .add-note-btn {
    inset: 50% auto auto 50%;
    transform: translate(-50%, -50%);

    &:hover {
      transform: translate(-50%, -50%) scale(1.2);
    }
  }

  &.current-hour {
    border-top: 0.1875rem solid var(--calendaria-today);
    background: var(--calendaria-current-hour);
  }

  &.selected {
    border: 0.125rem solid var(--calendaria-primary);
    background: color-mix(in srgb, var(--calendaria-primary) 30%, transparent);
  }
}

.week-event-block {
  --hour-span: 1;

  gap: 0.25rem;
  display: flex;
  z-index: 10;
  position: absolute;
  top: 0.125rem;
  bottom: 0.125rem;
  left: 0.125rem;
  flex-direction: row;
  justify-content: flex-start;
  align-items: center;
  width: calc(var(--hour-span) * 100% + (var(--hour-span) - 1) * 0.0625rem - 0.25rem);
  padding: 0.25rem 0.375rem;
  border-top: 0.1875rem solid var(--calendaria-shadow);
  border-radius: 0.25rem;
  overflow: hidden;
  color: var(--calendaria-text-on-color);
  font-size: 0.6875rem;
  text-shadow: 0 0.0625rem 0.125rem var(--calendaria-text-shadow-on-color);
  cursor: pointer;
  box-shadow:
    0 0.125rem 0.25rem var(--calendaria-shadow-light),
    inset 0 0.0625rem 0 var(--calendaria-highlight);
  transition:
    box-shadow 0.15s ease,
    filter 0.15s ease,
    transform 0.15s ease;

  &:hover {
    z-index: 20;
    box-shadow:
      0 0.25rem 0.5rem var(--calendaria-shadow),
      inset 0 0.0625rem 0 var(--calendaria-highlight);
    filter: brightness(1.15);
    transform: translateY(-0.125rem);
  }

  .event-icon {
    display: flex;
    flex-shrink: 0;
    justify-content: center;
    align-items: center;

    i {
      font-size: 0.75rem;
    }

    img {
      object-fit: contain;
      width: 0.875rem;
      height: 0.875rem;
    }
  }

  .event-name {
    min-width: 0;
    overflow: hidden;
    font-weight: 600;
    line-height: 1.3;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  &.compact {
    gap: 0.125rem;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 0.125rem 0.25rem;
    text-align: center;

    .event-icon {
      i {
        font-size: 0.875rem;
      }

      img {
        width: 1rem;
        height: 1rem;
      }
    }

    .event-name {
      max-width: 100%;
      font-size: 0.5625rem;
    }
  }
}

/* ======================================== */
/* Year View Styles                         */
/* ======================================== */

.calendar-year-view {
  width: fit-content;
  height: fit-content;
}

.year-grid {
  gap: var(--calendaria-year-gap);
  display: flex;
  flex-direction: column;
  width: fit-content;
  height: fit-content;
  margin-top: 0.25rem;
  padding-top: 0.25rem;
}

.year-row {
  gap: var(--calendaria-year-gap);
  grid-template-columns: repeat(3, auto);
  display: grid;
}

.year-cell {
  display: flex;
  flex-direction: column;
  box-sizing: border-box;
  width: fit-content;
  height: fit-content;
  padding: var(--calendaria-year-cell-padding);
  border: 0.125rem solid var(--calendaria-border-light);
  border-radius: 0.25rem;
  cursor: pointer;
  background: var(--calendaria-bg);
  transition:
    border-color 0.2s,
    box-shadow 0.2s,
    transform 0.2s;

  &:hover {
    border-color: var(--calendaria-border);
    box-shadow: 0 0.125rem 0.5rem var(--calendaria-shadow-light);
    transform: translateY(-0.125rem);
  }

  &.current-year {
    box-shadow: 0 0 0 0.125rem var(--calendaria-today);
  }
}

.year-header {
  display: flex;
  justify-content: center;
  align-items: center;
  height: var(--calendaria-year-header-height);
  padding-bottom: 0.25rem;
  border-bottom: 0.0625rem solid var(--calendaria-border-light);
  color: var(--calendaria-title-text);
  font-weight: bold;
  font-size: 1.2rem;
  text-align: center;
}

.year-months {
  gap: var(--calendaria-year-month-gap);
  grid-template-columns: repeat(3, var(--calendaria-year-month-width));
  display: grid;
  margin-top: var(--calendaria-year-month-gap);
}

.month-mini {
  display: flex;
  justify-content: center;
  align-items: center;
  width: var(--calendaria-year-month-width);
  height: var(--calendaria-year-month-height);
  border-radius: 0.125rem;
  font-size: 0.8rem;
  cursor: pointer;
  background: var(--calendaria-bg-lighter);
  transition: background 0.2s;

  &:hover {
    color: var(--calendaria-text-on-color);
    background: var(--calendaria-primary);
  }

  &.no-days {
    opacity: 0.4;
    cursor: default;
    pointer-events: none;
  }
}

/* -------------------------------------------- */
/*  Calendar Note Sheet                         */
/* -------------------------------------------- */

.calendar-note-sheet {
  .window-content {
    gap: 0.5rem;
    padding: 0.5rem;
  }

  .window-header {
    .header-controls {
      gap: 0.25rem;
      display: flex;
      align-items: center;
      margin-right: auto;
      margin-left: 0;
    }
  }
}

.calendar-note-sheet.minimized {
  .window-title {
    visibility: visible;
  }
}

/* -------------------------------------------- */
/*  Calendar Note View Mode                      */
/* -------------------------------------------- */

.calendar-note-view {
  gap: 1rem;
  display: flex;
  flex-direction: column;
  height: 100%;
  padding: 1rem;
  overflow-y: auto;

  .note-header {
    gap: 0.75rem;
    display: flex;
    align-items: center;
    padding-bottom: 0.75rem;
    border-bottom: 0.125rem solid var(--color-border-light, var(--calendaria-border));
  }

  .note-icon {
    flex-shrink: 0;

    i {
      font-size: 2rem;
    }

    img {
      object-fit: contain;
      width: 2rem;
      height: 2rem;
    }
  }

  .note-title {
    flex: 1;
    margin: 0;
    font-weight: bold;
    font-size: 1.5rem;
    line-height: 1.2;
  }

  .gm-only-badge {
    padding: 0.25rem 0.5rem;
    border-radius: 0.1875rem;
    color: var(--calendaria-text-on-color);
    font-size: 0.75rem;
    background: var(--color-level-warning, var(--calendaria-warning));
  }

  .note-datetime {
    gap: 1rem;
    display: flex;
    flex-wrap: wrap;
    padding: 0.5rem 0.75rem;
    border-radius: 0.25rem;
    font-size: 0.9rem;
    background: var(--color-cool-5-50);

    .date-info,
    .time-info,
    .repeat-info,
    .moon-info {
      gap: 0.5rem;
      display: flex;
      align-items: center;
    }
  }

  .note-categories {
    gap: 0.5rem;
    display: flex;
    flex-wrap: wrap;

    .category-tag {
      padding: 0.25rem 0.75rem;
      border: 0.0625rem solid var(--color-cool-3, var(--calendaria-cool-3));
      border-radius: 1rem;
      font-size: 0.85rem;
      background: var(--color-cool-4);
    }
  }

  .note-content {
    flex: 1;
    padding: 0.5rem;
    line-height: 1.6;

    &:empty::before {
      color: var(--color-text-light-6, var(--calendaria-text-dim));
      font-style: italic;
      content: 'No content';
    }
  }
}

.calendar-note-sheet.view-mode .window-content {
  padding: 0;
}

.calendaria .calendar-note-form {
  gap: 0.5rem;
  display: flex;
  flex-direction: column;
  height: 100%;

  select,
  input[type='text'],
  input[type='number'],
  input[type='time'],
  button:not(.header-control),
  .date-picker-btn {
    box-sizing: border-box;
    height: 2rem;
  }

  .form-row-1 {
    gap: 0.5rem;
    grid-template-columns: 1fr auto auto;
    display: grid;
  }

  .form-row-2 {
    gap: 0.5rem;
    grid-template-columns: 1fr 1fr auto;
    display: grid;
  }

  .form-row-3 {
    .reminder-fieldset {
      .reminder-controls {
        gap: 0.75rem;
        display: flex;
        flex-wrap: wrap;

        .form-group-stacked {
          flex: 1 1 auto;
          min-width: 7.5rem;

          label {
            margin-bottom: 0.25rem;
            font-size: var(--font-size-11);
          }

          .inline-form {
            gap: 0.25rem;
            display: flex;
            align-items: center;

            input[type='number'] {
              flex: 0 0 auto;
              width: 3.75rem;
            }

            .hint {
              color: var(--color-text-dark-secondary);
              font-size: var(--font-size-10);
            }
          }

          select {
            width: 100%;
          }
        }

        .reminder-users {
          flex: 1 1 100%;
        }
      }
    }
  }

  .form-row-4 {
    gap: 0.5rem;
    grid-template-columns: 1fr 1fr;
    display: grid;

    fieldset {
      min-width: 0;
    }

    .inline-form {
      min-width: 0;

      select,
      input,
      multi-select {
        flex: 1 1 0;
        min-width: 0;
      }
    }
  }

  fieldset {
    display: flex;
    flex-direction: column;
    justify-content: center;
    margin: 0;
    padding: 0.5rem;
  }

  .editor-fieldset {
    flex: 1;
    min-height: 9.375rem;

    prose-mirror {
      display: flex;
      flex: 1;
      flex-direction: column;

      .editor-container {
        flex: 1;
        overflow-y: auto;
      }
    }
  }

  .date-picker-btn {
    gap: 0.375rem;
    display: flex;
    flex: 1;
    align-items: center;
    min-width: 0;
    padding: 0.125rem 0.375rem;
    border-radius: 0.1875rem;
    font-size: var(--font-size-11);
    line-height: 1.4;
    text-align: left;
    cursor: pointer;

    &:hover {
      background: var(--color-cool-4);
    }

    i {
      flex-shrink: 0;
      font-size: var(--font-size-10);
    }

    span {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
  }

  .emblem-controls {
    gap: 0.5rem;
    display: flex;
    align-items: center;
  }

  .icon-picker {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0.25rem;
    cursor: pointer;

    &:hover .icon-preview {
      opacity: 0.8;
    }
  }

  .icon-preview {
    object-fit: contain;
    width: auto;
    height: 1.5rem;
    font-size: 1.5rem;
  }

  .color-input {
    width: 3.75rem;
    height: 1.5rem;
    padding: 0;
    border: none;
    cursor: pointer;
    background: transparent;

    &::-webkit-color-swatch-wrapper {
      padding: 0;
    }

    &::-webkit-color-swatch {
      border-radius: 0.1875rem;
    }

    &::-moz-color-swatch {
      border-radius: 0.1875rem;
    }
  }

  .checkbox-group {
    gap: 0.25rem;
    display: flex;
    flex-direction: column;

    label {
      gap: 0.375rem;
      display: flex;
      align-items: center;
      font-size: var(--font-size-11);
      cursor: pointer;
    }
  }

  .date-fieldset {
    gap: 0.25rem;
    display: flex;
    flex-direction: column;

    .form-group {
      gap: 0.375rem;
      grid-template-columns: auto 1fr;
      display: grid;
      align-items: center;

      > label {
        font-weight: 600;
        font-size: var(--font-size-11);
      }
    }
  }

  .time-fieldset .time-grid {
    gap: 0.25rem 0.375rem;
    grid-template-columns: auto 1fr auto;
    display: grid;
    align-items: center;

    > label {
      font-weight: 600;
      font-size: var(--font-size-11);
    }

    .time-inputs {
      gap: 0.125rem;
      display: flex;
      align-items: center;

      input[type='number'] {
        width: 2.5rem;
        padding: 0.125rem 0.25rem;
        border-radius: 0.1875rem;
        font-size: var(--font-size-11);
        text-align: center;
      }

      .time-separator {
        font-weight: 600;
      }
    }

    .all-day-label {
      gap: 0.125rem;
      grid-column: 3;
      grid-row: 1 / 3;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding-left: 0.5rem;
      font-weight: normal;
      font-size: var(--font-size-10);
      cursor: pointer;

      input[type='checkbox'] {
        margin: 0;
      }
    }
  }

  .repeat-fieldset .repeat-controls {
    gap: 0.75rem;
    display: flex;
    align-items: flex-start;

    > select {
      padding: 0.125rem 0.375rem;
      border-radius: 0.1875rem;
      font-size: var(--font-size-11);
      line-height: 1.4;
    }

    .max-occurrences {
      gap: 0.125rem;
      display: flex;
      flex-direction: column;
      align-items: center;

      input {
        width: 3.75rem;
        padding: 0.125rem 0.375rem;
        border-radius: 0.1875rem;
        font-size: var(--font-size-11);
        line-height: 1.4;
        text-align: center;
      }

      label {
        color: var(--color-text-light-6, var(--calendaria-text-dim));
        font-size: var(--font-size-10);
        text-align: center;
      }
    }
  }

  .hint {
    margin: 0 0 0.375rem;
    color: var(--color-text-light-6, var(--calendaria-text-dim));
    font-style: italic;
    font-size: var(--font-size-10);

    &.no-moons,
    &.warning {
      color: var(--color-level-warning, var(--calendaria-warning));
    }
  }

  .tag-list {
    gap: 0.375rem;
    display: flex;
    flex-wrap: wrap;
    margin-bottom: 0.5rem;
  }

  .tag {
    gap: 0.375rem;
    display: inline-flex;
    align-items: center;
    max-width: 100%;
    padding: 0.25rem 0.5rem;
    border: 0.0625rem solid var(--color-cool-3, var(--calendaria-cool-3));
    border-radius: 1rem;
    font-size: var(--font-size-11);
    background: var(--color-cool-4);

    .tag-label {
      overflow: hidden;
      color: var(--color-text-light-heading, var(--calendaria-text-heading));
      font-weight: 600;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .tag-value {
      overflow: hidden;
      color: var(--color-text-light-primary, var(--calendaria-text));
      text-overflow: ellipsis;
      white-space: nowrap;
    }
  }

  .remove-btn {
    margin: 0;
    padding: 0;
    border: none;
    color: var(--color-text-light-6, var(--calendaria-text-dim));
    line-height: 1;
    cursor: pointer;
    background: none;

    &:hover {
      color: var(--color-level-error, var(--calendaria-error));
    }

    i {
      font-size: var(--font-size-10);
    }
  }

  .inline-form {
    gap: 0.375rem;
    display: flex;
    align-items: center;

    select,
    input {
      box-sizing: border-box;
      height: 2rem;
      min-height: 2rem;
      padding: 0.25rem 0.5rem;
      border-radius: 0.1875rem;
      font-size: var(--font-size-11);
      line-height: 1;
    }

    select {
      flex: 1;
      min-width: 6.25rem;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    input[type='number'] {
      width: 4.375rem;
    }
  }

  .add-btn {
    gap: 0.25rem;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 2rem;
    height: 2rem;
    padding: 0;
    border-radius: 0.1875rem;
    color: var(--color-text-light-heading, var(--calendaria-text-heading));
    font-size: var(--font-size-11);
    white-space: nowrap;
    cursor: pointer;

    &:hover {
      background: var(--color-cool-4);
    }

    i {
      font-size: var(--font-size-11);
    }
  }

  .form-group {
    gap: 0.375rem;
    display: flex;
    align-items: center;

    label {
      flex-shrink: 0;
      min-width: 2.5rem;
      font-weight: 600;
      font-size: var(--font-size-11);
    }

    select,
    input {
      padding: 0.125rem 0.375rem;
      border-radius: 0.1875rem;
      font-size: var(--font-size-11);
      line-height: 1.4;
    }

    select {
      min-width: 6.25rem;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    input[type='number'] {
      width: 5rem;
    }
  }

  .form-group-stacked {
    gap: 0.125rem;
    display: flex;
    flex-direction: column;
    align-items: center;

    label {
      font-weight: 500;
      font-size: var(--font-size-11);
      text-align: center;
    }

    select,
    input {
      box-sizing: border-box;
      height: 2rem;
      min-height: 2rem;
      padding: 0.25rem 0.5rem;
      border-radius: 0.1875rem;
      font-size: var(--font-size-11);
      line-height: 1;
    }

    input[type='number'] {
      width: 5rem;
    }

    .inline-form {
      align-items: stretch;
    }
  }

  .repeat-config-grid {
    gap: 0.5rem;
    grid-template-columns: 1fr 1fr;
    display: grid;
  }

  .repeat-config-primary,
  .repeat-config-secondary {
    gap: 0.5rem;
    display: flex;
    flex-direction: column;
    min-width: 0;

    fieldset {
      grid-template-rows: auto auto 1fr;
      display: grid;
      flex: 1;
      align-content: start;
      min-width: 0;
      min-height: 7rem;

      > .inline-form {
        align-self: end;
      }
    }

    .inline-form {
      min-width: 0;

      select,
      input {
        flex: 1 1 0;
        box-sizing: border-box;
        min-width: 0;
        height: 2rem;
        min-height: 2rem;
        padding: 0.25rem 0.5rem;
        line-height: 1;
      }

      input[type='number'] {
        flex: 0 0 auto;
        width: 3.75rem;
      }
    }
  }

  .repeat-options {
    display: flex;
    align-items: center;
    margin-top: 0.375rem;

    label {
      gap: 0.375rem;
      display: flex;
      align-items: center;
      font-weight: 500;
      font-size: var(--font-size-11);
    }

    input[type='number'] {
      width: 3.75rem;
      padding: 0.125rem 0.375rem;
      border-radius: 0.1875rem;
      text-align: center;
    }
  }

  fieldset:has(.form-group-stacked) > .inline-form {
    justify-content: center;
    align-items: flex-end;
  }

  .range-config-inputs {
    gap: 0.5rem;
    display: flex;
    flex-direction: column;
  }

  .range-component {
    gap: 0.5rem;
    display: flex;
    align-items: center;

    > label {
      flex-shrink: 0;
      min-width: 3.125rem;
      font-weight: 600;
      font-size: var(--font-size-11);
    }
  }

  .range-controls {
    gap: 0.375rem;
    display: flex;
    flex: 1;
    align-items: center;
  }

  .range-value-inputs {
    gap: 0.375rem;
    display: flex;
    align-items: center;

    span {
      color: var(--color-text-light-6, var(--calendaria-text-dim));
      font-size: var(--font-size-11);
    }
  }

  .categories-fieldset {
    .inline-form {
      align-items: flex-end;
    }

    multi-select {
      flex: 1;
      align-self: flex-end;

      .tags {
        gap: 0.25rem;
        display: flex;
        flex-wrap: wrap;
        min-height: 1.5rem;
        max-height: 1.5rem;
        padding-right: 0.25rem;
        overflow-y: auto;
      }

      select {
        height: 1.625rem !important;
        padding: 0.125rem 0.375rem !important;
        border-radius: 0.1875rem;
        font-size: var(--font-size-11) !important;
        line-height: 1.4 !important;
      }

      .tag {
        padding: 0.125rem 0.375rem;
        font-size: var(--font-size-10);
        cursor: pointer;

        &:hover {
          background: var(--color-cool-3, var(--calendaria-cool-3));
        }
      }
    }

    .new-category-input {
      align-self: flex-end;
      width: 10rem;
      padding: 0.125rem 0.375rem;
      border-radius: 0.1875rem;
      font-size: var(--font-size-11);
      line-height: 1.4;

      &::placeholder {
        color: var(--color-text-light-6, var(--calendaria-text-dim));
        font-style: italic;
      }
    }

    .add-btn {
      align-self: flex-end;
    }
  }
}

/* -------------------------------------------- */
/*  Non-dnd5e System Overrides                   */
/* -------------------------------------------- */

.calendaria.calendar-note-sheet:not(.dnd5e2) .calendar-note-form {
  input[type='text']:not(prose-mirror *),
  input[type='number']:not(prose-mirror *),
  select:not(prose-mirror *) {
    border-radius: 0.1875rem;
  }

  button:not(prose-mirror *) {
    border: 0.0625rem solid var(--calendaria-border);
    border-radius: 0.1875rem;
  }

  fieldset {
    border: 0.0625rem solid var(--calendaria-border);
    border-radius: 0.25rem;
  }
}

/* ======================================== */
/* Shared Vertical Tab Navigation           */
/* ======================================== */

.calendaria {
  nav.sheet-tabs {
    gap: 0;
    grid-column: 1;
    grid-row: 1;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
    align-items: stretch;
    width: max-content;
    min-width: 8rem;
    max-width: 8rem;
    height: 100%;
    padding: 0;
    border-top: none;
    border-right: 0.0625rem solid var(--color-cool-4);
    border-bottom: none;

    .tab-group {
      display: flex;
      flex-direction: column;

      .tab-group-header {
        padding: 0.5rem;
        color: var(--color-text-dark-secondary);
        font-weight: 500;
        font-size: var(--font-size-18);
        text-align: left;
      }
    }

    [data-tab] {
      gap: 0.5rem;
      display: flex;
      flex-direction: row;
      justify-content: flex-start;
      align-items: center;
      max-width: 100%;
      padding: 0.5rem;
      border-bottom: none;
      border-left: 0.1875rem solid var(--group-color, transparent);
      border-radius: 0;
      font-size: var(--font-size-14);
      text-align: left;

      > span:not(.notification-pip) {
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      i {
        width: 1.25em;
        margin: 0;
        text-align: center;
      }

      &.active {
        border-left-color: var(--group-color, var(--color-warm-1));
        background: color-mix(in srgb, var(--group-color, var(--color-warm-1)) 40%, transparent);
      }
    }
  }

  .nav-search {
    position: relative;

    input[type='search'] {
      margin: 0;
      padding: 0 0.3rem 0 2rem;
      border: none;
      border-radius: 0;
      font-size: var(--font-size-11);
    }

    > i {
      position: absolute;
      top: 50%;
      left: 0.5rem;
      font-size: var(--font-size-16);
      pointer-events: none;
      transform: translateY(-50%);
    }
  }
}

/* ======================================== */
/* Calendar Editor Styles                   */
/* ======================================== */

.calendar-editor {
  &.standard-form {
    gap: 0;
  }

  fieldset legend {
    gap: 0.5rem;
    display: flex;
    align-items: center;
  }

  .legend-help {
    opacity: 0.6;
    height: 1.25rem;
    margin-right: 0.125rem;
    padding: 0;
    border: none;
    font-size: var(--font-size-14);
    cursor: pointer;
    background: none;

    &:hover {
      opacity: 1;
    }
  }

  .window-content {
    gap: 0;
    grid-template-columns: auto 1fr;
    grid-template-rows: 1fr auto;
    display: grid;
    height: 100%;
    padding: 0;
    overflow: hidden;
  }

  .flexrow {
    align-items: flex-start;
  }

  section.tab {
    padding: 0.75rem;
    overflow-y: auto;
  }

  .warning {
    color: var(--color-level-warning);
  }

  .format-input.invalid {
    border-color: var(--calendaria-error);
    outline: 0.0625rem solid var(--calendaria-error);
  }

  .format-preview {
    font-style: italic;

    &.error {
      color: var(--calendaria-error);
    }
  }

  .template-selector {
    gap: 0.5rem;
    display: flex;
    flex-direction: column;
    align-items: stretch;

    .form-group {
      margin: 0;
    }

    select {
      flex: 1;
    }

    .template-actions {
      gap: 0.5rem;
      display: flex;
      justify-content: flex-end;
    }
  }

  .header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;

    legend {
      float: left;
      margin: 0;
    }
  }

  .validation-info {
    gap: 0.5rem;
    display: flex;
    align-items: center;
    padding: 0.5rem 0.75rem;
    border-radius: 0.25rem;
    font-size: var(--font-size-14);
    background: var(--color-cool-5-50);

    i {
      color: var(--color-level-success);
    }

    &.warning i {
      color: var(--color-level-warning);
    }

    .mismatch {
      color: var(--color-level-warning);
    }
  }

  .items-list {
    grid-template-columns: var(--list-columns, 2fr 1fr auto);
    row-gap: 0.5rem;
    display: grid;

    > .list-header,
    > .item {
      grid-column: 1 / -1;
      grid-template-columns: subgrid;
      display: grid;
      align-items: center;
      padding: 0.25rem 0.5rem;
      column-gap: 0.5rem;
    }

    > .item:not(.flexrow) {
      row-gap: 0.5rem;

      > * {
        grid-column: 1 / -1;
      }

      > .flexrow {
        grid-template-columns: subgrid;
        display: grid;
        align-items: center;
        column-gap: 0.5rem;
      }
    }

    label.checkbox {
      justify-self: center;
    }

    input.duplicate {
      border-color: var(--color-level-error);
      color: var(--color-level-error);
    }
  }

  .months-list {
    --list-columns: 2fr 1fr 3.5rem 3.5rem 1fr 1fr auto;
  }

  .weekdays-list {
    --list-columns: 2fr 1fr auto auto;
  }

  .named-weeks-list {
    --list-columns: 2fr 1fr 5rem auto;
  }

  .named-weeks-list.no-week-number {
    --list-columns: 2fr 1fr auto;
  }

  .named-years-list {
    --list-columns: 2fr 6rem auto;
  }

  .festivals-list {
    --list-columns: 2fr auto 1fr 3.5rem 3.5rem 3.5rem auto auto auto;
  }

  .festival-icon-display {
    --button-background-color: transparent;
    --button-border-color: transparent;

    padding: 0.25rem;
    font-size: 1.25em;

    &:hover {
      --button-hover-text-color: currentcolor;

      opacity: 0.8;
    }
  }

  .festival-description {
    height: calc(var(--input-height, 1.75rem) * 2);
    font-size: 0.85rem;
    resize: none;
  }

  .canonical-hours-list {
    --list-columns: 2fr 1fr 3.5rem 3.5rem auto;
  }

  .eras-list {
    --list-columns: 2fr 0.5fr 5rem 5rem auto;
  }

  .moons-list {
    --list-columns: 3fr 1fr auto auto;
  }

  .item {
    gap: 0.5rem;
    display: flex;
    align-items: center;
    padding: 0.5rem;
    border: 0.0625rem solid var(--color-cool-4);
    border-radius: 0.25rem;
    background: var(--color-cool-5-50);
  }

  .item-controls {
    gap: 0.125rem;
    display: flex;
    flex: none;
    align-items: center;

    button {
      --button-background-color: transparent;
      --button-border-color: transparent;

      padding: 0.25rem;
      font-size: 0.85em;

      &:disabled {
        opacity: 0.3;
      }

      &:hover:not(:disabled) {
        --button-hover-text-color: var(--color-text-primary);
      }

      &[data-action='toggleCustomWeekdays'] {
        color: var(--calendaria-toggle);

        &.toggled {
          color: var(--calendaria-toggle-active);
        }
      }

      &[data-action='removeMonth'],
      &[data-action='removeWeekday'],
      &[data-action='removeSeason'],
      &[data-action='removeFestival'],
      &[data-action='removeMoon'],
      &[data-action='removeMoonPhase'],
      &[data-action='removeEra'] {
        &:hover:not(:disabled) {
          --button-hover-text-color: var(--color-level-error);
        }
      }
    }
  }

  .item-fields {
    gap: 0.5rem;
    display: flex;
    flex: 1;
    flex-wrap: wrap;
    align-items: center;

    input[type='text'] {
      flex: 1;
      min-width: 6.25rem;
    }

    .abbr-field {
      flex: none;
      width: 3.4375rem;
    }

    .days-field {
      flex: none;
      width: 3.4375rem;
    }

    .day-field {
      flex: none;
      width: 3.75rem;
    }

    .type-field {
      flex: none;
      width: 5.9375rem;
    }

    .range-fields,
    .date-fields {
      gap: 0.5rem;
      display: flex;
      align-items: center;

      label {
        color: var(--color-text-secondary);
        font-weight: normal;
        font-size: var(--font-size-12);
      }
    }

    .rest-day {
      gap: 0.25rem;
      display: flex;
      align-items: center;
      font-size: var(--font-size-14);
      white-space: nowrap;

      label {
        font-weight: normal;
      }
    }
  }

  .computed-value {
    color: var(--color-text-primary);
    font-weight: 600;
    font-size: var(--font-size-16);
  }

  .leap-days-note {
    color: var(--color-text-secondary);
    font-size: var(--font-size-13);
    white-space: nowrap;
  }

  .notice {
    gap: 0.5rem;
    display: flex;
    align-items: flex-start;
    margin-bottom: 0.75rem;
    padding: 0.5rem 0.75rem;
    border-radius: 0.25rem;
    font-size: var(--font-size-13);
    line-height: 1.4;

    i {
      flex: none;
      margin-top: 0.15rem;
    }
  }

  .list-header {
    gap: 0.5rem;
    display: flex;
    align-items: center;
    padding: 0.25rem 0.5rem;
    color: var(--color-text-secondary);
    font-weight: 600;
    font-size: var(--font-size-14);

    > span {
      text-align: center;
    }
  }

  .seasons-list {
    &.date-based {
      --list-columns: 1.5fr 0.75fr auto 1.5fr 1.5fr 1fr auto;
    }

    &.periodic {
      --list-columns: 1.5fr 0.75fr auto 4rem 1fr auto;
    }
  }

  .season-item {
    border-left: 0.1875rem solid var(--season-color, var(--color-cool-4));
  }

  .season-icon-display {
    --button-background-color: transparent;
    --button-border-color: transparent;

    padding: 0.25rem;
    font-size: 1.25em;

    &:hover {
      --button-hover-text-color: currentcolor;

      opacity: 0.8;
    }
  }

  .season-date-fields {
    gap: 0.375rem;
    display: flex;
    align-items: center;

    select {
      flex: 1;
      min-width: 0;
    }

    input[type='number'] {
      flex: 0 0 2.5rem;
    }
  }

  .moon-item {
    padding: 0.75rem 0.5rem;

    .moon-header {
      .color-input-wrapper {
        gap: 0.375rem;
        display: flex;
        align-items: center;
      }

      input[type='color'] {
        width: 2.5rem;
      }

      .moon-color-preview {
        flex-shrink: 0;
        width: 1.5rem;
        height: 1.5rem;
        border-radius: 50%;
        overflow: hidden;

        img {
          width: 100%;
          height: 100%;
        }

        &.tinted {
          background-color: color-mix(in srgb, var(--moon-color, transparent) 50%, rgb(255 255 255));
        }

        &.tinted img {
          mix-blend-mode: multiply;
        }
      }
    }

    .moon-fields {
      gap: 0.75rem;
      display: flex;
      flex-direction: column;
      padding-top: 0.75rem;
    }

    .moon-phases-section {
      margin-top: 0.5rem;

      .phases-list {
        --list-columns: auto 1.6fr 1fr 1fr 4.25rem 4.25rem auto;
      }

      .empty-phases {
        display: flex;
        justify-content: center;
        padding-top: 0.75rem;
        text-align: center;
      }

      .phase-icon-btn {
        width: 2rem;
        height: 2rem;
        padding: 0.125rem;
        border: none;
        border-radius: 50%;
        overflow: hidden;
        cursor: pointer;
        background: transparent;

        &.tinted {
          background-color: color-mix(in srgb, var(--moon-color, transparent) 50%, rgb(255 255 255));
        }

        &.tinted img {
          mix-blend-mode: multiply;
        }

        img {
          object-fit: contain;
          width: 100%;
          height: 100%;
        }

        .phase-emoji {
          font-size: 1.25rem;
          line-height: 1;
        }
      }
    }

    .moon-phase-slider {
      margin: 1.125rem 0 0.5rem;
      border: 0.0625rem solid color-mix(in srgb, var(--color-light-2) 70%, transparent);
      border-radius: 0.25rem;

      .slider-track {
        position: relative;
        width: 100%;
        height: 1.25rem;
        border-radius: 0.25rem;
        overflow: visible;
        background:
          radial-gradient(0.0625rem 0.0625rem at 10% 20%, rgb(255 255 255 / 80%), transparent), radial-gradient(0.0625rem 0.0625rem at 25% 70%, rgb(255 255 255 / 60%), transparent),
          radial-gradient(0.0625rem 0.0625rem at 40% 30%, rgb(255 255 255 / 70%), transparent), radial-gradient(0.0625rem 0.0625rem at 55% 80%, rgb(255 255 255 / 50%), transparent),
          radial-gradient(0.0625rem 0.0625rem at 70% 15%, rgb(255 255 255 / 80%), transparent), radial-gradient(0.0625rem 0.0625rem at 85% 60%, rgb(255 255 255 / 60%), transparent),
          radial-gradient(0.0625rem 0.0625rem at 95% 40%, rgb(255 255 255 / 70%), transparent), radial-gradient(0.0313rem 0.0313rem at 5% 50%, rgb(255 255 255 / 40%), transparent),
          radial-gradient(0.0313rem 0.0313rem at 15% 85%, rgb(255 255 255 / 40%), transparent), radial-gradient(0.0313rem 0.0313rem at 30% 10%, rgb(255 255 255 / 40%), transparent),
          radial-gradient(0.0313rem 0.0313rem at 45% 55%, rgb(255 255 255 / 40%), transparent), radial-gradient(0.0313rem 0.0313rem at 60% 45%, rgb(255 255 255 / 40%), transparent),
          radial-gradient(0.0313rem 0.0313rem at 75% 90%, rgb(255 255 255 / 40%), transparent), radial-gradient(0.0313rem 0.0313rem at 90% 25%, rgb(255 255 255 / 40%), transparent),
          linear-gradient(to bottom, rgb(13 16 51) 0%, rgb(10 10 26) 50%, rgb(5 5 16) 100%);
      }

      .slider-segment {
        display: flex;
        position: absolute;
        top: 0;
        justify-content: center;
        align-items: center;
        box-sizing: border-box;
        height: 100%;
        border-right: 0.0625rem solid rgb(255 255 255 / 15%);
        transition: background 0.15s;

        &:first-child {
          border-radius: 0.25rem 0 0 0.25rem;
        }

        &:last-child {
          border-right: none;
          border-radius: 0 0.25rem 0.25rem 0;
        }

        &:hover {
          background: rgb(255 255 255 / 10%);
        }

        .phase-icon-wrapper {
          width: 0.875rem;
          height: 0.875rem;
          border-radius: 50%;
          overflow: hidden;
          pointer-events: none;
        }

        &.tinted .phase-icon-wrapper {
          background-color: color-mix(in srgb, var(--moon-color, transparent) 50%, rgb(255 255 255));
        }

        &.tinted .phase-icon-wrapper img {
          mix-blend-mode: multiply;
        }

        .phase-icon {
          object-fit: contain;
          width: 100%;
          height: 100%;
        }

        .phase-emoji {
          font-size: 0.75rem;
          line-height: 1;
        }

        .phase-percent {
          position: absolute;
          top: -1.125rem;
          left: 50%;
          color: var(--color-text-dark-secondary);
          font-size: var(--font-size-13);
          white-space: nowrap;
          cursor: pointer;
          transform: translateX(-50%);
        }
      }

      .slider-handle {
        z-index: 10;
        position: absolute;
        top: -0.0625rem;
        width: 0.25rem;
        height: calc(100% + 0.125rem);
        border-radius: 0.125rem;
        cursor: col-resize;
        background: var(--color-warm-1);
        transition:
          background 0.15s,
          box-shadow 0.15s;
        transform: translateX(-50%);

        &:hover,
        &.dragging {
          background: color-mix(in srgb, var(--color-warm-1) 80%, rgb(255 255 255));
          box-shadow: 0 0 0.5rem var(--color-warm-1);
        }

        &::before {
          position: absolute;
          top: 50%;
          left: 50%;
          width: 0.0625rem;
          height: 0.75rem;
          border-radius: 0.0625rem;
          content: '';
          background: rgb(255 255 255 / 50%);
          transform: translate(-50%, -50%);
        }
      }
    }
  }

  .cycle-item {
    flex-direction: column;
    align-items: stretch;
    padding: 0.75rem;

    .cycle-header-grid {
      gap: 0.75rem;
      grid-template-columns: 1fr 5rem 5rem 8.75rem auto;
      display: grid;
      padding-bottom: 0.5rem;
      border-bottom: 0.0625rem solid var(--color-cool-4);

      .grid-col {
        gap: 0.25rem;
        display: flex;
        flex-direction: column;
        align-items: center;

        label {
          color: var(--color-text-secondary);
          font-weight: 600;
          font-size: var(--font-size-14);
          text-align: center;
          white-space: nowrap;
        }

        input,
        select {
          width: 100%;
        }
      }

      .col-controls {
        .item-controls {
          gap: 0.25rem;
          display: flex;
        }
      }
    }

    .cycle-stages-section {
      legend {
        font-weight: bold;
        font-size: var(--font-size-14);
      }

      .stages-list {
        gap: 0.25rem;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
      }

      .stage-item {
        gap: 0.5rem;
        display: flex;
        align-items: center;
        padding: 0.25rem 0.5rem;

        .col-stage-name {
          flex: 1;
          min-width: 6.25rem;
        }

        .item-controls {
          gap: 0.25rem;
          display: flex;
          flex: none;
        }
      }
    }
  }

  .empty-list {
    gap: 1rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 2rem;
    border: 0.0625rem dashed var(--color-cool-4);
    border-radius: 0.25rem;
    color: var(--color-text-secondary);
    font-style: italic;
    text-align: center;
    background: var(--color-cool-5-50);
  }

  footer.form-footer {
    grid-column: 1 / -1;
    grid-row: 2;
    display: flex;
    align-items: center;
    padding: 0.5rem 1rem;
    border-top: 0.0625rem solid var(--color-cool-4);
    background: var(--color-cool-5);

    button {
      flex: none;
      width: fit-content;
      border: 0.0625rem solid var(--button-border-color);

      &:hover {
        border-color: var(--button-hover-border-color);
        color: var(--button-hover-text-color);
        background: var(--button-hover-background-color);
      }

      &:focus {
        outline: 0.0625rem solid var(--button-focus-outline-color);
        box-shadow: 0 0 0.25rem var(--button-focus-outline-color);
      }

      &[data-action='exportCalendar'] {
        flex: 1;
      }

      &[data-action='saveCalendar'] {
        flex: 2;
      }

      &.primary {
        border: 0.0625rem solid var(--button-border-color);
        background: var(--button-background-color);

        &:hover {
          border-color: var(--button-hover-border-color);
          background: var(--button-hover-background-color);
        }
      }
    }
  }

  /* -------------------------------------------- */
  /*  Weather Tab Styles                          */
  /* -------------------------------------------- */
  .season-climate-list {
    --list-columns: auto 1fr auto;
  }

  .zone-climate-list {
    --list-columns: auto 1fr auto;
  }
}
/* -------------------------------------------- */
/*  Climate Editor                              */
/* -------------------------------------------- */

.calendaria.climate-editor {
  max-width: 62.5rem;
  max-height: 50rem;

  .window-content {
    padding: 1rem;
    overflow-y: auto;
  }

  .preset-category {
    margin-bottom: 1rem;

    h4 {
      margin: 0.5rem 0;
      border-bottom: 0.0625rem solid var(--color-cool-4);
      font-size: 0.9rem;
    }
  }

  .preset-row {
    gap: 0.5rem;
    grid-template-columns: 1.5rem 1fr 3.75rem 1.25rem;
    display: grid;
    align-items: center;
    padding: 0.25rem 0;

    input[type='number'] {
      text-align: right;
    }
  }

  .preset-icon {
    text-align: center;
  }

  .preset-name {
    gap: 0.25rem;
    display: flex;
    align-items: center;

    input {
      flex: 1;
    }

    .preset-reset-alias {
      flex: none;
      padding: 0.125rem 0.25rem;
      font-size: 0.75rem;
    }
  }

  .units {
    color: var(--color-text-secondary);
    font-size: 0.85rem;
  }

  /* Zone mode: wider grid with checkbox, alias, and temp columns */
  &.zone-mode .preset-row {
    grid-template-columns: 1.5rem 1.5rem 1fr 3.75rem 1.25rem 3.75rem 1.25rem 3.75rem 1.25rem;
  }

  .preset-temp-input {
    width: 3.75rem;
  }

  .form-fields.temperature > i {
    flex: 0 0 0.5rem;
    text-align: center;
  }

  .daylight-fieldset {
    .solstice-value {
      font-weight: 600;
    }

    .solstice-date {
      color: var(--color-text-secondary, hsl(0deg 0% 60%));
      font-size: 0.85rem;
    }
  }
}

/* -------------------------------------------- */
/*  Chat Announcements                          */
/* -------------------------------------------- */

.calendaria-announcement {
  gap: 0.5rem;
  display: flex;
  flex-direction: column;

  .announcement-date {
    color: var(--color-text-dark-primary, var(--calendaria-text));
    font-weight: 500;
    font-size: 0.9em;
  }

  .announcement-content {
    color: var(--color-text-dark-secondary, var(--calendaria-text-secondary));
    font-size: 0.85em;
    line-height: 1.4;
  }

  .announcement-open {
    gap: 0.35rem;
    display: inline-flex;
    align-items: center;
    color: var(--color-text-hyperlink, var(--calendaria-link));
    font-size: 0.85em;
    text-decoration: none;
    cursor: pointer;

    &:hover {
      text-decoration: underline;
    }

    i,
    img {
      font-size: 1em;
    }

    img {
      width: 1em;
      height: 1em;
    }
  }
}

.calendaria-reminder {
  gap: 0.5rem;
  display: flex;
  flex-direction: column;

  .reminder-message {
    color: var(--color-text-dark-primary, var(--calendaria-text));
    font-size: 0.9em;

    strong {
      color: var(--color-text-dark-heading, var(--calendaria-text));
    }
  }

  .announcement-open {
    gap: 0.35rem;
    display: inline-flex;
    align-items: center;
    color: var(--color-text-hyperlink, var(--calendaria-link));
    font-size: 0.85em;
    text-decoration: none;
    cursor: pointer;

    &:hover {
      text-decoration: underline;
    }
  }
}

.custom-weekdays-list {
  gap: 0.375rem;
  display: flex;
  flex-direction: column;
}

.custom-weekday-header,
.custom-weekday-row {
  gap: 0.5rem;
  grid-template-columns: 1fr 5rem 4rem;
  display: grid;
  align-items: center;
}

.custom-weekday-header span {
  color: var(--color-text-dark-secondary);
  font-weight: 600;
  font-size: var(--font-size-14);
  text-align: center;
}

.custom-weekday-row input[type='checkbox'] {
  justify-self: center;
  width: 1rem;
  height: 1rem;
}

.custom-weekdays-dialog .form-footer,
.season-icon-dialog .form-footer {
  gap: 0.5rem;
  display: flex;

  button {
    flex: 1;

    &[data-action='disable'],
    &[data-action='reset'] {
      flex: none;
    }
  }
}

/* ======================================== */
/* TimeKeeper Styles                        */
/* ======================================== */

.time-keeper {
  opacity: var(--calendaria-timekeeper-idle-opacity, 0.4);
  position: fixed;
  width: 12.5rem;
  padding: 0.375rem;
  border: 0.0625rem solid var(--calendaria-border);
  border-radius: 0.375rem;
  pointer-events: auto;
  background: color-mix(in srgb, var(--calendaria-bg) 95%, transparent);
  box-shadow: 0 0.125rem 0.5rem var(--calendaria-shadow);
  transition: opacity 0.3s ease-in-out 2s;

  &:hover {
    opacity: 1;
    transition-delay: 0s;

    .time-keeper-controls {
      opacity: 1;
      max-height: 1.875rem;
      margin-top: 0.375rem;
    }
  }
}

.time-keeper .time-display {
  display: flex;
  flex-direction: column;
  align-items: center;
  cursor: move;
}

.time-keeper .time-display-time-wrapper {
  display: flex;
  position: relative;
  justify-content: center;
  align-items: center;
}

.time-keeper .time-display-time {
  color: var(--calendaria-text);
  font-weight: bold;
  font-size: 1.25rem;
  line-height: 1.2;
  font-family: monospace;
  letter-spacing: 0.0625rem;
  transition: opacity 0.15s ease;
}

.time-keeper .time-display-play-btn {
  display: flex;
  opacity: 0;
  position: absolute;
  top: 50%;
  left: 50%;
  justify-content: center;
  align-items: center;
  padding: 0.25rem;
  border: none;
  color: var(--calendaria-text-dim);
  cursor: pointer;
  pointer-events: none;
  background: transparent;
  transition:
    opacity 0.15s ease,
    color 0.15s ease;
  transform: translate(-50%, -50%);

  i {
    font-size: 1.25rem;
  }

  &:hover {
    color: var(--calendaria-text);
  }
}

.time-keeper .time-display-time-wrapper:hover .time-display-play-btn {
  opacity: 1;
  pointer-events: auto;
}

.time-keeper .time-display-time-wrapper:hover .time-display-time {
  opacity: 0.3;
}

.time-keeper .time-display-date {
  color: var(--calendaria-text-dim);
  font-size: 0.6875rem;
  line-height: 1.2;
}

.time-keeper .time-keeper-controls {
  gap: 0.25rem;
  display: flex;
  opacity: 0;
  justify-content: center;
  align-items: center;
  max-height: 0;
  overflow: hidden;
  transition:
    opacity 0.2s ease-out,
    max-height 0.2s ease-out;
}

.time-keeper .time-btn {
  display: flex;
  flex: 1;
  justify-content: center;
  align-items: center;
  box-sizing: border-box;
  height: 1.5rem;
  padding: 0;
  border: 0.0625rem solid var(--calendaria-button-border);
  border-radius: 0.1875rem;
  color: var(--calendaria-button-text);
  cursor: pointer;
  background: var(--calendaria-button-bg);
  transition: background 0.15s ease;

  &:hover {
    background: var(--calendaria-button-hover);
  }

  &:focus {
    outline: none;
    box-shadow: none;
  }

  i {
    font-size: 0.625rem;
  }
}

.time-keeper .increment-select {
  -moz-appearance: none;
  -webkit-appearance: none;
  appearance: none;
  box-sizing: border-box;
  width: 3.25rem;
  min-width: 3.25rem;
  height: 1.75rem;
  margin: 0;
  padding: 0 0.375rem;
  border: 0.0625rem solid var(--calendaria-button-border);
  border-radius: 0.1875rem;
  color: var(--calendaria-button-text);
  font-size: 0.75rem;
  line-height: calc(1.75rem - 0.125rem);
  text-align: center;
  cursor: pointer;
  background: var(--calendaria-button-bg);
  background-image: none;

  &:hover {
    background: var(--calendaria-button-hover);
  }

  &:focus {
    outline: none;
    box-shadow: none;
  }
}

.time-keeper .time-keeper-readonly {
  gap: 0.25rem;
  display: flex;
  opacity: 0;
  justify-content: center;
  align-items: center;
  max-height: 0;
  padding: 0;
  overflow: hidden;
  color: var(--calendaria-text-dim);
  font-size: 0.6875rem;
  transition:
    opacity 0.2s ease-out,
    max-height 0.2s ease-out,
    margin-top 0.2s ease-out,
    padding 0.2s ease-out;

  i {
    font-size: 0.6875rem;
  }
}

.time-keeper:hover .time-keeper-readonly {
  opacity: 1;
  max-height: 1.875rem;
  margin-top: 0.375rem;
  padding: 0.25rem 0;
}

.time-keeper .time-display-stopwatch-btn {
  display: flex;
  opacity: 0;
  position: absolute;
  right: -4rem;
  justify-content: center;
  align-items: center;
  width: 1.25rem;
  height: 1.25rem;
  padding: 0;
  border: none;
  border-radius: 0.25rem;
  color: var(--calendaria-text-dim);
  font-size: 0.75rem;
  cursor: pointer;
  pointer-events: none;
  background: transparent;
  transition:
    opacity 0.15s ease,
    color 0.15s ease;

  &:hover {
    color: var(--calendaria-text);
  }
}

.time-keeper .time-display:hover .time-display-stopwatch-btn {
  opacity: 1;
  pointer-events: auto;
}

/* ======================================== */
/* Stopwatch                                */
/* ======================================== */

.stopwatch {
  --stopwatch-size: 12.5rem;

  position: fixed;
  padding: 0;
  border: none;
  background: transparent;
  box-shadow: none;
}

.stopwatch .stopwatch-wrapper {
  display: flex;
  position: relative;
  flex-direction: column;
  align-items: center;
  width: var(--stopwatch-size);
}

.stopwatch .stopwatch-face {
  display: flex;
  position: relative;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  width: var(--stopwatch-size);
  height: var(--stopwatch-size);
  border: 0.25rem solid var(--calendaria-border);
  border-radius: 50%;
  cursor: grab;
  background: var(--calendaria-bg);
  box-shadow:
    0 0.25rem 1rem var(--calendaria-shadow),
    inset 0 0 1.25rem rgb(0 0 0 / 20%);

  &:active {
    cursor: grabbing;
  }
}

.stopwatch .stopwatch-dial {
  inset: 0.5rem;
  position: absolute;
  border: 0.125rem solid var(--calendaria-border-light);
  border-radius: 50%;
  pointer-events: none;
  background: linear-gradient(180deg, var(--calendaria-bg-lighter) 0%, var(--calendaria-bg-darker) 100%);
}

.stopwatch .stopwatch-ticks {
  inset: 0;
  position: absolute;
  border-radius: 50%;
  pointer-events: none;

  &::before {
    -webkit-mask: radial-gradient(circle, transparent 88%, rgb(0 0 0) 88%);
    inset: 0.125rem;
    mask: radial-gradient(circle, transparent 88%, rgb(0 0 0) 88%);
    position: absolute;
    border-radius: 50%;
    content: '';
    background: repeating-conic-gradient(from 0deg, var(--calendaria-text-dim) 0deg 1deg, transparent 1deg 6deg);
  }
}

.stopwatch .stopwatch-hand {
  position: absolute;
  bottom: 50%;
  left: 50%;
  border-radius: 0.125rem;
  pointer-events: none;
  transform-origin: bottom center;

  &.second-hand {
    z-index: 3;
    width: 0.125rem;
    height: 42%;
    margin-left: -0.0625rem;
    background: var(--calendaria-error);
    box-shadow: 0 0 0.5rem color-mix(in srgb, var(--calendaria-error) 80%, transparent);
  }

  &.minute-hand {
    z-index: 2;
    width: 0.3125rem;
    height: 32%;
    margin-left: -0.1562rem;
    background: var(--calendaria-text);
    box-shadow: 0 0 0.1875rem rgb(0 0 0 / 40%);
  }
}

.stopwatch .stopwatch-center-dot {
  z-index: 4;
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0.75rem;
  height: 0.75rem;
  margin: -0.375rem 0 0 -0.375rem;
  border: 0.125rem solid var(--calendaria-border);
  border-radius: 50%;
  pointer-events: none;
  background: var(--calendaria-text);
  box-shadow: 0 0.0625rem 0.1875rem rgb(0 0 0 / 30%);
}

.stopwatch .stopwatch-display {
  display: flex;
  z-index: 10;
  position: absolute;
  top: 50%;
  left: 50%;
  flex-direction: column;
  align-items: center;
  padding: 0.375rem 0.625rem;
  border-radius: 0.375rem;
  pointer-events: none;
  background: color-mix(in srgb, var(--calendaria-bg) 85%, transparent);
  transform: translate(-50%, -50%);
}

.stopwatch .stopwatch-time {
  padding: 0.25rem 0.5rem;
  border: 0.0625rem solid var(--calendaria-border);
  border-radius: 0.25rem;
  color: var(--calendaria-text);
  font-weight: bold;
  font-size: calc(var(--stopwatch-size) * 0.09);
  line-height: 1;
  font-family: monospace;
  letter-spacing: 0.0313rem;
  user-select: none;
  pointer-events: none;
  background: var(--calendaria-bg);
}

.stopwatch .stopwatch-controls {
  inset: 0;
  position: absolute;
  pointer-events: none;
}

.stopwatch .stopwatch-btn {
  display: flex;
  position: absolute;
  justify-content: center;
  align-items: center;
  width: 2rem;
  height: 2rem;
  margin: 0;
  padding: 0;
  border: none;
  outline: none;
  color: var(--calendaria-text-dim);
  font-size: 1.125rem;
  line-height: 1;
  cursor: pointer;
  pointer-events: auto;
  background: none;
  box-shadow: none;
  transition:
    color 0.15s ease,
    transform 0.1s ease;
  transform: translateX(-50%);

  &:focus,
  &:active {
    outline: none;
    box-shadow: none;
  }

  /* Uniform icon sizing */
  i {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 2rem;
    height: 2rem;
    margin: 0;
    padding: 0;
    font-size: inherit;
    line-height: 1;
  }

  &:hover:not(:disabled) {
    color: var(--calendaria-text);
    transform: translateX(-50%) scale(1.15);
  }

  &:disabled {
    opacity: 0.3;
    cursor: not-allowed;
  }

  /* Position buttons: Bell | Lap | PlayPause | Reset | Mode */

  &.notification {
    top: 87%;
    left: 10%;

    &.active {
      color: var(--calendaria-primary);
    }
  }

  &.lap {
    top: 97%;
    left: 30%;
  }

  &.start,
  &.pause {
    top: 100%;
    left: 50%;
  }

  &.start {
    color: var(--calendaria-success);
  }

  &.pause {
    color: var(--calendaria-warning);
  }

  &.reset {
    top: 97%;
    left: 70%;
    color: var(--calendaria-error);
  }

  &.mode {
    top: 87%;
    left: 90%;
    color: var(--calendaria-primary);
  }
}

.stopwatch .stopwatch-laps {
  width: var(--stopwatch-size);
  margin-top: 1.5625rem;
  border: 0.0625rem solid var(--calendaria-border);
  border-radius: 0.5rem;
  background: var(--calendaria-bg);
  box-shadow: 0 0.125rem 0.375rem var(--calendaria-shadow);
}

.stopwatch .stopwatch-laps-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.25rem 0.5rem;
  border-bottom: 0.0625rem solid var(--calendaria-border-light);
  color: var(--calendaria-text-dim);
  font-weight: 600;
  font-size: 0.5625rem;
  text-transform: uppercase;

  .stopwatch-clear-laps {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 0.875rem;
    height: 0.875rem;
    padding: 0;
    border: none;
    border-radius: 0.1875rem;
    color: var(--calendaria-text-dim);
    font-size: 0.5rem;
    cursor: pointer;
    background: transparent;
    transition: color 0.15s ease;

    &:hover {
      color: var(--calendaria-error);
    }
  }
}

.stopwatch .stopwatch-lap-list {
  max-height: 3.75rem;
  margin: 0;
  padding: 0.25rem 0.5rem;
  overflow-y: auto;
  list-style: none;
}

.stopwatch .stopwatch-lap {
  display: flex;
  justify-content: space-between;
  padding: 0.125rem 0;
  color: var(--calendaria-text);
  font-size: 0.625rem;
  font-family: monospace;

  .lap-index {
    color: var(--calendaria-text-dim);
  }
}

.stopwatch .stopwatch-resize-handle {
  opacity: 0;
  position: absolute;
  top: 0;
  right: 0;
  width: 0.875rem;
  height: 0.875rem;
  cursor: nesw-resize;
  transition: opacity 0.15s ease;

  &::after {
    position: absolute;
    top: 0.125rem;
    right: 0.125rem;
    width: 0.5rem;
    height: 0.5rem;
    border-top: 0.125rem solid var(--calendaria-text-dim);
    border-right: 0.125rem solid var(--calendaria-text-dim);
    content: '';
  }

  &:hover::after {
    border-color: var(--calendaria-primary);
  }
}

.stopwatch:hover .stopwatch-resize-handle {
  opacity: 1;
}

.stopwatch-notification-form {
  .form-group {
    margin-bottom: 0.75rem;

    label {
      display: block;
      margin-bottom: 0.25rem;
      font-weight: 600;
    }

    input,
    select {
      box-sizing: border-box;
      width: 100%;
      padding: 0.375rem 0.5rem;
      border: 0.0625rem solid var(--color-border-light-tertiary);
      border-radius: 0.25rem;
    }

    .hint {
      margin-top: 0.25rem;
      color: var(--color-text-dark-secondary);
      font-size: 0.6875rem;
    }
  }
}

/* ======================================== */
/* MiniCal                                  */
/* ======================================== */

.mini-cal {
  --mini-day-size: 3.25rem;
  --mini-gap: 0.1875rem;

  opacity: var(--calendaria-minical-idle-opacity, 1);
  z-index: var(--z-index-ui);
  position: fixed;
  transition: opacity 0.3s ease-in-out 2s;

  &:hover {
    opacity: 1;
    transition-delay: 0s;
  }

  .mini-cal-container {
    display: flex;
    position: relative;
    flex-direction: column;
    border: 0.0625rem solid var(--calendaria-border);
    border-radius: 0.875rem;
    overflow: visible;
    background: var(--calendaria-bg);
    box-shadow: 0 0.25rem 0.75rem var(--calendaria-shadow);
    transition: border-radius 0.2s ease;

    &:has(.mini-sidebar:is(.visible, .locked)) {
      border-radius: 0.875rem 0 0 0.875rem;

      .mini-top-row {
        border-radius: 0.875rem 0 0;
      }

      .mini-time-display {
        border-radius: 0 0 0 0.875rem;
      }

      .mini-time-controls {
        border-radius: 0 0 0 0.875rem;
      }
    }
  }

  .mini-top-row {
    gap: 0.375rem;
    display: flex;
    align-items: center;
    padding: 0.375rem 0.5rem;
    border-bottom: 0.0625rem solid var(--calendaria-border-light);
    border-radius: 0.875rem 0.875rem 0 0;
    cursor: pointer;
    background: var(--calendaria-bg-lighter);

    .mini-title-group {
      gap: 0;
      display: flex;
      flex: 1;
      flex-direction: column;
      align-items: center;
      min-width: 0;
    }

    .mini-title {
      color: var(--calendaria-title-text);
      font-weight: 600;
      font-size: 0.95rem;
      white-space: nowrap;
    }

    .nav-btn {
      display: flex;
      flex-shrink: 0;
      justify-content: center;
      align-items: center;
      width: 1.5rem;
      height: 1.5rem;
      padding: 0;
      border: none;
      border-radius: 0.25rem;
      color: var(--calendaria-text);
      cursor: pointer;
      background: transparent;
      transition: background 0.15s;

      &:hover {
        background: var(--calendaria-bg-hover);
      }
    }

    &.position-locked {
      cursor: default;
    }
  }

  .mini-sidebar {
    gap: 0.25rem;
    display: flex;
    z-index: -1;
    position: absolute;
    top: -0.0625rem;
    bottom: -0.0625rem;
    left: 100%;
    flex-direction: column;
    align-items: center;
    width: 1.875rem;
    padding: 0.375rem 0;
    border-left: 0.0625rem solid var(--calendaria-border-light);
    border-radius: 0 0.875rem 0.875rem 0;
    background: var(--calendaria-bg-lighter);
    transition: transform 0.2s ease;
    transform: translateX(-100%);
  }

  .mini-sidebar.visible {
    transform: translateX(0);
  }

  .mini-sidebar.locked {
    transform: translateX(0);
  }

  .mini-cal-container:has(.mini-notes-panel.visible) .mini-sidebar {
    border-radius: 0;
  }

  .mini-notes-panel {
    display: flex;
    opacity: 0;
    z-index: -2;
    position: absolute;
    top: -0.0625rem;
    bottom: -0.0625rem;
    left: calc(100% + 1.875rem);
    flex-direction: column;
    width: 13.75rem;
    border: 0.0625rem solid var(--calendaria-border);
    border-left: none;
    border-radius: 0 0.875rem 0.875rem 0;
    pointer-events: none;
    background: var(--calendaria-bg);
    box-shadow: 0.25rem 0 0.75rem var(--calendaria-shadow);
    transition:
      transform 0.25s ease,
      opacity 0.25s ease;
    transform: translateX(-100%);
  }

  .mini-notes-panel.visible {
    opacity: 1;
    pointer-events: auto;
    transform: translateX(0);
  }

  .notes-panel-header {
    gap: 0.25rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.375rem 0.5rem;
    border-bottom: 0.0625rem solid var(--calendaria-border-light);
    border-radius: 0 0.875rem 0 0;
    background: var(--calendaria-bg-lighter);
  }

  .notes-panel-title {
    overflow: hidden;
    color: var(--calendaria-title-text);
    font-weight: 600;
    font-size: 0.85rem;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .notes-panel-close {
    display: flex;
    flex-shrink: 0;
    justify-content: center;
    align-items: center;
    width: 1.5rem;
    height: 1.5rem;
    padding: 0;
    border: none;
    border-radius: 0.25rem;
    color: var(--calendaria-text);
    cursor: pointer;
    background: transparent;
    transition:
      background 0.15s,
      color 0.15s;

    &:hover {
      color: var(--calendaria-error);
      background: var(--calendaria-bg-hover);
    }
  }

  .notes-panel-list {
    gap: 0.25rem;
    display: flex;
    flex: 1;
    flex-direction: column;
    padding: 0.375rem;
    overflow-y: auto;
  }

  .notes-panel-item {
    gap: 0.5rem;
    display: flex;
    align-items: center;
    padding: 0.375rem 0.5rem;
    border-radius: 0.25rem;
    cursor: pointer;
    background: var(--calendaria-bg-lighter);
    transition: background 0.15s;

    &:hover {
      background: var(--calendaria-bg-hover);
    }
  }

  .note-item-icon {
    display: flex;
    flex-shrink: 0;
    justify-content: center;
    align-items: center;
    width: 1.25rem;
    height: 1.25rem;

    i {
      font-size: 0.875rem;
    }

    img {
      object-fit: contain;
      width: 1.125rem;
      height: 1.125rem;
    }
  }

  .note-item-content {
    gap: 0.0625rem;
    display: flex;
    flex: 1;
    flex-direction: column;
    min-width: 0;
  }

  .note-item-title {
    overflow: hidden;
    color: var(--calendaria-text);
    font-weight: 500;
    font-size: 0.8rem;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .note-item-meta {
    gap: 0.375rem;
    display: flex;
    align-items: center;
    color: var(--calendaria-text-dim);
    font-size: 0.65rem;
  }

  .note-item-time {
    white-space: nowrap;
  }

  .note-item-author {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;

    &::before {
      margin-right: 0.375rem;
      content: '';
    }
  }

  .note-item-edit {
    display: flex;
    opacity: 0;
    flex-shrink: 0;
    justify-content: center;
    align-items: center;
    width: 1.375rem;
    height: 1.375rem;
    padding: 0;
    border: none;
    border-radius: 0.1875rem;
    color: var(--calendaria-text-dim);
    cursor: pointer;
    background: transparent;
    transition:
      opacity 0.15s,
      background 0.15s,
      color 0.15s;

    &:hover {
      color: var(--calendaria-primary);
      background: var(--calendaria-bg-hover);
    }
  }

  .notes-panel-item:hover .note-item-edit {
    opacity: 1;
  }

  .sidebar-btn {
    display: flex;
    justify-content: center;
    align-items: center;
    width: 1.5rem;
    height: 1.5rem;
    padding: 0;
    border: none;
    border-radius: 0.25rem;
    color: var(--calendaria-text);
    cursor: pointer;
    background: transparent;
    transition:
      background 0.15s,
      color 0.15s;

    &:hover {
      background: var(--calendaria-bg-hover);
    }

    &.pin-btn.has-sticky {
      color: var(--calendaria-primary);
    }

    &.pin-btn.sticky-position {
      color: var(--calendaria-error);
    }

    &.set-current-date {
      color: var(--calendaria-primary);
    }
  }

  .calendar-indicators {
    gap: 0.5rem;
    flex-wrap: wrap;
    margin: 0 0.5rem 0.25rem;
    padding: 0.25rem 0;
    font-size: var(--font-size-12, 0.75rem);
  }

  .weather-indicator .weather-temp {
    margin-left: 0.15rem;
    padding-left: 0.25rem;
    border-left: 0.0625rem solid var(--calendaria-border);
    font-size: 0.85em;
  }

  .mini-grid {
    z-index: 1;
    position: relative;
    padding: 0.5rem;
    background: var(--calendaria-bg);
  }

  .mini-weekdays {
    gap: var(--mini-gap);
    grid-template-columns: repeat(var(--mini-weekday-count, 7), var(--mini-day-size));
    display: grid;
    width: fit-content;
    margin: 0 auto 0.25rem;

    .weekday {
      padding: 0.125rem 0;
      color: var(--calendaria-weekday-header);
      font-weight: 600;
      font-size: 0.7rem;
      text-align: center;
      text-transform: uppercase;

      &.rest-day {
        color: var(--calendaria-rest-day, rgb(139 157 195));
      }
    }
  }

  .mini-days {
    gap: var(--mini-gap);
    grid-template-columns: repeat(var(--mini-weekday-count, 7), var(--mini-day-size));
    display: grid;
    width: fit-content;
    margin: 0 auto;
  }

  .mini-intercalary-row {
    gap: var(--mini-gap);
    grid-column: 1 / -1;
    display: flex;
    justify-content: center;

    .mini-day.intercalary {
      width: 100%;
      background: color-mix(in srgb, var(--festival-color, var(--calendaria-festival-border)) 15%, var(--calendaria-bg));

      .festival-name {
        color: var(--festival-color, var(--calendaria-festival-text));
        font-weight: 500;
        font-size: 0.85rem;
        white-space: nowrap;
      }
    }
  }

  .mini-day {
    display: flex;
    position: relative;
    justify-content: center;
    align-items: center;
    width: var(--mini-day-size);
    height: var(--mini-day-size);
    border-radius: 0.25rem;
    cursor: pointer;
    background: var(--calendaria-bg-lighter);
    transition: background 0.15s;

    &:hover {
      background: var(--calendaria-bg-hover);
    }

    &.empty {
      cursor: default;
      background: transparent;
    }

    &.other-month,
    &.other-week {
      opacity: 0.4;
      cursor: pointer;
      background: transparent;

      &:hover {
        opacity: 0.6;
        background: var(--calendaria-bg-hover);
      }

      .day-num {
        color: var(--calendaria-day-number);
      }
    }

    &.today {
      background: var(--calendaria-today-bg);
      box-shadow: inset 0 0 0 0.125rem var(--calendaria-today);

      .day-num {
        color: var(--calendaria-today);
        font-weight: 700;
      }
    }

    &.selected {
      background: var(--calendaria-selected-bg);
      box-shadow: inset 0 0 0 0.125rem var(--calendaria-primary);
    }

    &.festival {
      background: color-mix(in srgb, var(--festival-color, var(--calendaria-festival-border)) 15%, var(--calendaria-bg));

      .day-num {
        color: var(--festival-color, var(--calendaria-festival-text));
      }
    }

    .day-num {
      color: var(--calendaria-day-number);
      font-weight: 500;
      font-size: 0.9rem;
    }

    .note-badge {
      display: flex;
      position: absolute;
      bottom: 0.1563rem;
      left: 0.15rem;
      justify-content: center;
      align-items: center;
      width: 0.9375rem;
      height: 0.9375rem;
      padding: 0 0.125rem;
      border-radius: 0.25rem;
      color: var(--calendaria-note-badge-text);
      font-weight: 700;
      font-size: 0.85rem;
      background: var(--calendaria-note-badge-bg);
    }

    .moon-tint {
      position: absolute;
      top: 0.125rem;
      right: 0.125rem;
      width: 0.75rem;
      height: 0.75rem;
      border-radius: 50%;
      overflow: hidden;
      background-color: color-mix(in srgb, var(--moon-color, transparent) 50%, rgb(255 255 255));
    }

    .moon-tiny {
      position: absolute;
      top: 0.125rem;
      right: 0.125rem;
      width: 0.75rem;
      height: 0.75rem;

      &.tinted {
        mix-blend-mode: multiply;
        position: static;
        width: 100%;
        height: 100%;
      }
    }
  }

  .mini-time-display {
    display: flex;
    z-index: 1;
    position: relative;
    justify-content: center;
    align-items: center;
    padding: 0.5rem 0.625rem;
    border-top: 0.0625rem solid var(--calendaria-border-light);
    border-radius: 0 0 0.875rem 0.875rem;
    cursor: pointer;
    background: var(--calendaria-bg-lighter);

    .time-value {
      color: var(--calendaria-title-text);
      font-weight: 600;
      font-size: 1.1rem;
      font-family: monospace;
      letter-spacing: 0.0625rem;
      transition: opacity 0.15s;
    }

    .date-value {
      color: var(--calendaria-text-dim);
      font-size: 0.85rem;
    }

    .hidden {
      display: none;
    }

    .time-toggle {
      inset: 0;
      display: flex;
      opacity: 0;
      position: absolute;
      justify-content: center;
      align-items: center;
      pointer-events: none;
      background: var(--calendaria-bg-lighter);
      transition: opacity 0.15s;

      i {
        color: var(--calendaria-text);
        font-size: 1.2rem;
      }

      &.active i {
        color: var(--calendaria-primary);
      }
    }

    &:hover .time-value {
      opacity: 0;
    }

    &:hover .time-toggle {
      opacity: 1;
      pointer-events: auto;
    }
  }

  .mini-time-controls {
    display: flex;
    position: relative;
    justify-content: center;
    align-items: center;
    height: 2.75rem;
    margin-bottom: -2.75rem;
    padding: 0.5rem 0.625rem;
    border-top: 0.0625rem solid var(--calendaria-border-light);
    border-radius: 0 0 0.875rem 0.875rem;
    background: var(--calendaria-bg-lighter);
    transition:
      transform 0.25s ease,
      margin-bottom 0.25s ease;
    transform: translateY(-100%);

    &.visible {
      margin-bottom: 0;
      transform: translateY(0);
    }

    .controls-group {
      gap: 0.25rem;
      display: flex;
      align-items: center;
    }

    .time-btn {
      display: flex;
      justify-content: center;
      align-items: center;
      box-sizing: border-box;
      width: 1.75rem;
      height: 1.75rem;
      padding: 0;
      border: 0.0625rem solid var(--calendaria-button-border);
      border-radius: 0.25rem;
      color: var(--calendaria-button-text);
      cursor: pointer;
      background: var(--calendaria-button-bg);
      transition:
        border-color 0.15s,
        background 0.15s;

      &:hover {
        border-color: var(--calendaria-primary);
        background: var(--calendaria-bg-hover);
      }

      &:focus {
        outline: none;
        box-shadow: none;
      }

      &.custom-jump {
        width: auto;
        min-width: 1.75rem;
        padding: 0 0.25rem;
        font-weight: 600;
        font-size: var(--font-size-11);
      }
    }

    .increment-select {
      -moz-appearance: none;
      -webkit-appearance: none;
      appearance: none;
      box-sizing: border-box;
      width: 3.25rem;
      min-width: 3.25rem;
      height: 1.75rem;
      margin: 0;
      padding: 0 0.375rem;
      border: 0.0625rem solid var(--calendaria-button-border);
      border-radius: 0.25rem;
      color: var(--calendaria-button-text);
      font-size: 0.75rem;
      line-height: 1.625rem;
      text-align: center;
      cursor: pointer;
      background: var(--calendaria-button-bg);
      background-image: none;

      &:hover {
        border-color: var(--calendaria-primary);
      }

      &:focus {
        outline: none;
        box-shadow: none;
      }
    }
  }
}

#context-menu {
  .context-group {
    max-height: none;
    overflow: visible;
  }

  .context-item {
    &.sticky-active {
      color: var(--color-text-light-highlight, rgb(255 255 255));
      background: var(--calendaria-primary);

      &:hover {
        background: var(--calendaria-primary);
      }
    }

    &:has(.note-row) {
      display: flex;
      align-items: center;
    }

    .note-row {
      display: flex;
      flex: 1;
      align-items: center;
      min-width: 0;
    }

    .note-name {
      max-width: 9.375rem;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .note-actions {
      gap: 0.5rem;
      display: inline-flex;
      margin-left: auto;
      padding-left: 0.5rem;

      i {
        opacity: 0.6;
        cursor: pointer;
        transition: opacity 0.15s ease;

        &:hover {
          opacity: 1;
        }
      }
    }
  }
}

/* Day Cell Tooltip Styles */
.calendaria-day-tooltip {
  line-height: 1.4;
  text-align: center;

  .calendaria-day-tooltip-date {
    margin-bottom: 0.125rem;
    font-size: 0.9rem;

    strong {
      color: var(--color-text-primary, rgb(238 238 238));
    }
  }

  .calendaria-day-tooltip-festival {
    color: var(--calendaria-primary, rgb(74 158 255));
    font-size: 0.85rem;
  }

  .calendaria-day-tooltip-season {
    color: var(--color-text-secondary, rgb(170 170 170));
    font-size: 0.8rem;
  }

  .calendaria-day-tooltip-sun {
    margin-top: 0.25rem;
    color: var(--color-text-secondary, rgb(170 170 170));
    font-size: 0.8rem;

    i {
      opacity: 0.7;
      margin: 0 0.125rem;
    }

    .fa-sun {
      color: rgb(251 191 36);
    }

    .fa-moon {
      color: rgb(167 139 250);
    }
  }
}

.hidden {
  display: none !important;
}

/* ======================================== */
/* Importer Application                      */
/* ======================================== */

.calendaria.importer-app {
  max-height: 60vh;
  overflow: hidden;

  .importer-content {
    gap: 0.75rem;
    display: flex;
    flex: 1;
    flex-direction: column;
    min-height: 0;
    padding: 0.5rem;
    overflow: hidden;
  }

  .no-importers {
    padding: 2rem;
    text-align: center;

    i {
      display: block;
      margin-bottom: 0.5rem;
      font-size: 2rem;
    }
  }

  fieldset {
    border-radius: 0.3125rem;
  }

  .importer-grid {
    gap: 0.75rem;
    grid-template-columns: 17.5rem 1fr;
    display: grid;
    flex: 1;
    min-height: 0;
    overflow: hidden;
  }

  .importer-left {
    gap: 0.75rem;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
  }

  .importer-right {
    display: flex;
    flex-direction: column;
    min-height: 0;
    overflow: hidden;
  }

  .source-section {
    min-width: 0;
    max-width: 100%;
    padding: 0.5rem;
    overflow: hidden;

    legend {
      gap: 0.5rem;
      display: flex;
      align-items: center;
      padding: 0 0.5rem;
      font-weight: 600;
    }

    .form-group {
      margin-bottom: 0.5rem;
    }
  }

  .importer-description {
    margin: 0;
    padding: 0.25rem 0;
    font-size: 0.85rem;
    line-height: 1.3;
  }

  .file-upload-zone {
    gap: 0.5rem;
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
    min-width: 0;
    max-width: 100%;
    padding: 0.75rem;
    border: 0.0625rem dashed var(--color-border-light-tertiary, var(--calendaria-input-border));
    border-radius: 0.375rem;
    overflow: hidden;
    cursor: pointer;
    transition: border-color 0.2s;

    &:hover,
    &.dragover {
      border-color: var(--color-border-highlight, var(--calendaria-primary));
    }

    &.has-file {
      justify-content: space-between;
      border-style: solid;
      cursor: default;

      .file-name {
        flex: 1;
        min-width: 0;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .clear-file {
        padding: 0.15rem 0.35rem;
        border: none;
        font-size: 0.8rem;
        cursor: pointer;
        background: none;
        box-shadow: none;
      }
    }

    i {
      opacity: 0.7;
      font-size: 1.25rem;
    }

    span {
      font-size: 0.85rem;
    }
  }

  .import-from-module {
    width: 100%;
    padding: 0.5rem;
    border: none;
    background: none;
    box-shadow: none;

    i {
      margin-right: 0.5rem;
    }
  }

  .module-loaded {
    gap: 0.5rem;
    display: flex;
    align-items: center;
    padding: 0.5rem 0.75rem;
    border-radius: 0.375rem;

    span {
      flex: 1;
      font-size: 0.85rem;
    }

    .clear-module {
      padding: 0.15rem 0.35rem;
      border: none;
      font-size: 0.8rem;
      cursor: pointer;
      background: none;
      box-shadow: none;
    }

    i:first-child {
      opacity: 0.7;
    }
  }

  .import-error {
    gap: 0.5rem;
    display: flex;
    align-items: flex-start;
    padding: 0.5rem;
    border-radius: 0.25rem;
    background: rgb(255 0 0 / 10%);

    i {
      flex-shrink: 0;
      color: var(--color-level-error, var(--calendaria-error));
    }

    span {
      font-size: 0.85rem;
      white-space: pre-wrap;
    }
  }

  .preview-section {
    padding: 0.5rem;

    legend {
      gap: 0.5rem;
      display: flex;
      align-items: center;
      padding: 0 0.5rem;
      font-weight: 600;
    }
  }

  .preview-header {
    padding: 0.25rem 0 0.5rem;
    font-weight: 600;
    font-size: 1rem;
    text-align: center;
  }

  .preview-grid {
    gap: 0.25rem;
    grid-template-columns: 1fr 1fr;
    display: grid;
  }

  .preview-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 0.2rem 0.35rem;
    font-size: 0.85rem;

    .preview-value {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .preview-label {
      opacity: 0.7;
      font-size: 0.75rem;
    }
  }

  .undated-notice {
    gap: 0.5rem;
    display: flex;
    align-items: center;
    margin-top: 0.5rem;
    padding: 0.5rem 0.75rem;
    border-radius: 0.25rem;
    color: var(--calendaria-primary, rgb(33 150 243));
    font-size: 0.85rem;
    background: var(--calendaria-primary-10, rgb(33 150 243 / 10%));

    i {
      font-size: 1rem;
    }
  }

  .import-options {
    padding: 0.5rem;

    legend {
      gap: 0.5rem;
      display: flex;
      align-items: center;
      padding: 0 0.5rem;
      font-weight: 600;
    }

    .form-group.slim {
      margin-bottom: 0.35rem;

      label {
        margin-bottom: 0.15rem;
        font-size: 0.85rem;
      }

      input {
        padding: 0.25rem 0.35rem;
        font-size: 0.85rem;
      }
    }

    .id-prefix {
      opacity: 0.7;
      padding-right: 0.25rem;
      font-size: 0.85rem;
    }
  }

  .note-selection {
    display: flex;
    flex: 1;
    flex-direction: column;
    min-height: 0;
    padding: 0.5rem;

    legend {
      gap: 0.5rem;
      display: flex;
      flex-shrink: 0;
      align-items: center;
      padding: 0 0.5rem;
      font-weight: 600;

      .note-count {
        opacity: 0.7;
        font-weight: normal;
        font-size: 0.85rem;
      }
    }
  }

  .note-bulk-actions {
    gap: 0.35rem;
    display: flex;
    flex-shrink: 0;
    justify-content: flex-end;
    margin-bottom: 0.5rem;

    .bulk-btn {
      padding: 0.35rem 0.65rem;
      border: none;
      font-size: 0.9rem;
      background: none;
      box-shadow: none;

      &:hover {
        background: var(--color-cool-4);
      }
    }
  }

  .note-selection-table {
    scrollbar-gutter: stable;
    display: flex;
    flex: 1;
    flex-direction: column;
    border-radius: 0.25rem;
    overflow-y: auto;
  }

  .note-row {
    gap: 0.35rem;
    grid-template-columns: 1fr 3.125rem 4.5rem;
    display: grid;
    align-items: center;
    padding: 0.3rem 0.5rem;
    border-bottom: 0.0625rem solid var(--color-border-light-tertiary, var(--calendaria-input-border));

    &:last-child {
      border-bottom: none;
    }

    &.header {
      z-index: 1;
      position: sticky;
      top: 0;
      font-weight: 600;
      font-size: 0.8rem;
      background: var(--color-cool-5);

      .note-radios {
        display: flex;
        justify-content: space-around;

        i {
          opacity: 0.8;
          font-size: 0.75rem;
        }
      }
    }

    &:not(.header):hover {
      background: var(--color-cool-5-75, var(--calendaria-cool-5-75));
    }
  }

  .note-name {
    overflow: hidden;
    font-size: 0.85rem;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .note-date {
    opacity: 0.8;
    font-size: 0.8rem;
    text-align: center;
  }

  .note-radios {
    display: flex;
    justify-content: space-around;
    align-items: center;

    input[type='radio'] {
      width: 0.875rem;
      height: 0.875rem;
      margin: 0;
      cursor: pointer;
    }
  }

  .no-notes {
    display: flex;
    opacity: 0.6;
    flex: 1;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 2rem;
    text-align: center;

    i {
      margin-bottom: 0.75rem;
      font-size: 2rem;
    }

    p {
      margin: 0;
      font-size: 0.9rem;
    }
  }

  .form-footer {
    display: flex;
    justify-content: center;
    padding-top: 0.5rem;
    border-top: 0.0625rem solid var(--color-border-light-tertiary, var(--calendaria-input-border));

    button[type='submit'] {
      padding: 0.5rem 1.5rem;

      &:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      i {
        margin-right: 0.5rem;
      }
    }
  }
}

/* ======================================== */
/* Macro Trigger Styles (Settings Panel)    */
/* ======================================== */

.calendaria.settings-panel {
  nav.sheet-tabs .tab-group:last-child {
    margin-top: auto;
  }

  .season-triggers-list,
  .moon-triggers-list {
    gap: 0.5rem;
    display: flex;
    flex-direction: column;
    margin-bottom: 1rem;
  }

  .trigger-header {
    gap: 0.5rem;
    display: flex;
    align-items: center;
    padding: 0.25rem 0;
    color: var(--color-text-dark-secondary);
    font-weight: 500;
    font-size: var(--font-size-13);

    span:first-child {
      flex: 0 0 10rem;
    }

    span:nth-child(2) {
      flex: 1;
    }

    span:last-child {
      width: 1.75rem;
    }
  }

  .season-trigger-row,
  .moon-trigger-row {
    gap: 0.5rem;
    display: flex;
    align-items: center;
    padding: 0.25rem 0;
  }

  .season-trigger-row {
    > select:first-child {
      flex: 0 0 10rem;
    }

    > select:nth-child(2) {
      flex: 1;
    }
  }

  .moon-trigger-row {
    > select:first-child {
      flex: 0 0 7.5rem;
    }

    > select:nth-child(2) {
      flex: 0 0 7.5rem;
    }

    > select:nth-child(3) {
      flex: 1;
    }
  }

  .moon-triggers-list .trigger-header {
    span:first-child {
      flex: 0 0 7.5rem;
    }

    span:nth-child(2) {
      flex: 0 0 7.5rem;
    }

    span:nth-child(3) {
      flex: 1;
    }
  }

  .fieldset-header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;

    > .hint {
      flex: 1;
      margin: 0;
    }
  }

  .add-trigger-row {
    gap: 0.5rem;
    display: flex;
    align-items: center;

    select {
      min-width: 6.25rem;
    }
  }

  .toolbar-apps-checkboxes {
    gap: 0.5rem;
    display: flex;
    margin-right: 0.1875rem;

    .checkbox-inline {
      gap: 0.25rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      cursor: pointer;

      input[type='checkbox'] {
        margin: 0;
      }

      i {
        font-size: var(--font-size-14);
      }
    }
  }
}

/* ======================================== */
/* Weather Picker Application               */
/* ======================================== */

.weather-picker-app {
  &.standard-form {
    gap: 0;
  }

  .window-content {
    padding: 0.75rem;
    background: var(--calendaria-bg);
  }

  .weather-picker-content {
    gap: 1rem;
    display: flex;
    flex-direction: column;
  }

  .zone-selector {
    padding-bottom: 0.75rem;
    border-bottom: 0.0625rem solid var(--calendaria-border);
  }

  .weather-category {
    .category-header {
      display: block;
      margin: 0 0 0.5rem;
      padding-bottom: 0.25rem;
      border-bottom: 0.0625rem solid var(--calendaria-border);
      color: var(--calendaria-text-dim);
      font-weight: 600;
      font-size: var(--font-size-15);
    }

    .weather-buttons {
      gap: 0.4rem;
      grid-template-columns: repeat(auto-fill, minmax(6.875rem, 1fr));
      display: grid;
    }
  }

  .weather-btn {
    gap: 0.4rem;
    display: flex;
    align-items: center;
    padding: 0.4rem 0.6rem;
    border: 0.0625rem solid color-mix(in srgb, var(--weather-color) 50%, transparent);
    border-radius: 0.25rem;
    color: var(--calendaria-text);
    text-align: left;
    cursor: pointer;
    background: color-mix(in srgb, var(--weather-color) 20%, var(--calendaria-bg-lighter));
    transition:
      border-color 0.15s ease,
      background 0.15s ease,
      transform 0.15s ease;

    &:hover {
      border-color: var(--weather-color);
      background: color-mix(in srgb, var(--weather-color) 35%, var(--calendaria-bg-lighter));
      transform: translateY(-0.0625rem);
    }

    &:active {
      transform: translateY(0);
    }

    &.active {
      border-color: var(--weather-color);
      background: color-mix(in srgb, var(--weather-color) 40%, var(--calendaria-bg-lighter));
      box-shadow: 0 0 0 0.0625rem var(--weather-color);
    }

    i {
      flex-shrink: 0;
      width: 1rem;
      color: var(--weather-color);
      font-size: 0.9rem;
      text-align: center;
    }

    .weather-label {
      overflow: hidden;
      font-size: 0.8rem;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
  }

  .weather-picker-footer {
    gap: 0.5rem;
    display: flex;
    padding-top: 0.5rem;
    border-top: 0.0625rem solid var(--calendaria-border);

    .footer-btn {
      gap: 0.5rem;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 0.5rem 1.5rem;
      border: none;
      border-radius: 0.25rem;
      color: var(--calendaria-text-on-color);
      font-weight: 500;
      font-size: 0.9rem;
      cursor: pointer;
      transition: opacity 0.15s ease;

      &:hover {
        opacity: 0.85;
      }

      i {
        font-size: 1rem;
      }
    }

    .clear-btn {
      flex-shrink: 0;
      background: var(--calendaria-error);
    }

    .random-btn {
      flex-shrink: 0;
      background: var(--calendaria-primary);
    }

    .save-btn {
      flex: 1;
      background: var(--calendaria-success);
    }
  }
}

/* ======================================== */
/* HUD - Sundial Widget                     */
/* ======================================== */

.calendaria-hud {
  display: inline-flex;
  opacity: var(--calendaria-hud-idle-opacity, 1);
  z-index: 100;
  position: fixed;
  flex-direction: column;
  align-items: center;
  color: var(--calendaria-text);
  font-family: var(--font-primary, 'Signika', 'Palatino Linotype', serif);
  transition: opacity 0.3s ease-in-out 2s;

  &:hover {
    opacity: 1;
    transition-delay: 0s;
  }
}

.calendaria-hud-content {
  display: flex;
  position: relative;
  flex-direction: column;
  align-items: center;
}

/* ======================================== */
/* Sundial Dome                             */
/* ======================================== */
.calendaria-hud-dome {
  z-index: 1;
  position: absolute;
  bottom: calc(100% - 0.875rem);
  left: 50%;
  width: 10rem;
  height: 5rem;
  border: 0.125rem solid rgb(26 26 26);
  border-bottom: none;
  border-radius: 5rem 5rem 0 0;
  overflow: hidden;
  cursor: pointer;
  transition:
    opacity 0.3s ease,
    border-color 0.3s ease;
  transform: translateX(-50%);
}

.calendaria-hud-dome:focus {
  outline: 0.125rem solid rgb(100 180 255 / 60%);
  outline-offset: 0.125rem;
}

.calendaria-hud-dome::before {
  inset: 0;
  z-index: 10;
  position: absolute;
  border: 0.125rem solid rgb(20 20 20 / 90%);
  border-bottom: none;
  border-radius: 5rem 5rem 0 0;
  pointer-events: none;
  content: '';
  box-shadow: inset 0 0 1.25rem rgb(0 0 0 / 40%);
}

.calendaria-hud-dome.hidden {
  display: none;
}

.calendaria-hud-sky {
  inset: 0;
  position: absolute;
  transition: background 0.5s ease;
}

/* ======================================== */
/* Stars                                    */
/* ======================================== */
.calendaria-hud-stars {
  inset: 0;
  opacity: 0;
  z-index: 2;
  position: absolute;
  transition: opacity 1.5s ease;
}

.calendaria-hud-stars.visible {
  opacity: 1;
}

.calendaria-hud-stars::before,
.calendaria-hud-stars::after {
  position: absolute;
  width: 0.125rem;
  height: 0.125rem;
  border-radius: 50%;
  content: '';
  background: rgb(255 255 255);
  box-shadow:
    1rem 0.75rem 0 0 rgb(255 255 255 / 80%),
    3.5rem 1.375rem 0 0 rgb(255 255 255 / 60%),
    4.8125rem 1.625rem 0 0 rgb(255 255 255 / 70%),
    7.5rem 0.875rem 0 0 rgb(255 255 255 / 65%),
    8.75rem 2.375rem 0 0 rgb(255 255 255 / 75%),
    2.1875rem 1.75rem 0 0.0625rem rgb(255 255 255 / 90%),
    6.1875rem 0.5rem 0 0.0625rem rgb(255 255 255 / 85%),
    3rem 2.75rem 0 0.0625rem rgb(255 255 255 / 80%),
    5.5rem 2.5rem 0 0 rgb(255 255 255 / 70%),
    8rem 1.875rem 0 0 rgb(255 255 255 / 75%);
  animation: calendaria-twinkle 3s ease-in-out infinite;
}

.calendaria-hud-stars::after {
  box-shadow:
    1.5625rem 1.125rem 0 0 rgb(255 255 255 / 70%),
    4.0625rem 2.1875rem 0 0 rgb(255 255 255 / 80%),
    6.5625rem 1.25rem 0 0 rgb(255 255 255 / 65%),
    2.8125rem 0.625rem 0 0.0625rem rgb(255 255 255 / 90%),
    7.1875rem 3rem 0 0 rgb(255 255 255 / 75%);
  animation-delay: 1.5s;
}

@keyframes calendaria-twinkle {
  0%,
  100% {
    opacity: 0.3;
  }

  50% {
    opacity: 1;
  }
}

/* ======================================== */
/* Clouds                                   */
/* ======================================== */
.calendaria-hud-clouds {
  inset: 0;
  opacity: 0;
  z-index: 2;
  position: absolute;
  overflow: hidden;
  pointer-events: none;
  transition: opacity 1s ease;
}

.calendaria-hud-clouds.visible {
  opacity: 1;
}

.calendaria-hud-clouds::before,
.calendaria-hud-clouds::after {
  position: absolute;
  border-radius: 50%;
  content: '';
  background: rgb(255 255 255 / 35%);
  filter: blur(0.125rem);
}

.calendaria-hud-clouds::before {
  top: 1.5625rem;
  left: -2.5rem;
  width: 2.1875rem;
  height: 0.875rem;
  box-shadow:
    0.5rem -0.25rem 0 -0.125rem rgb(255 255 255 / 30%),
    1rem 0 0 -0.0625rem rgb(255 255 255 / 25%);
  animation: calendaria-clouds-drift 25s linear infinite;
}

.calendaria-hud-clouds::after {
  top: 2.8125rem;
  left: -1.875rem;
  width: 1.75rem;
  height: 0.6875rem;
  box-shadow:
    0.375rem -0.1875rem 0 -0.0625rem rgb(255 255 255 / 28%),
    0.75rem 0 0 0 rgb(255 255 255 / 22%);
  animation: calendaria-clouds-drift 35s linear infinite;
  animation-delay: 8s;
}

@keyframes calendaria-clouds-drift {
  0% {
    transform: translateX(0);
  }

  100% {
    transform: translateX(13.75rem);
  }
}

/* ======================================== */
/* Celestial Track & Bodies                 */
/* ======================================== */
.calendaria-hud-track {
  z-index: 3;
  position: absolute;
  bottom: 0;
  left: 50%;
  width: 8.75rem;
  height: 4.375rem;
  pointer-events: none;
  transform: translateX(-50%);
}

.calendaria-hud-body {
  position: absolute;
  border-radius: 50%;
  transition: opacity 0.8s ease;
}

.calendaria-hud-sun {
  opacity: 0;
  width: 1.25rem;
  height: 1.25rem;
  background: radial-gradient(circle at 35% 35%, rgb(255 245 170) 0%, rgb(255 229 92) 30%, rgb(255 217 61) 60%, rgb(255 165 0) 100%);
  box-shadow:
    0 0 0.9375rem rgb(255 217 61),
    0 0 1.875rem rgb(255 217 61 / 50%),
    0 0 3.125rem rgb(255 165 0 / 30%);
}

.calendaria-hud-moon {
  opacity: 0;
  width: 1.125rem;
  height: 1.125rem;
  background: radial-gradient(circle at 35% 35%, rgb(255 255 248) 0%, rgb(232 232 224) 40%, rgb(200 200 184) 100%);
  box-shadow:
    0 0 0.625rem rgb(255 255 255 / 50%),
    0 0 1.25rem rgb(255 255 255 / 20%);
}

/* ======================================== */
/* Bar Wrapper                              */
/* ======================================== */
.calendaria-hud-bar-wrapper {
  display: contents;
}

/* ======================================== */
/* Main Bar                                 */
/* ======================================== */
.calendaria-hud-bar {
  grid-template-columns: 1fr auto 1fr;
  display: inline-grid;
  z-index: 10;
  position: relative;
  align-items: center;
  align-content: center;
  min-height: 2.25rem;
  max-height: 3rem;
  padding: 0 0.625rem;
  border: 0.0625rem solid var(--calendaria-border);
  border-radius: 0.375rem;
  cursor: grab;
  background: var(--calendaria-bg);
  box-shadow: 0 0 0.625rem var(--calendaria-shadow);
}

/* Width scale for fullsize mode - prevents content-driven resizing */
.calendaria-hud:not(.compact) .calendaria-hud-bar {
  display: grid;
  box-sizing: border-box;
  width: calc(50rem * var(--hud-width-scale, 1));
}

.calendaria-hud:not(.compact) .calendaria-hud-section {
  min-width: 0;
  overflow: hidden;
}

.calendaria-hud:not(.compact) .calendaria-hud-indicators {
  flex: 1 1 0;
  justify-content: flex-start;
  min-width: 0;
  overflow: hidden;
}

.calendaria-hud:not(.compact) .calendaria-hud-indicators .weather-indicator {
  max-width: 100%;
  overflow: hidden;
}

.calendaria-hud:not(.compact) .calendaria-hud-indicators .weather-label,
.calendaria-hud:not(.compact) .calendaria-hud-indicators .season-label {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.calendaria-hud:not(.compact) .calendaria-hud-tray {
  gap: 0.25rem;
  box-sizing: border-box;
  max-width: calc(50rem * var(--hud-width-scale, 1));
  padding: clamp(0.25rem, calc(0.375rem * var(--hud-width-scale, 1)), 0.375rem) clamp(0.375rem, calc(0.625rem * var(--hud-width-scale, 1)), 0.625rem);
}

.calendaria-hud:not(.compact) .calendaria-hud-tray .calendaria-hud-time-btn {
  width: 1.625rem;
  height: 1.625rem;
  font-size: 0.75rem;
}

.calendaria-hud:not(.compact) .calendaria-hud-tray .calendaria-hud-select {
  height: 1.625rem;
  padding: 0 0.375rem;
  font-size: 0.75rem;
  line-height: 1.5rem;
}

.calendaria-hud-bar.dragging {
  cursor: grabbing;
}

.calendaria-hud-bar.locked {
  cursor: default;
}

.calendaria-hud-bar.has-events {
  border-color: var(--event-glow, rgb(238 136 136));
}

/* Wobble animation for sticky zone detection */
@keyframes calendaria-wobble {
  0%,
  100% {
    transform: rotate(-1.5deg);
  }

  50% {
    transform: rotate(1.5deg);
  }
}

.calendaria-hud-bar.near-snap,
.time-keeper .time-display.near-snap,
.mini-cal .mini-top-row.near-snap {
  border-color: var(--calendaria-primary);
  box-shadow:
    0 0 0.625rem var(--calendaria-shadow),
    0 0 0.5rem var(--calendaria-primary);
  animation: calendaria-wobble 0.15s ease-in-out infinite;
}

/* Snap indicator ghost preview */
.calendaria-snap-indicator {
  display: flex;
  opacity: 0;
  z-index: 59;
  position: fixed;
  justify-content: center;
  align-items: center;
  height: 2rem;
  padding: 0 0.75rem;
  border: 0.125rem dashed var(--calendaria-primary);
  border-radius: 0.375rem;
  pointer-events: none;
  background: color-mix(in srgb, var(--calendaria-primary) 15%, transparent);
  transition: opacity 0.15s ease;
}

.calendaria-snap-indicator.visible {
  opacity: 1;
}

.calendaria-snap-indicator::before {
  display: block;
  opacity: 0.5;
  width: 3.75rem;
  height: 0.25rem;
  border-radius: 0.125rem;
  content: '';
  background: var(--calendaria-primary);
}

/* DOM-parented pinned state */
.calendaria-pinned {
  z-index: 1000 !important;
  position: relative !important;
  top: auto !important;
  left: auto !important;
  width: max-content;
  margin-bottom: 0.5rem;
  pointer-events: auto !important;
}

/* ======================================== */
/* HUD Sections                             */
/* ======================================== */
.calendaria-hud-section {
  gap: 0.625rem;
  display: flex;
  align-items: center;
}

.calendaria-hud-section.left {
  justify-content: flex-start;
  padding-right: 0.3125rem;
}

.calendaria-hud-section.right {
  justify-content: flex-end;
  padding-left: 0.3125rem;
}

/* ======================================== */
/* HUD Buttons                              */
/* ======================================== */
.calendaria-hud-btn {
  display: flex;
  flex-shrink: 0;
  justify-content: center;
  align-items: center;
  width: 1.375rem;
  height: 1.375rem;
  min-height: 1.375rem;
  max-height: 1.375rem;
  margin: 0;
  padding: 0;
  border: 0.0625rem solid var(--calendaria-button-border);
  border-radius: 0.1875rem;
  color: var(--calendaria-text-dim);
  line-height: 1;
  cursor: pointer;
  background: var(--calendaria-button-bg);
  transition:
    color 0.15s ease,
    background 0.15s ease;
}

.calendaria-hud-btn:hover {
  color: var(--calendaria-text);
  background: var(--calendaria-bg-hover);
}

.calendaria-hud-btn:focus-visible {
  outline: 0.125rem solid var(--calendaria-primary);
  outline-offset: 0.0625rem;
}

.calendaria-hud-btn i {
  font-size: var(--font-size-13, 0.8125rem);
}

.calendaria-hud-btn.pin-btn {
  transition:
    all 0.15s ease,
    transform 0.2s ease;
}

.calendaria-hud-btn.pin-btn.has-sticky {
  color: var(--calendaria-accent);
}

.calendaria-hud-btn.pin-btn.has-sticky i {
  transform: rotate(-45deg);
}

.calendaria-hud-btn.pin-btn.sticky-position {
  color: var(--calendaria-success);
}

.calendaria-hud-btn-group {
  gap: 0.25rem;
  display: flex;
  flex-shrink: 0;
  align-items: center;
}

.calendaria-hud-btn-group.left,
.calendaria-hud-btn-group.right {
  min-width: 3.75rem;
}

.calendaria-hud-btn-group.left {
  justify-content: flex-start;
}

.calendaria-hud-btn-group.right {
  justify-content: flex-end;
}

/* ======================================== */
/* Left Info Panel                          */
/* ======================================== */
.calendaria-hud-info-panel {
  gap: 0.5rem;
  display: flex;
  position: relative;
  flex: 1 1 0;
  justify-content: right;
  align-items: center;
  min-width: 0;
  overflow: hidden;
  cursor: default;
}

.calendaria-hud-date {
  gap: 0.25em;
  display: inline-flex;
  align-items: center;
  overflow: hidden;
  color: var(--calendaria-text);
  font-weight: 500;
  font-size: clamp(var(--font-size-10, 0.625rem), calc(var(--font-size-12, 0.75rem) * var(--hud-width-scale, 1)), var(--font-size-12, 0.75rem));
  text-overflow: ellipsis;
  white-space: nowrap;
  cursor: pointer;
  transition: color 0.15s ease;
}

.calendaria-hud-date:hover {
  color: var(--calendaria-primary);
}

.calendaria-hud-date.hidden {
  display: none;
}

.calendaria-hud-date.compressed {
  font-size: var(--font-size-10, 0.625rem);
}

.calendaria-hud-event {
  gap: 0.375rem;
  display: flex;
  align-items: center;
  padding: 0.125rem 0.375rem;
  border-radius: 0.25rem;
  cursor: pointer;
  background: color-mix(in srgb, var(--event-color, rgb(168 100 100)) 20%, transparent);
  transition: background 0.15s ease;
}

.calendaria-hud-event.hidden {
  display: none;
}

.calendaria-hud-event:hover {
  background: color-mix(in srgb, var(--event-color, rgb(168 100 100)) 35%, transparent);
}

.calendaria-hud-event-icon {
  color: var(--event-color, rgb(238 136 136));
  font-size: var(--font-size-11, 0.6875rem);
}

.calendaria-hud-event-name {
  max-width: 8.75rem;
  overflow: hidden;
  color: var(--calendaria-text);
  font-size: var(--font-size-11, 0.6875rem);
  text-overflow: ellipsis;
}

.calendaria-hud-events {
  gap: 0.25rem;
  display: flex;
  align-items: center;
}

.calendaria-hud-event-icon-wrapper {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 1.25rem;
  height: 1.25rem;
  border-radius: 0.25rem;
  cursor: pointer;
  background: color-mix(in srgb, var(--event-color, rgb(168 100 100)) 25%, transparent);
  transition:
    background 0.15s ease,
    transform 0.15s ease;
}

.calendaria-hud-event-icon-wrapper:hover {
  background: color-mix(in srgb, var(--event-color, rgb(168 100 100)) 45%, transparent);
  transform: scale(1.1);
}

.calendaria-hud-event-icon-wrapper .calendaria-hud-event-icon {
  color: var(--event-color, rgb(238 136 136));
  font-size: var(--font-size-11, 0.6875rem);
}

/* ======================================== */
/* Center Section                           */
/* ======================================== */
.calendaria-hud-center {
  display: flex;
  flex-shrink: 0;
  justify-content: center;
  align-items: center;
}

.calendaria-hud-time-wrapper {
  display: flex;
  position: relative;
  justify-content: center;
  align-items: center;
  padding: 0 0.3125rem;
}

.calendaria-hud-time {
  padding: 0 0.5rem;
  color: var(--calendaria-text);
  font-size: clamp(var(--font-size-12, 0.75rem), calc(var(--font-size-14, 0.875rem) * var(--hud-width-scale, 1)), var(--font-size-14, 0.875rem));
  font-family: Consolas, Monaco, monospace;
  text-align: center;
  letter-spacing: 0.0313rem;
  white-space: nowrap;
}

.calendaria-hud-play-btn {
  display: flex;
  opacity: 0;
  position: absolute;
  top: 50%;
  left: 50%;
  justify-content: center;
  align-items: center;
  padding: 0.25rem;
  border: none;
  color: var(--calendaria-text-dim);
  cursor: pointer;
  pointer-events: none;
  background: transparent;
  transition:
    opacity 0.15s ease,
    color 0.15s ease;
  transform: translate(-50%, -50%);
}

.calendaria-hud-play-btn i {
  font-size: 1.25rem;
}

.calendaria-hud-time-wrapper:hover .calendaria-hud-play-btn {
  opacity: 1;
  pointer-events: auto;
}

.calendaria-hud-time-wrapper:hover .calendaria-hud-time {
  opacity: 0.3;
}

.calendaria-hud-play-btn:hover {
  color: var(--calendaria-text);
}

.calendaria-hud.time-flowing .calendaria-hud-time {
  animation: calendaria-time-pulse 2s ease-in-out infinite;
}

@keyframes calendaria-time-pulse {
  0%,
  100% {
    color: var(--calendaria-text);
  }

  50% {
    color: var(--calendaria-success);
  }
}

/* ======================================== */
/* Right Section                            */
/* ======================================== */
.calendaria-hud-indicators {
  gap: 0.5rem;
  display: flex;
  flex-shrink: 0;
  align-items: center;
}

.calendaria-hud-indicators .weather-indicator,
.calendaria-hud-indicators .season-indicator,
.calendaria-hud-indicators .era-indicator,
.calendaria-hud-indicators .cycle-indicator {
  font-size: clamp(var(--font-size-10, 0.625rem), calc(var(--font-size-12, 0.75rem) * var(--hud-width-scale, 1)), var(--font-size-12, 0.75rem));
  cursor: default;
}

.calendaria-hud-indicators .weather-indicator {
  padding: 0.25rem 0.5rem;
  border: 0.0625rem solid color-mix(in srgb, var(--weather-color, var(--calendaria-text-dim)) 30%, transparent);
  border-radius: 0.25rem;
  color: var(--calendaria-text);
  background: color-mix(in srgb, var(--weather-color, var(--calendaria-text-dim)) 15%, transparent);
}

.calendaria-hud-indicators .weather-indicator i {
  color: var(--weather-color, var(--calendaria-text-dim));
}

.calendaria-hud-indicators .weather-label,
.calendaria-hud-indicators .season-label {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.calendaria-hud-indicators .weather-indicator.clickable {
  cursor: pointer;
  transition:
    background 0.15s ease,
    border-color 0.15s ease;
}

.calendaria-hud-indicators .weather-indicator.clickable:hover {
  border-color: var(--weather-color, var(--calendaria-text-dim));
  background: color-mix(in srgb, var(--weather-color, var(--calendaria-text-dim)) 30%, transparent);
}

.calendaria-hud-indicators .weather-indicator.no-weather {
  border: 0.0625rem dashed var(--calendaria-border);
  color: var(--calendaria-text-dim);
  background: transparent;
}

.calendaria-hud-indicators .weather-indicator.no-weather:hover {
  border-color: var(--color-positive-fg, var(--calendaria-positive-fg));
  background: color-mix(in srgb, var(--color-positive-bg, var(--calendaria-positive-bg)) 20%, transparent);
}

.calendaria-hud-indicators .weather-temp {
  opacity: 0.8;
  margin-left: 0.25rem;
  font-size: 0.85em;
}

.calendaria-hud-indicators .season-indicator {
  overflow: hidden;
  color: var(--season-color, var(--calendaria-text-dim));
}

.calendaria-hud-indicators .season-indicator i {
  color: var(--season-color, var(--calendaria-text-dim));
}

.calendaria-hud-indicators .era-indicator,
.calendaria-hud-indicators .cycle-indicator {
  color: var(--calendaria-text-dim);
}

/* Weather display modes */
.calendaria-hud-indicators .weather-indicator.weather-mode-temp,
.calendaria-hud-indicators .weather-indicator.weather-mode-icon {
  padding: 0.15rem 0.35rem;
}

.calendaria-hud-indicators .weather-indicator.weather-mode-temp .weather-temp {
  margin-left: 0;
}

/* ======================================== */
/* Widget Indicators                        */
/* ======================================== */
.calendaria-widget-indicator {
  gap: 0.25rem;
  display: inline-flex;
  align-items: center;
  line-height: 1;
  cursor: default;
}

.calendaria-widget-indicator i {
  display: inline-flex;
  justify-content: center;
  align-items: center;
  font-size: 0.75em;
  line-height: 1;
}

.calendaria-widget-indicator .widget-label {
  line-height: 1;
}

.calendaria-widget-indicator.clickable {
  cursor: pointer;
}

.calendaria-hud-indicators .calendaria-widget-indicator {
  color: var(--widget-color, var(--calendaria-text-dim));
}

.calendaria-hud-indicators .calendaria-widget-indicator i {
  color: var(--widget-color, var(--calendaria-text-dim));
}

/* MiniCal / BigCal widget indicators */
.calendar-indicators .calendaria-widget-indicator {
  color: var(--widget-color, var(--calendaria-text-dim));
}

.calendar-indicators .calendaria-widget-indicator i {
  color: var(--widget-color, var(--calendaria-text-dim));
}

/* Custom widgets */
.calendaria-widget-custom {
  display: flex;
  align-items: center;
}

.calendaria-hud-tray .calendaria-widget-custom {
  font-size: var(--font-size-11, 0.6875rem);
}

/* ======================================== */
/* Hover Tray                               */
/* ======================================== */
.calendaria-hud-tray {
  gap: 0.25rem;
  display: flex;
  opacity: 0;
  z-index: 5;
  justify-content: center;
  align-items: center;
  max-height: 0;
  margin-top: -0.0625rem;
  padding: 0 0.625rem;
  border: 0.0625rem solid var(--calendaria-border);
  border-top: none;
  border-radius: 0 0 0.375rem 0.375rem;
  overflow: hidden;
  background: var(--calendaria-bg);
  transition:
    opacity 0.25s ease,
    max-height 0.25s ease,
    padding 0.25s ease;
}

.calendaria-hud:hover .calendaria-hud-tray,
.calendaria-hud-tray.visible {
  opacity: 1;
  max-height: 2.625rem;
  padding: 0.375rem 0.625rem;
}

/* ======================================== */
/* Tray Buttons                             */
/* ======================================== */
.calendaria-hud-time-btn {
  display: flex;
  flex-shrink: 0;
  justify-content: center;
  align-items: center;
  width: 1.625rem;
  height: 1.625rem;
  border: 0.0625rem solid var(--calendaria-button-border);
  border-radius: 0.25rem;
  color: var(--calendaria-text-dim);
  cursor: pointer;
  background: var(--calendaria-button-bg);
  transition:
    color 0.15s ease,
    background 0.15s ease;
}

.calendaria-hud-time-btn:hover {
  color: var(--calendaria-text);
  background: var(--calendaria-bg-hover);
}

.calendaria-hud-time-btn:focus,
.calendaria-hud-time-btn:focus-visible {
  outline: none;
  box-shadow: none;
}

.calendaria-hud-time-btn i {
  font-size: var(--font-size-14, 0.875rem);
}

.calendaria-hud-time-btn.time-shortcut {
  color: var(--calendaria-accent);
}

.calendaria-hud-time-btn.time-shortcut:hover {
  color: var(--calendaria-accent);
  background: color-mix(in srgb, var(--calendaria-accent) 15%, transparent);
}

.calendaria-hud-time-btn.custom-jump {
  width: auto;
  min-width: 1.625rem;
  padding: 0 0.25rem;
  font-weight: 600;
  font-size: var(--font-size-10, 0.625rem);
}

/* ======================================== */
/* Tray Dropdown                            */
/* ======================================== */
.calendaria-hud-select {
  -moz-appearance: none;
  -webkit-appearance: none;
  appearance: none;
  box-sizing: border-box;
  min-width: 3.25rem;
  height: 1.625rem;
  padding: 0 0.375rem;
  border: 0.0625rem solid var(--calendaria-button-border);
  border-radius: 0.25rem;
  color: var(--calendaria-text-dim);
  font-size: 0.75rem;
  line-height: 1.5rem;
  text-align: center;
  cursor: pointer;
  background: var(--calendaria-button-bg);
  transition:
    border-color 0.15s ease,
    color 0.15s ease,
    background 0.15s ease;
}

.calendaria-hud-select option {
  color: var(--calendaria-text-dim);
  background: var(--calendaria-bg);
}

.calendaria-hud-select:hover {
  border-color: var(--calendaria-border);
  color: var(--calendaria-text);
  background: var(--calendaria-button-hover);
}

.calendaria-hud-select:focus {
  outline: none;
  box-shadow: none;
}

.calendaria-hud-select[data-action='setIncrement'] {
  width: 3.25rem;
  min-width: 3.25rem;
}

.calendaria-hud-tray-divider {
  width: 0.0625rem;
  height: 1.125rem;
  background: var(--calendaria-border);
}

/* ======================================== */
/* Tray Up (Open Upward)                    */
/* ======================================== */
.calendaria-hud-bar-wrapper.tray-up {
  position: relative;
}

.calendaria-hud-bar-wrapper.tray-up .calendaria-hud-tray {
  position: absolute;
  bottom: 100%;
  left: 50%;
  margin-top: 0;
  margin-bottom: -0.0625rem;
  border-top: 0.0625rem solid var(--calendaria-border);
  border-bottom: none;
  border-radius: 0.375rem 0.375rem 0 0;
  transform: translateX(-50%);
}

/* ======================================== */
/* Compact Mode                             */
/* ======================================== */
.calendaria-hud.compact .calendaria-hud-dome {
  bottom: calc(100% - 0.625rem);
  width: 7.5rem;
  height: 3.75rem;
  border-radius: 3.75rem 3.75rem 0 0;
}

.calendaria-hud.compact .calendaria-hud-dome::before {
  border-radius: 3.75rem 3.75rem 0 0;
}

.calendaria-hud.compact .calendaria-hud-stars::before,
.calendaria-hud.compact .calendaria-hud-stars::after {
  box-shadow:
    0.75rem 0.625rem 0 0 rgb(255 255 255 / 75%),
    2.5rem 1.125rem 0 0 rgb(255 255 255 / 60%),
    3.75rem 0.75rem 0 0 rgb(255 255 255 / 70%),
    5.3125rem 1.375rem 0 0 rgb(255 255 255 / 65%),
    6.25rem 0.9375rem 0 0 rgb(255 255 255 / 80%),
    1.75rem 2.1875rem 0 0.0625rem rgb(255 255 255 / 85%),
    4.5rem 0.5rem 0 0.0625rem rgb(255 255 255 / 75%);
}

.calendaria-hud.compact .calendaria-hud-stars::after {
  box-shadow:
    1.25rem 0.875rem 0 0 rgb(255 255 255 / 70%),
    3.125rem 1.5625rem 0 0 rgb(255 255 255 / 65%),
    5rem 1.125rem 0 0 rgb(255 255 255 / 75%),
    5.9375rem 2.1875rem 0 0 rgb(255 255 255 / 60%);
}

.calendaria-hud.compact .calendaria-hud-track {
  width: 6.25rem;
  height: 3.125rem;
}

.calendaria-hud.compact .calendaria-hud-sun {
  width: 1rem;
  height: 1rem;
}

.calendaria-hud.compact .calendaria-hud-moon {
  width: 0.875rem;
  height: 0.875rem;
}

.calendaria-hud.compact .calendaria-hud-center {
  flex-shrink: 0;
}

.calendaria-hud.compact .calendaria-hud-btn-group.left,
.calendaria-hud.compact .calendaria-hud-btn-group.right {
  min-width: 3.125rem;
}

.calendaria-hud.compact .calendaria-hud-section {
  gap: 0.5rem;
}

.calendaria-hud.compact .calendaria-hud-info-panel,
.calendaria-hud.compact .calendaria-hud-indicators {
  gap: 0.25rem;
}

.calendaria-hud.compact .calendaria-hud-bar {
  gap: 0.5rem;
  height: 1.875rem;
  padding: 0 0.5rem;
}

.calendaria-hud.compact .calendaria-hud-btn {
  width: 1.125rem;
  height: 1.125rem;
  min-height: 1.125rem;
  max-height: 1.125rem;
}

.calendaria-hud.compact .calendaria-hud-btn i {
  font-size: var(--font-size-11, 0.6875rem);
}

.calendaria-hud.compact .calendaria-hud-btn-group {
  gap: 0.1875rem;
}

.calendaria-hud.compact .calendaria-hud-date,
.calendaria-hud.compact .calendaria-hud-event-name {
  font-size: var(--font-size-10, 0.625rem);
}

.calendaria-hud.compact .calendaria-hud-time {
  padding: 0 0.375rem;
  font-size: var(--font-size-12, 0.75rem);
}

.calendaria-hud.compact .calendaria-hud-indicators .weather-indicator,
.calendaria-hud.compact .calendaria-hud-indicators .season-indicator,
.calendaria-hud.compact .calendaria-hud-indicators .era-indicator,
.calendaria-hud.compact .calendaria-hud-indicators .cycle-indicator,
.calendaria-hud.compact .calendaria-hud-indicators .calendaria-widget-indicator {
  font-size: var(--font-size-12, 0.75rem);
}

.calendaria-hud.compact .calendaria-hud-indicators .calendaria-widget-indicator i,
.calendaria-hud.compact .calendaria-hud-indicators .calendaria-widget-indicator .widget-label {
  font-size: var(--font-size-12, 0.75rem);
}

.calendaria-hud.compact .calendaria-hud-select {
  min-width: 2.5rem;
  height: 1.375rem;
  padding: 0.0625rem 0.25rem;
  font-size: var(--font-size-10, 0.625rem);
}

.calendaria-hud.compact .calendaria-hud-live-event {
  width: 1.375rem;
  height: 1.375rem;
}

.calendaria-hud.compact .calendaria-hud-live-event-icon {
  font-size: var(--font-size-10, 0.625rem);
}

/* ======================================== */
/* Slice Mode                               */
/* ======================================== */
.calendaria-hud.slice-mode .calendaria-hud-dome {
  display: none;
}

.calendaria-hud-slice {
  display: grid;
  position: relative;
  align-items: center;
  min-width: 7.5rem;
  min-height: 1.5rem;
  border: 0.0625rem solid rgb(0 0 0 / 30%);
  border-radius: 0.25rem;
  overflow: hidden;
  cursor: pointer;
}

.calendaria-hud-slice:focus {
  outline: 0.125rem solid rgb(100 180 255 / 60%);
  outline-offset: 0.0625rem;
}

.calendaria-slice-sky {
  inset: 0;
  position: absolute;
  transition: background 0.5s ease;
}

.calendaria-slice-track {
  inset: 0;
  z-index: 1;
  position: absolute;
  pointer-events: none;
}

.calendaria-slice-body {
  position: absolute;
  top: 50%;
  border-radius: 50%;
  transition: opacity 0.8s ease;
  transform: translateY(-50%);
}

.calendaria-slice-sun {
  opacity: 0;
  width: 0.875rem;
  height: 0.875rem;
  background: radial-gradient(circle at 35% 35%, rgb(255 245 170) 0%, rgb(255 229 92) 30%, rgb(255 217 61) 60%, rgb(255 165 0) 100%);
  box-shadow:
    0 0 0.5rem rgb(255 217 61),
    0 0 1rem rgb(255 217 61 / 50%);
}

.calendaria-slice-moon {
  opacity: 0;
  width: 0.75rem;
  height: 0.75rem;
  background: radial-gradient(circle at 35% 35%, rgb(255 255 248) 0%, rgb(232 232 224) 40%, rgb(200 200 184) 100%);
  box-shadow:
    0 0 0.375rem rgb(255 255 255 / 50%),
    0 0 0.75rem rgb(255 255 255 / 20%);
}

.calendaria-slice-time-overlay {
  display: flex;
  z-index: 2;
  position: relative;
  justify-content: center;
  align-items: center;
  pointer-events: none;
}

.calendaria-slice-time-overlay .calendaria-hud-time {
  padding: 0 0.25rem;
  color: rgb(255 255 255);
  font-weight: 600;
  font-size: clamp(var(--font-size-10, 0.625rem), calc(var(--font-size-12, 0.75rem) * var(--hud-width-scale, 1)), var(--font-size-12, 0.75rem));
  text-shadow:
    0 0 0.125rem rgb(0 0 0),
    0 0 0.25rem rgb(0 0 0),
    0.0625rem 0.0625rem 0.125rem rgb(0 0 0),
    -0.0625rem -0.0625rem 0.125rem rgb(0 0 0),
    0.0625rem -0.0625rem 0.125rem rgb(0 0 0),
    -0.0625rem 0.0625rem 0.125rem rgb(0 0 0);
}

.calendaria-slice-time-overlay .calendaria-hud-play-btn {
  display: flex;
  opacity: 0;
  position: absolute;
  top: 50%;
  left: 50%;
  justify-content: center;
  align-items: center;
  width: 1.125rem;
  height: 1.125rem;
  min-height: 1.125rem;
  max-height: 1.125rem;
  padding: 0;
  border: none;
  border-radius: 50%;
  color: rgb(255 255 255);
  font-size: var(--font-size-10, 0.625rem);
  line-height: 1;
  pointer-events: auto;
  background: rgb(0 0 0 / 40%);
  transition: opacity 0.2s ease;
  transform: translate(-50%, -50%);
}

.calendaria-hud-slice:hover .calendaria-slice-time-overlay .calendaria-hud-play-btn {
  opacity: 1;
}

.calendaria-slice-time-overlay .calendaria-hud-play-btn:hover {
  background: rgb(0 0 0 / 60%);
}

.calendaria-slice-time-overlay .calendaria-hud-play-btn i {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

/* Compact slice adjustments */
.calendaria-hud.compact .calendaria-hud-slice {
  min-width: 6.25rem;
  min-height: 1.25rem;
}

.calendaria-hud.compact .calendaria-slice-sun {
  width: 0.75rem;
  height: 0.75rem;
}

.calendaria-hud.compact .calendaria-slice-moon {
  width: 0.625rem;
  height: 0.625rem;
}

.calendaria-hud.compact .calendaria-slice-time-overlay .calendaria-hud-time {
  font-size: var(--font-size-10, 0.625rem);
}

.calendaria-hud.compact .calendaria-slice-time-overlay .calendaria-hud-play-btn {
  width: 0.875rem;
  height: 0.875rem;
  min-height: 0.875rem;
  max-height: 0.875rem;
  font-size: 0.5rem;
}

/* ======================================== */
/* Chat Message Timestamps                  */
/* ======================================== */
.chat-message:has(.calendaria-timestamp-wrapper) .message-header .message-metadata {
  gap: 0.25rem;
  display: flex;
  align-items: center;
  max-width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.chat-message:has(.calendaria-timestamp-wrapper) .message-header .message-metadata .message-timestamp {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.calendaria-timestamp-wrapper {
  display: inline;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.calendaria-timestamp-wrapper .calendaria-timestamp-real {
  opacity: 0.7;

  &::before {
    content: '(';
  }

  &::after {
    content: ')';
  }
}

/* ======================================== */
/* Search Functionality                     */
/* ======================================== */
.calendaria-hud-search-panel {
  display: none;
  z-index: 100000;
  position: fixed;
  flex-direction: column;
  width: 17.5rem;
  padding: 0.5rem;
  border: 0.0625rem solid var(--calendaria-border, rgb(58 58 94));
  border-radius: 0.5rem;
  background: var(--calendaria-bg, rgb(26 26 46));
  box-shadow: 0 0.25rem 1.25rem rgb(0 0 0 / 50%);
}

.calendaria-hud-search-panel.visible {
  display: flex;
}

.calendaria-hud-search-panel .search-panel-header {
  gap: 0.25rem;
  display: flex;
  position: relative;
  align-items: center;
}

.calendaria-hud-search-panel .search-input {
  flex: 1;
  padding: 0.5rem 0.75rem;
  border: 0.0625rem solid var(--calendaria-border);
  border-radius: 0.375rem;
  color: var(--calendaria-text);
  font-size: var(--font-size-13, 0.8125rem);
  background: var(--calendaria-bg);
  box-shadow: 0 0.125rem 0.5rem var(--calendaria-shadow);
}

.calendaria-hud-search-panel .search-input:focus {
  border-color: var(--calendaria-primary);
  outline: none;
  box-shadow: 0 0.125rem 0.75rem var(--calendaria-shadow);
}

.calendaria-hud-search-panel .search-input::-webkit-search-cancel-button {
  -webkit-appearance: none;
  appearance: none;
  opacity: 0.5;
  width: 0.875rem;
  height: 0.875rem;
  cursor: pointer;
  background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 384 512'%3E%3Cpath fill='%23888' d='M342.6 150.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192 210.7 86.6 105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L146.7 256 41.4 361.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192 301.3l105.4 105.3c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.3 256l105.3-105.4z'/%3E%3C/svg%3E")
    center/contain no-repeat;
  transition: opacity 0.15s ease;
}

.calendaria-hud-search-panel .search-input::-webkit-search-cancel-button:hover {
  opacity: 1;
}

.calendaria-hud-search-panel .search-panel-results {
  display: none;
}

.calendaria-hud-search-panel .search-panel-results.has-results {
  display: block;
  max-height: 15.625rem;
  margin-top: 0.25rem;
  padding: 0.5rem;
  border: 0.0625rem solid var(--calendaria-border);
  border-radius: 0.375rem;
  overflow-y: auto;
  background: var(--calendaria-bg);
  box-shadow: 0 0.25rem 1rem var(--calendaria-shadow);
}

.calendaria-hud-search-panel .search-result-item {
  gap: 0.5rem;
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  align-items: center;
  padding: 0.3125rem 0.5rem;
  border-radius: 0.25rem;
  cursor: pointer;
  transition: background-color 0.15s ease;
}

.calendaria-hud-search-panel .search-result-item:hover {
  background: var(--calendaria-bg-hover);
}

.calendaria-hud-search-panel .result-content {
  gap: 0.0625rem;
  display: flex;
  flex: 1;
  flex-direction: column;
  min-width: 0;
}

.calendaria-hud-search-panel .result-name {
  color: var(--calendaria-text);
  font-weight: 500;
  font-size: var(--font-size-14, 0.875rem);
}

.calendaria-hud-search-panel .result-description {
  overflow: hidden;
  color: var(--calendaria-text-dim);
  font-size: var(--font-size-10, 0.625rem);
  text-overflow: ellipsis;
  white-space: nowrap;
}

.calendaria-hud-search-panel .result-icons {
  gap: 0.125rem;
  grid-template-columns: repeat(3, 1fr);
  display: grid;
  flex-shrink: 0;
  max-width: 3.375rem;
}

.calendaria-hud-search-panel .result-icons i {
  display: flex;
  opacity: 0.85;
  justify-content: center;
  align-items: center;
  width: 1rem;
  height: 1rem;
  font-size: 0.625rem;
  transition: opacity 0.15s ease;
}

.calendaria-hud-search-panel .result-icons i:hover {
  opacity: 1;
}

.calendaria-hud-search-panel .result-note-icon {
  font-size: 0.6875rem;
}

.calendaria-hud-search-panel .no-results {
  gap: 0.5rem;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 0.75rem;
  color: var(--calendaria-text-dim);
  font-size: var(--font-size-11, 0.6875rem);
}

/* ======================================== */
/* Moons Radial View Tooltip                */
/* ======================================== */
.calendaria-moons-tooltip {
  z-index: 100001;
  position: fixed;
  padding: 0.75rem;
  border: 0.0625rem solid var(--calendaria-border, rgb(58 58 94));
  border-radius: 0.625rem;
  cursor: grab;
  background: var(--calendaria-bg, rgb(26 26 46));
  box-shadow: 0 0.25rem 1.25rem rgb(0 0 0 / 60%);
}

.calendaria-moons-tooltip .moons-radial {
  position: relative;
  width: var(--radial-size);
  height: var(--radial-size);
  margin: 0.5rem auto;
}

.calendaria-moons-tooltip .moon-radial-item {
  --angle: calc(360deg / var(--moon-count) * var(--moon-index));
  --radius: calc(var(--radial-size) / 2 - 1rem);

  display: flex;
  position: absolute;
  top: 50%;
  left: 50%;
  flex-direction: column;
  align-items: center;
  cursor: pointer;
  transition: transform 0.15s ease;
  transform: translate(-50%, -50%) rotate(var(--angle)) translateY(calc(var(--radius) * -1)) rotate(calc(var(--angle) * -1));
}

.calendaria-moons-tooltip .moon-radial-icon {
  display: flex;
  justify-content: center;
  align-items: center;
  width: 1.75rem;
  height: 1.75rem;
  padding: 0.1875rem;
  border-radius: 50%;
  background: var(--calendaria-bg-hover, rgb(40 40 70));
  box-shadow: 0 0.125rem 0.375rem rgb(0 0 0 / 40%);
}

.calendaria-moons-tooltip .moon-radial-icon.tinted {
  background-color: color-mix(in srgb, var(--moon-color, transparent) 50%, rgb(40 40 70));
}

.calendaria-moons-tooltip .moon-radial-icon.tinted img {
  mix-blend-mode: multiply;
  filter: brightness(1.2) contrast(1.1);
}

.calendaria-moons-tooltip .moon-radial-icon img {
  object-fit: contain;
  width: 100%;
  height: 100%;
}

.calendaria-moons-tooltip .moon-radial-item:hover {
  transform: translate(-50%, -50%) rotate(var(--angle)) translateY(calc(var(--radius) * -1)) rotate(calc(var(--angle) * -1)) scale(1.1);
}

.calendaria-moons-tooltip .moon-radial-item.selected .moon-radial-icon {
  outline: 0.125rem solid var(--calendaria-primary, rgb(123 104 238));
  outline-offset: 0.125rem;
}

.calendaria-moons-tooltip .moon-name {
  color: var(--calendaria-text);
  font-weight: 500;
  font-size: var(--font-size-10, 0.625rem);
  line-height: 1.2;
  text-align: center;
  white-space: nowrap;
}

.calendaria-moons-tooltip .moon-radial-item.selected .moon-name {
  color: var(--calendaria-primary, rgb(123 104 238));
}

/* Clickable moon icons in calendar */
.moon-tiny.clickable,
.moon-tint.clickable {
  cursor: pointer;
  transition:
    transform 0.15s ease,
    box-shadow 0.15s ease;
}

.moon-tiny.clickable:hover,
.moon-tint.clickable:hover {
  z-index: 10;
  filter: brightness(1.2);
  transform: scale(1.3);
}

/* ======================================== */
/* Settings Panel                           */
/* ======================================== */
.settings-panel {
  /* Standardized font sizes */
  fieldset {
    legend {
      gap: 0.5rem;
      display: flex;
      align-items: center;
      font-size: var(--font-size-15);
    }
  }

  /* Legend action buttons (reset, help) */
  .reset-section,
  .legend-help {
    opacity: 0.6;
    height: 1.25rem;
    margin-right: 0.125rem;
    padding: 0;
    border: none;
    font-size: var(--font-size-14);
    cursor: pointer;
    background: none;

    &:hover {
      opacity: 1;
    }

    &:focus {
      outline: none;
      box-shadow: none;
    }
  }

  .reset-section {
    margin-left: auto;

    &:hover {
      color: var(--calendaria-error);
    }
  }

  .legend-help:hover {
    color: var(--calendaria-primary);
  }

  .form-group label,
  label {
    font-size: var(--font-size-14);
  }

  span {
    font-size: var(--font-size-13);
  }

  input,
  select {
    font-size: var(--font-size-14);
  }

  &.standard-form {
    gap: 0;

    .form-group > label {
      flex: 2;
    }
  }

  /* Search highlight */
  .search-highlight,
  fieldset.search-highlight {
    background: color-mix(in srgb, var(--color-warm-1) 20%, transparent) !important;
  }

  a.button,
  a.link-button {
    border: none;
    transition:
      background 0.15s ease,
      opacity 0.15s ease;

    &:hover {
      border: none;
    }

    &:focus {
      outline: none;
      box-shadow: none;
    }

    &:disabled {
      opacity: 0.4;
    }
  }

  button[type='submit'],
  button.primary {
    border: 0.0625rem solid var(--button-border-color);
    background: var(--button-background-color);

    &:hover {
      border-color: var(--button-hover-border-color);
      background: var(--button-hover-background-color);
    }
  }

  .window-content {
    gap: 0;
    grid-template-columns: auto 1fr;
    grid-template-rows: 1fr auto;
    display: grid;
    height: 100%;
    padding: 0;
    overflow: hidden;
  }

  .settings-footer {
    gap: 1rem;
    grid-column: 1 / -1;
    grid-row: 2;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem 1rem;
    border-top: 0.0625rem solid var(--color-cool-4);
    background: var(--color-cool-5-75);

    .footer-left,
    .footer-right {
      gap: 0.5rem;
      display: flex;
      align-items: center;
      min-width: 7.5rem;
    }

    .footer-left {
      justify-content: flex-start;
    }

    .footer-right {
      justify-content: flex-end;
    }

    .save-indicator {
      gap: 0.35rem;
      display: flex;
      align-items: center;
      color: var(--color-level-success);
      font-size: var(--font-size-13);

      i {
        font-size: var(--font-size-13);
      }

      &[data-state='saving'] {
        color: var(--color-warm-1);
      }
    }

    .footer-center {
      display: flex;
      flex-direction: column;
      align-items: center;
      line-height: 1.2;
    }

    .module-name {
      font-weight: 600;
      font-size: var(--font-size-14);
    }

    .version-link {
      color: var(--color-text-dark-secondary);
      font-size: var(--font-size-13);
      text-decoration: none;

      &:hover {
        color: var(--color-text-primary);
        text-decoration: underline;
      }
    }

    .social-icon {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 1.5rem;
      height: 1.5rem;
      border-radius: 0.25rem;
      color: var(--color-text-dark-secondary);
      font-size: var(--font-size-14);
      text-decoration: none;
    }
  }

  section.tab {
    grid-column: 2;
    grid-row: 1;
    display: none;
    padding: 1rem;
    overflow-y: auto;

    &.active {
      gap: 1rem;
      display: flex;
      flex-direction: column;
    }

    &[data-tab='home'] {
      overflow-y: hidden;

      > :last-child {
        flex-shrink: 0;
        height: auto;
        margin-top: auto;
      }
    }
  }

  .section-hint {
    margin-top: -0.25rem;
    margin-bottom: 0.5rem;

    &.success {
      color: var(--color-level-success);

      i {
        margin-right: 0.25rem;
      }
    }
  }

  .info-box {
    gap: 0.75rem;
    display: flex;
    align-items: flex-start;
    padding: 0.75rem 1rem;
    border-left: 0.1875rem solid var(--color-warm-1);
    border-radius: 0.25rem;
    background: var(--color-cool-5-50);

    i {
      margin-top: 0.125rem;
      color: var(--color-warm-1);
      font-size: var(--font-size-14);
    }

    p {
      margin: 0;
      color: var(--color-text-secondary);
      font-size: var(--font-size-13);
    }
  }

  /* Welcome Section */
  .welcome-section {
    flex-shrink: 0;

    .welcome-content {
      .welcome-text {
        margin: 0 0 0.75rem;
        color: var(--color-text-secondary);
        font-size: var(--font-size-13);
        line-height: 1.5;

        &:last-of-type {
          margin-bottom: 0;
        }
      }
    }
  }

  /* Recent Settings */
  .recent-settings {
    display: flex;
    flex: 1 1 auto;
    flex-direction: column;
    min-height: 0;

    .recent-list {
      display: flex;
      flex: 1 1 auto;
      flex-direction: column;
      min-height: 0;
      overflow-y: auto;
    }

    .recent-item {
      gap: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.1rem 0.25rem;
      border-radius: 0.25rem;
      color: var(--color-text-primary);
      text-decoration: none;
      cursor: pointer;
      transition: background 0.15s ease;

      &:hover {
        background: var(--color-cool-5);
      }

      .recent-label {
        font-size: var(--font-size-13);
      }

      .recent-time {
        color: var(--color-text-dark-secondary);
        font-size: var(--font-size-13);
        white-space: nowrap;
      }
    }
  }

  .button-row {
    gap: 0.5rem;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;

    &.app-controls {
      > button:first-child {
        flex: 1;
      }

      > button:nth-child(2),
      > button:nth-child(3) {
        flex: 2;
      }
    }

    button,
    a.link-button {
      gap: 0.5rem;
      display: inline-flex;
      align-items: center;
      width: fit-content;
      border: 0.0625rem solid var(--button-border-color);
      border-radius: 0.25rem;
      color: inherit;
      text-decoration: none;
      cursor: pointer;
      background: var(--button-background-color);

      &:hover {
        background: var(--button-hover-background-color);
      }

      i {
        width: 1rem;
        font-size: var(--font-size-14);
        text-align: center;
      }
    }
  }

  .form-group .form-fields.time-speed-fields {
    gap: 0.5rem;
    display: flex;
    align-items: center;

    input[type='number'] {
      width: 3.75rem;
      text-align: center;
    }

    select {
      width: auto;
    }

    .time-speed-suffix {
      color: var(--color-text-secondary);
      font-size: var(--font-size-13);
      white-space: nowrap;
    }
  }

  .time-jumps-grid {
    gap: 0.25rem 0.5rem;
    grid-template-columns: 1fr repeat(4, 4.5rem);
    display: grid;
    align-items: start;

    .time-jumps-header {
      display: contents;

      span {
        color: var(--color-text-secondary);
        font-weight: 600;
        font-size: var(--font-size-13);
        line-height: 1.2;
        text-align: center;

        &:first-child {
          text-align: left;
        }
      }
    }

    .time-jumps-row {
      display: contents;

      input[type='number'] {
        width: 100%;
        text-align: center;
      }
    }
  }

  .form-group .form-fields:has(input[type='range']) {
    align-items: center;

    input[type='range'] {
      flex: 1;

      &::-webkit-slider-runnable-track {
        height: 0.375rem;
      }

      &::-moz-range-track {
        height: 0.375rem;
      }
    }

    .range-value {
      flex: 0;
      min-width: 2.5em;
      color: var(--color-text-secondary);
      font-size: var(--font-size-13);
      text-align: center;
    }

    .input-suffix {
      flex: none;
      color: var(--color-text-secondary);
      font-size: var(--font-size-13);
    }
  }

  .slider-with-ticks {
    gap: 0.125rem;
    display: flex;
    position: relative;
    flex: 1;
    flex-direction: column;

    input[type='range'] {
      width: 100%;
    }

    .slider-ticks {
      display: flex;
      justify-content: space-between;
      padding: 0 0.5rem;

      span {
        width: 0.0625rem;
        height: 0.375rem;
        background: var(--color-border-light-tertiary);
      }
    }
  }

  .categories-list {
    gap: 0.5rem;
    display: flex;
    flex-direction: column;
    margin-bottom: 0.75rem;
  }

  .category-header {
    gap: 0.5rem;
    display: flex;
    align-items: center;
    padding: 0.25rem 0;
    color: var(--color-text-dark-secondary);
    font-weight: 500;
    font-size: var(--font-size-13);

    .col-color {
      width: 2rem;
      text-align: center;
    }

    .col-name {
      flex: 1;
    }

    .col-icon {
      width: 10em;
    }

    .col-actions {
      width: 2rem;
    }
  }

  .category-row {
    gap: 0.5rem;
    display: flex;
    align-items: center;
    padding: 0.25rem 0;

    input[type='color'] {
      width: 2rem;
      height: 2rem;
    }

    input[type='text'] {
      flex: 1;
    }

    .icon-input {
      flex: none;
      width: 10em;
    }

    .icon-button {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 2rem;
      height: 2rem;
      padding: 0;

      &.danger:hover {
        color: var(--color-text-light-highlight);
        background: var(--color-level-error);
      }
    }
  }

  .empty-message {
    color: var(--color-text-secondary);
    font-style: italic;
    font-size: var(--font-size-13);
  }

  .add-button {
    gap: 0.5rem;
    display: inline-flex;
    align-items: center;
    width: fit-content;
    margin: 0 auto;
    padding: 0.5rem 1rem;
    border: 0.0625rem solid var(--button-border-color);
    border-radius: 0.25rem;
    cursor: pointer;
    background: var(--button-background-color);

    &:hover {
      background: var(--button-hover-background-color);
    }
  }

  .weather-presets-grid {
    margin-bottom: 0.75rem;
  }

  .weather-presets-header,
  .weather-preset-row {
    gap: 0.5rem;
    grid-template-columns: 2rem 2rem minmax(6rem, 1fr) 5rem 4rem 4rem;
    display: grid;
    align-items: center;
    padding: 0.25rem 0;
  }

  .weather-presets-header {
    margin-bottom: 0.25rem;
    padding-bottom: 0.5rem;
    border-bottom: 0.0625rem solid var(--color-border-light-tertiary);
    color: var(--color-text-secondary);
    font-weight: 600;
    font-size: var(--font-size-13);

    span {
      text-align: center;
    }
  }

  .weather-preset-row {
    border-bottom: 0.0625rem solid var(--color-border-light-secondary);

    &:last-child {
      border-bottom: none;
    }

    .preset-color-swatch {
      width: 1.5rem;
      height: 1.5rem;
      border: 0.0625rem solid var(--color-border-light-tertiary);
      border-radius: 0.25rem;
    }

    .preset-icon-display {
      color: var(--color-text-secondary);
      text-align: center;
    }

    .preset-label {
      overflow: hidden;
      font-weight: 500;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .preset-temp-display {
      color: var(--color-text-secondary);
      font-size: var(--font-size-13);
      text-align: center;
    }

    .preset-darkness-display {
      color: var(--color-text-secondary);
      font-size: var(--font-size-13);
      text-align: center;
    }

    .preset-actions {
      gap: 0.25rem;
      display: flex;
      justify-content: flex-end;
    }

    .icon-button {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 1.75rem;
      height: 1.75rem;
      padding: 0;

      &.danger:hover {
        color: var(--color-text-light-highlight);
        background: var(--color-level-error);
      }
    }
  }

  .automation-info {
    h4 {
      margin: 0 0 0.5rem;
      font-size: var(--font-size-14);
    }

    .trigger-list {
      gap: 0.25rem 1rem;
      grid-template-columns: repeat(auto-fill, minmax(9.375rem, 1fr));
      display: grid;
      margin: 0;
      padding: 0;
      list-style: none;

      li {
        gap: 0.5rem;
        display: flex;
        align-items: center;
        color: var(--color-text-secondary);
        font-size: var(--font-size-13);

        i {
          width: 1.25em;
          color: var(--color-warm-1);
          text-align: center;
        }
      }
    }
  }

  .about-header {
    gap: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 0.75rem;
  }

  .module-info {
    gap: 0.375rem;
    display: flex;
    flex-direction: column;

    .info-row {
      gap: 0.5rem;
      display: flex;
      font-size: var(--font-size-14);

      .info-label {
        font-weight: 500;
      }

      .info-value {
        color: var(--color-text-primary);
      }
    }
  }

  .kofi-button {
    gap: 0.5rem;
    display: inline-flex;
    align-items: center;
    padding: 0.5rem 0.75rem;
    border-radius: 0.375rem;
    color: rgb(255 255 255);
    font-weight: 500;
    font-size: var(--font-size-14);
    text-decoration: none;
    white-space: nowrap;
    background: rgb(255 94 91);
    transition: background 0.15s ease;

    &:hover {
      color: rgb(255 255 255);
      background: rgb(229 69 66);
    }

    i {
      font-size: var(--font-size-14);
    }
  }

  .color-categories-grid {
    gap: 1rem;
    grid-template-columns: repeat(auto-fill, minmax(17.5rem, 1fr));
    display: grid;
  }

  .color-category {
    h4 {
      margin: 0 0 0.5rem;
      padding-bottom: 0.25rem;
      border-bottom: 0.0625rem solid var(--color-cool-4);
      font-weight: 500;
      font-size: var(--font-size-13);
    }

    .form-group.color-row {
      margin-bottom: 0.25rem;

      label {
        min-width: 7.5rem;
        font-size: var(--font-size-14);
      }
    }
  }

  .color-fields {
    gap: 0.5rem;
    display: flex;
    align-items: center;

    input[type='color'] {
      width: 2.5rem;
      height: 1.75rem;
    }

    .color-hex {
      width: 6em;
      font-size: var(--font-size-14);
      font-family: var(--font-mono);
      text-align: center;
    }

    .reset-color {
      display: flex;
      flex-shrink: 0;
      justify-content: center;
      align-items: center;
      width: 1.75rem;
      height: 1.75rem;
      padding: 0;
      border: 0.0625rem solid var(--button-border-color);
      border-radius: 0.25rem;
      background: var(--button-background-color);

      &:hover:not(:disabled) {
        background: var(--button-hover-background-color);
      }

      &:disabled {
        opacity: 0.4;
        cursor: default;
      }
    }
  }

  .custom-theme-editor {
    margin-top: 1rem;
  }

  .color-table-header {
    gap: 0.5rem;
    grid-template-columns: 6.25rem 1fr 1.75rem 5rem 2.25rem;
    display: grid;
    align-items: center;
    padding: 0.25rem 0.5rem;
    border-bottom: 0.0625rem solid var(--color-border-light-tertiary);
    font-size: var(--font-size-13);
    text-align: center;
  }

  .color-table-row {
    gap: 0.5rem;
    grid-template-columns: 6.25rem 1fr 1.75rem 5rem 2.25rem;
    display: grid;
    align-items: center;
    padding: 0.375rem 0.5rem;
    border-radius: 0.25rem;

    &:hover {
      background: var(--color-cool-4);
    }

    .col-location,
    .col-usage {
      font-size: var(--font-size-13);
    }
  }

  .color-category-section {
    margin-bottom: 1.5rem;

    h3.category-label {
      margin: 0 0 0.5rem;
      font-size: var(--font-h5-size);
    }
  }

  .col-location {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .col-usage {
    line-height: 1.3;
  }

  input.col-color {
    width: 1.75rem;
  }

  input.col-hex {
    font-size: var(--font-size-14);
    font-family: var(--font-mono);
    text-align: center;
  }

  button.col-reset {
    justify-self: center;
  }

  .component-badge {
    margin-left: 0.25rem;
    padding: 0.125rem 0.375rem;
    border-radius: 0.1875rem;
    font-size: var(--font-size-13);
  }

  /* Format Settings Tab */
  .format-location {
    border-radius: 0.25rem;

    > .form-group {
      margin-bottom: 0.5rem;

      label {
        font-weight: 500;
      }
    }
  }

  .format-row {
    gap: 1rem;
    display: flex;
    flex-wrap: wrap;
  }

  .format-column {
    gap: 0.375rem;
    display: flex;
    flex: 1;
    flex-direction: column;
    min-width: 12.5rem;

    .format-label {
      font-size: var(--font-size-13);
    }

    select {
      width: 100%;
    }

    .format-custom-input {
      width: 100%;

      &.hidden {
        display: none;
      }

      &.invalid {
        border-color: var(--calendaria-error);
        outline: 0.0625rem solid var(--calendaria-error);
      }
    }

    .format-preview {
      color: var(--calendaria-text-dim);
      font-style: italic;

      &:empty {
        display: none;
      }

      &.error {
        color: var(--calendaria-error);
      }
    }
  }

  .token-reference {
    gap: 1.5rem;
    display: flex;
    flex-wrap: wrap;

    .token-group {
      flex: 1;
      min-width: 12.5rem;

      h4 {
        margin: 0 0 0.5rem;
        font-weight: 500;
      }

      .token-grid {
        gap: 0.25rem 0.75rem;
        grid-template-columns: auto 1fr;
        display: grid;
        align-items: center;
        font-size: var(--font-size-13);

        .token-header {
          opacity: 0.7;
          padding-bottom: 0.25rem;
          border-bottom: 0.0625rem solid var(--color-border-light-tertiary);
          font-weight: 600;
          font-size: var(--font-size-13);
          text-transform: uppercase;
        }

        code {
          width: fit-content;
          padding: 0.125rem 0.375rem;
          border-radius: 0.1875rem;
          font-size: var(--font-size-13);
          white-space: nowrap;
        }

        span:not(.token-header) {
          color: var(--color-text-light-secondary);
        }
      }
    }
  }

  /* Permissions Tab */
  .permissions-table {
    gap: 0.5rem 1rem;
    grid-template-columns: 1fr 4.5rem 4.5rem 4.5rem;
    display: grid;
    align-items: center;
  }

  .permissions-header {
    display: contents;

    span {
      padding: 0.25rem 0;
      color: var(--color-text-dark-secondary);
      font-weight: 500;
      font-size: var(--font-size-13);
      text-align: center;
    }

    span:first-child {
      text-align: left;
    }

    &::after {
      grid-column: 1 / -1;
      margin-bottom: 0.25rem;
      border-bottom: 0.0625rem solid var(--color-border-light-tertiary);
      content: '';
    }
  }

  .permissions-list {
    display: contents;
    margin: 0;
    padding: 0;
    list-style: none;
  }

  .permission-row {
    display: contents;

    label.permission-name {
      padding: 0.25rem 0;
      color: var(--color-text-dark-secondary);
      font-weight: 500;
      font-size: var(--font-size-14);
    }

    input[type='checkbox'] {
      justify-self: center;
    }

    .hint {
      grid-column: 1 / -1;
      padding-bottom: 0.5rem;
      border-bottom: 0.0625rem solid var(--color-border-light-tertiary);
    }

    &:last-child .hint {
      padding-bottom: 0;
      border-bottom: none;
    }
  }
}

/* Settings Search Dropdown (appended to body) */
.calendaria-search-results {
  display: flex;
  z-index: 10000;
  position: fixed;
  flex-direction: column;
  max-height: 30rem;
  border-radius: 0.25rem;
  overflow: hidden auto;
  background: var(--color-cool-5);
  box-shadow: 0 0.25rem 0.75rem rgb(0 0 0 / 20%);

  .search-result {
    gap: 0.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.5rem;
    border: none;
    border-bottom: 0.0625rem solid var(--color-cool-4);
    color: var(--color-text-light-highlight);
    text-align: left;
    cursor: pointer;
    background: transparent;

    &:last-child {
      border-bottom: none;
    }

    &:hover {
      color: var(--color-text-light-highlight);
      background: var(--color-cool-4);
    }

    .result-label {
      flex: 1;
      overflow: hidden;
      font-size: var(--font-size-12);
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .result-tab {
      flex-shrink: 0;
      color: var(--color-text-dark-secondary);
      font-size: var(--font-size-10);
    }
  }

  .no-results {
    padding: 0.75rem;
    color: var(--color-text-dark-secondary);
    font-style: italic;
    font-size: var(--font-size-12);
    text-align: center;
  }
}

/* Calendar Editor - Light Theme */
.theme-light .calendar-editor {
  footer.form-footer {
    border-top-color: var(--color-border-light-tertiary);
    background: var(--color-light-2);
  }

  .warning {
    color: var(--color-level-error);
  }

  .item {
    border-color: var(--color-border-light-tertiary);
    background: none;
  }

  .empty-list {
    color: unset;
    background: unset;
  }
}

/* Settings Search Dropdown - Light Theme */
.theme-light .calendaria-search-results {
  border: 0.0625rem solid var(--color-border-light-tertiary);
  background: var(--color-light-2);

  .search-result {
    border-bottom-color: var(--color-border-light-tertiary);
    color: var(--color-text-dark-primary);

    &:hover {
      color: var(--color-text-dark-primary);
      background: rgb(0 0 0 / 8%);
    }

    .result-tab {
      color: var(--color-text-dark-5);
    }
  }

  .no-results {
    color: var(--color-text-dark-5);
  }
}

/* Settings Panel - Light Theme */
.theme-light .settings-panel {
  .settings-footer {
    border-top-color: var(--color-border-light-tertiary);
    background: var(--color-light-2);

    .save-indicator {
      color: rgb(21 128 61);

      &[data-state='saving'] {
        color: var(--color-warm-2);
      }
    }

    .version-link {
      color: var(--color-text-dark-5);

      &:hover {
        color: var(--color-text-dark-primary);
      }
    }
  }

  .recent-settings .recent-item:hover {
    background: rgb(0 0 0 / 8%);
  }

  .format-preview {
    color: var(--color-text-dark-5);
  }
}

/* -------------------------------------------- */
/*  Token Reference Dialog                      */
/* -------------------------------------------- */

.token-reference-dialog {
  .token-reference-content {
    gap: 1rem;
    display: flex;
    flex-direction: column;
    height: 100%;
    overflow-y: auto;
  }

  .context-hint {
    opacity: 0.8;
    margin: 0 0 0.5rem;
    font-style: italic;
    font-size: var(--font-size-12);
  }

  .token-groups {
    gap: 0.75rem;
    display: flex;
    flex: 1;
    flex-direction: column;
    overflow-y: auto;
  }

  .token-group {
    h3.group-header {
      margin: 0 0 0.375rem;
      padding-bottom: 0.25rem;
      border-bottom: 0.0625rem solid var(--color-border-light-tertiary);
      font-size: var(--font-size-h4);
    }

    .token-list {
      gap: 0.125rem;
      display: flex;
      flex-direction: column;
    }

    .token-item {
      gap: 0.75rem;
      display: flex;
      opacity: 0.5;
      align-items: baseline;
      padding: 0.25rem 0.5rem;
      border-radius: 0.1875rem;
      font-size: var(--font-size-12);

      &.highlighted {
        opacity: 1;
      }

      &:hover {
        opacity: 1;
      }

      .token-code {
        flex-shrink: 0;
        min-width: 5rem;
        padding: 0.125rem 0.375rem;
        border: 0.0625rem solid var(--color-border-light-tertiary);
        border-radius: 0.1875rem;
        font-size: var(--font-size-11);
        font-family: var(--font-mono);
      }

      .token-description {
        opacity: 0.8;
      }

      &.highlighted .token-description {
        opacity: 1;
      }
    }
  }

  .token-syntax-help {
    padding: 0.75rem;
    border: 0.0625rem solid var(--color-border-light-tertiary);
    border-radius: 0.25rem;
    font-size: var(--font-size-12);

    h3 {
      margin: 0 0 0.375rem;
      font-size: var(--font-size-h4);
    }

    p {
      opacity: 0.8;
      margin: 0 0 0.5rem;
    }

    .syntax-examples {
      margin: 0;
      padding-left: 1.25rem;

      li {
        margin-bottom: 0.25rem;
      }

      code {
        padding: 0.125rem 0.25rem;
        border: 0.0625rem solid var(--color-border-light-tertiary);
        border-radius: 0.125rem;
        font-size: var(--font-size-11);
      }
    }
  }
}

/* -------------------------------------------- */
/*  Computed Event Builder                      */
/* -------------------------------------------- */

.computed-event-builder {
  .computed-builder-content {
    gap: 1rem;
    display: flex;
    flex-direction: column;
    padding: 0.5rem;
  }

  .computed-help {
    margin: 0;
    padding: 0.75rem;
    border-radius: 0.25rem;
    color: var(--color-warm-2);
    font-size: var(--font-size-12);
    background: var(--color-cool-5-25);
  }

  fieldset {
    margin: 0;
    padding: 0.75rem;
    border: 0.0625rem solid var(--color-border-light-tertiary);
    border-radius: 0.25rem;

    legend {
      padding: 0 0.5rem;
      font-weight: 600;
    }
  }

  .chain-step {
    margin-bottom: 0.75rem;
    padding: 0.75rem;
    border: 0.0625rem solid var(--color-border-light-secondary);
    border-radius: 0.25rem;
    background: var(--color-cool-5-10);

    &:last-of-type {
      margin-bottom: 0;
    }
  }

  .step-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 0.0625rem solid var(--color-border-light-secondary);
  }

  .step-label {
    font-weight: 600;
    font-size: var(--font-size-12);
  }

  .remove-step,
  .remove-override {
    padding: 0.25rem 0.5rem;
    border: none;
    border-radius: 0.1875rem;
    color: var(--color-level-error);
    font-size: var(--font-size-11);
    cursor: pointer;
    background: transparent;

    &:hover {
      background: var(--color-level-error-bg);
    }
  }

  .step-content {
    gap: 0.5rem;
    display: flex;
    flex-direction: column;
  }

  .form-group {
    gap: 0.5rem;
    display: flex;
    align-items: center;

    label {
      min-width: 5rem;
      font-size: var(--font-size-12);
    }

    select,
    input {
      flex: 1;
      padding: 0.375rem;
      border: 0.0625rem solid var(--color-border-light-tertiary);
      border-radius: 0.1875rem;
      font-size: var(--font-size-12);
    }

    input[type='number'] {
      max-width: 5rem;
    }
  }

  .add-step,
  .add-override {
    gap: 0.5rem;
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 0.5rem;
    padding: 0.5rem;
    border: 0.0625rem dashed var(--color-border-light-tertiary);
    border-radius: 0.25rem;
    color: var(--color-text-secondary);
    font-size: var(--font-size-12);
    cursor: pointer;
    background: transparent;
    transition:
      border-color 0.15s ease,
      color 0.15s ease,
      background 0.15s ease;

    &:hover {
      border-color: var(--color-border-highlight);
      color: var(--color-text-primary);
      background: var(--color-cool-5-10);
    }
  }

  .overrides-section {
    .hint {
      margin: 0 0 0.75rem;
      color: var(--color-text-secondary);
      font-size: var(--font-size-11);
    }
  }

  .override-row {
    gap: 0.5rem;
    display: flex;
    align-items: center;
    margin-bottom: 0.5rem;

    .override-year {
      min-width: 3.75rem;
      font-weight: 600;
    }

    select {
      flex: 1;
      padding: 0.375rem;
      border: 0.0625rem solid var(--color-border-light-tertiary);
      border-radius: 0.1875rem;
      font-size: var(--font-size-12);
    }

    input[type='number'] {
      width: 3.75rem;
      padding: 0.375rem;
      border: 0.0625rem solid var(--color-border-light-tertiary);
      border-radius: 0.1875rem;
      font-size: var(--font-size-12);
    }
  }

  .form-footer {
    display: flex;
    justify-content: flex-end;
    padding-top: 0.5rem;
    border-top: 0.0625rem solid var(--color-border-light-tertiary);

    button {
      gap: 0.5rem;
      display: flex;
      align-items: center;
      padding: 0.5rem 1rem;
      border: 0.0625rem solid var(--button-border-color);
      border-radius: 0.25rem;
      font-size: var(--font-size-12);
      cursor: pointer;
      background: var(--button-background-color);

      &:hover {
        background: var(--button-hover-background-color);
      }
    }
  }
}

/* ======================================== */
/* Set Date Dialog                          */
/* ======================================== */

.set-date-dialog .timepoints-section {
  border: 0.0625rem solid var(--color-border-light-tertiary);
  border-radius: 0.25rem;

  .timepoints-header {
    gap: 0.5rem;
    display: flex;
    align-items: center;
    padding: 0.5rem 0.75rem;
    cursor: pointer;
    user-select: none;

    i {
      width: 0.75rem;
      font-size: var(--font-size-13);
    }

    h3 {
      flex: 1;
      margin: 0;
      font-size: var(--font-size-13);
    }

    .timepoints-count {
      padding: 0.125rem 0.5rem;
      border-radius: 0.625rem;
      font-size: var(--font-size-13);
    }
  }

  .timepoints-content {
    padding: 0.5rem;
    border-top: 0.0625rem solid var(--color-border-light-tertiary);
  }

  .timepoints-list {
    max-height: 11.25rem;
    margin: 0 0 0.5rem;
    padding: 0;
    overflow-y: auto;
    list-style: none;
  }

  .timepoint-row {
    gap: 0.5rem;
    display: flex;
    align-items: center;
    padding: 0.375rem 0.5rem;
    border-radius: 0.25rem;

    .timepoint-info {
      flex: 1;
      min-width: 0;
      cursor: pointer;

      .timepoint-name {
        display: block;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .timepoint-date {
        display: block;
        opacity: 0.7;
        font-size: var(--font-size-11);
      }
    }

    .timepoint-name-input {
      flex: 1;
    }

    .timepoint-actions {
      gap: 0.25rem;
      display: flex;
    }

    .timepoint-btn {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 1.75rem;
      height: 1.75rem;
      padding: 0;
      cursor: pointer;

      &.delete:hover {
        color: var(--color-level-error);
      }
    }
  }

  .no-timepoints {
    opacity: 0.7;
    margin: 0;
    padding: 1rem;
    font-size: var(--font-size-12);
    text-align: center;
  }

  .save-timepoint-btn {
    gap: 0.5rem;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    padding: 0.5rem;
    border: 0.0625rem dashed var(--color-border-light-tertiary);
    border-radius: 0.25rem;
    font-size: var(--font-size-12);
    cursor: pointer;
    background: transparent;

    &:hover {
      border-color: var(--color-warm-1);
      color: var(--color-warm-1);
    }
  }
}

/* ======================================== */
/* Date Picker Dialog                       */
/* ======================================== */

.dialog-date-picker {
  .form-grid {
    gap: 0.75rem;
    grid-template-columns: 1fr 1fr 1fr;
    display: grid;
  }

  .form-group {
    gap: 0.25rem;
    display: flex;
    flex-direction: column;

    > label {
      color: var(--calendaria-text-dim);
      font-weight: 500;
      font-size: var(--font-size-11);
    }

    input:not([type='checkbox']),
    select {
      box-sizing: border-box;
      height: 1.875rem;
      padding: 0 0.5rem;
      border: 0.0625rem solid var(--calendaria-input-border);
      border-radius: 0.25rem;
      color: var(--calendaria-text);
      font-size: var(--font-size-13);
      line-height: 1.75rem;
      text-align: center;
      background: var(--calendaria-input-bg);

      &:focus {
        border-color: var(--calendaria-primary);
        outline: none;
      }
    }

    select {
      appearance: none;
      padding-right: 1.5rem;
      cursor: pointer;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12'%3E%3Cpath fill='%23999' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 0.5rem center;
      background-size: 0.625rem;
    }

    input[type='number'] {
      -moz-appearance: textfield;
      appearance: textfield;

      &::-webkit-outer-spin-button,
      &::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
    }
  }
}

/* ======================================== */
/* Journal Sidebar Footer                   */
/* ======================================== */

.directory-footer.calendaria-footer {
  gap: 0.125rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  border-top: 0.0625rem solid var(--color-border-light-tertiary);

  .calendaria-footer-buttons {
    gap: 0.25rem;
    display: flex;
  }

  i {
    font-size: var(--font-size-10);
  }
}

/* ======================================== */
/* Reset Section Dialog List                */
/* ======================================== */

.reset-section-list {
  margin: 0.5rem 0 0 1.5rem;
  padding: 0;
  list-style-type: disc;
  color: var(--color-text-secondary);
  font-size: var(--font-size-13);

  li {
    margin-bottom: 0.25rem;
  }
}
