

    <div class="editor-main">
        
        {{#if (eq activeTab 'general')}}
        <div class="tab-content">
            <div class="editor-card">
                <h2>General Information</h2>
                <div class="grid-2">
                    <div class="input-group"><label>Name</label><input type="text" name="name" value="{{config.name}}"></div>
                    <div class="input-group"><label>Unique ID</label><input type="text" name="id" value="{{config.id}}"></div>
                </div>
                <div class="input-group"><label>Description</label><input type="text" name="description" value="{{config.description}}"></div>
            </div>
        </div>
        {{/if}}

        {{#if (eq activeTab 'mechanics')}}
        <div class="tab-content">
            <div class="editor-card">
                <h2>Mechanics</h2>
                <div class="grid-4">
                    <div class="input-group"><label>Hrs/Day</label><input type="number" name="days.hoursPerDay" value="{{config.days.hoursPerDay}}"></div>
                    <div class="input-group"><label>Min/Hr</label><input type="number" name="days.minutesPerHour" value="{{config.days.minutesPerHour}}"></div>
                    <div class="input-group"><label>Sec/Min</label><input type="number" name="days.secondsPerMinute" value="{{config.days.secondsPerMinute}}"></div>
                    <div class="input-group"><label>Year 0</label><input type="number" name="years.yearZero" value="{{config.years.yearZero}}"></div>
                </div>
                <div class="grid-4" style="margin-top:10px;">
                    <div class="input-group"><label>Leap Int.</label><input type="number" name="years.leapYear.leapInterval" value="{{config.years.leapYear.leapInterval}}"></div>
                    <div class="input-group"><label>Leap Start</label><input type="number" name="years.leapYear.leapStart" value="{{config.years.leapYear.leapStart}}"></div>
                    <div class="input-group"><label>1st WkDay</label><input type="number" name="years.firstWeekday" value="{{config.years.firstWeekday}}"></div>
                    <div class="input-group" style="display:flex; align-items:center;">
                        <label style="margin-right:5px;">Fixed Cal</label>
                        <input type="checkbox" name="years.resetWeekdays" {{#if config.years.resetWeekdays}}checked{{/if}}>
                    </div>
                </div>
                <div style="margin-top:10px; padding:5px; background:rgba(0,0,0,0.05); border-radius:4px;">
                    <label style="font-weight:bold;">Calculated Days / Year: </label>
                    <span>{{config.days.daysPerYear}}</span>
                </div>
            </div>
        </div>
        {{/if}}

        {{#if (eq activeTab 'months')}}
        <div class="tab-content">
            <div class="editor-card">
                <h2>Months <button type="button" data-action="addMonth" class="btn-sm"><i class="fas fa-plus"></i> Add</button></h2>
                <table>
                    <thead><tr><th style="width:40px;">Ord</th><th>Name</th><th>Abbr</th><th style="width:60px;">Days</th><th style="width:30px;">Int</th><th style="width:60px;">Leap</th><th></th></tr></thead>
                    <tbody>
                        {{#each months}}
                        <tr>
                            <td><input type="number" name="months.values.{{index}}.ordinal" value="{{ordinal}}"></td>
                            <td><input type="text" name="months.values.{{index}}.name" value="{{name}}"></td>
                            <td><input type="text" name="months.values.{{index}}.abbreviation" value="{{abbreviation}}"></td>
                            <td><input type="number" name="months.values.{{index}}.days" value="{{days}}"></td>
                            <td style="text-align:center;"><input type="checkbox" name="months.values.{{index}}.intercalary" {{#if intercalary}}checked{{/if}}></td>
                            <td><input type="number" name="months.values.{{index}}.leapDays" value="{{leapDays}}"></td>
                            <td><a data-action="removeMonth" data-index="{{index}}" style="color:red;"><i class="fas fa-trash"></i></a></td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>
        </div>
        {{/if}}

        {{#if (eq activeTab 'weekdays')}}
        <div class="tab-content">
            <div class="editor-card">
                <h2>Weekdays <button type="button" data-action="addDay" class="btn-sm"><i class="fas fa-plus"></i> Add</button></h2>
                <table>
                    <thead><tr><th>Ord</th><th>Name</th><th>Abbr</th><th></th></tr></thead>
                    <tbody>
                        {{#each days}}
                        <tr>
                            <td style="width:40px;"><input type="number" name="days.values.{{index}}.ordinal" value="{{ordinal}}"></td>
                            <td><input type="text" name="days.values.{{index}}.name" value="{{name}}"></td>
                            <td><input type="text" name="days.values.{{index}}.abbreviation" value="{{abbreviation}}"></td>
                            <td style="width:30px;"><a data-action="removeDay" data-index="{{index}}" style="color:red;"><i class="fas fa-trash"></i></a></td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>
        </div>
        {{/if}}

        {{#if (eq activeTab 'events')}}
        <div class="tab-content">
            <div class="editor-card">
                <h2>Events & Holidays <button type="button" data-action="addNote" class="btn-sm"><i class="fas fa-plus"></i> Add</button></h2>
                {{#each notes}}
                <div style="border:1px solid #ccc; padding:5px; margin-bottom:5px;">
                    <input type="hidden" name="notes.{{index}}.isPreset" value="{{isPreset}}">
                    
                    <div style="display:flex; gap:5px; margin-bottom:5px; align-items:center;">
                        <input type="text" name="notes.{{index}}.title" value="{{title}}" placeholder="Title" style="font-weight:bold; flex:1;">
                        
                        <div style="display:flex; align-items:center; gap:5px; margin-right:5px;" title="Visible to Players?">
                            <label style="font-size:0.8em; white-space:nowrap;">Visible</label>
                            <input type="checkbox" name="notes.{{index}}.playerVisible" {{#if playerVisible}}checked{{/if}}>
                        </div>

                        <a data-action="removeNote" data-index="{{index}}" style="color:red;"><i class="fas fa-trash"></i></a>
                    </div>
                    <div class="grid-4">
                        <select name="notes.{{index}}.date.month">
                            {{#each ../uniqueMonthOrdinals}}
                            <option value="{{ordinal}}" {{#if (eq ordinal ../date.month)}}selected{{/if}}>{{displayName}}</option>
                            {{/each}}
                        </select>
                        <input type="number" name="notes.{{index}}.date.day" value="{{date.day}}" placeholder="Day Idx">
                        <input type="number" name="notes.{{index}}.date.year" value="{{date.year}}" placeholder="Year">
                        <select name="notes.{{index}}.repeatUnit">
                            <option value="none" {{#if (eq repeatUnit 'none')}}selected{{/if}}>Once</option>
                            <option value="years" {{#if (eq repeatUnit 'years')}}selected{{/if}}>Yearly</option>
                            <option value="months" {{#if (eq repeatUnit 'months')}}selected{{/if}}>Monthly</option>
                        </select>
                    </div>
                    <div style="margin-top:5px; display:flex; gap:5px;">
                         <div style="flex:1;">
                            <input type="text" name="notes.{{index}}.icon" value="{{icon}}" placeholder="Icon Class (fas fa-star)">
                         </div>
                    </div>
                    <textarea name="notes.{{index}}.content" rows="1" style="width:100%; margin-top:5px;" placeholder="Description">{{content}}</textarea>
                </div>
                {{/each}}
                {{#unless notes.length}}
                <p style="color:#777; font-style:italic;">No events added.</p>
                {{/unless}}
            </div>
        </div>
        {{/if}}

        {{#if (eq activeTab 'seasons')}}
        <div class="tab-content">
            <div class="editor-card">
                <h2>Seasons <button type="button" data-action="addSeason" class="btn-sm"><i class="fas fa-plus"></i> Add</button></h2>
                
                <div class="timeline-container">
                    {{#each months}}<div class="timeline-segment {{seasonClass}}">{{abbreviation}}</div>{{/each}}
                </div>
                {{#if seasonErrors.length}}<div class="error-box">Overlap Detected in Seasons!</div>{{/if}}

                {{#each seasons}}
                <div style="border:1px solid #ccc; padding:5px; margin-bottom:5px; border-radius:4px;" class="{{#if isOverlapping}}error-border{{/if}}">
                    <div style="display:flex; justify-content:space-between; margin-bottom: 5px;">
                        <div style="display:flex; gap: 5px; align-items:center;">
                            <input type="checkbox" name="seasons.values.{{index}}.included" {{#if included}}checked{{/if}} title="Include in Export">
                            <strong>Season {{index}}</strong>
                        </div>
                        <a data-action="removeSeason" data-index="{{index}}" style="color:red;"><i class="fas fa-trash"></i></a>
                    </div>
                    <div class="grid-2">
                         <input type="text" name="seasons.values.{{index}}.name" value="{{name}}" placeholder="Season Name" {{#unless included}}disabled{{/unless}}>
                         <div style="display:flex; gap:5px;">
                            <select name="seasons.values.{{index}}.monthStart" {{#unless included}}disabled{{/unless}}>
                                {{#each ../uniqueMonthOrdinals}}
                                <option value="{{ordinal}}" {{#if (eq ordinal ../monthStart)}}selected{{/if}}>{{displayName}}</option>
                                {{/each}}
                            </select>
                            <span style="align-self:center;">to</span>
                            <select name="seasons.values.{{index}}.monthEnd" {{#unless included}}disabled{{/unless}}>
                                {{#each ../uniqueMonthOrdinals}}
                                <option value="{{ordinal}}" {{#if (eq ordinal ../monthEnd)}}selected{{/if}}>{{displayName}}</option>
                                {{/each}}
                            </select>
                         </div>
                    </div>
                </div>
                {{/each}}
            </div>
        </div>
        {{/if}}

        {{#if (eq activeTab 'sun')}}
        <div class="tab-content">
            <div class="editor-card">
                <h2>Sun / Lighting <button type="button" data-action="addSun" class="btn-sm"><i class="fas fa-plus"></i> Add</button></h2>
                
                <div class="timeline-container">
                    {{#each months}}<div class="timeline-segment {{sunClass}}">{{abbreviation}}</div>{{/each}}
                </div>
                {{#if sunErrors.length}}<div class="error-box">Overlap Detected in Sun Config!</div>{{/if}}

                <table>
                    <thead><tr><th style="width:30px;">Use</th><th>Start</th><th>End</th><th style="width:70px;">Dawn</th><th style="width:70px;">Dusk</th><th style="width:30px;"></th></tr></thead>
                    <tbody>
                        {{#each sun}}
                        <tr class="{{#if isOverlapping}}error-border{{/if}}">
                            <td><input type="checkbox" name="sun.values.{{index}}.included" {{#if included}}checked{{/if}}></td>
                            <td>
                                <select name="sun.values.{{index}}.monthStart" {{#unless included}}disabled{{/unless}}>
                                    {{#each ../uniqueMonthOrdinals}}
                                    <option value="{{ordinal}}" {{#if (eq ordinal ../monthStart)}}selected{{/if}}>{{displayName}}</option>
                                    {{/each}}
                                </select>
                            </td>
                            <td>
                                <select name="sun.values.{{index}}.monthEnd" {{#unless included}}disabled{{/unless}}>
                                    {{#each ../uniqueMonthOrdinals}}
                                    <option value="{{ordinal}}" {{#if (eq ordinal ../monthEnd)}}selected{{/if}}>{{displayName}}</option>
                                    {{/each}}
                                </select>
                            </td>
                            <td><input type="number" name="sun.values.{{index}}.dawn" value="{{dawn}}" {{#unless included}}disabled{{/unless}}></td>
                            <td><input type="number" name="sun.values.{{index}}.dusk" value="{{dusk}}" {{#unless included}}disabled{{/unless}}></td>
                            <td><a data-action="removeSun" data-index="{{index}}" style="color:red;"><i class="fas fa-trash"></i></a></td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>
        </div>
        {{/if}}

        {{#if (eq activeTab 'weather')}}
        <div class="tab-content">
            <div class="editor-card">
                <h2>Weather <button type="button" data-action="addWeather" class="btn-sm"><i class="fas fa-plus"></i> Add</button></h2>
                
                <div class="timeline-container">
                    {{#each months}}<div class="timeline-segment {{weatherClass}}">{{abbreviation}}</div>{{/each}}
                </div>
                {{#if weatherErrors.length}}<div class="error-box">Overlap Detected in Weather!</div>{{/if}}

                <table>
                    <thead><tr><th>Use</th><th>Type</th><th>Start</th><th>End</th><th>Off.</th><th></th></tr></thead>
                    <tbody>
                        {{#each weather}}
                        <tr class="{{#if isOverlapping}}error-border{{/if}}">
                            <td><input type="checkbox" name="weather.values.{{index}}.included" {{#if included}}checked{{/if}}></td>
                            <td>
                                <select name="weather.values.{{index}}.name" {{#unless included}}disabled{{/unless}}>
                                    {{#each ../weatherTypes}}
                                    <option value="{{this}}" {{#if (eq this ../name)}}selected{{/if}}>{{this}}</option>
                                    {{/each}}
                                </select>
                            </td>
                            <td>
                                <select name="weather.values.{{index}}.monthStart" {{#unless included}}disabled{{/unless}}>
                                    {{#each ../uniqueMonthOrdinals}}
                                    <option value="{{ordinal}}" {{#if (eq ordinal ../monthStart)}}selected{{/if}}>{{displayName}}</option>
                                    {{/each}}
                                </select>
                            </td>
                            <td>
                                <select name="weather.values.{{index}}.monthEnd" {{#unless included}}disabled{{/unless}}>
                                    {{#each ../uniqueMonthOrdinals}}
                                    <option value="{{ordinal}}" {{#if (eq ordinal ../monthEnd)}}selected{{/if}}>{{displayName}}</option>
                                    {{/each}}
                                </select>
                            </td>
                            <td><input type="number" name="weather.values.{{index}}.tempOffset" value="{{tempOffset}}" {{#unless included}}disabled{{/unless}}></td>
                            <td><a data-action="removeWeather" data-index="{{index}}" style="color:red;"><i class="fas fa-trash"></i></a></td>
                        </tr>
                        {{#if isOverlapping}}
                        <tr><td colspan="6" style="color:red; font-size:0.8em;">Overlaps with another entry!</td></tr>
                        {{/if}}
                        {{/each}}
                    </tbody>
                </table>
            </div>
        </div>
        {{/if}}

        {{#if (eq activeTab 'moons')}}
        <div class="tab-content">
            <div class="editor-card">
                <h2>Moons <button type="button" data-action="addMoon" class="btn-sm"><i class="fas fa-plus"></i> Add</button></h2>
                {{#each moons}}
                <div style="border:1px solid #aaa; padding:10px; margin-bottom:10px; border-radius:4px;">
                     <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                        <input type="text" name="moons.values.{{index}}.name" value="{{name}}" style="font-weight:bold; width:50%;" placeholder="Moon Name">
                        <a data-action="removeMoon" data-index="{{index}}" style="color:red;"><i class="fas fa-trash"></i> Remove Moon</a>
                    </div>
                    <div class="grid-3">
                        <div class="input-group"><label>Cycle (Days)</label><input type="number" step="0.01" name="moons.values.{{index}}.cycleLength" value="{{cycleLength}}"></div>
                        <div class="input-group"><label>Offset</label><input type="number" name="moons.values.{{index}}.offset" value="{{offset}}"></div>
                        <div class="input-group"><label>Color</label><input type="color" name="moons.values.{{index}}.color" value="{{color}}" style="height:30px; width:100%;"></div>
                    </div>
                     <div class="input-group" style="margin-top:5px;">
                        <label>First New Moon (Year / Month / Day)</label>
                        <div style="display:flex; gap:5px;">
                            <input type="number" name="moons.values.{{index}}.firstNewMoon.year" value="{{firstNewMoon.year}}">
                            <input type="number" name="moons.values.{{index}}.firstNewMoon.month" value="{{firstNewMoon.month}}">
                            <input type="number" name="moons.values.{{index}}.firstNewMoon.day" value="{{firstNewMoon.day}}">
                        </div>
                    </div>
                    
                    <div style="margin-top:5px; border-top:1px solid #ddd; padding-top:5px;">
                        <label>Phases</label>
                        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:5px;">
                        {{#each phases as |phase pIndex|}}
                            <div style="border:1px solid #eee; padding:2px; display:flex; gap:5px; align-items:center;">
                                 <input type="hidden" name="moons.values.{{../index}}.phases.{{pIndex}}.name" value="{{phase.name}}">
                                 <input type="hidden" name="moons.values.{{../index}}.phases.{{pIndex}}.icon" value="{{phase.icon}}">

                                 <input type="checkbox" name="moons.values.{{../index}}.phases.{{pIndex}}.included" {{#if phase.included}}checked{{/if}}>
                                 <span style="font-size:0.8em; flex:0.4;">{{phase.name}}</span>
                                 
                                 <input type="text" name="moons.values.{{../index}}.phases.{{pIndex}}.display" value="{{phase.display}}" placeholder="Display Name" style="flex:1;" {{#unless phase.included}}disabled{{/unless}}>
                                 <input type="number" step="0.1" name="moons.values.{{../index}}.phases.{{pIndex}}.length" value="{{phase.length}}" style="width:50px;" {{#unless phase.included}}disabled{{/unless}}>
                            </div>
                        {{/each}}
                        </div>
                    </div>
                </div>
                {{/each}}
            </div>
        </div>
        {{/if}}

</div>